import{f as Gr,s as Ur}from"./chunk-HKRZFNQ7.js";import{a as jr}from"./chunk-77SZ5CWY.js";import{Ab as Fr,Bb as Ce,Fa as tt,Gb as Lr,Ib as Nr,Ja as Es,Jb as Ut,K as ii,Ka as $,Kb as Ee,L as Ae,M as vt,Mb as Rs,N as si,P as te,Pa as de,Qa as ri,Ra as kt,S as Pt,Sa as Gt,Ta as ai,Va as Ir,Wb as Vr,X as ni,Y as Ct,Yb as Br,Z as Et,_ as Mr,_b as Hr,ab as Dt,cb as jt,da as he,eb as Rr,f as Tr,ha as Cs,i as It,ia as we,ib as L,jb as B,kb as ct,n as Rt,nb as Ss,pb as ht,qb as oi,rb as xs,sb as Ts,t as ei,tb as Ms,ub as Pr,vb as j,w as Ht,wb as Is,xb as kr,yb as Dr,zb as Or}from"./chunk-DDA2IPGD.js";import{a as X,b as nt,f as Zt,g as w}from"./chunk-RA2WU32H.js";var Re={};Re.d=(r,t)=>{for(var e in t)Re.o(t,e)&&!Re.o(r,e)&&Object.defineProperty(r,e,{enumerable:!0,get:t[e]})};Re.o=(r,t)=>Object.prototype.hasOwnProperty.call(r,t);var P=globalThis.pdfjsLib={};Re.d(P,{AbortException:()=>Lt,AnnotationEditorLayer:()=>ol,AnnotationEditorParamsType:()=>N,AnnotationEditorType:()=>k,AnnotationEditorUIManager:()=>Le,AnnotationLayer:()=>Wn,AnnotationMode:()=>$t,ColorPicker:()=>Gi,DOMSVGFactory:()=>Ge,DrawLayer:()=>er,FeatureTest:()=>rt,GlobalWorkerOptions:()=>ie,ImageKind:()=>fi,InvalidPDFException:()=>ke,MissingPDFException:()=>se,OPS:()=>St,OutputScale:()=>Fe,PDFDataRangeTransport:()=>Ii,PDFDateString:()=>mi,PDFWorker:()=>pe,PasswordResponses:()=>go,PermissionFlag:()=>po,PixelsPerInch:()=>Wt,RenderingCancelledException:()=>Oe,TextLayer:()=>Be,TouchManager:()=>_i,UnexpectedResponseException:()=>ge,Util:()=>T,VerbosityLevel:()=>$i,XfaLayer:()=>ki,build:()=>nl,createValidAbsoluteUrl:()=>yo,fetchData:()=>Xi,getDocument:()=>tl,getFilenameFromUrl:()=>To,getPdfFilenameFromUrl:()=>Mo,getXfaPageViewport:()=>Io,isDataScheme:()=>Yi,isPdfFile:()=>nr,noContextMenu:()=>xt,normalizeUnicode:()=>Eo,setLayerDimensions:()=>ne,shadow:()=>O,stopEvent:()=>mt,version:()=>sl});var lt=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),ra=[1,0,0,1,0,0],Ls=[.001,0,0,.001,0,0],ho=1e7,ui=1.35,uo=.35,Ac=uo/ui,gt={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},$t={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},fo="pdfjs_internal_editor_",k={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},N={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35,DRAW_STEP:41},po={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},at={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},fi={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},et={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};var Se={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};var $i={ERRORS:0,WARNINGS:1,INFOS:5},St={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93},go={NEED_PASSWORD:1,INCORRECT_PASSWORD:2},zi=$i.WARNINGS;function mo(r){Number.isInteger(r)&&(zi=r)}function bo(){return zi}function Wi(r){zi>=$i.INFOS&&console.log(`Info: ${r}`)}function D(r){zi>=$i.WARNINGS&&console.log(`Warning: ${r}`)}function G(r){throw new Error(r)}function Q(r,t){r||G(t)}function _o(r){switch(r?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function yo(r,t=null,e=null){if(!r)return null;try{if(e&&typeof r=="string"&&(e.addDefaultProtocol&&r.startsWith("www.")&&r.match(/\./g)?.length>=2&&(r=`http://${r}`),e.tryConvertEncoding))try{r=Co(r)}catch{}let i=t?new URL(r,t):new URL(r);if(_o(i))return i}catch{}return null}function O(r,t,e,i=!1){return Object.defineProperty(r,t,{value:e,enumerable:!i,configurable:!0,writable:!1}),e}var qt=function(){function t(e,i){this.message=e,this.name=i}return t.prototype=new Error,t.constructor=t,t}(),pi=class extends qt{constructor(t,e){super(t,"PasswordException"),this.code=e}},Pe=class extends qt{constructor(t,e){super(t,"UnknownErrorException"),this.details=e}},ke=class extends qt{constructor(t){super(t,"InvalidPDFException")}},se=class extends qt{constructor(t){super(t,"MissingPDFException")}},ge=class extends qt{constructor(t,e){super(t,"UnexpectedResponseException"),this.status=e}},Ns=class extends qt{constructor(t){super(t,"FormatError")}},Lt=class extends qt{constructor(t){super(t,"AbortException")}};function aa(r){(typeof r!="object"||r?.length===void 0)&&G("Invalid argument for bytesToString");let t=r.length,e=8192;if(t<e)return String.fromCharCode.apply(null,r);let i=[];for(let s=0;s<t;s+=e){let n=Math.min(s+e,t),a=r.subarray(s,n);i.push(String.fromCharCode.apply(null,a))}return i.join("")}function qi(r){typeof r!="string"&&G("Invalid argument for stringToBytes");let t=r.length,e=new Uint8Array(t);for(let i=0;i<t;++i)e[i]=r.charCodeAt(i)&255;return e}function vo(r){return String.fromCharCode(r>>24&255,r>>16&255,r>>8&255,r&255)}function ir(r){let t=Object.create(null);for(let[e,i]of r)t[e]=i;return t}function Ao(){let r=new Uint8Array(4);return r[0]=1,new Uint32Array(r.buffer,0,1)[0]===1}function wo(){try{return new Function(""),!0}catch{return!1}}var rt=class{static get isLittleEndian(){return O(this,"isLittleEndian",Ao())}static get isEvalSupported(){return O(this,"isEvalSupported",wo())}static get isOffscreenCanvasSupported(){return O(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return O(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){return typeof navigator<"u"&&typeof navigator?.platform=="string"?O(this,"platform",{isMac:navigator.platform.includes("Mac"),isWindows:navigator.platform.includes("Win"),isFirefox:typeof navigator?.userAgent=="string"&&navigator.userAgent.includes("Firefox")}):O(this,"platform",{isMac:!1,isWindows:!1,isFirefox:!1})}static get isCSSRoundSupported(){return O(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}},Ps=Array.from(Array(256).keys(),r=>r.toString(16).padStart(2,"0")),T=class{static makeHexColor(t,e,i){return`#${Ps[t]}${Ps[e]}${Ps[i]}`}static scaleMinMax(t,e){let i;t[0]?(t[0]<0&&(i=e[0],e[0]=e[2],e[2]=i),e[0]*=t[0],e[2]*=t[0],t[3]<0&&(i=e[1],e[1]=e[3],e[3]=i),e[1]*=t[3],e[3]*=t[3]):(i=e[0],e[0]=e[1],e[1]=i,i=e[2],e[2]=e[3],e[3]=i,t[1]<0&&(i=e[1],e[1]=e[3],e[3]=i),e[1]*=t[1],e[3]*=t[1],t[2]<0&&(i=e[0],e[0]=e[2],e[2]=i),e[0]*=t[2],e[2]*=t[2]),e[0]+=t[4],e[1]+=t[5],e[2]+=t[4],e[3]+=t[5]}static transform(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]}static applyTransform(t,e){let i=t[0]*e[0]+t[1]*e[2]+e[4],s=t[0]*e[1]+t[1]*e[3]+e[5];return[i,s]}static applyInverseTransform(t,e){let i=e[0]*e[3]-e[1]*e[2],s=(t[0]*e[3]-t[1]*e[2]+e[2]*e[5]-e[4]*e[3])/i,n=(-t[0]*e[1]+t[1]*e[0]+e[4]*e[1]-e[5]*e[0])/i;return[s,n]}static getAxialAlignedBoundingBox(t,e){let i=this.applyTransform(t,e),s=this.applyTransform(t.slice(2,4),e),n=this.applyTransform([t[0],t[3]],e),a=this.applyTransform([t[2],t[1]],e);return[Math.min(i[0],s[0],n[0],a[0]),Math.min(i[1],s[1],n[1],a[1]),Math.max(i[0],s[0],n[0],a[0]),Math.max(i[1],s[1],n[1],a[1])]}static inverseTransform(t){let e=t[0]*t[3]-t[1]*t[2];return[t[3]/e,-t[1]/e,-t[2]/e,t[0]/e,(t[2]*t[5]-t[4]*t[3])/e,(t[4]*t[1]-t[5]*t[0])/e]}static singularValueDecompose2dScale(t){let e=[t[0],t[2],t[1],t[3]],i=t[0]*e[0]+t[1]*e[2],s=t[0]*e[1]+t[1]*e[3],n=t[2]*e[0]+t[3]*e[2],a=t[2]*e[1]+t[3]*e[3],o=(i+a)/2,l=Math.sqrt((i+a)**2-4*(i*a-n*s))/2,c=o+l||1,h=o-l||1;return[Math.sqrt(c),Math.sqrt(h)]}static normalizeRect(t){let e=t.slice(0);return t[0]>t[2]&&(e[0]=t[2],e[2]=t[0]),t[1]>t[3]&&(e[1]=t[3],e[3]=t[1]),e}static intersect(t,e){let i=Math.max(Math.min(t[0],t[2]),Math.min(e[0],e[2])),s=Math.min(Math.max(t[0],t[2]),Math.max(e[0],e[2]));if(i>s)return null;let n=Math.max(Math.min(t[1],t[3]),Math.min(e[1],e[3])),a=Math.min(Math.max(t[1],t[3]),Math.max(e[1],e[3]));return n>a?null:[i,n,s,a]}static#t(t,e,i,s,n,a,o,l,c,h){if(c<=0||c>=1)return;let d=1-c,u=c*c,f=u*c,p=d*(d*(d*t+3*c*e)+3*u*i)+f*s,g=d*(d*(d*n+3*c*a)+3*u*o)+f*l;h[0]=Math.min(h[0],p),h[1]=Math.min(h[1],g),h[2]=Math.max(h[2],p),h[3]=Math.max(h[3],g)}static#e(t,e,i,s,n,a,o,l,c,h,d,u){if(Math.abs(c)<1e-12){Math.abs(h)>=1e-12&&this.#t(t,e,i,s,n,a,o,l,-d/h,u);return}let f=h**2-4*d*c;if(f<0)return;let p=Math.sqrt(f),g=2*c;this.#t(t,e,i,s,n,a,o,l,(-h+p)/g,u),this.#t(t,e,i,s,n,a,o,l,(-h-p)/g,u)}static bezierBoundingBox(t,e,i,s,n,a,o,l,c){return c?(c[0]=Math.min(c[0],t,o),c[1]=Math.min(c[1],e,l),c[2]=Math.max(c[2],t,o),c[3]=Math.max(c[3],e,l)):c=[Math.min(t,o),Math.min(e,l),Math.max(t,o),Math.max(e,l)],this.#e(t,i,n,o,e,s,a,l,3*(-t+3*(i-n)+o),6*(t-2*i+n),3*(i-t),c),this.#e(t,i,n,o,e,s,a,l,3*(-e+3*(s-a)+l),6*(e-2*s+a),3*(s-e),c),c}};function Co(r){return decodeURIComponent(escape(r))}var ks=null,$r=null;function Eo(r){return ks||(ks=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,$r=new Map([["\uFB05","\u017Ft"]])),r.replaceAll(ks,(t,e,i)=>e?e.normalize("NFKC"):$r.get(i))}function So(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();let r=new Uint8Array(32);return crypto.getRandomValues(r),aa(r)}var sr="pdfjs_internal_id_";function xo(r){return Uint8Array.prototype.toBase64?r.toBase64():btoa(aa(r))}typeof Promise.try!="function"&&(Promise.try=function(r,...t){return new Promise(e=>{e(r(...t))})});var Vt="http://www.w3.org/2000/svg",Wt=class{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF};function Xi(r,t="text"){return w(this,null,function*(){if(Ie(r,document.baseURI)){let e=yield fetch(r);if(!e.ok)throw new Error(e.statusText);switch(t){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"json":return e.json()}return e.text()}return new Promise((e,i)=>{let s=new XMLHttpRequest;s.open("GET",r,!0),s.responseType=t,s.onreadystatechange=()=>{if(s.readyState===XMLHttpRequest.DONE){if(s.status===200||s.status===0){switch(t){case"arraybuffer":case"blob":case"json":e(s.response);return}e(s.responseText);return}i(new Error(s.statusText))}},s.send(null)})})}var De=class r{constructor({viewBox:t,userUnit:e,scale:i,rotation:s,offsetX:n=0,offsetY:a=0,dontFlip:o=!1}){this.viewBox=t,this.userUnit=e,this.scale=i,this.rotation=s,this.offsetX=n,this.offsetY=a,i*=e;let l=(t[2]+t[0])/2,c=(t[3]+t[1])/2,h,d,u,f;switch(s%=360,s<0&&(s+=360),s){case 180:h=-1,d=0,u=0,f=1;break;case 90:h=0,d=1,u=1,f=0;break;case 270:h=0,d=-1,u=-1,f=0;break;case 0:h=1,d=0,u=0,f=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}o&&(u=-u,f=-f);let p,g,b,m;h===0?(p=Math.abs(c-t[1])*i+n,g=Math.abs(l-t[0])*i+a,b=(t[3]-t[1])*i,m=(t[2]-t[0])*i):(p=Math.abs(l-t[0])*i+n,g=Math.abs(c-t[1])*i+a,b=(t[2]-t[0])*i,m=(t[3]-t[1])*i),this.transform=[h*i,d*i,u*i,f*i,p-h*i*l-u*i*c,g-d*i*l-f*i*c],this.width=b,this.height=m}get rawDims(){let{userUnit:t,viewBox:e}=this,i=e.map(s=>s*t);return O(this,"rawDims",{pageWidth:i[2]-i[0],pageHeight:i[3]-i[1],pageX:i[0],pageY:i[1]})}clone({scale:t=this.scale,rotation:e=this.rotation,offsetX:i=this.offsetX,offsetY:s=this.offsetY,dontFlip:n=!1}={}){return new r({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:t,rotation:e,offsetX:i,offsetY:s,dontFlip:n})}convertToViewportPoint(t,e){return T.applyTransform([t,e],this.transform)}convertToViewportRectangle(t){let e=T.applyTransform([t[0],t[1]],this.transform),i=T.applyTransform([t[2],t[3]],this.transform);return[e[0],e[1],i[0],i[1]]}convertToPdfPoint(t,e){return T.applyInverseTransform([t,e],this.transform)}},Oe=class extends qt{constructor(t,e=0){super(t,"RenderingCancelledException"),this.extraDelay=e}};function Yi(r){let t=r.length,e=0;for(;e<t&&r[e].trim()==="";)e++;return r.substring(e,e+5).toLowerCase()==="data:"}function nr(r){return typeof r=="string"&&/\.pdf$/i.test(r)}function To(r){return[r]=r.split(/[#?]/,1),r.substring(r.lastIndexOf("/")+1)}function Mo(r,t="document.pdf"){if(typeof r!="string")return t;if(Yi(r))return D('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),t;let e=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,i=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,s=e.exec(r),n=i.exec(s[1])||i.exec(s[2])||i.exec(s[3]);if(n&&(n=n[0],n.includes("%")))try{n=i.exec(decodeURIComponent(n))[0]}catch{}return n||t}var gi=class{started=Object.create(null);times=[];time(t){t in this.started&&D(`Timer is already running for ${t}`),this.started[t]=Date.now()}timeEnd(t){t in this.started||D(`Timer has not been started for ${t}`),this.times.push({name:t,start:this.started[t],end:Date.now()}),delete this.started[t]}toString(){let t=[],e=0;for(let{name:i}of this.times)e=Math.max(i.length,e);for(let{name:i,start:s,end:n}of this.times)t.push(`${i.padEnd(e)} ${n-s}ms
`);return t.join("")}};function Ie(r,t){try{let{protocol:e}=t?new URL(r,t):new URL(r);return e==="http:"||e==="https:"}catch{return!1}}function xt(r){r.preventDefault()}function mt(r){r.preventDefault(),r.stopPropagation()}var mi=class{static#t;static toDateObject(t){if(!t||typeof t!="string")return null;this.#t||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");let e=this.#t.exec(t);if(!e)return null;let i=parseInt(e[1],10),s=parseInt(e[2],10);s=s>=1&&s<=12?s-1:0;let n=parseInt(e[3],10);n=n>=1&&n<=31?n:1;let a=parseInt(e[4],10);a=a>=0&&a<=23?a:0;let o=parseInt(e[5],10);o=o>=0&&o<=59?o:0;let l=parseInt(e[6],10);l=l>=0&&l<=59?l:0;let c=e[7]||"Z",h=parseInt(e[8],10);h=h>=0&&h<=23?h:0;let d=parseInt(e[9],10)||0;return d=d>=0&&d<=59?d:0,c==="-"?(a+=h,o+=d):c==="+"&&(a-=h,o-=d),new Date(Date.UTC(i,s,n,a,o,l))}};function Io(r,{scale:t=1,rotation:e=0}){let{width:i,height:s}=r.attributes.style,n=[0,0,parseInt(i),parseInt(s)];return new De({viewBox:n,userUnit:1,scale:t,rotation:e})}function rr(r){if(r.startsWith("#")){let t=parseInt(r.slice(1),16);return[(t&16711680)>>16,(t&65280)>>8,t&255]}return r.startsWith("rgb(")?r.slice(4,-1).split(",").map(t=>parseInt(t)):r.startsWith("rgba(")?r.slice(5,-1).split(",").map(t=>parseInt(t)).slice(0,3):(D(`Not a valid color format: "${r}"`),[0,0,0])}function Ro(r){let t=document.createElement("span");t.style.visibility="hidden",document.body.append(t);for(let e of r.keys()){t.style.color=e;let i=window.getComputedStyle(t).color;r.set(e,rr(i))}t.remove()}function z(r){let{a:t,b:e,c:i,d:s,e:n,f:a}=r.getTransform();return[t,e,i,s,n,a]}function Ot(r){let{a:t,b:e,c:i,d:s,e:n,f:a}=r.getTransform().invertSelf();return[t,e,i,s,n,a]}function ne(r,t,e=!1,i=!0){if(t instanceof De){let{pageWidth:s,pageHeight:n}=t.rawDims,{style:a}=r,o=rt.isCSSRoundSupported,l=`var(--scale-factor) * ${s}px`,c=`var(--scale-factor) * ${n}px`,h=o?`round(down, ${l}, var(--scale-round-x, 1px))`:`calc(${l})`,d=o?`round(down, ${c}, var(--scale-round-y, 1px))`:`calc(${c})`;!e||t.rotation%180===0?(a.width=h,a.height=d):(a.width=d,a.height=h)}i&&r.setAttribute("data-main-rotation",t.rotation)}var Fe=class{constructor(){let t=window.devicePixelRatio||1;this.sx=t,this.sy=t}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}},Vs=class r{#t=null;#e=null;#i;#s=null;#r=null;static#n=null;constructor(t){this.#i=t,r.#n||=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button"})}render(){let t=this.#t=document.createElement("div");t.classList.add("editToolbar","hidden"),t.setAttribute("role","toolbar");let e=this.#i._uiManager._signal;t.addEventListener("contextmenu",xt,{signal:e}),t.addEventListener("pointerdown",r.#l,{signal:e});let i=this.#s=document.createElement("div");i.className="buttons",t.append(i);let s=this.#i.toolbarPosition;if(s){let{style:n}=t,a=this.#i._uiManager.direction==="ltr"?1-s[0]:s[0];n.insetInlineEnd=`${100*a}%`,n.top=`calc(${100*s[1]}% + var(--editor-toolbar-vert-offset))`}return this.#u(),t}get div(){return this.#t}static#l(t){t.stopPropagation()}#o(t){this.#i._focusEventsAllowed=!1,mt(t)}#h(t){this.#i._focusEventsAllowed=!0,mt(t)}#c(t){let e=this.#i._uiManager._signal;t.addEventListener("focusin",this.#o.bind(this),{capture:!0,signal:e}),t.addEventListener("focusout",this.#h.bind(this),{capture:!0,signal:e}),t.addEventListener("contextmenu",xt,{signal:e})}hide(){this.#t.classList.add("hidden"),this.#e?.hideDropdown()}show(){this.#t.classList.remove("hidden"),this.#r?.shown()}#u(){let{editorType:t,_uiManager:e}=this.#i,i=document.createElement("button");i.className="delete",i.tabIndex=0,i.setAttribute("data-l10n-id",r.#n[t]),this.#c(i),i.addEventListener("click",s=>{e.delete()},{signal:e._signal}),this.#s.append(i)}get#d(){let t=document.createElement("div");return t.className="divider",t}addAltText(t){return w(this,null,function*(){let e=yield t.render();this.#c(e),this.#s.prepend(e,this.#d),this.#r=t})}addColorPicker(t){this.#e=t;let e=t.renderButton();this.#c(e),this.#s.prepend(e,this.#d)}remove(){this.#t.remove(),this.#e?.destroy(),this.#e=null}},Bs=class{#t=null;#e=null;#i;constructor(t){this.#i=t}#s(){let t=this.#e=document.createElement("div");t.className="editToolbar",t.setAttribute("role","toolbar"),t.addEventListener("contextmenu",xt,{signal:this.#i._signal});let e=this.#t=document.createElement("div");return e.className="buttons",t.append(e),this.#n(),t}#r(t,e){let i=0,s=0;for(let n of t){let a=n.y+n.height;if(a<i)continue;let o=n.x+(e?n.width:0);if(a>i){s=o,i=a;continue}e?o>s&&(s=o):o<s&&(s=o)}return[e?1-s:s,i]}show(t,e,i){let[s,n]=this.#r(e,i),{style:a}=this.#e||=this.#s();t.append(this.#e),a.insetInlineEnd=`${100*s}%`,a.top=`calc(${100*n}% + var(--editor-toolbar-vert-offset))`}hide(){this.#e.remove()}#n(){let t=document.createElement("button");t.className="highlightButton",t.tabIndex=0,t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");let e=document.createElement("span");t.append(e),e.className="visuallyHidden",e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");let i=this.#i._signal;t.addEventListener("contextmenu",xt,{signal:i}),t.addEventListener("click",()=>{this.#i.highlightSelection("floating_button")},{signal:i}),this.#t.append(t)}};function bi(r,t,e){for(let i of e)t.addEventListener(i,r[i].bind(r))}var Hs=class{#t=0;get id(){return`${fo}${this.#t++}`}},Gs=class r{#t=So();#e=0;#i=null;static get _isSVGFittingCanvas(){let t='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',i=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),s=new Image;s.src=t;let n=s.decode().then(()=>(i.drawImage(s,0,0,1,1,0,0,1,3),new Uint32Array(i.getImageData(0,0,1,1).data.buffer)[0]===0));return O(this,"_isSVGFittingCanvas",n)}#s(t,e){return w(this,null,function*(){this.#i||=new Map;let i=this.#i.get(t);if(i===null)return null;if(i?.bitmap)return i.refCounter+=1,i;try{i||={bitmap:null,id:`image_${this.#t}_${this.#e++}`,refCounter:0,isSvg:!1};let s;if(typeof e=="string"?(i.url=e,s=yield Xi(e,"blob")):e instanceof File?s=i.file=e:e instanceof Blob&&(s=e),s.type==="image/svg+xml"){let n=r._isSVGFittingCanvas,a=new FileReader,o=new Image,l=new Promise((c,h)=>{o.onload=()=>{i.bitmap=o,i.isSvg=!0,c()},a.onload=()=>w(this,null,function*(){let d=i.svgUrl=a.result;o.src=(yield n)?`${d}#svgView(preserveAspectRatio(none))`:d}),o.onerror=a.onerror=h});a.readAsDataURL(s),yield l}else i.bitmap=yield createImageBitmap(s);i.refCounter=1}catch(s){D(s),i=null}return this.#i.set(t,i),i&&this.#i.set(i.id,i),i})}getFromFile(t){return w(this,null,function*(){let{lastModified:e,name:i,size:s,type:n}=t;return this.#s(`${e}_${i}_${s}_${n}`,t)})}getFromUrl(t){return w(this,null,function*(){return this.#s(t,t)})}getFromBlob(t,e){return w(this,null,function*(){let i=yield e;return this.#s(t,i)})}getFromId(t){return w(this,null,function*(){this.#i||=new Map;let e=this.#i.get(t);if(!e)return null;if(e.bitmap)return e.refCounter+=1,e;if(e.file)return this.getFromFile(e.file);if(e.blobPromise){let{blobPromise:i}=e;return delete e.blobPromise,this.getFromBlob(e.id,i)}return this.getFromUrl(e.url)})}getFromCanvas(t,e){this.#i||=new Map;let i=this.#i.get(t);if(i?.bitmap)return i.refCounter+=1,i;let s=new OffscreenCanvas(e.width,e.height);return s.getContext("2d").drawImage(e,0,0),i={bitmap:s.transferToImageBitmap(),id:`image_${this.#t}_${this.#e++}`,refCounter:1,isSvg:!1},this.#i.set(t,i),this.#i.set(i.id,i),i}getSvgUrl(t){let e=this.#i.get(t);return e?.isSvg?e.svgUrl:null}deleteId(t){this.#i||=new Map;let e=this.#i.get(t);if(!e||(e.refCounter-=1,e.refCounter!==0))return;let{bitmap:i}=e;if(!e.url&&!e.file){let s=new OffscreenCanvas(i.width,i.height);s.getContext("bitmaprenderer").transferFromImageBitmap(i),e.blobPromise=s.convertToBlob()}i.close?.(),e.bitmap=null}isValidId(t){return t.startsWith(`image_${this.#t}_`)}},js=class{#t=[];#e=!1;#i;#s=-1;constructor(t=128){this.#i=t}add({cmd:t,undo:e,post:i,mustExec:s,type:n=NaN,overwriteIfSameType:a=!1,keepUndo:o=!1}){if(s&&t(),this.#e)return;let l={cmd:t,undo:e,post:i,type:n};if(this.#s===-1){this.#t.length>0&&(this.#t.length=0),this.#s=0,this.#t.push(l);return}if(a&&this.#t[this.#s].type===n){o&&(l.undo=this.#t[this.#s].undo),this.#t[this.#s]=l;return}let c=this.#s+1;c===this.#i?this.#t.splice(0,1):(this.#s=c,c<this.#t.length&&this.#t.splice(c)),this.#t.push(l)}undo(){if(this.#s===-1)return;this.#e=!0;let{undo:t,post:e}=this.#t[this.#s];t(),e?.(),this.#e=!1,this.#s-=1}redo(){if(this.#s<this.#t.length-1){this.#s+=1,this.#e=!0;let{cmd:t,post:e}=this.#t[this.#s];t(),e?.(),this.#e=!1}}hasSomethingToUndo(){return this.#s!==-1}hasSomethingToRedo(){return this.#s<this.#t.length-1}cleanType(t){if(this.#s!==-1){for(let e=this.#s;e>=0;e--)if(this.#t[e].type!==t){this.#t.splice(e+1,this.#s-e),this.#s=e;return}this.#t.length=0,this.#s=-1}}destroy(){this.#t=null}},re=class{constructor(t){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;let{isMac:e}=rt.platform;for(let[i,s,n={}]of t)for(let a of i){let o=a.startsWith("mac+");e&&o?(this.callbacks.set(a.slice(4),{callback:s,options:n}),this.allKeys.add(a.split("+").at(-1))):!e&&!o&&(this.callbacks.set(a,{callback:s,options:n}),this.allKeys.add(a.split("+").at(-1)))}}#t(t){t.altKey&&this.buffer.push("alt"),t.ctrlKey&&this.buffer.push("ctrl"),t.metaKey&&this.buffer.push("meta"),t.shiftKey&&this.buffer.push("shift"),this.buffer.push(t.key);let e=this.buffer.join("+");return this.buffer.length=0,e}exec(t,e){if(!this.allKeys.has(e.key))return;let i=this.callbacks.get(this.#t(e));if(!i)return;let{callback:s,options:{bubbles:n=!1,args:a=[],checker:o=null}}=i;o&&!o(t,e)||(s.bind(t,...a,e)(),n||mt(e))}},Us=class r{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){let t=new Map([["CanvasText",null],["Canvas",null]]);return Ro(t),O(this,"_colors",t)}convert(t){let e=rr(t);if(!window.matchMedia("(forced-colors: active)").matches)return e;for(let[i,s]of this._colors)if(s.every((n,a)=>n===e[a]))return r._colorsMapping.get(i);return e}getHexCode(t){let e=this._colors.get(t);return e?T.makeHexColor(...e):t}},Le=(()=>{class r{#t=new AbortController;#e=null;#i=new Map;#s=new Map;#r=null;#n=null;#l=null;#o=new js;#h=null;#c=null;#u=0;#d=new Set;#f=null;#a=null;#p=new Set;_editorUndoBar=null;#m=!1;#g=!1;#b=!1;#v=null;#_=null;#A=null;#C=null;#S=!1;#T=null;#I=new Hs;#w=!1;#M=!1;#x=null;#P=null;#O=null;#L=null;#E=k.NONE;#y=new Set;#D=null;#G=null;#j=null;#U={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#N=[0,0];#F=null;#V=null;#$=null;#k=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){let e=r.prototype,i=o=>o.#V.contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&o.hasSomethingToControl(),s=(o,{target:l})=>{if(l instanceof HTMLInputElement){let{type:c}=l;return c!=="text"&&c!=="number"}return!0},n=this.TRANSLATE_SMALL,a=this.TRANSLATE_BIG;return O(this,"_keyboardManager",new re([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:s}],[["ctrl+z","mac+meta+z"],e.undo,{checker:s}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:s}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:s}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(o,{target:l})=>!(l instanceof HTMLButtonElement)&&o.#V.contains(l)&&!o.isEnterHandled}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(o,{target:l})=>!(l instanceof HTMLButtonElement)&&o.#V.contains(document.activeElement)}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-n,0],checker:i}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-a,0],checker:i}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[n,0],checker:i}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[a,0],checker:i}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-n],checker:i}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-a],checker:i}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,n],checker:i}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,a],checker:i}]]))}constructor(e,i,s,n,a,o,l,c,h,d,u,f,p){let g=this._signal=this.#t.signal;this.#V=e,this.#$=i,this.#r=s,this._eventBus=n,n._on("editingaction",this.onEditingAction.bind(this),{signal:g}),n._on("pagechanging",this.onPageChanging.bind(this),{signal:g}),n._on("scalechanging",this.onScaleChanging.bind(this),{signal:g}),n._on("rotationchanging",this.onRotationChanging.bind(this),{signal:g}),n._on("setpreference",this.onSetPreference.bind(this),{signal:g}),n._on("switchannotationeditorparams",b=>this.updateParams(b.type,b.value),{signal:g}),this.#et(),this.#rt(),this.#X(),this.#n=a.annotationStorage,this.#v=a.filterFactory,this.#G=o,this.#C=l||null,this.#m=c,this.#g=h,this.#b=d,this.#L=u||null,this.viewParameters={realScale:Wt.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=f||null,this._supportsPinchToZoom=p!==!1}destroy(){this.#k?.resolve(),this.#k=null,this.#t?.abort(),this.#t=null,this._signal=null;for(let e of this.#s.values())e.destroy();this.#s.clear(),this.#i.clear(),this.#p.clear(),this.#e=null,this.#y.clear(),this.#o.destroy(),this.#r?.destroy(),this.#T?.hide(),this.#T=null,this.#_&&(clearTimeout(this.#_),this.#_=null),this.#F&&(clearTimeout(this.#F),this.#F=null),this._editorUndoBar?.destroy()}combinedSignal(e){return AbortSignal.any([this._signal,e.signal])}get mlManager(){return this.#L}get useNewAltTextFlow(){return this.#g}get useNewAltTextWhenAddingImage(){return this.#b}get hcmFilter(){return O(this,"hcmFilter",this.#G?this.#v.addHCMFilter(this.#G.foreground,this.#G.background):"none")}get direction(){return O(this,"direction",getComputedStyle(this.#V).direction)}get highlightColors(){return O(this,"highlightColors",this.#C?new Map(this.#C.split(",").map(e=>e.split("=").map(i=>i.trim()))):null)}get highlightColorNames(){return O(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}setCurrentDrawingSession(e){e?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),this.#c=e}setMainHighlightColorPicker(e){this.#O=e}editAltText(e,i=!1){this.#r?.editAltText(this,e,i)}switchToMode(e,i){this._eventBus.on("annotationeditormodechanged",i,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:e})}setPreference(e,i){this._eventBus.dispatch("setpreference",{source:this,name:e,value:i})}onSetPreference({name:e,value:i}){switch(e){case"enableNewAltTextWhenAddingImage":this.#b=i;break}}onPageChanging({pageNumber:e}){this.#u=e-1}focusMainContainer(){this.#V.focus()}findParent(e,i){for(let s of this.#s.values()){let{x:n,y:a,width:o,height:l}=s.div.getBoundingClientRect();if(e>=n&&e<=n+o&&i>=a&&i<=a+l)return s}return null}disableUserSelect(e=!1){this.#$.classList.toggle("noUserSelect",e)}addShouldRescale(e){this.#p.add(e)}removeShouldRescale(e){this.#p.delete(e)}onScaleChanging({scale:e}){this.commitOrRemove(),this.viewParameters.realScale=e*Wt.PDF_TO_CSS_UNITS;for(let i of this.#p)i.onScaleChanging();this.#c?.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}#B({anchorNode:e}){return e.nodeType===Node.TEXT_NODE?e.parentElement:e}#q(e){let{currentLayer:i}=this;if(i.hasTextLayer(e))return i;for(let s of this.#s.values())if(s.hasTextLayer(e))return s;return null}highlightSelection(e=""){let i=document.getSelection();if(!i||i.isCollapsed)return;let{anchorNode:s,anchorOffset:n,focusNode:a,focusOffset:o}=i,l=i.toString(),h=this.#B(i).closest(".textLayer"),d=this.getSelectionBoxes(h);if(!d)return;i.empty();let u=this.#q(h),f=this.#E===k.NONE,p=()=>{u?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:d,anchorNode:s,anchorOffset:n,focusNode:a,focusOffset:o,text:l}),f&&this.showAllEditors("highlight",!0,!0)};if(f){this.switchToMode(k.HIGHLIGHT,p);return}p()}#Z(){let e=document.getSelection();if(!e||e.isCollapsed)return;let s=this.#B(e).closest(".textLayer"),n=this.getSelectionBoxes(s);n&&(this.#T||=new Bs(this),this.#T.show(s,n,this.direction==="ltr"))}addToAnnotationStorage(e){!e.isEmpty()&&this.#n&&!this.#n.has(e.id)&&this.#n.setValue(e.id,e)}#tt(){let e=document.getSelection();if(!e||e.isCollapsed){this.#D&&(this.#T?.hide(),this.#D=null,this.#R({hasSelectedText:!1}));return}let{anchorNode:i}=e;if(i===this.#D)return;let n=this.#B(e).closest(".textLayer");if(!n){this.#D&&(this.#T?.hide(),this.#D=null,this.#R({hasSelectedText:!1}));return}if(this.#T?.hide(),this.#D=i,this.#R({hasSelectedText:!0}),!(this.#E!==k.HIGHLIGHT&&this.#E!==k.NONE)&&(this.#E===k.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#S=this.isShiftKeyDown,!this.isShiftKeyDown)){let a=this.#E===k.HIGHLIGHT?this.#q(n):null;a?.toggleDrawing();let o=new AbortController,l=this.combinedSignal(o),c=h=>{h.type==="pointerup"&&h.button!==0||(o.abort(),a?.toggleDrawing(!0),h.type==="pointerup"&&this.#W("main_toolbar"))};window.addEventListener("pointerup",c,{signal:l}),window.addEventListener("blur",c,{signal:l})}}#W(e=""){this.#E===k.HIGHLIGHT?this.highlightSelection(e):this.#m&&this.#Z()}#et(){document.addEventListener("selectionchange",this.#tt.bind(this),{signal:this._signal})}#it(){if(this.#A)return;this.#A=new AbortController;let e=this.combinedSignal(this.#A);window.addEventListener("focus",this.focus.bind(this),{signal:e}),window.addEventListener("blur",this.blur.bind(this),{signal:e})}#st(){this.#A?.abort(),this.#A=null}blur(){if(this.isShiftKeyDown=!1,this.#S&&(this.#S=!1,this.#W("main_toolbar")),!this.hasSelection)return;let{activeElement:e}=document;for(let i of this.#y)if(i.div.contains(e)){this.#P=[i,e],i._focusEventsAllowed=!1;break}}focus(){if(!this.#P)return;let[e,i]=this.#P;this.#P=null,i.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),i.focus()}#X(){if(this.#x)return;this.#x=new AbortController;let e=this.combinedSignal(this.#x);window.addEventListener("keydown",this.keydown.bind(this),{signal:e}),window.addEventListener("keyup",this.keyup.bind(this),{signal:e})}#nt(){this.#x?.abort(),this.#x=null}#Y(){if(this.#h)return;this.#h=new AbortController;let e=this.combinedSignal(this.#h);document.addEventListener("copy",this.copy.bind(this),{signal:e}),document.addEventListener("cut",this.cut.bind(this),{signal:e}),document.addEventListener("paste",this.paste.bind(this),{signal:e})}#K(){this.#h?.abort(),this.#h=null}#rt(){let e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})}addEditListeners(){this.#X(),this.#Y()}removeEditListeners(){this.#nt(),this.#K()}dragOver(e){for(let{type:i}of e.dataTransfer.items)for(let s of this.#a)if(s.isHandlingMimeForPasting(i)){e.dataTransfer.dropEffect="copy",e.preventDefault();return}}drop(e){for(let i of e.dataTransfer.items)for(let s of this.#a)if(s.isHandlingMimeForPasting(i.type)){s.paste(i,this.currentLayer),e.preventDefault();return}}copy(e){if(e.preventDefault(),this.#e?.commitOrRemove(),!this.hasSelection)return;let i=[];for(let s of this.#y){let n=s.serialize(!0);n&&i.push(n)}i.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(i))}cut(e){this.copy(e),this.delete()}paste(e){return w(this,null,function*(){e.preventDefault();let{clipboardData:i}=e;for(let a of i.items)for(let o of this.#a)if(o.isHandlingMimeForPasting(a.type)){o.paste(a,this.currentLayer);return}let s=i.getData("application/pdfjs");if(!s)return;try{s=JSON.parse(s)}catch(a){D(`paste: "${a.message}".`);return}if(!Array.isArray(s))return;this.unselectAll();let n=this.currentLayer;try{let a=[];for(let c of s){let h=yield n.deserialize(c);if(!h)return;a.push(h)}let o=()=>{for(let c of a)this.#J(c);this.#Q(a)},l=()=>{for(let c of a)c.remove()};this.addCommands({cmd:o,undo:l,mustExec:!0})}catch(a){D(`paste: "${a.message}".`)}})}keydown(e){!this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!0),this.#E!==k.NONE&&!this.isEditorHandlingKeyboard&&r._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!1,this.#S&&(this.#S=!1,this.#W("main_toolbar")))}onEditingAction({name:e}){switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}#R(e){Object.entries(e).some(([s,n])=>this.#U[s]!==n)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#U,e)}),this.#E===k.HIGHLIGHT&&e.hasSelectedEditor===!1&&this.#H([[N.HIGHLIGHT_FREE,!0]]))}#H(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})}setEditingState(e){e?(this.#it(),this.#Y(),this.#R({isEditing:this.#E!==k.NONE,isEmpty:this.#z(),hasSomethingToUndo:this.#o.hasSomethingToUndo(),hasSomethingToRedo:this.#o.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#st(),this.#K(),this.#R({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!this.#a){this.#a=e;for(let i of this.#a)this.#H(i.defaultPropertiesToUpdate)}}getId(){return this.#I.id}get currentLayer(){return this.#s.get(this.#u)}getLayer(e){return this.#s.get(e)}get currentPageIndex(){return this.#u}addLayer(e){this.#s.set(e.pageIndex,e),this.#w?e.enable():e.disable()}removeLayer(e){this.#s.delete(e.pageIndex)}updateMode(e,i=null,s=!1){return w(this,null,function*(){if(this.#E!==e&&!(this.#k&&(yield this.#k.promise,!this.#k))){if(this.#k=Promise.withResolvers(),this.#E=e,e===k.NONE){this.setEditingState(!1),this.#ot(),this._editorUndoBar?.hide(),this.#k.resolve();return}this.setEditingState(!0),yield this.#at(),this.unselectAll();for(let n of this.#s.values())n.updateMode(e);if(!i){s&&this.addNewEditorFromKeyboard(),this.#k.resolve();return}for(let n of this.#i.values())n.annotationElementId===i?(this.setSelected(n),n.enterInEditMode()):n.unselect();this.#k.resolve()}})}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e!==this.#E&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:e})}updateParams(e,i){if(this.#a){switch(e){case N.CREATE:this.currentLayer.addNewEditor();return;case N.HIGHLIGHT_DEFAULT_COLOR:this.#O?.updateColor(i);break;case N.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#j||=new Map).set(e,i),this.showAllEditors("highlight",i);break}for(let s of this.#y)s.updateParams(e,i);for(let s of this.#a)s.updateDefaultParams(e,i)}}showAllEditors(e,i,s=!1){for(let a of this.#i.values())a.editorType===e&&a.show(i);(this.#j?.get(N.HIGHLIGHT_SHOW_ALL)??!0)!==i&&this.#H([[N.HIGHLIGHT_SHOW_ALL,i]])}enableWaiting(e=!1){if(this.#M!==e){this.#M=e;for(let i of this.#s.values())e?i.disableClick():i.enableClick(),i.div.classList.toggle("waiting",e)}}#at(){return w(this,null,function*(){if(!this.#w){this.#w=!0;let e=[];for(let i of this.#s.values())e.push(i.enable());yield Promise.all(e);for(let i of this.#i.values())i.enable()}})}#ot(){if(this.unselectAll(),this.#w){this.#w=!1;for(let e of this.#s.values())e.disable();for(let e of this.#i.values())e.disable()}}getEditors(e){let i=[];for(let s of this.#i.values())s.pageIndex===e&&i.push(s);return i}getEditor(e){return this.#i.get(e)}addEditor(e){this.#i.set(e.id,e)}removeEditor(e){e.div.contains(document.activeElement)&&(this.#_&&clearTimeout(this.#_),this.#_=setTimeout(()=>{this.focusMainContainer(),this.#_=null},0)),this.#i.delete(e.id),this.unselect(e),(!e.annotationElementId||!this.#d.has(e.annotationElementId))&&this.#n?.remove(e.id)}addDeletedAnnotationElement(e){this.#d.add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return this.#d.has(e)}removeDeletedAnnotationElement(e){this.#d.delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}#J(e){let i=this.#s.get(e.pageIndex);i?i.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))}setActiveEditor(e){this.#e!==e&&(this.#e=e,e&&this.#H(e.propertiesToUpdate))}get#lt(){let e=null;for(e of this.#y);return e}updateUI(e){this.#lt===e&&this.#H(e.propertiesToUpdate)}updateUIForDefaultProperties(e){this.#H(e.defaultPropertiesToUpdate)}toggleSelected(e){if(this.#y.has(e)){this.#y.delete(e),e.unselect(),this.#R({hasSelectedEditor:this.hasSelection});return}this.#y.add(e),e.select(),this.#H(e.propertiesToUpdate),this.#R({hasSelectedEditor:!0})}setSelected(e){this.#c?.commitOrRemove();for(let i of this.#y)i!==e&&i.unselect();this.#y.clear(),this.#y.add(e),e.select(),this.#H(e.propertiesToUpdate),this.#R({hasSelectedEditor:!0})}isSelected(e){return this.#y.has(e)}get firstSelectedEditor(){return this.#y.values().next().value}unselect(e){e.unselect(),this.#y.delete(e),this.#R({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#y.size!==0}get isEnterHandled(){return this.#y.size===1&&this.firstSelectedEditor.isEnterHandled}undo(){this.#o.undo(),this.#R({hasSomethingToUndo:this.#o.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#z()}),this._editorUndoBar?.hide()}redo(){this.#o.redo(),this.#R({hasSomethingToUndo:!0,hasSomethingToRedo:this.#o.hasSomethingToRedo(),isEmpty:this.#z()})}addCommands(e){this.#o.add(e),this.#R({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#z()})}cleanUndoStack(e){this.#o.cleanType(e)}#z(){if(this.#i.size===0)return!0;if(this.#i.size===1)for(let e of this.#i.values())return e.isEmpty();return!1}delete(){this.commitOrRemove();let e=this.currentLayer?.endDrawingSession(!0);if(!this.hasSelection&&!e)return;let i=e?[e]:[...this.#y],s=()=>{this._editorUndoBar?.show(n,i.length===1?i[0].editorType:i.length);for(let a of i)a.remove()},n=()=>{for(let a of i)this.#J(a)};this.addCommands({cmd:s,undo:n,mustExec:!0})}commitOrRemove(){this.#e?.commitOrRemove()}hasSomethingToControl(){return this.#e||this.hasSelection}#Q(e){for(let i of this.#y)i.unselect();this.#y.clear();for(let i of e)i.isEmpty()||(this.#y.add(i),i.select());this.#R({hasSelectedEditor:this.hasSelection})}selectAll(){for(let e of this.#y)e.commit();this.#Q(this.#i.values())}unselectAll(){if(!(this.#e&&(this.#e.commitOrRemove(),this.#E!==k.NONE))&&!this.#c?.commitOrRemove()&&this.hasSelection){for(let e of this.#y)e.unselect();this.#y.clear(),this.#R({hasSelectedEditor:!1})}}translateSelectedEditors(e,i,s=!1){if(s||this.commitOrRemove(),!this.hasSelection)return;this.#N[0]+=e,this.#N[1]+=i;let[n,a]=this.#N,o=[...this.#y],l=1e3;this.#F&&clearTimeout(this.#F),this.#F=setTimeout(()=>{this.#F=null,this.#N[0]=this.#N[1]=0,this.addCommands({cmd:()=>{for(let c of o)this.#i.has(c.id)&&c.translateInPage(n,a)},undo:()=>{for(let c of o)this.#i.has(c.id)&&c.translateInPage(-n,-a)},mustExec:!1})},l);for(let c of o)c.translateInPage(e,i)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#f=new Map;for(let e of this.#y)this.#f.set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#f)return!1;this.disableUserSelect(!1);let e=this.#f;this.#f=null;let i=!1;for(let[{x:n,y:a,pageIndex:o},l]of e)l.newX=n,l.newY=a,l.newPageIndex=o,i||=n!==l.savedX||a!==l.savedY||o!==l.savedPageIndex;if(!i)return!1;let s=(n,a,o,l)=>{if(this.#i.has(n.id)){let c=this.#s.get(l);c?n._setParentAndPosition(c,a,o):(n.pageIndex=l,n.x=a,n.y=o)}};return this.addCommands({cmd:()=>{for(let[n,{newX:a,newY:o,newPageIndex:l}]of e)s(n,a,o,l)},undo:()=>{for(let[n,{savedX:a,savedY:o,savedPageIndex:l}]of e)s(n,a,o,l)},mustExec:!0}),!0}dragSelectedEditors(e,i){if(this.#f)for(let s of this.#f.keys())s.drag(e,i)}rebuild(e){if(e.parent===null){let i=this.getLayer(e.pageIndex);i?(i.changeParent(e),i.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||this.#y.size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return this.#e===e}getActive(){return this.#e}getMode(){return this.#E}get imageManager(){return O(this,"imageManager",new Gs)}getSelectionBoxes(e){if(!e)return null;let i=document.getSelection();for(let h=0,d=i.rangeCount;h<d;h++)if(!e.contains(i.getRangeAt(h).commonAncestorContainer))return null;let{x:s,y:n,width:a,height:o}=e.getBoundingClientRect(),l;switch(e.getAttribute("data-main-rotation")){case"90":l=(h,d,u,f)=>({x:(d-n)/o,y:1-(h+u-s)/a,width:f/o,height:u/a});break;case"180":l=(h,d,u,f)=>({x:1-(h+u-s)/a,y:1-(d+f-n)/o,width:u/a,height:f/o});break;case"270":l=(h,d,u,f)=>({x:1-(d+f-n)/o,y:(h-s)/a,width:f/o,height:u/a});break;default:l=(h,d,u,f)=>({x:(h-s)/a,y:(d-n)/o,width:u/a,height:f/o});break}let c=[];for(let h=0,d=i.rangeCount;h<d;h++){let u=i.getRangeAt(h);if(!u.collapsed)for(let{x:f,y:p,width:g,height:b}of u.getClientRects())g===0||b===0||c.push(l(f,p,g,b))}return c.length===0?null:c}addChangedExistingAnnotation({annotationElementId:e,id:i}){(this.#l||=new Map).set(e,i)}removeChangedExistingAnnotation({annotationElementId:e}){this.#l?.delete(e)}renderAnnotationElement(e){let i=this.#l?.get(e.data.id);if(!i)return;let s=this.#n.getRawValue(i);s&&(this.#E===k.NONE&&!s.hasBeenModified||s.renderAnnotationElement(e))}}return r})(),zr=(()=>{class r{#t=null;#e=!1;#i=null;#s=null;#r=null;#n=null;#l=!1;#o=null;#h=null;#c=null;#u=null;#d=!1;static#f=null;static _l10n=null;constructor(e){this.#h=e,this.#d=e._uiManager.useNewAltTextFlow,r.#f||=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"})}static initialize(e){r._l10n??=e}render(){return w(this,null,function*(){let e=this.#i=document.createElement("button");e.className="altText",e.tabIndex="0";let i=this.#s=document.createElement("span");e.append(i),this.#d?(e.classList.add("new"),e.setAttribute("data-l10n-id",r.#f.missing),i.setAttribute("data-l10n-id",r.#f["missing-label"])):(e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),i.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));let s=this.#h._uiManager._signal;e.addEventListener("contextmenu",xt,{signal:s}),e.addEventListener("pointerdown",a=>a.stopPropagation(),{signal:s});let n=a=>{a.preventDefault(),this.#h._uiManager.editAltText(this.#h),this.#d&&this.#h._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:this.#a}})};return e.addEventListener("click",n,{capture:!0,signal:s}),e.addEventListener("keydown",a=>{a.target===e&&a.key==="Enter"&&(this.#l=!0,n(a))},{signal:s}),yield this.#p(),e})}get#a(){return this.#t&&"added"||this.#t===null&&this.guessedText&&"review"||"missing"}finish(){this.#i&&(this.#i.focus({focusVisible:this.#l}),this.#l=!1)}isEmpty(){return this.#d?this.#t===null:!this.#t&&!this.#e}hasData(){return this.#d?this.#t!==null||!!this.#c:this.isEmpty()}get guessedText(){return this.#c}setGuessedText(e){return w(this,null,function*(){this.#t===null&&(this.#c=e,this.#u=yield r._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:e}),this.#p())})}toggleAltTextBadge(e=!1){if(!this.#d||this.#t){this.#o?.remove(),this.#o=null;return}if(!this.#o){let i=this.#o=document.createElement("div");i.className="noAltTextBadge",this.#h.div.append(i)}this.#o.classList.toggle("hidden",!e)}serialize(e){let i=this.#t;return!e&&this.#c===i&&(i=this.#u),{altText:i,decorative:this.#e,guessedText:this.#c,textWithDisclaimer:this.#u}}get data(){return{altText:this.#t,decorative:this.#e}}set data({altText:e,decorative:i,guessedText:s,textWithDisclaimer:n,cancel:a=!1}){s&&(this.#c=s,this.#u=n),!(this.#t===e&&this.#e===i)&&(a||(this.#t=e,this.#e=i),this.#p())}toggle(e=!1){this.#i&&(!e&&this.#n&&(clearTimeout(this.#n),this.#n=null),this.#i.disabled=!e)}shown(){this.#h._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:this.#a}})}destroy(){this.#i?.remove(),this.#i=null,this.#s=null,this.#r=null,this.#o?.remove(),this.#o=null}#p(){return w(this,null,function*(){let e=this.#i;if(!e)return;if(this.#d){if(e.classList.toggle("done",!!this.#t),e.setAttribute("data-l10n-id",r.#f[this.#a]),this.#s?.setAttribute("data-l10n-id",r.#f[`${this.#a}-label`]),!this.#t){this.#r?.remove();return}}else{if(!this.#t&&!this.#e){e.classList.remove("done"),this.#r?.remove();return}e.classList.add("done"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let i=this.#r;if(!i){this.#r=i=document.createElement("span"),i.className="tooltip",i.setAttribute("role","tooltip"),i.id=`alt-text-tooltip-${this.#h.id}`;let n=100,a=this.#h._uiManager._signal;a.addEventListener("abort",()=>{clearTimeout(this.#n),this.#n=null},{once:!0}),e.addEventListener("mouseenter",()=>{this.#n=setTimeout(()=>{this.#n=null,this.#r.classList.add("show"),this.#h._reportTelemetry({action:"alt_text_tooltip"})},n)},{signal:a}),e.addEventListener("mouseleave",()=>{this.#n&&(clearTimeout(this.#n),this.#n=null),this.#r?.classList.remove("show")},{signal:a})}this.#e?i.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(i.removeAttribute("data-l10n-id"),i.textContent=this.#t),i.parentNode||e.append(i),this.#h.getImageForAltText()?.setAttribute("aria-describedby",i.id)})}}return r})(),_i=class r{#t;#e=!1;#i=null;#s;#r;#n;#l;#o;#h=null;#c;#u=null;constructor({container:t,isPinchingDisabled:e=null,isPinchingStopped:i=null,onPinchStart:s=null,onPinching:n=null,onPinchEnd:a=null,signal:o}){this.#t=t,this.#i=i,this.#s=e,this.#r=s,this.#n=n,this.#l=a,this.#c=new AbortController,this.#o=AbortSignal.any([o,this.#c.signal]),t.addEventListener("touchstart",this.#d.bind(this),{passive:!1,signal:this.#o})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return O(this,"MIN_TOUCH_DISTANCE_TO_PINCH",35/(window.devicePixelRatio||1))}#d(t){if(this.#s?.()||t.touches.length<2)return;if(!this.#u){this.#u=new AbortController;let s=AbortSignal.any([this.#o,this.#u.signal]),n=this.#t,a={signal:s,passive:!1};n.addEventListener("touchmove",this.#f.bind(this),a),n.addEventListener("touchend",this.#a.bind(this),a),n.addEventListener("touchcancel",this.#a.bind(this),a),this.#r?.()}if(mt(t),t.touches.length!==2||this.#i?.()){this.#h=null;return}let[e,i]=t.touches;e.identifier>i.identifier&&([e,i]=[i,e]),this.#h={touch0X:e.screenX,touch0Y:e.screenY,touch1X:i.screenX,touch1Y:i.screenY}}#f(t){if(!this.#h||t.touches.length!==2)return;let[e,i]=t.touches;e.identifier>i.identifier&&([e,i]=[i,e]);let{screenX:s,screenY:n}=e,{screenX:a,screenY:o}=i,l=this.#h,{touch0X:c,touch0Y:h,touch1X:d,touch1Y:u}=l,f=d-c,p=u-h,g=a-s,b=o-n,m=Math.hypot(g,b)||1,_=Math.hypot(f,p)||1;if(!this.#e&&Math.abs(_-m)<=r.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(l.touch0X=s,l.touch0Y=n,l.touch1X=a,l.touch1Y=o,t.preventDefault(),!this.#e){this.#e=!0;return}let y=[(s+a)/2,(n+o)/2];this.#n?.(y,_,m)}#a(t){this.#u.abort(),this.#u=null,this.#l?.(),this.#h&&(t.preventDefault(),this.#h=null,this.#e=!1)}destroy(){this.#c?.abort(),this.#c=null}},W=class r{#t=null;#e=null;#i=null;#s=!1;#r=null;#n="";#l=!1;#o=null;#h=null;#c=null;#u=null;#d="";#f=!1;#a=null;#p=!1;#m=!1;#g=!1;#b=null;#v=0;#_=0;#A=null;#C=null;_editToolbar=null;_initialOptions=Object.create(null);_initialData=null;_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;static _l10n=null;static _l10nResizer=null;#S=!1;#T=r._zIndex++;static _borderLineWidth=-1;static _colorManager=new Us;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){let t=r.prototype._resizeWithKeyboard,e=Le.TRANSLATE_SMALL,i=Le.TRANSLATE_BIG;return O(this,"_resizerKeyboardManager",new re([[["ArrowLeft","mac+ArrowLeft"],t,{args:[-e,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t,{args:[-i,0]}],[["ArrowRight","mac+ArrowRight"],t,{args:[e,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t,{args:[i,0]}],[["ArrowUp","mac+ArrowUp"],t,{args:[0,-e]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t,{args:[0,-i]}],[["ArrowDown","mac+ArrowDown"],t,{args:[0,e]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t,{args:[0,i]}],[["Escape","mac+Escape"],r.prototype._stopResizingWithKeyboard]]))}constructor(t){this.parent=t.parent,this.id=t.id,this.width=this.height=null,this.pageIndex=t.parent.pageIndex,this.name=t.name,this.div=null,this._uiManager=t.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=t.isCentered,this._structTreeParentId=null;let{rotation:e,rawDims:{pageWidth:i,pageHeight:s,pageX:n,pageY:a}}=this.parent.viewport;this.rotation=e,this.pageRotation=(360+e-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[i,s],this.pageTranslation=[n,a];let[o,l]=this.parentDimensions;this.x=t.x/o,this.y=t.y/l,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get isDrawer(){return!1}static get _defaultLineColor(){return O(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(t){let e=new $s({id:t.parent.getNextId(),parent:t.parent,uiManager:t._uiManager});e.annotationElementId=t.annotationElementId,e.deleted=!0,e._uiManager.addToAnnotationStorage(e)}static initialize(t,e){if(r._l10n??=t,r._l10nResizer||=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"}),r._borderLineWidth!==-1)return;let i=getComputedStyle(document.documentElement);r._borderLineWidth=parseFloat(i.getPropertyValue("--outline-width"))||0}static updateDefaultParams(t,e){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(t){return!1}static paste(t,e){G("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#S}set _isDraggable(t){this.#S=t,this.div?.classList.toggle("draggable",t)}get isEnterHandled(){return!0}center(){let[t,e]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*e/(t*2),this.y+=this.width*t/(e*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*e/(t*2),this.y-=this.width*t/(e*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(t){this._uiManager.addCommands(t)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#T}setParent(t){t!==null?(this.pageIndex=t.pageIndex,this.pageDimensions=t.pageDimensions):this.#B(),this.parent=t}focusin(t){this._focusEventsAllowed&&(this.#f?this.#f=!1:this.parent.setSelected(this))}focusout(t){!this._focusEventsAllowed||!this.isAttachedToDOM||t.relatedTarget?.closest(`#${this.id}`)||(t.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(t,e,i,s){let[n,a]=this.parentDimensions;[i,s]=this.screenToPageTranslation(i,s),this.x=(t+i)/n,this.y=(e+s)/a,this.fixAndSetPosition()}#I([t,e],i,s){[i,s]=this.screenToPageTranslation(i,s),this.x+=i/t,this.y+=s/e,this._onTranslating(this.x,this.y),this.fixAndSetPosition()}translate(t,e){this.#I(this.parentDimensions,t,e)}translateInPage(t,e){this.#a||=[this.x,this.y,this.width,this.height],this.#I(this.pageDimensions,t,e),this.div.scrollIntoView({block:"nearest"})}drag(t,e){this.#a||=[this.x,this.y,this.width,this.height];let{div:i,parentDimensions:[s,n]}=this;if(this.x+=t/s,this.y+=e/n,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){let{x:d,y:u}=this.div.getBoundingClientRect();this.parent.findNewParent(this,d,u)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:a,y:o}=this,[l,c]=this.getBaseTranslation();a+=l,o+=c;let{style:h}=i;h.left=`${(100*a).toFixed(2)}%`,h.top=`${(100*o).toFixed(2)}%`,this._onTranslating(a,o),i.scrollIntoView({block:"nearest"})}_onTranslating(t,e){}_onTranslated(t,e){}get _hasBeenMoved(){return!!this.#a&&(this.#a[0]!==this.x||this.#a[1]!==this.y)}get _hasBeenResized(){return!!this.#a&&(this.#a[2]!==this.width||this.#a[3]!==this.height)}getBaseTranslation(){let[t,e]=this.parentDimensions,{_borderLineWidth:i}=r,s=i/t,n=i/e;switch(this.rotation){case 90:return[-s,n];case 180:return[s,n];case 270:return[s,-n];default:return[-s,-n]}}get _mustFixPosition(){return!0}fixAndSetPosition(t=this.rotation){let{div:{style:e},pageDimensions:[i,s]}=this,{x:n,y:a,width:o,height:l}=this;if(o*=i,l*=s,n*=i,a*=s,this._mustFixPosition)switch(t){case 0:n=Math.max(0,Math.min(i-o,n)),a=Math.max(0,Math.min(s-l,a));break;case 90:n=Math.max(0,Math.min(i-l,n)),a=Math.min(s,Math.max(o,a));break;case 180:n=Math.min(i,Math.max(o,n)),a=Math.min(s,Math.max(l,a));break;case 270:n=Math.min(i,Math.max(l,n)),a=Math.max(0,Math.min(s-o,a));break}this.x=n/=i,this.y=a/=s;let[c,h]=this.getBaseTranslation();n+=c,a+=h,e.left=`${(100*n).toFixed(2)}%`,e.top=`${(100*a).toFixed(2)}%`,this.moveInDOM()}static#w(t,e,i){switch(i){case 90:return[e,-t];case 180:return[-t,-e];case 270:return[-e,t];default:return[t,e]}}screenToPageTranslation(t,e){return r.#w(t,e,this.parentRotation)}pageTranslationToScreen(t,e){return r.#w(t,e,360-this.parentRotation)}#M(t){switch(t){case 90:{let[e,i]=this.pageDimensions;return[0,-e/i,i/e,0]}case 180:return[-1,0,0,-1];case 270:{let[e,i]=this.pageDimensions;return[0,e/i,-i/e,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){let{parentScale:t,pageDimensions:[e,i]}=this;return[e*t,i*t]}setDims(t,e){let[i,s]=this.parentDimensions,{style:n}=this.div;n.width=`${(100*t/i).toFixed(2)}%`,this.#l||(n.height=`${(100*e/s).toFixed(2)}%`)}fixDims(){let{style:t}=this.div,{height:e,width:i}=t,s=i.endsWith("%"),n=!this.#l&&e.endsWith("%");if(s&&n)return;let[a,o]=this.parentDimensions;s||(t.width=`${(100*parseFloat(i)/a).toFixed(2)}%`),!this.#l&&!n&&(t.height=`${(100*parseFloat(e)/o).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}#x(){if(this.#o)return;this.#o=document.createElement("div"),this.#o.classList.add("resizers");let t=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],e=this._uiManager._signal;for(let i of t){let s=document.createElement("div");this.#o.append(s),s.classList.add("resizer",i),s.setAttribute("data-resizer-name",i),s.addEventListener("pointerdown",this.#P.bind(this,i),{signal:e}),s.addEventListener("contextmenu",xt,{signal:e}),s.tabIndex=-1}this.div.prepend(this.#o)}#P(t,e){e.preventDefault();let{isMac:i}=rt.platform;if(e.button!==0||e.ctrlKey&&i)return;this.#i?.toggle(!1);let s=this._isDraggable;this._isDraggable=!1,this.#h=[e.screenX,e.screenY];let n=new AbortController,a=this._uiManager.combinedSignal(n);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",this.#E.bind(this,t),{passive:!0,capture:!0,signal:a}),window.addEventListener("touchmove",mt,{passive:!1,signal:a}),window.addEventListener("contextmenu",xt,{signal:a}),this.#c={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};let o=this.parent.div.style.cursor,l=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(e.target).cursor;let c=()=>{n.abort(),this.parent.togglePointerEvents(!0),this.#i?.toggle(!0),this._isDraggable=s,this.parent.div.style.cursor=o,this.div.style.cursor=l,this.#L()};window.addEventListener("pointerup",c,{signal:a}),window.addEventListener("blur",c,{signal:a})}#O(t,e,i,s){this.width=i,this.height=s,this.x=t,this.y=e;let[n,a]=this.parentDimensions;this.setDims(n*i,a*s),this.fixAndSetPosition(),this._onResized()}_onResized(){}#L(){if(!this.#c)return;let{savedX:t,savedY:e,savedWidth:i,savedHeight:s}=this.#c;this.#c=null;let n=this.x,a=this.y,o=this.width,l=this.height;n===t&&a===e&&o===i&&l===s||this.addCommands({cmd:this.#O.bind(this,n,a,o,l),undo:this.#O.bind(this,t,e,i,s),mustExec:!0})}static _round(t){return Math.round(t*1e4)/1e4}#E(t,e){let[i,s]=this.parentDimensions,n=this.x,a=this.y,o=this.width,l=this.height,c=r.MIN_SIZE/i,h=r.MIN_SIZE/s,d=this.#M(this.rotation),u=(x,M)=>[d[0]*x+d[2]*M,d[1]*x+d[3]*M],f=this.#M(360-this.rotation),p=(x,M)=>[f[0]*x+f[2]*M,f[1]*x+f[3]*M],g,b,m=!1,_=!1;switch(t){case"topLeft":m=!0,g=(x,M)=>[0,0],b=(x,M)=>[x,M];break;case"topMiddle":g=(x,M)=>[x/2,0],b=(x,M)=>[x/2,M];break;case"topRight":m=!0,g=(x,M)=>[x,0],b=(x,M)=>[0,M];break;case"middleRight":_=!0,g=(x,M)=>[x,M/2],b=(x,M)=>[0,M/2];break;case"bottomRight":m=!0,g=(x,M)=>[x,M],b=(x,M)=>[0,0];break;case"bottomMiddle":g=(x,M)=>[x/2,M],b=(x,M)=>[x/2,0];break;case"bottomLeft":m=!0,g=(x,M)=>[0,M],b=(x,M)=>[x,0];break;case"middleLeft":_=!0,g=(x,M)=>[0,M/2],b=(x,M)=>[x,M/2];break}let y=g(o,l),v=b(o,l),A=u(...v),E=r._round(n+A[0]),C=r._round(a+A[1]),I=1,R=1,V,F;if(e.fromKeyboard)({deltaX:V,deltaY:F}=e);else{let{screenX:x,screenY:M}=e,[bt,Tt]=this.#h;[V,F]=this.screenToPageTranslation(x-bt,M-Tt),this.#h[0]=x,this.#h[1]=M}if([V,F]=p(V/i,F/s),m){let x=Math.hypot(o,l);I=R=Math.max(Math.min(Math.hypot(v[0]-y[0]-V,v[1]-y[1]-F)/x,1/o,1/l),c/o,h/l)}else _?I=Math.max(c,Math.min(1,Math.abs(v[0]-y[0]-V)))/o:R=Math.max(h,Math.min(1,Math.abs(v[1]-y[1]-F)))/l;let q=r._round(o*I),Z=r._round(l*R);A=u(...b(q,Z));let H=E-A[0],dt=C-A[1];this.#a||=[this.x,this.y,this.width,this.height],this.width=q,this.height=Z,this.x=H,this.y=dt,this.setDims(i*q,s*Z),this.fixAndSetPosition(),this._onResizing()}_onResizing(){}altTextFinish(){this.#i?.finish()}addEditToolbar(){return w(this,null,function*(){return this._editToolbar||this.#m?this._editToolbar:(this._editToolbar=new Vs(this),this.div.append(this._editToolbar.render()),this.#i&&(yield this._editToolbar.addAltText(this.#i)),this._editToolbar)})}removeEditToolbar(){this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,this.#i?.destroy())}addContainer(t){let e=this._editToolbar?.div;e?e.before(t):this.div.append(t)}getClientDimensions(){return this.div.getBoundingClientRect()}addAltTextButton(){return w(this,null,function*(){this.#i||(zr.initialize(r._l10n),this.#i=new zr(this),this.#t&&(this.#i.data=this.#t,this.#t=null),yield this.addEditToolbar())})}get altTextData(){return this.#i?.data}set altTextData(t){this.#i&&(this.#i.data=t)}get guessedAltText(){return this.#i?.guessedText}setGuessedAltText(t){return w(this,null,function*(){yield this.#i?.setGuessedText(t)})}serializeAltText(t){return this.#i?.serialize(t)}hasAltText(){return!!this.#i&&!this.#i.isEmpty()}hasAltTextData(){return this.#i?.hasData()??!1}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.tabIndex=this.#s?-1:0,this._isVisible||this.div.classList.add("hidden"),this.setInForeground(),this.#N();let[t,e]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*e/t).toFixed(2)}%`,this.div.style.maxHeight=`${(100*t/e).toFixed(2)}%`);let[i,s]=this.getInitialTranslation();return this.translate(i,s),bi(this,this.div,["pointerdown"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(this.#C||=new _i({container:this.div,isPinchingDisabled:()=>!this.isSelected,onPinchStart:this.#y.bind(this),onPinching:this.#D.bind(this),onPinchEnd:this.#G.bind(this),signal:this._uiManager._signal})),this._uiManager._editorUndoBar?.hide(),this.div}#y(){this.#c={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height},this.#i?.toggle(!1),this.parent.togglePointerEvents(!1)}#D(t,e,i){let n=.7*(i/e)+1-.7;if(n===1)return;let a=this.#M(this.rotation),o=(E,C)=>[a[0]*E+a[2]*C,a[1]*E+a[3]*C],[l,c]=this.parentDimensions,h=this.x,d=this.y,u=this.width,f=this.height,p=r.MIN_SIZE/l,g=r.MIN_SIZE/c;n=Math.max(Math.min(n,1/u,1/f),p/u,g/f);let b=r._round(u*n),m=r._round(f*n);if(b===u&&m===f)return;this.#a||=[h,d,u,f];let _=o(u/2,f/2),y=r._round(h+_[0]),v=r._round(d+_[1]),A=o(b/2,m/2);this.x=y-A[0],this.y=v-A[1],this.width=b,this.height=m,this.setDims(l*b,c*m),this.fixAndSetPosition(),this._onResizing()}#G(){this.#i?.toggle(!0),this.parent.togglePointerEvents(!0),this.#L()}pointerdown(t){let{isMac:e}=rt.platform;if(t.button!==0||t.ctrlKey&&e){t.preventDefault();return}if(this.#f=!0,this._isDraggable){this.#U(t);return}this.#j(t)}get isSelected(){return this._uiManager.isSelected(this)}#j(t){let{isMac:e}=rt.platform;t.ctrlKey&&!e||t.shiftKey||t.metaKey&&e?this.parent.toggleSelected(this):this.parent.setSelected(this)}#U(t){let{isSelected:e}=this;this._uiManager.setUpDragSession();let i=!1,s=new AbortController,n=this._uiManager.combinedSignal(s),a={capture:!0,passive:!1,signal:n},o=c=>{s.abort(),this.#r=null,this.#f=!1,this._uiManager.endDragSession()||this.#j(c),i&&this._onStopDragging()};e&&(this.#v=t.clientX,this.#_=t.clientY,this.#r=t.pointerId,this.#n=t.pointerType,window.addEventListener("pointermove",c=>{i||(i=!0,this._onStartDragging());let{clientX:h,clientY:d,pointerId:u}=c;if(u!==this.#r){mt(c);return}let[f,p]=this.screenToPageTranslation(h-this.#v,d-this.#_);this.#v=h,this.#_=d,this._uiManager.dragSelectedEditors(f,p)},a),window.addEventListener("touchmove",mt,a),window.addEventListener("pointerdown",c=>{c.pointerType===this.#n&&(this.#C||c.isPrimary)&&o(c),mt(c)},a));let l=c=>{if(!this.#r||this.#r===c.pointerId){o(c);return}mt(c)};window.addEventListener("pointerup",l,{signal:n}),window.addEventListener("blur",l,{signal:n})}_onStartDragging(){}_onStopDragging(){}moveInDOM(){this.#b&&clearTimeout(this.#b),this.#b=setTimeout(()=>{this.#b=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(t,e,i){t.changeParent(this),this.x=e,this.y=i,this.fixAndSetPosition(),this._onTranslated()}getRect(t,e,i=this.rotation){let s=this.parentScale,[n,a]=this.pageDimensions,[o,l]=this.pageTranslation,c=t/s,h=e/s,d=this.x*n,u=this.y*a,f=this.width*n,p=this.height*a;switch(i){case 0:return[d+c+o,a-u-h-p+l,d+c+f+o,a-u-h+l];case 90:return[d+h+o,a-u+c+l,d+h+p+o,a-u+c+f+l];case 180:return[d-c-f+o,a-u+h+l,d-c+o,a-u+h+p+l];case 270:return[d-h-p+o,a-u-c-f+l,d-h+o,a-u-c+l];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(t,e){let[i,s,n,a]=t,o=n-i,l=a-s;switch(this.rotation){case 0:return[i,e-a,o,l];case 90:return[i,e-s,l,o];case 180:return[n,e-s,o,l];case 270:return[n,e-a,l,o];default:throw new Error("Invalid rotation")}}onceAdded(t){}isEmpty(){return!1}enableEditMode(){this.#m=!0}disableEditMode(){this.#m=!1}isInEditMode(){return this.#m}shouldGetKeyboardEvents(){return this.#g}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){let{top:t,left:e,bottom:i,right:s}=this.getClientDimensions(),{innerHeight:n,innerWidth:a}=window;return e<a&&s>0&&t<n&&i>0}#N(){if(this.#u||!this.div)return;this.#u=new AbortController;let t=this._uiManager.combinedSignal(this.#u);this.div.addEventListener("focusin",this.focusin.bind(this),{signal:t}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:t})}rebuild(){this.#N()}rotate(t){}resize(){}serializeDeleted(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(t=!1,e=null){G("An editor must be serializable")}static deserialize(t,e,i){return w(this,null,function*(){let s=new this.prototype.constructor({parent:e,id:e.getNextId(),uiManager:i});s.rotation=t.rotation,s.#t=t.accessibilityData;let[n,a]=s.pageDimensions,[o,l,c,h]=s.getRectInCurrentCoords(t.rect,a);return s.x=o/n,s.y=l/a,s.width=c/n,s.height=h/a,s})}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){if(this.#u?.abort(),this.#u=null,this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.#b&&(clearTimeout(this.#b),this.#b=null),this.#B(),this.removeEditToolbar(),this.#A){for(let t of this.#A.values())clearTimeout(t);this.#A=null}this.parent=null,this.#C?.destroy(),this.#C=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#x(),this.#o.classList.remove("hidden"),bi(this,this.div,["keydown"]))}get toolbarPosition(){return null}keydown(t){if(!this.isResizable||t.target!==this.div||t.key!=="Enter")return;this._uiManager.setSelected(this),this.#c={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};let e=this.#o.children;if(!this.#e){this.#e=Array.from(e);let a=this.#F.bind(this),o=this.#V.bind(this),l=this._uiManager._signal;for(let c of this.#e){let h=c.getAttribute("data-resizer-name");c.setAttribute("role","spinbutton"),c.addEventListener("keydown",a,{signal:l}),c.addEventListener("blur",o,{signal:l}),c.addEventListener("focus",this.#$.bind(this,h),{signal:l}),c.setAttribute("data-l10n-id",r._l10nResizer[h])}}let i=this.#e[0],s=0;for(let a of e){if(a===i)break;s++}let n=(360-this.rotation+this.parentRotation)%360/90*(this.#e.length/4);if(n!==s){if(n<s)for(let o=0;o<s-n;o++)this.#o.append(this.#o.firstChild);else if(n>s)for(let o=0;o<n-s;o++)this.#o.firstChild.before(this.#o.lastChild);let a=0;for(let o of e){let c=this.#e[a++].getAttribute("data-resizer-name");o.setAttribute("data-l10n-id",r._l10nResizer[c])}}this.#k(0),this.#g=!0,this.#o.firstChild.focus({focusVisible:!0}),t.preventDefault(),t.stopImmediatePropagation()}#F(t){r._resizerKeyboardManager.exec(this,t)}#V(t){this.#g&&t.relatedTarget?.parentNode!==this.#o&&this.#B()}#$(t){this.#d=this.#g?t:""}#k(t){if(this.#e)for(let e of this.#e)e.tabIndex=t}_resizeWithKeyboard(t,e){this.#g&&this.#E(this.#d,{deltaX:t,deltaY:e,fromKeyboard:!0})}#B(){this.#g=!1,this.#k(-1),this.#L()}_stopResizingWithKeyboard(){this.#B(),this.div.focus()}select(){if(this.makeResizable(),this.div?.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this._editToolbar?.show()});return}this._editToolbar?.show(),this.#i?.toggleAltTextBadge(!1)}unselect(){this.#o?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this._editToolbar?.hide(),this.#i?.toggleAltTextBadge(!0)}updateParams(t,e){}disableEditing(){}enableEditing(){}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return this.#p}set isEditing(t){this.#p=t,this.parent&&(t?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(t,e){this.#l=!0;let i=t/e,{style:s}=this.div;s.aspectRatio=i,s.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(t,e=!1){if(e){this.#A||=new Map;let{action:i}=t,s=this.#A.get(i);s&&clearTimeout(s),s=setTimeout(()=>{this._reportTelemetry(t),this.#A.delete(i),this.#A.size===0&&(this.#A=null)},r._telemetryTimeout),this.#A.set(i,s);return}t.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:t}})}show(t=this._isVisible){this.div.classList.toggle("hidden",!t),this._isVisible=t}enable(){this.div&&(this.div.tabIndex=0),this.#s=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#s=!0}renderAnnotationElement(t){let e=t.container.querySelector(".annotationContent");if(!e)e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),t.container.prepend(e);else if(e.nodeName==="CANVAS"){let i=e;e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),i.before(e)}return e}resetAnnotationElement(t){let{firstChild:e}=t.container;e?.nodeName==="DIV"&&e.classList.contains("annotationContent")&&e.remove()}},$s=class extends W{constructor(t){super(t),this.annotationElementId=t.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}},Wr=3285377520,At=4294901760,Ft=65535,yi=class{constructor(t){this.h1=t?t&4294967295:Wr,this.h2=t?t&4294967295:Wr}update(t){let e,i;if(typeof t=="string"){e=new Uint8Array(t.length*2),i=0;for(let g=0,b=t.length;g<b;g++){let m=t.charCodeAt(g);m<=255?e[i++]=m:(e[i++]=m>>>8,e[i++]=m&255)}}else if(ArrayBuffer.isView(t))e=t.slice(),i=e.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");let s=i>>2,n=i-s*4,a=new Uint32Array(e.buffer,0,s),o=0,l=0,c=this.h1,h=this.h2,d=3432918353,u=461845907,f=d&Ft,p=u&Ft;for(let g=0;g<s;g++)g&1?(o=a[g],o=o*d&At|o*f&Ft,o=o<<15|o>>>17,o=o*u&At|o*p&Ft,c^=o,c=c<<13|c>>>19,c=c*5+3864292196):(l=a[g],l=l*d&At|l*f&Ft,l=l<<15|l>>>17,l=l*u&At|l*p&Ft,h^=l,h=h<<13|h>>>19,h=h*5+3864292196);switch(o=0,n){case 3:o^=e[s*4+2]<<16;case 2:o^=e[s*4+1]<<8;case 1:o^=e[s*4],o=o*d&At|o*f&Ft,o=o<<15|o>>>17,o=o*u&At|o*p&Ft,s&1?c^=o:h^=o}this.h1=c,this.h2=h}hexdigest(){let t=this.h1,e=this.h2;return t^=e>>>1,t=t*3981806797&At|t*36045&Ft,e=e*4283543511&At|((e<<16|t>>>16)*2950163797&At)>>>16,t^=e>>>1,t=t*444984403&At|t*60499&Ft,e=e*3301882366&At|((e<<16|t>>>16)*3120437893&At)>>>16,t^=e>>>1,(t>>>0).toString(16).padStart(8,"0")+(e>>>0).toString(16).padStart(8,"0")}},zs=Object.freeze({map:null,hash:"",transfer:void 0}),Ne=class{#t=!1;#e=null;#i=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(t,e){let i=this.#i.get(t);return i===void 0?e:Object.assign(e,i)}getRawValue(t){return this.#i.get(t)}remove(t){if(this.#i.delete(t),this.#i.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(let e of this.#i.values())if(e instanceof W)return;this.onAnnotationEditor(null)}}setValue(t,e){let i=this.#i.get(t),s=!1;if(i!==void 0)for(let[n,a]of Object.entries(e))i[n]!==a&&(s=!0,i[n]=a);else s=!0,this.#i.set(t,e);s&&this.#s(),e instanceof W&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(e.constructor._type)}has(t){return this.#i.has(t)}getAll(){return this.#i.size>0?ir(this.#i):null}setAll(t){for(let[e,i]of Object.entries(t))this.setValue(e,i)}get size(){return this.#i.size}#s(){this.#t||(this.#t=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#t&&(this.#t=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new vi(this)}get serializable(){if(this.#i.size===0)return zs;let t=new Map,e=new yi,i=[],s=Object.create(null),n=!1;for(let[a,o]of this.#i){let l=o instanceof W?o.serialize(!1,s):o;l&&(t.set(a,l),e.update(`${a}:${JSON.stringify(l)}`),n||=!!l.bitmap)}if(n)for(let a of t.values())a.bitmap&&i.push(a.bitmap);return t.size>0?{map:t,hash:e.hexdigest(),transfer:i}:zs}get editorStats(){let t=null,e=new Map;for(let i of this.#i.values()){if(!(i instanceof W))continue;let s=i.telemetryFinalData;if(!s)continue;let{type:n}=s;e.has(n)||e.set(n,Object.getPrototypeOf(i).constructor),t||=Object.create(null);let a=t[n]||=new Map;for(let[o,l]of Object.entries(s)){if(o==="type")continue;let c=a.get(o);c||(c=new Map,a.set(o,c));let h=c.get(l)??0;c.set(l,h+1)}}for(let[i,s]of e)t[i]=s.computeTelemetryFinalData(t[i]);return t}resetModifiedIds(){this.#e=null}get modifiedIds(){if(this.#e)return this.#e;let t=[];for(let e of this.#i.values())!(e instanceof W)||!e.annotationElementId||!e.serialize()||t.push(e.annotationElementId);return this.#e={ids:new Set(t),hash:t.join(",")}}},vi=class extends Ne{#t;constructor(t){super();let{map:e,hash:i,transfer:s}=t.serializable,n=structuredClone(e,s?{transfer:s}:null);this.#t={map:n,hash:i,transfer:s}}get print(){G("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#t}get modifiedIds(){return O(this,"modifiedIds",{ids:new Set,hash:""})}},Ws=class{#t=new Set;constructor({ownerDocument:t=globalThis.document,styleElement:e=null}){this._document=t,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(t){this.nativeFontFaces.add(t),this._document.fonts.add(t)}removeNativeFontFace(t){this.nativeFontFaces.delete(t),this._document.fonts.delete(t)}insertRule(t){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));let e=this.styleElement.sheet;e.insertRule(t,e.cssRules.length)}clear(){for(let t of this.nativeFontFaces)this._document.fonts.delete(t);this.nativeFontFaces.clear(),this.#t.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}loadSystemFont(i){return w(this,arguments,function*({systemFontInfo:t,_inspectFont:e}){if(!(!t||this.#t.has(t.loadedName))){if(Q(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){let{loadedName:s,src:n,style:a}=t,o=new FontFace(s,n,a);this.addNativeFontFace(o);try{yield o.load(),this.#t.add(s),e?.(t)}catch{D(`Cannot load system font: ${t.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(o)}return}G("Not implemented: loadSystemFont without the Font Loading API.")}})}bind(t){return w(this,null,function*(){if(t.attached||t.missingFile&&!t.systemFontInfo)return;if(t.attached=!0,t.systemFontInfo){yield this.loadSystemFont(t);return}if(this.isFontLoadingAPISupported){let i=t.createNativeFontFace();if(i){this.addNativeFontFace(i);try{yield i.loaded}catch(s){throw D(`Failed to load font '${i.family}': '${s}'.`),t.disableFontFace=!0,s}}return}let e=t.createFontFaceRule();if(e){if(this.insertRule(e),this.isSyncFontLoadingSupported)return;yield new Promise(i=>{let s=this._queueLoadingCallback(i);this._prepareFontLoadEvent(t,s)})}})}get isFontLoadingAPISupported(){let t=!!this._document?.fonts;return O(this,"isFontLoadingAPISupported",t)}get isSyncFontLoadingSupported(){let t=!1;return(lt||typeof navigator<"u"&&typeof navigator?.userAgent=="string"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(t=!0),O(this,"isSyncFontLoadingSupported",t)}_queueLoadingCallback(t){function e(){for(Q(!s.done,"completeRequest() cannot be called twice."),s.done=!0;i.length>0&&i[0].done;){let n=i.shift();setTimeout(n.callback,0)}}let{loadingRequests:i}=this,s={done:!1,complete:e,callback:t};return i.push(s),s}get _loadTestFont(){let t=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return O(this,"_loadTestFont",t)}_prepareFontLoadEvent(t,e){function i(v,A){return v.charCodeAt(A)<<24|v.charCodeAt(A+1)<<16|v.charCodeAt(A+2)<<8|v.charCodeAt(A+3)&255}function s(v,A,E,C){let I=v.substring(0,A),R=v.substring(A+E);return I+C+R}let n,a,o=this._document.createElement("canvas");o.width=1,o.height=1;let l=o.getContext("2d"),c=0;function h(v,A){if(++c>30){D("Load test font never loaded."),A();return}if(l.font="30px "+v,l.fillText(".",0,20),l.getImageData(0,0,1,1).data[3]>0){A();return}setTimeout(h.bind(null,v,A))}let d=`lt${Date.now()}${this.loadTestFontId++}`,u=this._loadTestFont;u=s(u,976,d.length,d);let p=16,g=1482184792,b=i(u,p);for(n=0,a=d.length-3;n<a;n+=4)b=b-g+i(d,n)|0;n<d.length&&(b=b-g+i(d+"XXX",n)|0),u=s(u,p,4,vo(b));let m=`url(data:font/opentype;base64,${btoa(u)});`,_=`@font-face {font-family:"${d}";src:${m}}`;this.insertRule(_);let y=this._document.createElement("div");y.style.visibility="hidden",y.style.width=y.style.height="10px",y.style.position="absolute",y.style.top=y.style.left="0px";for(let v of[t.loadedName,d]){let A=this._document.createElement("span");A.textContent="Hi",A.style.fontFamily=v,y.append(A)}this._document.body.append(y),h(d,()=>{y.remove(),e.complete()})}},qs=class{constructor(t,{disableFontFace:e=!1,fontExtraProperties:i=!1,inspectFont:s=null}){this.compiledGlyphs=Object.create(null);for(let n in t)this[n]=t[n];this.disableFontFace=e===!0,this.fontExtraProperties=i===!0,this._inspectFont=s}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let t;if(!this.cssFontInfo)t=new FontFace(this.loadedName,this.data,{});else{let e={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(e.style=`oblique ${this.cssFontInfo.italicAngle}deg`),t=new FontFace(this.cssFontInfo.fontFamily,this.data,e)}return this._inspectFont?.(this),t}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;let t=`url(data:${this.mimetype};base64,${xo(this.data)});`,e;if(!this.cssFontInfo)e=`@font-face {font-family:"${this.loadedName}";src:${t}}`;else{let i=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(i+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),e=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${i}src:${t}}`}return this._inspectFont?.(this,t),e}getPathGenerator(t,e){if(this.compiledGlyphs[e]!==void 0)return this.compiledGlyphs[e];let i=this.loadedName+"_path_"+e,s;try{s=t.get(i)}catch(a){D(`getPathGenerator - ignoring character: "${a}".`)}let n=new Path2D(s||"");return this.fontExtraProperties||t.delete(i),this.compiledGlyphs[e]=n}},li={DATA:1,ERROR:2},J={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function qr(){}function ft(r){if(r instanceof Lt||r instanceof ke||r instanceof se||r instanceof pi||r instanceof ge||r instanceof Pe)return r;switch(r instanceof Error||typeof r=="object"&&r!==null||G('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),r.name){case"AbortException":return new Lt(r.message);case"InvalidPDFException":return new ke(r.message);case"MissingPDFException":return new se(r.message);case"PasswordException":return new pi(r.message,r.code);case"UnexpectedResponseException":return new ge(r.message,r.status);case"UnknownErrorException":return new Pe(r.message,r.details)}return new Pe(r.message,r.toString())}var ee=class{#t=new AbortController;constructor(t,e,i){this.sourceName=t,this.targetName=e,this.comObj=i,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),i.addEventListener("message",this.#e.bind(this),{signal:this.#t.signal})}#e({data:t}){if(t.targetName!==this.sourceName)return;if(t.stream){this.#s(t);return}if(t.callback){let i=t.callbackId,s=this.callbackCapabilities[i];if(!s)throw new Error(`Cannot resolve callback ${i}`);if(delete this.callbackCapabilities[i],t.callback===li.DATA)s.resolve(t.data);else if(t.callback===li.ERROR)s.reject(ft(t.reason));else throw new Error("Unexpected callback case");return}let e=this.actionHandler[t.action];if(!e)throw new Error(`Unknown action from worker: ${t.action}`);if(t.callbackId){let i=this.sourceName,s=t.sourceName,n=this.comObj;Promise.try(e,t.data).then(function(a){n.postMessage({sourceName:i,targetName:s,callback:li.DATA,callbackId:t.callbackId,data:a})},function(a){n.postMessage({sourceName:i,targetName:s,callback:li.ERROR,callbackId:t.callbackId,reason:ft(a)})});return}if(t.streamId){this.#i(t);return}e(t.data)}on(t,e){let i=this.actionHandler;if(i[t])throw new Error(`There is already an actionName called "${t}"`);i[t]=e}send(t,e,i){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,data:e},i)}sendWithPromise(t,e,i){let s=this.callbackId++,n=Promise.withResolvers();this.callbackCapabilities[s]=n;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,callbackId:s,data:e},i)}catch(a){n.reject(a)}return n.promise}sendWithStream(t,e,i,s){let n=this.streamId++,a=this.sourceName,o=this.targetName,l=this.comObj;return new ReadableStream({start:c=>{let h=Promise.withResolvers();return this.streamControllers[n]={controller:c,startCall:h,pullCall:null,cancelCall:null,isClosed:!1},l.postMessage({sourceName:a,targetName:o,action:t,streamId:n,data:e,desiredSize:c.desiredSize},s),h.promise},pull:c=>{let h=Promise.withResolvers();return this.streamControllers[n].pullCall=h,l.postMessage({sourceName:a,targetName:o,stream:J.PULL,streamId:n,desiredSize:c.desiredSize}),h.promise},cancel:c=>{Q(c instanceof Error,"cancel must have a valid reason");let h=Promise.withResolvers();return this.streamControllers[n].cancelCall=h,this.streamControllers[n].isClosed=!0,l.postMessage({sourceName:a,targetName:o,stream:J.CANCEL,streamId:n,reason:ft(c)}),h.promise}},i)}#i(t){let e=t.streamId,i=this.sourceName,s=t.sourceName,n=this.comObj,a=this,o=this.actionHandler[t.action],l={enqueue(c,h=1,d){if(this.isCancelled)return;let u=this.desiredSize;this.desiredSize-=h,u>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),n.postMessage({sourceName:i,targetName:s,stream:J.ENQUEUE,streamId:e,chunk:c},d)},close(){this.isCancelled||(this.isCancelled=!0,n.postMessage({sourceName:i,targetName:s,stream:J.CLOSE,streamId:e}),delete a.streamSinks[e])},error(c){Q(c instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,n.postMessage({sourceName:i,targetName:s,stream:J.ERROR,streamId:e,reason:ft(c)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:t.desiredSize,ready:null};l.sinkCapability.resolve(),l.ready=l.sinkCapability.promise,this.streamSinks[e]=l,Promise.try(o,t.data,l).then(function(){n.postMessage({sourceName:i,targetName:s,stream:J.START_COMPLETE,streamId:e,success:!0})},function(c){n.postMessage({sourceName:i,targetName:s,stream:J.START_COMPLETE,streamId:e,reason:ft(c)})})}#s(t){let e=t.streamId,i=this.sourceName,s=t.sourceName,n=this.comObj,a=this.streamControllers[e],o=this.streamSinks[e];switch(t.stream){case J.START_COMPLETE:t.success?a.startCall.resolve():a.startCall.reject(ft(t.reason));break;case J.PULL_COMPLETE:t.success?a.pullCall.resolve():a.pullCall.reject(ft(t.reason));break;case J.PULL:if(!o){n.postMessage({sourceName:i,targetName:s,stream:J.PULL_COMPLETE,streamId:e,success:!0});break}o.desiredSize<=0&&t.desiredSize>0&&o.sinkCapability.resolve(),o.desiredSize=t.desiredSize,Promise.try(o.onPull||qr).then(function(){n.postMessage({sourceName:i,targetName:s,stream:J.PULL_COMPLETE,streamId:e,success:!0})},function(c){n.postMessage({sourceName:i,targetName:s,stream:J.PULL_COMPLETE,streamId:e,reason:ft(c)})});break;case J.ENQUEUE:if(Q(a,"enqueue should have stream controller"),a.isClosed)break;a.controller.enqueue(t.chunk);break;case J.CLOSE:if(Q(a,"close should have stream controller"),a.isClosed)break;a.isClosed=!0,a.controller.close(),this.#r(a,e);break;case J.ERROR:Q(a,"error should have stream controller"),a.controller.error(ft(t.reason)),this.#r(a,e);break;case J.CANCEL_COMPLETE:t.success?a.cancelCall.resolve():a.cancelCall.reject(ft(t.reason)),this.#r(a,e);break;case J.CANCEL:if(!o)break;let l=ft(t.reason);Promise.try(o.onCancel||qr,l).then(function(){n.postMessage({sourceName:i,targetName:s,stream:J.CANCEL_COMPLETE,streamId:e,success:!0})},function(c){n.postMessage({sourceName:i,targetName:s,stream:J.CANCEL_COMPLETE,streamId:e,reason:ft(c)})}),o.sinkCapability.reject(l),o.isCancelled=!0,delete this.streamSinks[e];break;default:throw new Error("Unexpected stream case")}}#r(t,e){return w(this,null,function*(){yield Promise.allSettled([t.startCall?.promise,t.pullCall?.promise,t.cancelCall?.promise]),delete this.streamControllers[e]})}destroy(){this.#t?.abort(),this.#t=null}},Ai=class{#t=!1;constructor({enableHWA:t=!1}){this.#t=t}create(t,e){if(t<=0||e<=0)throw new Error("Invalid canvas size");let i=this._createCanvas(t,e);return{canvas:i,context:i.getContext("2d",{willReadFrequently:!this.#t})}}reset(t,e,i){if(!t.canvas)throw new Error("Canvas is not specified");if(e<=0||i<=0)throw new Error("Invalid canvas size");t.canvas.width=e,t.canvas.height=i}destroy(t){if(!t.canvas)throw new Error("Canvas is not specified");t.canvas.width=0,t.canvas.height=0,t.canvas=null,t.context=null}_createCanvas(t,e){G("Abstract method `_createCanvas` called.")}},Xs=class extends Ai{constructor({ownerDocument:t=globalThis.document,enableHWA:e=!1}){super({enableHWA:e}),this._document=t}_createCanvas(t,e){let i=this._document.createElement("canvas");return i.width=t,i.height=e,i}},wi=class{constructor({baseUrl:t=null,isCompressed:e=!0}){this.baseUrl=t,this.isCompressed=e}fetch(e){return w(this,arguments,function*({name:t}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!t)throw new Error("CMap name must be specified.");let i=this.baseUrl+t+(this.isCompressed?".bcmap":"");return this._fetch(i).then(s=>({cMapData:s,isCompressed:this.isCompressed})).catch(s=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${i}`)})})}_fetch(t){return w(this,null,function*(){G("Abstract method `_fetch` called.")})}},Ci=class extends wi{_fetch(t){return w(this,null,function*(){let e=yield Xi(t,this.isCompressed?"arraybuffer":"text");return e instanceof ArrayBuffer?new Uint8Array(e):qi(e)})}},Ei=class{addFilter(t){return"none"}addHCMFilter(t,e){return"none"}addAlphaFilter(t){return"none"}addLuminosityFilter(t){return"none"}addHighlightHCMFilter(t,e,i,s,n){return"none"}destroy(t=!1){}},Ys=class extends Ei{#t;#e;#i;#s;#r;#n;#l=0;constructor({docId:t,ownerDocument:e=globalThis.document}){super(),this.#s=t,this.#r=e}get#o(){return this.#e||=new Map}get#h(){return this.#n||=new Map}get#c(){if(!this.#i){let t=this.#r.createElement("div"),{style:e}=t;e.visibility="hidden",e.contain="strict",e.width=e.height=0,e.position="absolute",e.top=e.left=0,e.zIndex=-1;let i=this.#r.createElementNS(Vt,"svg");i.setAttribute("width",0),i.setAttribute("height",0),this.#i=this.#r.createElementNS(Vt,"defs"),t.append(i),i.append(this.#i),this.#r.body.append(t)}return this.#i}#u(t){if(t.length===1){let l=t[0],c=new Array(256);for(let d=0;d<256;d++)c[d]=l[d]/255;let h=c.join(",");return[h,h,h]}let[e,i,s]=t,n=new Array(256),a=new Array(256),o=new Array(256);for(let l=0;l<256;l++)n[l]=e[l]/255,a[l]=i[l]/255,o[l]=s[l]/255;return[n.join(","),a.join(","),o.join(",")]}#d(t){if(this.#t===void 0){this.#t="";let e=this.#r.URL;e!==this.#r.baseURI&&(Yi(e)?D('#createUrl: ignore "data:"-URL for performance reasons.'):this.#t=e.split("#",1)[0])}return`url(${this.#t}#${t})`}addFilter(t){if(!t)return"none";let e=this.#o.get(t);if(e)return e;let[i,s,n]=this.#u(t),a=t.length===1?i:`${i}${s}${n}`;if(e=this.#o.get(a),e)return this.#o.set(t,e),e;let o=`g_${this.#s}_transfer_map_${this.#l++}`,l=this.#d(o);this.#o.set(t,l),this.#o.set(a,l);let c=this.#p(o);return this.#g(i,s,n,c),l}addHCMFilter(t,e){let i=`${t}-${e}`,s="base",n=this.#h.get(s);if(n?.key===i||(n?(n.filter?.remove(),n.key=i,n.url="none",n.filter=null):(n={key:i,url:"none",filter:null},this.#h.set(s,n)),!t||!e))return n.url;let a=this.#v(t);t=T.makeHexColor(...a);let o=this.#v(e);if(e=T.makeHexColor(...o),this.#c.style.color="",t==="#000000"&&e==="#ffffff"||t===e)return n.url;let l=new Array(256);for(let f=0;f<=255;f++){let p=f/255;l[f]=p<=.03928?p/12.92:((p+.055)/1.055)**2.4}let c=l.join(","),h=`g_${this.#s}_hcm_filter`,d=n.filter=this.#p(h);this.#g(c,c,c,d),this.#a(d);let u=(f,p)=>{let g=a[f]/255,b=o[f]/255,m=new Array(p+1);for(let _=0;_<=p;_++)m[_]=g+_/p*(b-g);return m.join(",")};return this.#g(u(0,5),u(1,5),u(2,5),d),n.url=this.#d(h),n.url}addAlphaFilter(t){let e=this.#o.get(t);if(e)return e;let[i]=this.#u([t]),s=`alpha_${i}`;if(e=this.#o.get(s),e)return this.#o.set(t,e),e;let n=`g_${this.#s}_alpha_map_${this.#l++}`,a=this.#d(n);this.#o.set(t,a),this.#o.set(s,a);let o=this.#p(n);return this.#b(i,o),a}addLuminosityFilter(t){let e=this.#o.get(t||"luminosity");if(e)return e;let i,s;if(t?([i]=this.#u([t]),s=`luminosity_${i}`):s="luminosity",e=this.#o.get(s),e)return this.#o.set(t,e),e;let n=`g_${this.#s}_luminosity_map_${this.#l++}`,a=this.#d(n);this.#o.set(t,a),this.#o.set(s,a);let o=this.#p(n);return this.#f(o),t&&this.#b(i,o),a}addHighlightHCMFilter(t,e,i,s,n){let a=`${e}-${i}-${s}-${n}`,o=this.#h.get(t);if(o?.key===a||(o?(o.filter?.remove(),o.key=a,o.url="none",o.filter=null):(o={key:a,url:"none",filter:null},this.#h.set(t,o)),!e||!i))return o.url;let[l,c]=[e,i].map(this.#v.bind(this)),h=Math.round(.2126*l[0]+.7152*l[1]+.0722*l[2]),d=Math.round(.2126*c[0]+.7152*c[1]+.0722*c[2]),[u,f]=[s,n].map(this.#v.bind(this));d<h&&([h,d,u,f]=[d,h,f,u]),this.#c.style.color="";let p=(m,_,y)=>{let v=new Array(256),A=(d-h)/y,E=m/255,C=(_-m)/(255*y),I=0;for(let R=0;R<=y;R++){let V=Math.round(h+R*A),F=E+R*C;for(let q=I;q<=V;q++)v[q]=F;I=V+1}for(let R=I;R<256;R++)v[R]=v[I-1];return v.join(",")},g=`g_${this.#s}_hcm_${t}_filter`,b=o.filter=this.#p(g);return this.#a(b),this.#g(p(u[0],f[0],5),p(u[1],f[1],5),p(u[2],f[2],5),b),o.url=this.#d(g),o.url}destroy(t=!1){t&&this.#n?.size||(this.#i?.parentNode.parentNode.remove(),this.#i=null,this.#e?.clear(),this.#e=null,this.#n?.clear(),this.#n=null,this.#l=0)}#f(t){let e=this.#r.createElementNS(Vt,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(e)}#a(t){let e=this.#r.createElementNS(Vt,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(e)}#p(t){let e=this.#r.createElementNS(Vt,"filter");return e.setAttribute("color-interpolation-filters","sRGB"),e.setAttribute("id",t),this.#c.append(e),e}#m(t,e,i){let s=this.#r.createElementNS(Vt,e);s.setAttribute("type","discrete"),s.setAttribute("tableValues",i),t.append(s)}#g(t,e,i,s){let n=this.#r.createElementNS(Vt,"feComponentTransfer");s.append(n),this.#m(n,"feFuncR",t),this.#m(n,"feFuncG",e),this.#m(n,"feFuncB",i)}#b(t,e){let i=this.#r.createElementNS(Vt,"feComponentTransfer");e.append(i),this.#m(i,"feFuncA",t)}#v(t){return this.#c.style.color=t,rr(getComputedStyle(this.#c).getPropertyValue("color"))}},Si=class{constructor({baseUrl:t=null}){this.baseUrl=t}fetch(e){return w(this,arguments,function*({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!t)throw new Error("Font filename must be specified.");let i=`${this.baseUrl}${t}`;return this._fetch(i).catch(s=>{throw new Error(`Unable to load font data at: ${i}`)})})}_fetch(t){return w(this,null,function*(){G("Abstract method `_fetch` called.")})}},xi=class extends Si{_fetch(t){return w(this,null,function*(){let e=yield Xi(t,"arraybuffer");return new Uint8Array(e)})}};lt&&D("Please use the `legacy` build in Node.js environments.");function oa(r){return w(this,null,function*(){let e=yield process.getBuiltinModule("fs").promises.readFile(r);return new Uint8Array(e)})}var Ks=class extends Ei{},Js=class extends Ai{_createCanvas(t,e){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(t,e)}},Qs=class extends wi{_fetch(t){return w(this,null,function*(){return oa(t)})}},Zs=class extends Si{_fetch(t){return w(this,null,function*(){return oa(t)})}},ot={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function tn(r,t){if(!t)return;let e=t[2]-t[0],i=t[3]-t[1],s=new Path2D;s.rect(t[0],t[1],e,i),r.clip(s)}var Ve=class{getPattern(){G("Abstract method `getPattern` called.")}},en=class extends Ve{constructor(t){super(),this._type=t[1],this._bbox=t[2],this._colorStops=t[3],this._p0=t[4],this._p1=t[5],this._r0=t[6],this._r1=t[7],this.matrix=null}_createGradient(t){let e;this._type==="axial"?e=t.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(e=t.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(let i of this._colorStops)e.addColorStop(i[0],i[1]);return e}getPattern(t,e,i,s){let n;if(s===ot.STROKE||s===ot.FILL){let a=e.current.getClippedPathBoundingBox(s,z(t))||[0,0,0,0],o=Math.ceil(a[2]-a[0])||1,l=Math.ceil(a[3]-a[1])||1,c=e.cachedCanvases.getCanvas("pattern",o,l),h=c.context;h.clearRect(0,0,h.canvas.width,h.canvas.height),h.beginPath(),h.rect(0,0,h.canvas.width,h.canvas.height),h.translate(-a[0],-a[1]),i=T.transform(i,[1,0,0,1,a[0],a[1]]),h.transform(...e.baseTransform),this.matrix&&h.transform(...this.matrix),tn(h,this._bbox),h.fillStyle=this._createGradient(h),h.fill(),n=t.createPattern(c.canvas,"no-repeat");let d=new DOMMatrix(i);n.setTransform(d)}else tn(t,this._bbox),n=this._createGradient(t);return n}};function Ds(r,t,e,i,s,n,a,o){let l=t.coords,c=t.colors,h=r.data,d=r.width*4,u;l[e+1]>l[i+1]&&(u=e,e=i,i=u,u=n,n=a,a=u),l[i+1]>l[s+1]&&(u=i,i=s,s=u,u=a,a=o,o=u),l[e+1]>l[i+1]&&(u=e,e=i,i=u,u=n,n=a,a=u);let f=(l[e]+t.offsetX)*t.scaleX,p=(l[e+1]+t.offsetY)*t.scaleY,g=(l[i]+t.offsetX)*t.scaleX,b=(l[i+1]+t.offsetY)*t.scaleY,m=(l[s]+t.offsetX)*t.scaleX,_=(l[s+1]+t.offsetY)*t.scaleY;if(p>=_)return;let y=c[n],v=c[n+1],A=c[n+2],E=c[a],C=c[a+1],I=c[a+2],R=c[o],V=c[o+1],F=c[o+2],q=Math.round(p),Z=Math.round(_),H,dt,x,M,bt,Tt,Qt,_t;for(let it=q;it<=Z;it++){if(it<b){let U=it<p?0:(p-it)/(p-b);H=f-(f-g)*U,dt=y-(y-E)*U,x=v-(v-C)*U,M=A-(A-I)*U}else{let U;it>_?U=1:b===_?U=0:U=(b-it)/(b-_),H=g-(g-m)*U,dt=E-(E-R)*U,x=C-(C-V)*U,M=I-(I-F)*U}let K;it<p?K=0:it>_?K=1:K=(p-it)/(p-_),bt=f-(f-m)*K,Tt=y-(y-R)*K,Qt=v-(v-V)*K,_t=A-(A-F)*K;let ce=Math.round(Math.min(H,bt)),ve=Math.round(Math.max(H,bt)),yt=d*it+ce*4;for(let U=ce;U<=ve;U++)K=(H-U)/(H-bt),K<0?K=0:K>1&&(K=1),h[yt++]=dt-(dt-Tt)*K|0,h[yt++]=x-(x-Qt)*K|0,h[yt++]=M-(M-_t)*K|0,h[yt++]=255}}function Po(r,t,e){let i=t.coords,s=t.colors,n,a;switch(t.type){case"lattice":let o=t.verticesPerRow,l=Math.floor(i.length/o)-1,c=o-1;for(n=0;n<l;n++){let h=n*o;for(let d=0;d<c;d++,h++)Ds(r,e,i[h],i[h+1],i[h+o],s[h],s[h+1],s[h+o]),Ds(r,e,i[h+o+1],i[h+1],i[h+o],s[h+o+1],s[h+1],s[h+o])}break;case"triangles":for(n=0,a=i.length;n<a;n+=3)Ds(r,e,i[n],i[n+1],i[n+2],s[n],s[n+1],s[n+2]);break;default:throw new Error("illegal figure")}}var sn=class extends Ve{constructor(t){super(),this._coords=t[2],this._colors=t[3],this._figures=t[4],this._bounds=t[5],this._bbox=t[7],this._background=t[8],this.matrix=null}_createMeshCanvas(t,e,i){let o=Math.floor(this._bounds[0]),l=Math.floor(this._bounds[1]),c=Math.ceil(this._bounds[2])-o,h=Math.ceil(this._bounds[3])-l,d=Math.min(Math.ceil(Math.abs(c*t[0]*1.1)),3e3),u=Math.min(Math.ceil(Math.abs(h*t[1]*1.1)),3e3),f=c/d,p=h/u,g={coords:this._coords,colors:this._colors,offsetX:-o,offsetY:-l,scaleX:1/f,scaleY:1/p},b=d+2*2,m=u+2*2,_=i.getCanvas("mesh",b,m),y=_.context,v=y.createImageData(d,u);if(e){let E=v.data;for(let C=0,I=E.length;C<I;C+=4)E[C]=e[0],E[C+1]=e[1],E[C+2]=e[2],E[C+3]=255}for(let E of this._figures)Po(v,E,g);return y.putImageData(v,2,2),{canvas:_.canvas,offsetX:o-2*f,offsetY:l-2*p,scaleX:f,scaleY:p}}getPattern(t,e,i,s){tn(t,this._bbox);let n;if(s===ot.SHADING)n=T.singularValueDecompose2dScale(z(t));else if(n=T.singularValueDecompose2dScale(e.baseTransform),this.matrix){let o=T.singularValueDecompose2dScale(this.matrix);n=[n[0]*o[0],n[1]*o[1]]}let a=this._createMeshCanvas(n,s===ot.SHADING?null:this._background,e.cachedCanvases);return s!==ot.SHADING&&(t.setTransform(...e.baseTransform),this.matrix&&t.transform(...this.matrix)),t.translate(a.offsetX,a.offsetY),t.scale(a.scaleX,a.scaleY),t.createPattern(a.canvas,"no-repeat")}},nn=class extends Ve{getPattern(){return"hotpink"}};function ko(r){switch(r[0]){case"RadialAxial":return new en(r);case"Mesh":return new sn(r);case"Dummy":return new nn}throw new Error(`Unknown IR type: ${r[0]}`)}var Xr={COLORED:1,UNCOLORED:2},Do=(()=>{class r{static MAX_PATTERN_SIZE=3e3;constructor(e,i,s,n,a){this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.color=i,this.ctx=s,this.canvasGraphicsFactory=n,this.baseTransform=a}createPatternCanvas(e){let{bbox:i,operatorList:s,paintType:n,tilingType:a,color:o,canvasGraphicsFactory:l}=this,{xstep:c,ystep:h}=this;c=Math.abs(c),h=Math.abs(h),Wi("TilingType: "+a);let d=i[0],u=i[1],f=i[2],p=i[3],g=f-d,b=p-u,m=T.singularValueDecompose2dScale(this.matrix),_=T.singularValueDecompose2dScale(this.baseTransform),y=m[0]*_[0],v=m[1]*_[1],A=g,E=b,C=!1,I=!1,R=Math.ceil(c*y),V=Math.ceil(h*v),F=Math.ceil(g*y),q=Math.ceil(b*v);R>=F?A=c:C=!0,V>=q?E=h:I=!0;let Z=this.getSizeAndScale(A,this.ctx.canvas.width,y),H=this.getSizeAndScale(E,this.ctx.canvas.height,v),dt=e.cachedCanvases.getCanvas("pattern",Z.size,H.size),x=dt.context,M=l.createCanvasGraphics(x);if(M.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(M,n,o),x.translate(-Z.scale*d,-H.scale*u),M.transform(Z.scale,0,0,H.scale,0,0),x.save(),this.clipBbox(M,d,u,f,p),M.baseTransform=z(M.ctx),M.executeOperatorList(s),M.endDrawing(),x.restore(),C||I){let bt=dt.canvas;C&&(A=c),I&&(E=h);let Tt=this.getSizeAndScale(A,this.ctx.canvas.width,y),Qt=this.getSizeAndScale(E,this.ctx.canvas.height,v),_t=Tt.size,it=Qt.size,K=e.cachedCanvases.getCanvas("pattern-workaround",_t,it),ce=K.context,ve=C?Math.floor(g/c):0,yt=I?Math.floor(b/h):0;for(let U=0;U<=ve;U++)for(let Mt=0;Mt<=yt;Mt++)ce.drawImage(bt,_t*U,it*Mt,_t,it,0,0,_t,it);return{canvas:K.canvas,scaleX:Tt.scale,scaleY:Qt.scale,offsetX:d,offsetY:u}}return{canvas:dt.canvas,scaleX:Z.scale,scaleY:H.scale,offsetX:d,offsetY:u}}getSizeAndScale(e,i,s){let n=Math.max(r.MAX_PATTERN_SIZE,i),a=Math.ceil(e*s);return a>=n?a=n:s=a/e,{scale:s,size:a}}clipBbox(e,i,s,n,a){let o=n-i,l=a-s;e.ctx.rect(i,s,o,l),e.current.updateRectMinMax(z(e.ctx),[i,s,n,a]),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,i,s){let n=e.ctx,a=e.current;switch(i){case Xr.COLORED:let o=this.ctx;n.fillStyle=o.fillStyle,n.strokeStyle=o.strokeStyle,a.fillColor=o.fillStyle,a.strokeColor=o.strokeStyle;break;case Xr.UNCOLORED:let l=T.makeHexColor(s[0],s[1],s[2]);n.fillStyle=l,n.strokeStyle=l,a.fillColor=l,a.strokeColor=l;break;default:throw new Ns(`Unsupported paint type: ${i}`)}}getPattern(e,i,s,n){let a=s;n!==ot.SHADING&&(a=T.transform(a,i.baseTransform),this.matrix&&(a=T.transform(a,this.matrix)));let o=this.createPatternCanvas(i),l=new DOMMatrix(a);l=l.translate(o.offsetX,o.offsetY),l=l.scale(1/o.scaleX,1/o.scaleY);let c=e.createPattern(o.canvas,"repeat");return c.setTransform(l),c}}return r})();function Oo({src:r,srcPos:t=0,dest:e,width:i,height:s,nonBlackColor:n=4294967295,inverseDecode:a=!1}){let o=rt.isLittleEndian?4278190080:255,[l,c]=a?[n,o]:[o,n],h=i>>3,d=i&7,u=r.length;e=new Uint32Array(e.buffer);let f=0;for(let p=0;p<s;p++){for(let b=t+h;t<b;t++){let m=t<u?r[t]:255;e[f++]=m&128?c:l,e[f++]=m&64?c:l,e[f++]=m&32?c:l,e[f++]=m&16?c:l,e[f++]=m&8?c:l,e[f++]=m&4?c:l,e[f++]=m&2?c:l,e[f++]=m&1?c:l}if(d===0)continue;let g=t<u?r[t++]:255;for(let b=0;b<d;b++)e[f++]=g&1<<7-b?c:l}return{srcPos:t,destPos:f}}var Yr=16,Kr=100,Fo=15,Jr=10,Qr=1e3,pt=16;function Lo(r,t){if(r._removeMirroring)throw new Error("Context is already forwarding operations.");r.__originalSave=r.save,r.__originalRestore=r.restore,r.__originalRotate=r.rotate,r.__originalScale=r.scale,r.__originalTranslate=r.translate,r.__originalTransform=r.transform,r.__originalSetTransform=r.setTransform,r.__originalResetTransform=r.resetTransform,r.__originalClip=r.clip,r.__originalMoveTo=r.moveTo,r.__originalLineTo=r.lineTo,r.__originalBezierCurveTo=r.bezierCurveTo,r.__originalRect=r.rect,r.__originalClosePath=r.closePath,r.__originalBeginPath=r.beginPath,r._removeMirroring=()=>{r.save=r.__originalSave,r.restore=r.__originalRestore,r.rotate=r.__originalRotate,r.scale=r.__originalScale,r.translate=r.__originalTranslate,r.transform=r.__originalTransform,r.setTransform=r.__originalSetTransform,r.resetTransform=r.__originalResetTransform,r.clip=r.__originalClip,r.moveTo=r.__originalMoveTo,r.lineTo=r.__originalLineTo,r.bezierCurveTo=r.__originalBezierCurveTo,r.rect=r.__originalRect,r.closePath=r.__originalClosePath,r.beginPath=r.__originalBeginPath,delete r._removeMirroring},r.save=function(){t.save(),this.__originalSave()},r.restore=function(){t.restore(),this.__originalRestore()},r.translate=function(i,s){t.translate(i,s),this.__originalTranslate(i,s)},r.scale=function(i,s){t.scale(i,s),this.__originalScale(i,s)},r.transform=function(i,s,n,a,o,l){t.transform(i,s,n,a,o,l),this.__originalTransform(i,s,n,a,o,l)},r.setTransform=function(i,s,n,a,o,l){t.setTransform(i,s,n,a,o,l),this.__originalSetTransform(i,s,n,a,o,l)},r.resetTransform=function(){t.resetTransform(),this.__originalResetTransform()},r.rotate=function(i){t.rotate(i),this.__originalRotate(i)},r.clip=function(i){t.clip(i),this.__originalClip(i)},r.moveTo=function(e,i){t.moveTo(e,i),this.__originalMoveTo(e,i)},r.lineTo=function(e,i){t.lineTo(e,i),this.__originalLineTo(e,i)},r.bezierCurveTo=function(e,i,s,n,a,o){t.bezierCurveTo(e,i,s,n,a,o),this.__originalBezierCurveTo(e,i,s,n,a,o)},r.rect=function(e,i,s,n){t.rect(e,i,s,n),this.__originalRect(e,i,s,n)},r.closePath=function(){t.closePath(),this.__originalClosePath()},r.beginPath=function(){t.beginPath(),this.__originalBeginPath()}}var rn=class{constructor(t){this.canvasFactory=t,this.cache=Object.create(null)}getCanvas(t,e,i){let s;return this.cache[t]!==void 0?(s=this.cache[t],this.canvasFactory.reset(s,e,i)):(s=this.canvasFactory.create(e,i),this.cache[t]=s),s}delete(t){delete this.cache[t]}clear(){for(let t in this.cache){let e=this.cache[t];this.canvasFactory.destroy(e),delete this.cache[t]}}};function ci(r,t,e,i,s,n,a,o,l,c){let[h,d,u,f,p,g]=z(r);if(d===0&&u===0){let _=a*h+p,y=Math.round(_),v=o*f+g,A=Math.round(v),E=(a+l)*h+p,C=Math.abs(Math.round(E)-y)||1,I=(o+c)*f+g,R=Math.abs(Math.round(I)-A)||1;return r.setTransform(Math.sign(h),0,0,Math.sign(f),y,A),r.drawImage(t,e,i,s,n,0,0,C,R),r.setTransform(h,d,u,f,p,g),[C,R]}if(h===0&&f===0){let _=o*u+p,y=Math.round(_),v=a*d+g,A=Math.round(v),E=(o+c)*u+p,C=Math.abs(Math.round(E)-y)||1,I=(a+l)*d+g,R=Math.abs(Math.round(I)-A)||1;return r.setTransform(0,Math.sign(d),Math.sign(u),0,y,A),r.drawImage(t,e,i,s,n,0,0,R,C),r.setTransform(h,d,u,f,p,g),[R,C]}r.drawImage(t,e,i,s,n,a,o,l,c);let b=Math.hypot(h,d),m=Math.hypot(u,f);return[b*l,m*c]}function No(r){let{width:t,height:e}=r;if(t>Qr||e>Qr)return null;let i=1e3,s=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),n=t+1,a=new Uint8Array(n*(e+1)),o,l,c,h=t+7&-8,d=new Uint8Array(h*e),u=0;for(let m of r.data){let _=128;for(;_>0;)d[u++]=m&_?0:255,_>>=1}let f=0;for(u=0,d[u]!==0&&(a[0]=1,++f),l=1;l<t;l++)d[u]!==d[u+1]&&(a[l]=d[u]?2:1,++f),u++;for(d[u]!==0&&(a[l]=2,++f),o=1;o<e;o++){u=o*h,c=o*n,d[u-h]!==d[u]&&(a[c]=d[u]?1:8,++f);let m=(d[u]?4:0)+(d[u-h]?8:0);for(l=1;l<t;l++)m=(m>>2)+(d[u+1]?4:0)+(d[u-h+1]?8:0),s[m]&&(a[c+l]=s[m],++f),u++;if(d[u-h]!==d[u]&&(a[c+l]=d[u]?2:4,++f),f>i)return null}for(u=h*(e-1),c=o*n,d[u]!==0&&(a[c]=8,++f),l=1;l<t;l++)d[u]!==d[u+1]&&(a[c+l]=d[u]?4:8,++f),u++;if(d[u]!==0&&(a[c+l]=4,++f),f>i)return null;let p=new Int32Array([0,n,-1,0,-n,0,0,0,1]),g=new Path2D;for(o=0;f&&o<=e;o++){let m=o*n,_=m+t;for(;m<_&&!a[m];)m++;if(m===_)continue;g.moveTo(m%n,o);let y=m,v=a[m];do{let A=p[v];do m+=A;while(!a[m]);let E=a[m];E!==5&&E!==10?(v=E,a[m]=0):(v=E&51*v>>4,a[m]&=v>>2|v<<2),g.lineTo(m%n,m/n|0),a[m]||--f}while(y!==m);--o}return d=null,a=null,function(m){m.save(),m.scale(1/t,-1/e),m.translate(0,-e),m.fill(g),m.beginPath(),m.restore()}}var Ti=class{constructor(t,e){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=ra,this.textMatrixScale=1,this.fontMatrix=Ls,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=at.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.patternStroke=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,t,e])}clone(){let t=Object.create(this);return t.clipBox=this.clipBox.slice(),t}setCurrentPoint(t,e){this.x=t,this.y=e}updatePathMinMax(t,e,i){[e,i]=T.applyTransform([e,i],t),this.minX=Math.min(this.minX,e),this.minY=Math.min(this.minY,i),this.maxX=Math.max(this.maxX,e),this.maxY=Math.max(this.maxY,i)}updateRectMinMax(t,e){let i=T.applyTransform(e,t),s=T.applyTransform(e.slice(2),t),n=T.applyTransform([e[0],e[3]],t),a=T.applyTransform([e[2],e[1]],t);this.minX=Math.min(this.minX,i[0],s[0],n[0],a[0]),this.minY=Math.min(this.minY,i[1],s[1],n[1],a[1]),this.maxX=Math.max(this.maxX,i[0],s[0],n[0],a[0]),this.maxY=Math.max(this.maxY,i[1],s[1],n[1],a[1])}updateScalingPathMinMax(t,e){T.scaleMinMax(t,e),this.minX=Math.min(this.minX,e[0]),this.minY=Math.min(this.minY,e[1]),this.maxX=Math.max(this.maxX,e[2]),this.maxY=Math.max(this.maxY,e[3])}updateCurvePathMinMax(t,e,i,s,n,a,o,l,c,h){let d=T.bezierBoundingBox(e,i,s,n,a,o,l,c,h);h||this.updateRectMinMax(t,d)}getPathBoundingBox(t=ot.FILL,e=null){let i=[this.minX,this.minY,this.maxX,this.maxY];if(t===ot.STROKE){e||G("Stroke bounding box must include transform.");let s=T.singularValueDecompose2dScale(e),n=s[0]*this.lineWidth/2,a=s[1]*this.lineWidth/2;i[0]-=n,i[1]-=a,i[2]+=n,i[3]+=a}return i}updateClipFromPath(){let t=T.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(t||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(t){this.clipBox=t,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(t=ot.FILL,e=null){return T.intersect(this.clipBox,this.getPathBoundingBox(t,e))}};function Zr(r,t){if(t instanceof ImageData){r.putImageData(t,0,0);return}let e=t.height,i=t.width,s=e%pt,n=(e-s)/pt,a=s===0?n:n+1,o=r.createImageData(i,pt),l=0,c,h=t.data,d=o.data,u,f,p,g;if(t.kind===fi.GRAYSCALE_1BPP){let b=h.byteLength,m=new Uint32Array(d.buffer,0,d.byteLength>>2),_=m.length,y=i+7>>3,v=4294967295,A=rt.isLittleEndian?4278190080:255;for(u=0;u<a;u++){for(p=u<n?pt:s,c=0,f=0;f<p;f++){let E=b-l,C=0,I=E>y?i:E*8-7,R=I&-8,V=0,F=0;for(;C<R;C+=8)F=h[l++],m[c++]=F&128?v:A,m[c++]=F&64?v:A,m[c++]=F&32?v:A,m[c++]=F&16?v:A,m[c++]=F&8?v:A,m[c++]=F&4?v:A,m[c++]=F&2?v:A,m[c++]=F&1?v:A;for(;C<I;C++)V===0&&(F=h[l++],V=128),m[c++]=F&V?v:A,V>>=1}for(;c<_;)m[c++]=0;r.putImageData(o,0,u*pt)}}else if(t.kind===fi.RGBA_32BPP){for(f=0,g=i*pt*4,u=0;u<n;u++)d.set(h.subarray(l,l+g)),l+=g,r.putImageData(o,0,f),f+=pt;u<a&&(g=i*s*4,d.set(h.subarray(l,l+g)),r.putImageData(o,0,f))}else if(t.kind===fi.RGB_24BPP)for(p=pt,g=i*p,u=0;u<a;u++){for(u>=n&&(p=s,g=i*p),c=0,f=g;f--;)d[c++]=h[l++],d[c++]=h[l++],d[c++]=h[l++],d[c++]=255;r.putImageData(o,0,u*pt)}else throw new Error(`bad image kind: ${t.kind}`)}function ta(r,t){if(t.bitmap){r.drawImage(t.bitmap,0,0);return}let e=t.height,i=t.width,s=e%pt,n=(e-s)/pt,a=s===0?n:n+1,o=r.createImageData(i,pt),l=0,c=t.data,h=o.data;for(let d=0;d<a;d++){let u=d<n?pt:s;({srcPos:l}=Oo({src:c,srcPos:l,dest:h,width:i,height:u,nonBlackColor:0})),r.putImageData(o,0,d*pt)}}function xe(r,t){let e=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(let i of e)r[i]!==void 0&&(t[i]=r[i]);r.setLineDash!==void 0&&(t.setLineDash(r.getLineDash()),t.lineDashOffset=r.lineDashOffset)}function hi(r){if(r.strokeStyle=r.fillStyle="#000000",r.fillRule="nonzero",r.globalAlpha=1,r.lineWidth=1,r.lineCap="butt",r.lineJoin="miter",r.miterLimit=10,r.globalCompositeOperation="source-over",r.font="10px sans-serif",r.setLineDash!==void 0&&(r.setLineDash([]),r.lineDashOffset=0),!lt){let{filter:t}=r;t!=="none"&&t!==""&&(r.filter="none")}}function ea(r,t){if(t)return!0;let e=T.singularValueDecompose2dScale(r);e[0]=Math.fround(e[0]),e[1]=Math.fround(e[1]);let i=Math.fround((globalThis.devicePixelRatio||1)*Wt.PDF_TO_CSS_UNITS);return e[0]<=i&&e[1]<=i}var Vo=["butt","round","square"],Bo=["miter","round","bevel"],Ho={},ia={},fe=class r{constructor(t,e,i,s,n,{optionalContentConfig:a,markedContentStack:o=null},l,c){this.ctx=t,this.current=new Ti(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=e,this.objs=i,this.canvasFactory=s,this.filterFactory=n,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=o||[],this.optionalContentConfig=a,this.cachedCanvases=new rn(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=l,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=c,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(t,e=null){return typeof t=="string"?t.startsWith("g_")?this.commonObjs.get(t):this.objs.get(t):e}beginDrawing({transform:t,viewport:e,transparency:i=!1,background:s=null}){let n=this.ctx.canvas.width,a=this.ctx.canvas.height,o=this.ctx.fillStyle;if(this.ctx.fillStyle=s||"#ffffff",this.ctx.fillRect(0,0,n,a),this.ctx.fillStyle=o,i){let l=this.cachedCanvases.getCanvas("transparent",n,a);this.compositeCtx=this.ctx,this.transparentCanvas=l.canvas,this.ctx=l.context,this.ctx.save(),this.ctx.transform(...z(this.compositeCtx))}this.ctx.save(),hi(this.ctx),t&&(this.ctx.transform(...t),this.outputScaleX=t[0],this.outputScaleY=t[0]),this.ctx.transform(...e.transform),this.viewportScale=e.scale,this.baseTransform=z(this.ctx)}executeOperatorList(t,e,i,s){let n=t.argsArray,a=t.fnArray,o=e||0,l=n.length;if(l===o)return o;let c=l-o>Jr&&typeof i=="function",h=c?Date.now()+Fo:0,d=0,u=this.commonObjs,f=this.objs,p;for(;;){if(s!==void 0&&o===s.nextBreakPoint)return s.breakIt(o,i),o;if(p=a[o],p!==St.dependency)this[p].apply(this,n[o]);else for(let g of n[o]){let b=g.startsWith("g_")?u:f;if(!b.has(g))return b.get(g,i),o}if(o++,o===l)return o;if(c&&++d>Jr){if(Date.now()>h)return i(),o;d=0}}}#t(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#t(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(let t of this._cachedBitmapsMap.values()){for(let e of t.values())typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&(e.width=e.height=0);t.clear()}this._cachedBitmapsMap.clear(),this.#e()}#e(){if(this.pageColors){let t=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(t!=="none"){let e=this.ctx.filter;this.ctx.filter=t,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=e}}}_scaleImage(t,e){let i=t.width??t.displayWidth,s=t.height??t.displayHeight,n=Math.max(Math.hypot(e[0],e[1]),1),a=Math.max(Math.hypot(e[2],e[3]),1),o=i,l=s,c="prescale1",h,d;for(;n>2&&o>1||a>2&&l>1;){let u=o,f=l;n>2&&o>1&&(u=o>=16384?Math.floor(o/2)-1||1:Math.ceil(o/2),n/=o/u),a>2&&l>1&&(f=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l)/2,a/=l/f),h=this.cachedCanvases.getCanvas(c,u,f),d=h.context,d.clearRect(0,0,u,f),d.drawImage(t,0,0,o,l,0,0,u,f),t=h.canvas,o=u,l=f,c=c==="prescale1"?"prescale2":"prescale1"}return{img:t,paintWidth:o,paintHeight:l}}_createMaskCanvas(t){let e=this.ctx,{width:i,height:s}=t,n=this.current.fillColor,a=this.current.patternFill,o=z(e),l,c,h,d;if((t.bitmap||t.data)&&t.count>1){let I=t.bitmap||t.data.buffer;c=JSON.stringify(a?o:[o.slice(0,4),n]),l=this._cachedBitmapsMap.get(I),l||(l=new Map,this._cachedBitmapsMap.set(I,l));let R=l.get(c);if(R&&!a){let V=Math.round(Math.min(o[0],o[2])+o[4]),F=Math.round(Math.min(o[1],o[3])+o[5]);return{canvas:R,offsetX:V,offsetY:F}}h=R}h||(d=this.cachedCanvases.getCanvas("maskCanvas",i,s),ta(d.context,t));let u=T.transform(o,[1/i,0,0,-1/s,0,0]);u=T.transform(u,[1,0,0,1,0,-s]);let[f,p,g,b]=T.getAxialAlignedBoundingBox([0,0,i,s],u),m=Math.round(g-f)||1,_=Math.round(b-p)||1,y=this.cachedCanvases.getCanvas("fillCanvas",m,_),v=y.context,A=f,E=p;v.translate(-A,-E),v.transform(...u),h||(h=this._scaleImage(d.canvas,Ot(v)),h=h.img,l&&a&&l.set(c,h)),v.imageSmoothingEnabled=ea(z(v),t.interpolate),ci(v,h,0,0,h.width,h.height,0,0,i,s),v.globalCompositeOperation="source-in";let C=T.transform(Ot(v),[1,0,0,1,-A,-E]);return v.fillStyle=a?n.getPattern(e,this,C,ot.FILL):n,v.fillRect(0,0,i,s),l&&!a&&(this.cachedCanvases.delete("fillCanvas"),l.set(c,y.canvas)),{canvas:y.canvas,offsetX:Math.round(A),offsetY:Math.round(E)}}setLineWidth(t){t!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=t,this.ctx.lineWidth=t}setLineCap(t){this.ctx.lineCap=Vo[t]}setLineJoin(t){this.ctx.lineJoin=Bo[t]}setMiterLimit(t){this.ctx.miterLimit=t}setDash(t,e){let i=this.ctx;i.setLineDash!==void 0&&(i.setLineDash(t),i.lineDashOffset=e)}setRenderingIntent(t){}setFlatness(t){}setGState(t){for(let[e,i]of t)switch(e){case"LW":this.setLineWidth(i);break;case"LC":this.setLineCap(i);break;case"LJ":this.setLineJoin(i);break;case"ML":this.setMiterLimit(i);break;case"D":this.setDash(i[0],i[1]);break;case"RI":this.setRenderingIntent(i);break;case"FL":this.setFlatness(i);break;case"Font":this.setFont(i[0],i[1]);break;case"CA":this.current.strokeAlpha=i;break;case"ca":this.current.fillAlpha=i,this.ctx.globalAlpha=i;break;case"BM":this.ctx.globalCompositeOperation=i;break;case"SMask":this.current.activeSMask=i?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(i);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){let t=this.inSMaskMode;this.current.activeSMask&&!t?this.beginSMaskMode():!this.current.activeSMask&&t&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");let t=this.ctx.canvas.width,e=this.ctx.canvas.height,i="smaskGroupAt"+this.groupLevel,s=this.cachedCanvases.getCanvas(i,t,e);this.suspendedCtx=this.ctx,this.ctx=s.context;let n=this.ctx;n.setTransform(...z(this.suspendedCtx)),xe(this.suspendedCtx,n),Lo(n,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),xe(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(t){if(!this.current.activeSMask)return;t?(t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.ceil(t[2]),t[3]=Math.ceil(t[3])):t=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];let e=this.current.activeSMask,i=this.suspendedCtx;this.composeSMask(i,e,this.ctx,t),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(t,e,i,s){let n=s[0],a=s[1],o=s[2]-n,l=s[3]-a;o===0||l===0||(this.genericComposeSMask(e.context,i,o,l,e.subtype,e.backdrop,e.transferMap,n,a,e.offsetX,e.offsetY),t.save(),t.globalAlpha=1,t.globalCompositeOperation="source-over",t.setTransform(1,0,0,1,0,0),t.drawImage(i.canvas,0,0),t.restore())}genericComposeSMask(t,e,i,s,n,a,o,l,c,h,d){let u=t.canvas,f=l-h,p=c-d;if(a){let b=T.makeHexColor(...a);if(f<0||p<0||f+i>u.width||p+s>u.height){let m=this.cachedCanvases.getCanvas("maskExtension",i,s),_=m.context;_.drawImage(u,-f,-p),_.globalCompositeOperation="destination-atop",_.fillStyle=b,_.fillRect(0,0,i,s),_.globalCompositeOperation="source-over",u=m.canvas,f=p=0}else{t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0);let m=new Path2D;m.rect(f,p,i,s),t.clip(m),t.globalCompositeOperation="destination-atop",t.fillStyle=b,t.fillRect(f,p,i,s),t.restore()}}e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0),n==="Alpha"&&o?e.filter=this.filterFactory.addAlphaFilter(o):n==="Luminosity"&&(e.filter=this.filterFactory.addLuminosityFilter(o));let g=new Path2D;g.rect(l,c,i,s),e.clip(g),e.globalCompositeOperation="destination-in",e.drawImage(u,f,p,i,s,l,c,i,s),e.restore()}save(){this.inSMaskMode?(xe(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();let t=this.current;this.stateStack.push(t),this.current=t.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),xe(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(t,e,i,s,n,a){this.ctx.transform(t,e,i,s,n,a),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(t,e,i){let s=this.ctx,n=this.current,a=n.x,o=n.y,l,c,h=z(s),d=h[0]===0&&h[3]===0||h[1]===0&&h[2]===0,u=d?i.slice(0):null;for(let f=0,p=0,g=t.length;f<g;f++)switch(t[f]|0){case St.rectangle:a=e[p++],o=e[p++];let b=e[p++],m=e[p++],_=a+b,y=o+m;s.moveTo(a,o),b===0||m===0?s.lineTo(_,y):(s.lineTo(_,o),s.lineTo(_,y),s.lineTo(a,y)),d||n.updateRectMinMax(h,[a,o,_,y]),s.closePath();break;case St.moveTo:a=e[p++],o=e[p++],s.moveTo(a,o),d||n.updatePathMinMax(h,a,o);break;case St.lineTo:a=e[p++],o=e[p++],s.lineTo(a,o),d||n.updatePathMinMax(h,a,o);break;case St.curveTo:l=a,c=o,a=e[p+4],o=e[p+5],s.bezierCurveTo(e[p],e[p+1],e[p+2],e[p+3],a,o),n.updateCurvePathMinMax(h,l,c,e[p],e[p+1],e[p+2],e[p+3],a,o,u),p+=6;break;case St.curveTo2:l=a,c=o,s.bezierCurveTo(a,o,e[p],e[p+1],e[p+2],e[p+3]),n.updateCurvePathMinMax(h,l,c,a,o,e[p],e[p+1],e[p+2],e[p+3],u),a=e[p+2],o=e[p+3],p+=4;break;case St.curveTo3:l=a,c=o,a=e[p+2],o=e[p+3],s.bezierCurveTo(e[p],e[p+1],a,o,a,o),n.updateCurvePathMinMax(h,l,c,e[p],e[p+1],a,o,a,o,u),p+=4;break;case St.closePath:s.closePath();break}d&&n.updateScalingPathMinMax(h,u),n.setCurrentPoint(a,o)}closePath(){this.ctx.closePath()}stroke(t=!0){let e=this.ctx,i=this.current.strokeColor;e.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof i=="object"&&i?.getPattern?(e.save(),e.strokeStyle=i.getPattern(e,this,Ot(e),ot.STROKE),this.rescaleAndStroke(!1),e.restore()):this.rescaleAndStroke(!0)),t&&this.consumePath(this.current.getClippedPathBoundingBox()),e.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(t=!0){let e=this.ctx,i=this.current.fillColor,s=this.current.patternFill,n=!1;s&&(e.save(),e.fillStyle=i.getPattern(e,this,Ot(e),ot.FILL),n=!0);let a=this.current.getClippedPathBoundingBox();this.contentVisible&&a!==null&&(this.pendingEOFill?(e.fill("evenodd"),this.pendingEOFill=!1):e.fill()),n&&e.restore(),t&&this.consumePath(a)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=Ho}eoClip(){this.pendingClip=ia}beginText(){this.current.textMatrix=ra,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){let t=this.pendingTextPaths,e=this.ctx;if(t===void 0){e.beginPath();return}let i=new Path2D,s=e.getTransform().invertSelf();for(let{transform:n,x:a,y:o,fontSize:l,path:c}of t)i.addPath(c,new DOMMatrix(n).preMultiplySelf(s).translate(a,o).scale(l,-l));e.clip(i),e.beginPath(),delete this.pendingTextPaths}setCharSpacing(t){this.current.charSpacing=t}setWordSpacing(t){this.current.wordSpacing=t}setHScale(t){this.current.textHScale=t/100}setLeading(t){this.current.leading=-t}setFont(t,e){let i=this.commonObjs.get(t),s=this.current;if(!i)throw new Error(`Can't find font for ${t}`);if(s.fontMatrix=i.fontMatrix||Ls,(s.fontMatrix[0]===0||s.fontMatrix[3]===0)&&D("Invalid font matrix for font "+t),e<0?(e=-e,s.fontDirection=-1):s.fontDirection=1,this.current.font=i,this.current.fontSize=e,i.isType3Font)return;let n=i.loadedName||"sans-serif",a=i.systemFontInfo?.css||`"${n}", ${i.fallbackName}`,o="normal";i.black?o="900":i.bold&&(o="bold");let l=i.italic?"italic":"normal",c=e;e<Yr?c=Yr:e>Kr&&(c=Kr),this.current.fontSizeScale=e/c,this.ctx.font=`${l} ${o} ${c}px ${a}`}setTextRenderingMode(t){this.current.textRenderingMode=t}setTextRise(t){this.current.textRise=t}moveText(t,e){this.current.x=this.current.lineX+=t,this.current.y=this.current.lineY+=e}setLeadingMoveText(t,e){this.setLeading(-e),this.moveText(t,e)}setTextMatrix(t,e,i,s,n,a){this.current.textMatrix=[t,e,i,s,n,a],this.current.textMatrixScale=Math.hypot(t,e),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}#i(t,e,i){let s=new Path2D;return s.addPath(t,new DOMMatrix(i).invertSelf().multiplySelf(e)),s}paintChar(t,e,i,s,n){let a=this.ctx,o=this.current,l=o.font,c=o.textRenderingMode,h=o.fontSize/o.fontSizeScale,d=c&at.FILL_STROKE_MASK,u=!!(c&at.ADD_TO_PATH_FLAG),f=o.patternFill&&!l.missingFile,p=o.patternStroke&&!l.missingFile,g;if((l.disableFontFace||u||f||p)&&(g=l.getPathGenerator(this.commonObjs,t)),l.disableFontFace||f||p){if(a.save(),a.translate(e,i),a.scale(h,-h),d===at.FILL||d===at.FILL_STROKE)if(s){let b=a.getTransform();a.setTransform(...s),a.fill(this.#i(g,b,s))}else a.fill(g);if(d===at.STROKE||d===at.FILL_STROKE)if(n){let b=a.getTransform();a.setTransform(...n),a.stroke(this.#i(g,b,n))}else a.lineWidth/=h,a.stroke(g);a.restore()}else(d===at.FILL||d===at.FILL_STROKE)&&a.fillText(t,e,i),(d===at.STROKE||d===at.FILL_STROKE)&&a.strokeText(t,e,i);u&&(this.pendingTextPaths||=[]).push({transform:z(a),x:e,y:i,fontSize:h,path:g})}get isFontSubpixelAAEnabled(){let{context:t}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);t.scale(1.5,1),t.fillText("I",0,10);let e=t.getImageData(0,0,10,10).data,i=!1;for(let s=3;s<e.length;s+=4)if(e[s]>0&&e[s]<255){i=!0;break}return O(this,"isFontSubpixelAAEnabled",i)}showText(t){let e=this.current,i=e.font;if(i.isType3Font)return this.showType3Text(t);let s=e.fontSize;if(s===0)return;let n=this.ctx,a=e.fontSizeScale,o=e.charSpacing,l=e.wordSpacing,c=e.fontDirection,h=e.textHScale*c,d=t.length,u=i.vertical,f=u?1:-1,p=i.defaultVMetrics,g=s*e.fontMatrix[0],b=e.textRenderingMode===at.FILL&&!i.disableFontFace&&!e.patternFill;n.save(),n.transform(...e.textMatrix),n.translate(e.x,e.y+e.textRise),c>0?n.scale(h,-1):n.scale(h,1);let m,_;if(e.patternFill){n.save();let C=e.fillColor.getPattern(n,this,Ot(n),ot.FILL);m=z(n),n.restore(),n.fillStyle=C}if(e.patternStroke){n.save();let C=e.strokeColor.getPattern(n,this,Ot(n),ot.STROKE);_=z(n),n.restore(),n.strokeStyle=C}let y=e.lineWidth,v=e.textMatrixScale;if(v===0||y===0){let C=e.textRenderingMode&at.FILL_STROKE_MASK;(C===at.STROKE||C===at.FILL_STROKE)&&(y=this.getSinglePixelWidth())}else y/=v;if(a!==1&&(n.scale(a,a),y/=a),n.lineWidth=y,i.isInvalidPDFjsFont){let C=[],I=0;for(let R of t)C.push(R.unicode),I+=R.width;n.fillText(C.join(""),0,0),e.x+=I*g*h,n.restore(),this.compose();return}let A=0,E;for(E=0;E<d;++E){let C=t[E];if(typeof C=="number"){A+=f*C*s/1e3;continue}let I=!1,R=(C.isSpace?l:0)+o,V=C.fontChar,F=C.accent,q,Z,H=C.width;if(u){let x=C.vmetric||p,M=-(C.vmetric?x[1]:H*.5)*g,bt=x[2]*g;H=x?-x[0]:H,q=M/a,Z=(A+bt)/a}else q=A/a,Z=0;if(i.remeasure&&H>0){let x=n.measureText(V).width*1e3/s*a;if(H<x&&this.isFontSubpixelAAEnabled){let M=H/x;I=!0,n.save(),n.scale(M,1),q/=M}else H!==x&&(q+=(H-x)/2e3*s/a)}if(this.contentVisible&&(C.isInFont||i.missingFile)){if(b&&!F)n.fillText(V,q,Z);else if(this.paintChar(V,q,Z,m,_),F){let x=q+s*F.offset.x/a,M=Z-s*F.offset.y/a;this.paintChar(F.fontChar,x,M,m,_)}}let dt=u?H*g-R*c:H*g+R*c;A+=dt,I&&n.restore()}u?e.y-=A:e.x+=A*h,n.restore(),this.compose()}showType3Text(t){let e=this.ctx,i=this.current,s=i.font,n=i.fontSize,a=i.fontDirection,o=s.vertical?1:-1,l=i.charSpacing,c=i.wordSpacing,h=i.textHScale*a,d=i.fontMatrix||Ls,u=t.length,f=i.textRenderingMode===at.INVISIBLE,p,g,b,m;if(!(f||n===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,e.save(),e.transform(...i.textMatrix),e.translate(i.x,i.y),e.scale(h,a),p=0;p<u;++p){if(g=t[p],typeof g=="number"){m=o*g*n/1e3,this.ctx.translate(m,0),i.x+=m*h;continue}let _=(g.isSpace?c:0)+l,y=s.charProcOperatorList[g.operatorListId];if(!y){D(`Type3 character "${g.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=g,this.save(),e.scale(n,n),e.transform(...d),this.executeOperatorList(y),this.restore()),b=T.applyTransform([g.width,0],d)[0]*n+_,e.translate(b,0),i.x+=b*h}e.restore(),this.processingType3=null}}setCharWidth(t,e){}setCharWidthAndBounds(t,e,i,s,n,a){this.ctx.rect(i,s,n-i,a-s),this.ctx.clip(),this.endPath()}getColorN_Pattern(t){let e;if(t[0]==="TilingPattern"){let i=t[1],s=this.baseTransform||z(this.ctx),n={createCanvasGraphics:a=>new r(a,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};e=new Do(t,i,this.ctx,n,s)}else e=this._getPattern(t[1],t[2]);return e}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments),this.current.patternStroke=!0}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(t,e,i){this.ctx.strokeStyle=this.current.strokeColor=T.makeHexColor(t,e,i),this.current.patternStroke=!1}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(t,e,i){this.ctx.fillStyle=this.current.fillColor=T.makeHexColor(t,e,i),this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(t,e=null){let i;return this.cachedPatterns.has(t)?i=this.cachedPatterns.get(t):(i=ko(this.getObject(t)),this.cachedPatterns.set(t,i)),e&&(i.matrix=e),i}shadingFill(t){if(!this.contentVisible)return;let e=this.ctx;this.save();let i=this._getPattern(t);e.fillStyle=i.getPattern(e,this,Ot(e),ot.SHADING);let s=Ot(e);if(s){let{width:n,height:a}=e.canvas,[o,l,c,h]=T.getAxialAlignedBoundingBox([0,0,n,a],s);this.ctx.fillRect(o,l,c-o,h-l)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){G("Should not call beginInlineImage")}beginImageData(){G("Should not call beginImageData")}paintFormXObjectBegin(t,e){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),t&&this.transform(...t),this.baseTransform=z(this.ctx),e)){let i=e[2]-e[0],s=e[3]-e[1];this.ctx.rect(e[0],e[1],i,s),this.current.updateRectMinMax(z(this.ctx),e),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(t){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);let e=this.ctx;t.isolated||Wi("TODO: Support non-isolated groups."),t.knockout&&D("Knockout groups not supported.");let i=z(e);if(t.matrix&&e.transform(...t.matrix),!t.bbox)throw new Error("Bounding box is required.");let s=T.getAxialAlignedBoundingBox(t.bbox,z(e)),n=[0,0,e.canvas.width,e.canvas.height];s=T.intersect(s,n)||[0,0,0,0];let a=Math.floor(s[0]),o=Math.floor(s[1]),l=Math.max(Math.ceil(s[2])-a,1),c=Math.max(Math.ceil(s[3])-o,1);this.current.startNewPathAndClipBox([0,0,l,c]);let h="groupAt"+this.groupLevel;t.smask&&(h+="_smask_"+this.smaskCounter++%2);let d=this.cachedCanvases.getCanvas(h,l,c),u=d.context;u.translate(-a,-o),u.transform(...i),t.smask?this.smaskStack.push({canvas:d.canvas,context:u,offsetX:a,offsetY:o,subtype:t.smask.subtype,backdrop:t.smask.backdrop,transferMap:t.smask.transferMap||null,startTransformInverse:null}):(e.setTransform(1,0,0,1,0,0),e.translate(a,o),e.save()),xe(e,u),this.ctx=u,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(e),this.groupLevel++}endGroup(t){if(!this.contentVisible)return;this.groupLevel--;let e=this.ctx,i=this.groupStack.pop();if(this.ctx=i,this.ctx.imageSmoothingEnabled=!1,t.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();let s=z(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...s);let n=T.getAxialAlignedBoundingBox([0,0,e.canvas.width,e.canvas.height],s);this.ctx.drawImage(e.canvas,0,0),this.ctx.restore(),this.compose(n)}}beginAnnotation(t,e,i,s,n){if(this.#t(),hi(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),e){let a=e[2]-e[0],o=e[3]-e[1];if(n&&this.annotationCanvasMap){i=i.slice(),i[4]-=e[0],i[5]-=e[1],e=e.slice(),e[0]=e[1]=0,e[2]=a,e[3]=o;let[l,c]=T.singularValueDecompose2dScale(z(this.ctx)),{viewportScale:h}=this,d=Math.ceil(a*this.outputScaleX*h),u=Math.ceil(o*this.outputScaleY*h);this.annotationCanvas=this.canvasFactory.create(d,u);let{canvas:f,context:p}=this.annotationCanvas;this.annotationCanvasMap.set(t,f),this.annotationCanvas.savedCtx=this.ctx,this.ctx=p,this.ctx.save(),this.ctx.setTransform(l,0,0,-c,0,o*c),hi(this.ctx)}else hi(this.ctx),this.endPath(),this.ctx.rect(e[0],e[1],a,o),this.ctx.clip(),this.ctx.beginPath()}this.current=new Ti(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...i),this.transform(...s)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),this.#e(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(t){if(!this.contentVisible)return;let e=t.count;t=this.getObject(t.data,t),t.count=e;let i=this.ctx,s=this.processingType3;if(s&&(s.compiled===void 0&&(s.compiled=No(t)),s.compiled)){s.compiled(i);return}let n=this._createMaskCanvas(t),a=n.canvas;i.save(),i.setTransform(1,0,0,1,0,0),i.drawImage(a,n.offsetX,n.offsetY),i.restore(),this.compose()}paintImageMaskXObjectRepeat(t,e,i=0,s=0,n,a){if(!this.contentVisible)return;t=this.getObject(t.data,t);let o=this.ctx;o.save();let l=z(o);o.transform(e,i,s,n,0,0);let c=this._createMaskCanvas(t);o.setTransform(1,0,0,1,c.offsetX-l[4],c.offsetY-l[5]);for(let h=0,d=a.length;h<d;h+=2){let u=T.transform(l,[e,i,s,n,a[h],a[h+1]]),[f,p]=T.applyTransform([0,0],u);o.drawImage(c.canvas,f,p)}o.restore(),this.compose()}paintImageMaskXObjectGroup(t){if(!this.contentVisible)return;let e=this.ctx,i=this.current.fillColor,s=this.current.patternFill;for(let n of t){let{data:a,width:o,height:l,transform:c}=n,h=this.cachedCanvases.getCanvas("maskCanvas",o,l),d=h.context;d.save();let u=this.getObject(a,n);ta(d,u),d.globalCompositeOperation="source-in",d.fillStyle=s?i.getPattern(d,this,Ot(e),ot.FILL):i,d.fillRect(0,0,o,l),d.restore(),e.save(),e.transform(...c),e.scale(1,-1),ci(e,h.canvas,0,0,o,l,0,-1,1,1),e.restore()}this.compose()}paintImageXObject(t){if(!this.contentVisible)return;let e=this.getObject(t);if(!e){D("Dependent image isn't ready yet");return}this.paintInlineImageXObject(e)}paintImageXObjectRepeat(t,e,i,s){if(!this.contentVisible)return;let n=this.getObject(t);if(!n){D("Dependent image isn't ready yet");return}let a=n.width,o=n.height,l=[];for(let c=0,h=s.length;c<h;c+=2)l.push({transform:[e,0,0,i,s[c],s[c+1]],x:0,y:0,w:a,h:o});this.paintInlineImageXObjectGroup(n,l)}applyTransferMapsToCanvas(t){return this.current.transferMaps!=="none"&&(t.filter=this.current.transferMaps,t.drawImage(t.canvas,0,0),t.filter="none"),t.canvas}applyTransferMapsToBitmap(t){if(this.current.transferMaps==="none")return t.bitmap;let{bitmap:e,width:i,height:s}=t,n=this.cachedCanvases.getCanvas("inlineImage",i,s),a=n.context;return a.filter=this.current.transferMaps,a.drawImage(e,0,0),a.filter="none",n.canvas}paintInlineImageXObject(t){if(!this.contentVisible)return;let e=t.width,i=t.height,s=this.ctx;if(this.save(),!lt){let{filter:o}=s;o!=="none"&&o!==""&&(s.filter="none")}s.scale(1/e,-1/i);let n;if(t.bitmap)n=this.applyTransferMapsToBitmap(t);else if(typeof HTMLElement=="function"&&t instanceof HTMLElement||!t.data)n=t;else{let l=this.cachedCanvases.getCanvas("inlineImage",e,i).context;Zr(l,t),n=this.applyTransferMapsToCanvas(l)}let a=this._scaleImage(n,Ot(s));s.imageSmoothingEnabled=ea(z(s),t.interpolate),ci(s,a.img,0,0,a.paintWidth,a.paintHeight,0,-i,e,i),this.compose(),this.restore()}paintInlineImageXObjectGroup(t,e){if(!this.contentVisible)return;let i=this.ctx,s;if(t.bitmap)s=t.bitmap;else{let n=t.width,a=t.height,l=this.cachedCanvases.getCanvas("inlineImage",n,a).context;Zr(l,t),s=this.applyTransferMapsToCanvas(l)}for(let n of e)i.save(),i.transform(...n.transform),i.scale(1,-1),ci(i,s,n.x,n.y,n.w,n.h,0,-1,1,1),i.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(t){}markPointProps(t,e){}beginMarkedContent(t){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(t,e){t==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(e)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(t){let e=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(t);let i=this.ctx;this.pendingClip&&(e||(this.pendingClip===ia?i.clip("evenodd"):i.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),i.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){let t=z(this.ctx);if(t[1]===0&&t[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(t[0]),Math.abs(t[3]));else{let e=Math.abs(t[0]*t[3]-t[2]*t[1]),i=Math.hypot(t[0],t[2]),s=Math.hypot(t[1],t[3]);this._cachedGetSinglePixelWidth=Math.max(i,s)/e}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){let{lineWidth:t}=this.current,{a:e,b:i,c:s,d:n}=this.ctx.getTransform(),a,o;if(i===0&&s===0){let l=Math.abs(e),c=Math.abs(n);if(l===c)if(t===0)a=o=1/l;else{let h=l*t;a=o=h<1?1/h:1}else if(t===0)a=1/l,o=1/c;else{let h=l*t,d=c*t;a=h<1?1/h:1,o=d<1?1/d:1}}else{let l=Math.abs(e*n-i*s),c=Math.hypot(e,i),h=Math.hypot(s,n);if(t===0)a=h/l,o=c/l;else{let d=t*l;a=h>d?h/d:1,o=c>d?c/d:1}}this._cachedScaleForStroking[0]=a,this._cachedScaleForStroking[1]=o}return this._cachedScaleForStroking}rescaleAndStroke(t){let{ctx:e}=this,{lineWidth:i}=this.current,[s,n]=this.getScaleForStroking();if(e.lineWidth=i||1,s===1&&n===1){e.stroke();return}let a=e.getLineDash();if(t&&e.save(),e.scale(s,n),a.length>0){let o=Math.max(s,n);e.setLineDash(a.map(l=>l/o)),e.lineDashOffset/=o}e.stroke(),t&&e.restore()}isContentVisible(){for(let t=this.markedContentStack.length-1;t>=0;t--)if(!this.markedContentStack[t].visible)return!1;return!0}};for(let r in St)fe.prototype[r]!==void 0&&(fe.prototype[St[r]]=fe.prototype[r]);var ie=class{static#t=null;static#e="";static get workerPort(){return this.#t}static set workerPort(t){if(!(typeof Worker<"u"&&t instanceof Worker)&&t!==null)throw new Error("Invalid `workerPort` type.");this.#t=t}static get workerSrc(){return this.#e}static set workerSrc(t){if(typeof t!="string")throw new Error("Invalid `workerSrc` type.");this.#e=t}},an=class{#t;#e;constructor({parsedData:t,rawData:e}){this.#t=t,this.#e=e}getRaw(){return this.#e}get(t){return this.#t.get(t)??null}getAll(){return ir(this.#t)}has(t){return this.#t.has(t)}},ue=Symbol("INTERNAL"),on=class{#t=!1;#e=!1;#i=!1;#s=!0;constructor(t,{name:e,intent:i,usage:s,rbGroups:n}){this.#t=!!(t&gt.DISPLAY),this.#e=!!(t&gt.PRINT),this.name=e,this.intent=i,this.usage=s,this.rbGroups=n}get visible(){if(this.#i)return this.#s;if(!this.#s)return!1;let{print:t,view:e}=this.usage;return this.#t?e?.viewState!=="OFF":this.#e?t?.printState!=="OFF":!0}_setVisible(t,e,i=!1){t!==ue&&G("Internal method `_setVisible` called."),this.#i=i,this.#s=e}},ln=class{#t=null;#e=new Map;#i=null;#s=null;constructor(t,e=gt.DISPLAY){if(this.renderingIntent=e,this.name=null,this.creator=null,t!==null){this.name=t.name,this.creator=t.creator,this.#s=t.order;for(let i of t.groups)this.#e.set(i.id,new on(e,i));if(t.baseState==="OFF")for(let i of this.#e.values())i._setVisible(ue,!1);for(let i of t.on)this.#e.get(i)._setVisible(ue,!0);for(let i of t.off)this.#e.get(i)._setVisible(ue,!1);this.#i=this.getHash()}}#r(t){let e=t.length;if(e<2)return!0;let i=t[0];for(let s=1;s<e;s++){let n=t[s],a;if(Array.isArray(n))a=this.#r(n);else if(this.#e.has(n))a=this.#e.get(n).visible;else return D(`Optional content group not found: ${n}`),!0;switch(i){case"And":if(!a)return!1;break;case"Or":if(a)return!0;break;case"Not":return!a;default:return!0}}return i==="And"}isVisible(t){if(this.#e.size===0)return!0;if(!t)return Wi("Optional content group not defined."),!0;if(t.type==="OCG")return this.#e.has(t.id)?this.#e.get(t.id).visible:(D(`Optional content group not found: ${t.id}`),!0);if(t.type==="OCMD"){if(t.expression)return this.#r(t.expression);if(!t.policy||t.policy==="AnyOn"){for(let e of t.ids){if(!this.#e.has(e))return D(`Optional content group not found: ${e}`),!0;if(this.#e.get(e).visible)return!0}return!1}else if(t.policy==="AllOn"){for(let e of t.ids){if(!this.#e.has(e))return D(`Optional content group not found: ${e}`),!0;if(!this.#e.get(e).visible)return!1}return!0}else if(t.policy==="AnyOff"){for(let e of t.ids){if(!this.#e.has(e))return D(`Optional content group not found: ${e}`),!0;if(!this.#e.get(e).visible)return!0}return!1}else if(t.policy==="AllOff"){for(let e of t.ids){if(!this.#e.has(e))return D(`Optional content group not found: ${e}`),!0;if(this.#e.get(e).visible)return!1}return!0}return D(`Unknown optional content policy ${t.policy}.`),!0}return D(`Unknown group type ${t.type}.`),!0}setVisibility(t,e=!0,i=!0){let s=this.#e.get(t);if(!s){D(`Optional content group not found: ${t}`);return}if(i&&e&&s.rbGroups.length)for(let n of s.rbGroups)for(let a of n)a!==t&&this.#e.get(a)?._setVisible(ue,!1,!0);s._setVisible(ue,!!e,!0),this.#t=null}setOCGState({state:t,preserveRB:e}){let i;for(let s of t){switch(s){case"ON":case"OFF":case"Toggle":i=s;continue}let n=this.#e.get(s);if(n)switch(i){case"ON":this.setVisibility(s,!0,e);break;case"OFF":this.setVisibility(s,!1,e);break;case"Toggle":this.setVisibility(s,!n.visible,e);break}}this.#t=null}get hasInitialVisibility(){return this.#i===null||this.getHash()===this.#i}getOrder(){return this.#e.size?this.#s?this.#s.slice():[...this.#e.keys()]:null}getGroups(){return this.#e.size>0?ir(this.#e):null}getGroup(t){return this.#e.get(t)||null}getHash(){if(this.#t!==null)return this.#t;let t=new yi;for(let[e,i]of this.#e)t.update(`${e}:${i.visible}`);return this.#t=t.hexdigest()}},cn=class{constructor(t,{disableRange:e=!1,disableStream:i=!1}){Q(t,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');let{length:s,initialData:n,progressiveDone:a,contentDispositionFilename:o}=t;if(this._queuedChunks=[],this._progressiveDone=a,this._contentDispositionFilename=o,n?.length>0){let l=n instanceof Uint8Array&&n.byteLength===n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer;this._queuedChunks.push(l)}this._pdfDataRangeTransport=t,this._isStreamingSupported=!i,this._isRangeSupported=!e,this._contentLength=s,this._fullRequestReader=null,this._rangeReaders=[],t.addRangeListener((l,c)=>{this._onReceiveData({begin:l,chunk:c})}),t.addProgressListener((l,c)=>{this._onProgress({loaded:l,total:c})}),t.addProgressiveReadListener(l=>{this._onReceiveData({chunk:l})}),t.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),t.transportReady()}_onReceiveData({begin:t,chunk:e}){let i=e instanceof Uint8Array&&e.byteLength===e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer;if(t===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(i):this._queuedChunks.push(i);else{let s=this._rangeReaders.some(function(n){return n._begin!==t?!1:(n._enqueue(i),!0)});Q(s,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(t){t.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:t.loaded}):this._fullRequestReader?.onProgress?.({loaded:t.loaded,total:t.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(t){let e=this._rangeReaders.indexOf(t);e>=0&&this._rangeReaders.splice(e,1)}getFullReader(){Q(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");let t=this._queuedChunks;return this._queuedChunks=null,new hn(this,t,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;let i=new dn(this,t,e);return this._pdfDataRangeTransport.requestDataRange(t,e),this._rangeReaders.push(i),i}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(let e of this._rangeReaders.slice(0))e.cancel(t);this._pdfDataRangeTransport.abort()}},hn=class{constructor(t,e,i=!1,s=null){this._stream=t,this._done=i||!1,this._filename=nr(s)?s:null,this._queuedChunks=e||[],this._loaded=0;for(let n of this._queuedChunks)this._loaded+=n.byteLength;this._requests=[],this._headersReady=Promise.resolve(),t._fullRequestReader=this,this.onProgress=null}_enqueue(t){this._done||(this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunks.push(t),this._loaded+=t.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}read(){return w(this,null,function*(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let t=Promise.withResolvers();return this._requests.push(t),t.promise})}cancel(t){this._done=!0;for(let e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}},dn=class{constructor(t,e,i){this._stream=t,this._begin=e,this._end=i,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(t){if(!this._done){if(this._requests.length===0)this._queuedChunk=t;else{this._requests.shift().resolve({value:t,done:!1});for(let i of this._requests)i.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}read(){return w(this,null,function*(){if(this._queuedChunk){let e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};let t=Promise.withResolvers();return this._requests.push(t),t.promise})}cancel(t){this._done=!0;for(let e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}};function Go(r){let t=!0,e=i("filename\\*","i").exec(r);if(e){e=e[1];let h=o(e);return h=unescape(h),h=l(h),h=c(h),n(h)}if(e=a(r),e){let h=c(e);return n(h)}if(e=i("filename","i").exec(r),e){e=e[1];let h=o(e);return h=c(h),n(h)}function i(h,d){return new RegExp("(?:^|;)\\s*"+h+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',d)}function s(h,d){if(h){if(!/^[\x00-\xFF]+$/.test(d))return d;try{let u=new TextDecoder(h,{fatal:!0}),f=qi(d);d=u.decode(f),t=!1}catch{}}return d}function n(h){return t&&/[\x80-\xff]/.test(h)&&(h=s("utf-8",h),t&&(h=s("iso-8859-1",h))),h}function a(h){let d=[],u,f=i("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(u=f.exec(h))!==null;){let[,g,b,m]=u;if(g=parseInt(g,10),g in d){if(g===0)break;continue}d[g]=[b,m]}let p=[];for(let g=0;g<d.length&&g in d;++g){let[b,m]=d[g];m=o(m),b&&(m=unescape(m),g===0&&(m=l(m))),p.push(m)}return p.join("")}function o(h){if(h.startsWith('"')){let d=h.slice(1).split('\\"');for(let u=0;u<d.length;++u){let f=d[u].indexOf('"');f!==-1&&(d[u]=d[u].slice(0,f),d.length=u+1),d[u]=d[u].replaceAll(/\\(.)/g,"$1")}h=d.join('"')}return h}function l(h){let d=h.indexOf("'");if(d===-1)return h;let u=h.slice(0,d),p=h.slice(d+1).replace(/^[^']*'/,"");return s(u,p)}function c(h){return!h.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(h)?h:h.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(d,u,f,p){if(f==="q"||f==="Q")return p=p.replaceAll("_"," "),p=p.replaceAll(/=([0-9a-fA-F]{2})/g,function(g,b){return String.fromCharCode(parseInt(b,16))}),s(u,p);try{p=atob(p)}catch{}return s(u,p)})}return""}function la(r,t){let e=new Headers;if(!r||!t||typeof t!="object")return e;for(let i in t){let s=t[i];s!==void 0&&e.append(i,s)}return e}function Ki(r){try{return new URL(r).origin}catch{}return null}function ca({responseHeaders:r,isHttp:t,rangeChunkSize:e,disableRange:i}){let s={allowRangeRequests:!1,suggestedLength:void 0},n=parseInt(r.get("Content-Length"),10);return!Number.isInteger(n)||(s.suggestedLength=n,n<=2*e)||i||!t||r.get("Accept-Ranges")!=="bytes"||(r.get("Content-Encoding")||"identity")!=="identity"||(s.allowRangeRequests=!0),s}function ha(r){let t=r.get("Content-Disposition");if(t){let e=Go(t);if(e.includes("%"))try{e=decodeURIComponent(e)}catch{}if(nr(e))return e}return null}function Ji(r,t){return r===404||r===0&&t.startsWith("file:")?new se('Missing PDF "'+t+'".'):new ge(`Unexpected server response (${r}) while retrieving PDF "${t}".`,r)}function da(r){return r===200||r===206}function ua(r,t,e){return{method:"GET",headers:r,signal:e.signal,mode:"cors",credentials:t?"include":"same-origin",redirect:"follow"}}function fa(r){return r instanceof Uint8Array?r.buffer:r instanceof ArrayBuffer?r:(D(`getArrayBuffer - unexpected data format: ${r}`),new Uint8Array(r).buffer)}var Mi=class{_responseOrigin=null;constructor(t){this.source=t,this.isHttp=/^https?:/i.test(t.url),this.headers=la(this.isHttp,t.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return Q(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new un(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;let i=new fn(this,t,e);return this._rangeRequestReaders.push(i),i}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(let e of this._rangeRequestReaders.slice(0))e.cancel(t)}},un=class{constructor(t){this._stream=t,this._reader=null,this._loaded=0,this._filename=null;let e=t.source;this._withCredentials=e.withCredentials||!1,this._contentLength=e.length,this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange;let i=new Headers(t.headers),s=e.url;fetch(s,ua(i,this._withCredentials,this._abortController)).then(n=>{if(t._responseOrigin=Ki(n.url),!da(n.status))throw Ji(n.status,s);this._reader=n.body.getReader(),this._headersCapability.resolve();let a=n.headers,{allowRangeRequests:o,suggestedLength:l}=ca({responseHeaders:a,isHttp:t.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=o,this._contentLength=l||this._contentLength,this._filename=ha(a),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new Lt("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}read(){return w(this,null,function*(){yield this._headersCapability.promise;let{value:t,done:e}=yield this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:fa(t),done:!1})})}cancel(t){this._reader?.cancel(t),this._abortController.abort()}},fn=class{constructor(t,e,i){this._stream=t,this._reader=null,this._loaded=0;let s=t.source;this._withCredentials=s.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!s.disableStream,this._abortController=new AbortController;let n=new Headers(t.headers);n.append("Range",`bytes=${e}-${i-1}`);let a=s.url;fetch(a,ua(n,this._withCredentials,this._abortController)).then(o=>{let l=Ki(o.url);if(l!==t._responseOrigin)throw new Error(`Expected range response-origin "${l}" to match "${t._responseOrigin}".`);if(!da(o.status))throw Ji(o.status,a);this._readCapability.resolve(),this._reader=o.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}read(){return w(this,null,function*(){yield this._readCapability.promise;let{value:t,done:e}=yield this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,this.onProgress?.({loaded:this._loaded}),{value:fa(t),done:!1})})}cancel(t){this._reader?.cancel(t),this._abortController.abort()}},Os=200,Fs=206;function jo(r){let t=r.response;return typeof t!="string"?t:qi(t).buffer}var pn=class{_responseOrigin=null;constructor({url:t,httpHeaders:e,withCredentials:i}){this.url=t,this.isHttp=/^https?:/i.test(t),this.headers=la(this.isHttp,e),this.withCredentials=i||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(t){let e=new XMLHttpRequest,i=this.currXhrId++,s=this.pendingRequests[i]={xhr:e};e.open("GET",this.url),e.withCredentials=this.withCredentials;for(let[n,a]of this.headers)e.setRequestHeader(n,a);return this.isHttp&&"begin"in t&&"end"in t?(e.setRequestHeader("Range",`bytes=${t.begin}-${t.end-1}`),s.expectedStatus=Fs):s.expectedStatus=Os,e.responseType="arraybuffer",Q(t.onError,"Expected `onError` callback to be provided."),e.onerror=()=>{t.onError(e.status)},e.onreadystatechange=this.onStateChange.bind(this,i),e.onprogress=this.onProgress.bind(this,i),s.onHeadersReceived=t.onHeadersReceived,s.onDone=t.onDone,s.onError=t.onError,s.onProgress=t.onProgress,e.send(null),i}onProgress(t,e){let i=this.pendingRequests[t];i&&i.onProgress?.(e)}onStateChange(t,e){let i=this.pendingRequests[t];if(!i)return;let s=i.xhr;if(s.readyState>=2&&i.onHeadersReceived&&(i.onHeadersReceived(),delete i.onHeadersReceived),s.readyState!==4||!(t in this.pendingRequests))return;if(delete this.pendingRequests[t],s.status===0&&this.isHttp){i.onError(s.status);return}let n=s.status||Os;if(!(n===Os&&i.expectedStatus===Fs)&&n!==i.expectedStatus){i.onError(s.status);return}let o=jo(s);if(n===Fs){let l=s.getResponseHeader("Content-Range"),c=/bytes (\d+)-(\d+)\/(\d+)/.exec(l);c?i.onDone({begin:parseInt(c[1],10),chunk:o}):(D('Missing or invalid "Content-Range" header.'),i.onError(0))}else o?i.onDone({begin:0,chunk:o}):i.onError(s.status)}getRequestXhr(t){return this.pendingRequests[t].xhr}isPendingRequest(t){return t in this.pendingRequests}abortRequest(t){let e=this.pendingRequests[t].xhr;delete this.pendingRequests[t],e.abort()}},gn=class{constructor(t){this._source=t,this._manager=new pn(t),this._rangeChunkSize=t.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(t){let e=this._rangeRequestReaders.indexOf(t);e>=0&&this._rangeRequestReaders.splice(e,1)}getFullReader(){return Q(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new mn(this._manager,this._source),this._fullRequestReader}getRangeReader(t,e){let i=new bn(this._manager,t,e);return i.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(i),i}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(let e of this._rangeRequestReaders.slice(0))e.cancel(t)}},mn=class{constructor(t,e){this._manager=t,this._url=e.url,this._fullRequestId=t.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._contentLength=e.length,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){let t=this._fullRequestId,e=this._manager.getRequestXhr(t);this._manager._responseOrigin=Ki(e.responseURL);let i=e.getAllResponseHeaders(),s=new Headers(i?i.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(o=>{let[l,...c]=o.split(": ");return[l,c.join(": ")]}):[]),{allowRangeRequests:n,suggestedLength:a}=ca({responseHeaders:s,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});n&&(this._isRangeSupported=!0),this._contentLength=a||this._contentLength,this._filename=ha(s),this._isRangeSupported&&this._manager.abortRequest(t),this._headersCapability.resolve()}_onDone(t){if(t&&(this._requests.length>0?this._requests.shift().resolve({value:t.chunk,done:!1}):this._cachedChunks.push(t.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(let e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(t){this._storedError=Ji(t,this._url),this._headersCapability.reject(this._storedError);for(let e of this._requests)e.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(t){this.onProgress?.({loaded:t.loaded,total:t.lengthComputable?t.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}read(){return w(this,null,function*(){if(yield this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let t=Promise.withResolvers();return this._requests.push(t),t.promise})}cancel(t){this._done=!0,this._headersCapability.reject(t);for(let e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}},bn=class{constructor(t,e,i){this._manager=t,this._url=t.url,this._requestId=t.request({begin:e,end:i,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){let t=Ki(this._manager.getRequestXhr(this._requestId)?.responseURL);t!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${t}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){this.onClosed?.(this)}_onDone(t){let e=t.chunk;this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunk=e,this._done=!0;for(let i of this._requests)i.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(t){this._storedError??=Ji(t,this._url);for(let e of this._requests)e.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(t){this.isStreamingSupported||this.onProgress?.({loaded:t.loaded})}get isStreamingSupported(){return!1}read(){return w(this,null,function*(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){let e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};let t=Promise.withResolvers();return this._requests.push(t),t.promise})}cancel(t){this._done=!0;for(let e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}},Uo=/^[a-z][a-z0-9\-+.]+:/i;function $o(r){if(Uo.test(r))return new URL(r);let t=process.getBuiltinModule("url");return new URL(t.pathToFileURL(r))}var _n=class{constructor(t){this.source=t,this.url=$o(t.url),Q(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return Q(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new yn(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;let i=new vn(this,t,e);return this._rangeRequestReaders.push(i),i}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(let e of this._rangeRequestReaders.slice(0))e.cancel(t)}},yn=class{constructor(t){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null;let e=t.source;this._contentLength=e.length,this._loaded=0,this._filename=null,this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();let i=process.getBuiltinModule("fs");i.promises.lstat(this._url).then(s=>{this._contentLength=s.size,this._setReadableStream(i.createReadStream(this._url)),this._headersCapability.resolve()},s=>{s.code==="ENOENT"&&(s=new se(`Missing PDF "${this._url}".`)),this._storedError=s,this._headersCapability.reject(s)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}read(){return w(this,null,function*(){if(yield this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(t).buffer,done:!1})})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new Lt("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}},vn=class{constructor(t,e,i){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();let s=t.source;this._isStreamingSupported=!s.disableStream;let n=process.getBuiltinModule("fs");this._setReadableStream(n.createReadStream(this._url,{start:e,end:i-1}))}get isStreamingSupported(){return this._isStreamingSupported}read(){return w(this,null,function*(){if(yield this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(t).buffer,done:!1})})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),this._storedError&&this._readableStream.destroy(this._storedError)}},zo=1e5,ut=30,Wo=.8,Be=class r{#t=Promise.withResolvers();#e=null;#i=!1;#s=!!globalThis.FontInspector?.enabled;#r=null;#n=null;#l=0;#o=0;#h=null;#c=null;#u=0;#d=0;#f=Object.create(null);#a=[];#p=null;#m=[];#g=new WeakMap;#b=null;static#v=new Map;static#_=new Map;static#A=new WeakMap;static#C=null;static#S=new Set;constructor({textContentSource:t,container:e,viewport:i}){if(t instanceof ReadableStream)this.#p=t;else if(typeof t=="object")this.#p=new ReadableStream({start(l){l.enqueue(t),l.close()}});else throw new Error('No "textContentSource" parameter specified.');this.#e=this.#c=e,this.#d=i.scale*(globalThis.devicePixelRatio||1),this.#u=i.rotation,this.#n={div:null,properties:null,ctx:null};let{pageWidth:s,pageHeight:n,pageX:a,pageY:o}=i.rawDims;this.#b=[1,0,0,-1,-a,o+n],this.#o=s,this.#l=n,r.#P(),ne(e,i),this.#t.promise.finally(()=>{r.#S.delete(this),this.#n=null,this.#f=null}).catch(()=>{})}static get fontFamilyMap(){let{isWindows:t,isFirefox:e}=rt.platform;return O(this,"fontFamilyMap",new Map([["sans-serif",`${t&&e?"Calibri, ":""}sans-serif`],["monospace",`${t&&e?"Lucida Console, ":""}monospace`]]))}render(){let t=()=>{this.#h.read().then(({value:e,done:i})=>{if(i){this.#t.resolve();return}this.#r??=e.lang,Object.assign(this.#f,e.styles),this.#T(e.items),t()},this.#t.reject)};return this.#h=this.#p.getReader(),r.#S.add(this),t(),this.#t.promise}update({viewport:t,onBefore:e=null}){let i=t.scale*(globalThis.devicePixelRatio||1),s=t.rotation;if(s!==this.#u&&(e?.(),this.#u=s,ne(this.#c,{rotation:s})),i!==this.#d){e?.(),this.#d=i;let n={div:null,properties:null,ctx:r.#M(this.#r)};for(let a of this.#m)n.properties=this.#g.get(a),n.div=a,this.#w(n)}}cancel(){let t=new Lt("TextLayer task cancelled.");this.#h?.cancel(t).catch(()=>{}),this.#h=null,this.#t.reject(t)}get textDivs(){return this.#m}get textContentItemsStr(){return this.#a}#T(t){if(this.#i)return;this.#n.ctx??=r.#M(this.#r);let e=this.#m,i=this.#a;for(let s of t){if(e.length>zo){D("Ignoring additional textDivs for performance reasons."),this.#i=!0;return}if(s.str===void 0){if(s.type==="beginMarkedContentProps"||s.type==="beginMarkedContent"){let n=this.#e;this.#e=document.createElement("span"),this.#e.classList.add("markedContent"),s.id!==null&&this.#e.setAttribute("id",`${s.id}`),n.append(this.#e)}else s.type==="endMarkedContent"&&(this.#e=this.#e.parentNode);continue}i.push(s.str),this.#I(s)}}#I(t){let e=document.createElement("span"),i={angle:0,canvasWidth:0,hasText:t.str!=="",hasEOL:t.hasEOL,fontSize:0};this.#m.push(e);let s=T.transform(this.#b,t.transform),n=Math.atan2(s[1],s[0]),a=this.#f[t.fontName];a.vertical&&(n+=Math.PI/2);let o=this.#s&&a.fontSubstitution||a.fontFamily;o=r.fontFamilyMap.get(o)||o;let l=Math.hypot(s[2],s[3]),c=l*r.#O(o,this.#r),h,d;n===0?(h=s[4],d=s[5]-c):(h=s[4]+c*Math.sin(n),d=s[5]-c*Math.cos(n));let u="calc(var(--scale-factor)*",f=e.style;this.#e===this.#c?(f.left=`${(100*h/this.#o).toFixed(2)}%`,f.top=`${(100*d/this.#l).toFixed(2)}%`):(f.left=`${u}${h.toFixed(2)}px)`,f.top=`${u}${d.toFixed(2)}px)`),f.fontSize=`${u}${(r.#C*l).toFixed(2)}px)`,f.fontFamily=o,i.fontSize=l,e.setAttribute("role","presentation"),e.textContent=t.str,e.dir=t.dir,this.#s&&(e.dataset.fontName=a.fontSubstitutionLoadedName||t.fontName),n!==0&&(i.angle=n*(180/Math.PI));let p=!1;if(t.str.length>1)p=!0;else if(t.str!==" "&&t.transform[0]!==t.transform[3]){let g=Math.abs(t.transform[0]),b=Math.abs(t.transform[3]);g!==b&&Math.max(g,b)/Math.min(g,b)>1.5&&(p=!0)}if(p&&(i.canvasWidth=a.vertical?t.height:t.width),this.#g.set(e,i),this.#n.div=e,this.#n.properties=i,this.#w(this.#n),i.hasText&&this.#e.append(e),i.hasEOL){let g=document.createElement("br");g.setAttribute("role","presentation"),this.#e.append(g)}}#w(t){let{div:e,properties:i,ctx:s}=t,{style:n}=e,a="";if(r.#C>1&&(a=`scale(${1/r.#C})`),i.canvasWidth!==0&&i.hasText){let{fontFamily:o}=n,{canvasWidth:l,fontSize:c}=i;r.#x(s,c*this.#d,o);let{width:h}=s.measureText(e.textContent);h>0&&(a=`scaleX(${l*this.#d/h}) ${a}`)}i.angle!==0&&(a=`rotate(${i.angle}deg) ${a}`),a.length>0&&(n.transform=a)}static cleanup(){if(!(this.#S.size>0)){this.#v.clear();for(let{canvas:t}of this.#_.values())t.remove();this.#_.clear()}}static#M(t=null){let e=this.#_.get(t||="");if(!e){let i=document.createElement("canvas");i.className="hiddenCanvasElement",i.lang=t,document.body.append(i),e=i.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.#_.set(t,e),this.#A.set(e,{size:0,family:""})}return e}static#x(t,e,i){let s=this.#A.get(t);e===s.size&&i===s.family||(t.font=`${e}px ${i}`,s.size=e,s.family=i)}static#P(){if(this.#C!==null)return;let t=document.createElement("div");t.style.opacity=0,t.style.lineHeight=1,t.style.fontSize="1px",t.style.position="absolute",t.textContent="X",document.body.append(t),this.#C=t.getBoundingClientRect().height,t.remove()}static#O(t,e){let i=this.#v.get(t);if(i)return i;let s=this.#M(e);s.canvas.width=s.canvas.height=ut,this.#x(s,ut,t);let n=s.measureText(""),a=n.fontBoundingBoxAscent,o=Math.abs(n.fontBoundingBoxDescent);if(a){let h=a/(a+o);return this.#v.set(t,h),s.canvas.width=s.canvas.height=0,h}s.strokeStyle="red",s.clearRect(0,0,ut,ut),s.strokeText("g",0,0);let l=s.getImageData(0,0,ut,ut).data;o=0;for(let h=l.length-1-3;h>=0;h-=4)if(l[h]>0){o=Math.ceil(h/4/ut);break}s.clearRect(0,0,ut,ut),s.strokeText("A",0,ut),l=s.getImageData(0,0,ut,ut).data,a=0;for(let h=0,d=l.length;h<d;h+=4)if(l[h]>0){a=ut-Math.floor(h/4/ut);break}s.canvas.width=s.canvas.height=0;let c=a?a/(a+o):Wo;return this.#v.set(t,c),c}},He=class r{static textContent(t){let e=[],i={items:e,styles:Object.create(null)};function s(n){if(!n)return;let a=null,o=n.name;if(o==="#text")a=n.value;else if(r.shouldBuildText(o))n?.attributes?.textContent?a=n.attributes.textContent:n.value&&(a=n.value);else return;if(a!==null&&e.push({str:a}),!!n.children)for(let l of n.children)s(l)}return s(t),i}static shouldBuildText(t){return!(t==="textarea"||t==="input"||t==="option"||t==="select")}},qo=65536,Xo=100,Yo=5e3,Ko=lt?Js:Xs,Jo=lt?Qs:Ci,Qo=lt?Ks:Ys,Zo=lt?Zs:xi;function tl(r={}){typeof r=="string"||r instanceof URL?r={url:r}:(r instanceof ArrayBuffer||ArrayBuffer.isView(r))&&(r={data:r});let t=new An,{docId:e}=t,i=r.url?el(r.url):null,s=r.data?il(r.data):null,n=r.httpHeaders||null,a=r.withCredentials===!0,o=r.password??null,l=r.range instanceof Ii?r.range:null,c=Number.isInteger(r.rangeChunkSize)&&r.rangeChunkSize>0?r.rangeChunkSize:qo,h=r.worker instanceof pe?r.worker:null,d=r.verbosity,u=typeof r.docBaseUrl=="string"&&!Yi(r.docBaseUrl)?r.docBaseUrl:null,f=typeof r.cMapUrl=="string"?r.cMapUrl:null,p=r.cMapPacked!==!1,g=r.CMapReaderFactory||Jo,b=typeof r.standardFontDataUrl=="string"?r.standardFontDataUrl:null,m=r.StandardFontDataFactory||Zo,_=r.stopAtErrors!==!0,y=Number.isInteger(r.maxImageSize)&&r.maxImageSize>-1?r.maxImageSize:-1,v=r.isEvalSupported!==!1,A=typeof r.isOffscreenCanvasSupported=="boolean"?r.isOffscreenCanvasSupported:!lt,E=typeof r.isImageDecoderSupported=="boolean"?r.isImageDecoderSupported:!lt&&(rt.platform.isFirefox||!globalThis.chrome),C=Number.isInteger(r.canvasMaxAreaInBytes)?r.canvasMaxAreaInBytes:-1,I=typeof r.disableFontFace=="boolean"?r.disableFontFace:lt,R=r.fontExtraProperties===!0,V=r.enableXfa===!0,F=r.ownerDocument||globalThis.document,q=r.disableRange===!0,Z=r.disableStream===!0,H=r.disableAutoFetch===!0,dt=r.pdfBug===!0,x=r.CanvasFactory||Ko,M=r.FilterFactory||Qo,bt=r.enableHWA===!0,Tt=l?l.length:r.length??NaN,Qt=typeof r.useSystemFonts=="boolean"?r.useSystemFonts:!lt&&!I,_t=typeof r.useWorkerFetch=="boolean"?r.useWorkerFetch:g===Ci&&m===xi&&f&&b&&Ie(f,document.baseURI)&&Ie(b,document.baseURI),it=null;mo(d);let K={canvasFactory:new x({ownerDocument:F,enableHWA:bt}),filterFactory:new M({docId:e,ownerDocument:F}),cMapReaderFactory:_t?null:new g({baseUrl:f,isCompressed:p}),standardFontDataFactory:_t?null:new m({baseUrl:b})};if(!h){let yt={verbosity:d,port:ie.workerPort};h=yt.port?pe.fromPort(yt):new pe(yt),t._worker=h}let ce={docId:e,apiVersion:"4.10.38",data:s,password:o,disableAutoFetch:H,rangeChunkSize:c,length:Tt,docBaseUrl:u,enableXfa:V,evaluatorOptions:{maxImageSize:y,disableFontFace:I,ignoreErrors:_,isEvalSupported:v,isOffscreenCanvasSupported:A,isImageDecoderSupported:E,canvasMaxAreaInBytes:C,fontExtraProperties:R,useSystemFonts:Qt,cMapUrl:_t?f:null,standardFontDataUrl:_t?b:null}},ve={disableFontFace:I,fontExtraProperties:R,ownerDocument:F,pdfBug:dt,styleElement:it,loadingParams:{disableAutoFetch:H,enableXfa:V}};return h.promise.then(function(){if(t.destroyed)throw new Error("Loading aborted");if(h.destroyed)throw new Error("Worker was destroyed");let yt=h.messageHandler.sendWithPromise("GetDocRequest",ce,s?[s.buffer]:null),U;if(l)U=new cn(l,{disableRange:q,disableStream:Z});else if(!s){if(!i)throw new Error("getDocument - no `url` parameter provided.");let Mt;if(lt)if(Ie(i)){if(typeof fetch>"u"||typeof Response>"u"||!("body"in Response.prototype))throw new Error("getDocument - the Fetch API was disabled in Node.js, see `--no-experimental-fetch`.");Mt=Mi}else Mt=_n;else Mt=Ie(i)?Mi:gn;U=new Mt({url:i,length:Tt,httpHeaders:n,withCredentials:a,rangeChunkSize:c,disableRange:q,disableStream:Z})}return yt.then(Mt=>{if(t.destroyed)throw new Error("Loading aborted");if(h.destroyed)throw new Error("Worker was destroyed");let xr=new ee(e,Mt,h.port),co=new Sn(xr,t,U,ve,K);t._transport=co,xr.send("Ready",null)})}).catch(t._capability.reject),t}function el(r){if(r instanceof URL)return r.href;try{return new URL(r,window.location).href}catch{if(lt&&typeof r=="string")return r}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function il(r){if(lt&&typeof Buffer<"u"&&r instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(r instanceof Uint8Array&&r.byteLength===r.buffer.byteLength)return r;if(typeof r=="string")return qi(r);if(r instanceof ArrayBuffer||ArrayBuffer.isView(r)||typeof r=="object"&&!isNaN(r?.length))return new Uint8Array(r);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function sa(r){return typeof r=="object"&&Number.isInteger(r?.num)&&r.num>=0&&Number.isInteger(r?.gen)&&r.gen>=0}var An=class r{static#t=0;constructor(){this._capability=Promise.withResolvers(),this._transport=null,this._worker=null,this.docId=`d${r.#t++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}destroy(){return w(this,null,function*(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),yield this._transport?.destroy()}catch(t){throw this._worker?.port&&delete this._worker._pendingDestroy,t}this._transport=null,this._worker?.destroy(),this._worker=null})}},Ii=class{constructor(t,e,i=!1,s=null){this.length=t,this.initialData=e,this.progressiveDone=i,this.contentDispositionFilename=s,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=Promise.withResolvers()}addRangeListener(t){this._rangeListeners.push(t)}addProgressListener(t){this._progressListeners.push(t)}addProgressiveReadListener(t){this._progressiveReadListeners.push(t)}addProgressiveDoneListener(t){this._progressiveDoneListeners.push(t)}onDataRange(t,e){for(let i of this._rangeListeners)i(t,e)}onDataProgress(t,e){this._readyCapability.promise.then(()=>{for(let i of this._progressListeners)i(t,e)})}onDataProgressiveRead(t){this._readyCapability.promise.then(()=>{for(let e of this._progressiveReadListeners)e(t)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(let t of this._progressiveDoneListeners)t()})}transportReady(){this._readyCapability.resolve()}requestDataRange(t,e){G("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}},wn=class{constructor(t,e){this._pdfInfo=t,this._transport=e}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return O(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(t){return this._transport.getPage(t)}getPageIndex(t){return this._transport.getPageIndex(t)}getDestinations(){return this._transport.getDestinations()}getDestination(t){return this._transport.getDestination(t)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:t="display"}={}){let{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getOptionalContentConfig(e)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(t=!1){return this._transport.startCleanup(t||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(t){return this._transport.cachedPageNumber(t)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}},Cn=class{#t=null;#e=!1;constructor(t,e,i,s=!1){this._pageIndex=t,this._pageInfo=e,this._transport=i,this._stats=s?new gi:null,this._pdfBug=s,this.commonObjs=i.commonObjs,this.objs=new Ri,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:t,rotation:e=this.rotate,offsetX:i=0,offsetY:s=0,dontFlip:n=!1}={}){return new De({viewBox:this.view,userUnit:this.userUnit,scale:t,rotation:e,offsetX:i,offsetY:s,dontFlip:n})}getAnnotations({intent:t="display"}={}){let{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getAnnotations(this._pageIndex,e)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return O(this,"isPureXfa",!!this._transport._htmlForXfa)}getXfa(){return w(this,null,function*(){return this._transport._htmlForXfa?.children[this._pageIndex]||null})}render({canvasContext:t,viewport:e,intent:i="display",annotationMode:s=$t.ENABLE,transform:n=null,background:a=null,optionalContentConfigPromise:o=null,annotationCanvasMap:l=null,pageColors:c=null,printAnnotationStorage:h=null,isEditing:d=!1}){this._stats?.time("Overall");let u=this._transport.getRenderingIntent(i,s,h,d),{renderingIntent:f,cacheKey:p}=u;this.#e=!1,this.#s(),o||=this._transport.getOptionalContentConfig(f);let g=this._intentStates.get(p);g||(g=Object.create(null),this._intentStates.set(p,g)),g.streamReaderCancelTimeout&&(clearTimeout(g.streamReaderCancelTimeout),g.streamReaderCancelTimeout=null);let b=!!(f&gt.PRINT);g.displayReadyCapability||(g.displayReadyCapability=Promise.withResolvers(),g.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(u));let m=v=>{g.renderTasks.delete(_),(this._maybeCleanupAfterRender||b)&&(this.#e=!0),this.#i(!b),v?(_.capability.reject(v),this._abortOperatorList({intentState:g,reason:v instanceof Error?v:new Error(v)})):_.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},_=new Tn({callback:m,params:{canvasContext:t,viewport:e,transform:n,background:a},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:l,operatorList:g.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!b,pdfBug:this._pdfBug,pageColors:c});(g.renderTasks||=new Set).add(_);let y=_.task;return Promise.all([g.displayReadyCapability.promise,o]).then(([v,A])=>{if(this.destroyed){m();return}if(this._stats?.time("Rendering"),!(A.renderingIntent&f))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");_.initializeGraphics({transparency:v,optionalContentConfig:A}),_.operatorListChanged()}).catch(m),y}getOperatorList({intent:t="display",annotationMode:e=$t.ENABLE,printAnnotationStorage:i=null,isEditing:s=!1}={}){function n(){o.operatorList.lastChunk&&(o.opListReadCapability.resolve(o.operatorList),o.renderTasks.delete(l))}let a=this._transport.getRenderingIntent(t,e,i,s,!0),o=this._intentStates.get(a.cacheKey);o||(o=Object.create(null),this._intentStates.set(a.cacheKey,o));let l;return o.opListReadCapability||(l=Object.create(null),l.operatorListChanged=n,o.opListReadCapability=Promise.withResolvers(),(o.renderTasks||=new Set).add(l),o.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(a)),o.opListReadCapability.promise}streamTextContent({includeMarkedContent:t=!1,disableNormalization:e=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:t===!0,disableNormalization:e===!0},{highWaterMark:100,size(s){return s.items.length}})}getTextContent(t={}){if(this._transport._htmlForXfa)return this.getXfa().then(i=>He.textContent(i));let e=this.streamTextContent(t);return new Promise(function(i,s){function n(){a.read().then(function({value:l,done:c}){if(c){i(o);return}o.lang??=l.lang,Object.assign(o.styles,l.styles),o.items.push(...l.items),n()},s)}let a=e.getReader(),o={items:[],styles:Object.create(null),lang:null};n()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;let t=[];for(let e of this._intentStates.values())if(this._abortOperatorList({intentState:e,reason:new Error("Page was destroyed."),force:!0}),!e.opListReadCapability)for(let i of e.renderTasks)t.push(i.completed),i.cancel();return this.objs.clear(),this.#e=!1,this.#s(),Promise.all(t)}cleanup(t=!1){this.#e=!0;let e=this.#i(!1);return t&&e&&(this._stats&&=new gi),e}#i(t=!1){if(this.#s(),!this.#e||this.destroyed)return!1;if(t)return this.#t=setTimeout(()=>{this.#t=null,this.#i(!1)},Yo),!1;for(let{renderTasks:e,operatorList:i}of this._intentStates.values())if(e.size>0||!i.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#e=!1,!0}#s(){this.#t&&(clearTimeout(this.#t),this.#t=null)}_startRenderPage(t,e){let i=this._intentStates.get(e);i&&(this._stats?.timeEnd("Page Request"),i.displayReadyCapability?.resolve(t))}_renderPageChunk(t,e){for(let i=0,s=t.length;i<s;i++)e.operatorList.fnArray.push(t.fnArray[i]),e.operatorList.argsArray.push(t.argsArray[i]);e.operatorList.lastChunk=t.lastChunk,e.operatorList.separateAnnots=t.separateAnnots;for(let i of e.renderTasks)i.operatorListChanged();t.lastChunk&&this.#i(!0)}_pumpOperatorList({renderingIntent:t,cacheKey:e,annotationStorageSerializable:i,modifiedIds:s}){let{map:n,transfer:a}=i,l=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:t,cacheKey:e,annotationStorage:n,modifiedIds:s},a).getReader(),c=this._intentStates.get(e);c.streamReader=l;let h=()=>{l.read().then(({value:d,done:u})=>{if(u){c.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(d,c),h())},d=>{if(c.streamReader=null,!this._transport.destroyed){if(c.operatorList){c.operatorList.lastChunk=!0;for(let u of c.renderTasks)u.operatorListChanged();this.#i(!0)}if(c.displayReadyCapability)c.displayReadyCapability.reject(d);else if(c.opListReadCapability)c.opListReadCapability.reject(d);else throw d}})};h()}_abortOperatorList({intentState:t,reason:e,force:i=!1}){if(t.streamReader){if(t.streamReaderCancelTimeout&&(clearTimeout(t.streamReaderCancelTimeout),t.streamReaderCancelTimeout=null),!i){if(t.renderTasks.size>0)return;if(e instanceof Oe){let s=Xo;e.extraDelay>0&&e.extraDelay<1e3&&(s+=e.extraDelay),t.streamReaderCancelTimeout=setTimeout(()=>{t.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:t,reason:e,force:!0})},s);return}}if(t.streamReader.cancel(new Lt(e.message)).catch(()=>{}),t.streamReader=null,!this._transport.destroyed){for(let[s,n]of this._intentStates)if(n===t){this._intentStates.delete(s);break}this.cleanup()}}}get stats(){return this._stats}},En=class{#t=new Map;#e=Promise.resolve();postMessage(t,e){let i={data:structuredClone(t,e?{transfer:e}:null)};this.#e.then(()=>{for(let[s]of this.#t)s.call(this,i)})}addEventListener(t,e,i=null){let s=null;if(i?.signal instanceof AbortSignal){let{signal:n}=i;if(n.aborted){D("LoopbackPort - cannot use an `aborted` signal.");return}let a=()=>this.removeEventListener(t,e);s=()=>n.removeEventListener("abort",a),n.addEventListener("abort",a)}this.#t.set(e,s)}removeEventListener(t,e){this.#t.get(e)?.(),this.#t.delete(e)}terminate(){for(let[,t]of this.#t)t?.();this.#t.clear()}},pe=class r{static#t=0;static#e=!1;static#i;static{lt&&(this.#e=!0,ie.workerSrc||="./pdf.worker.mjs"),this._isSameOrigin=(t,e)=>{let i;try{if(i=new URL(t),!i.origin||i.origin==="null")return!1}catch{return!1}let s=new URL(e,i);return i.origin===s.origin},this._createCDNWrapper=t=>{let e=`await import("${t}");`;return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}}constructor({name:t=null,port:e=null,verbosity:i=bo()}={}){if(this.name=t,this.destroyed=!1,this.verbosity=i,this._readyCapability=Promise.withResolvers(),this._port=null,this._webWorker=null,this._messageHandler=null,e){if(r.#i?.has(e))throw new Error("Cannot use more than one PDFWorker per port.");(r.#i||=new WeakMap).set(e,this),this._initializeFromPort(e);return}this._initialize()}get promise(){return this._readyCapability.promise}#s(){this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(t){this._port=t,this._messageHandler=new ee("main","worker",t),this._messageHandler.on("ready",function(){}),this.#s()}_initialize(){if(r.#e||r.#r){this._setupFakeWorker();return}let{workerSrc:t}=r;try{r._isSameOrigin(window.location.href,t)||(t=r._createCDNWrapper(new URL(t,window.location).href));let e=new Worker(t,{type:"module"}),i=new ee("main","worker",e),s=()=>{n.abort(),i.destroy(),e.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},n=new AbortController;e.addEventListener("error",()=>{this._webWorker||s()},{signal:n.signal}),i.on("test",o=>{if(n.abort(),this.destroyed||!o){s();return}this._messageHandler=i,this._port=e,this._webWorker=e,this.#s()}),i.on("ready",o=>{if(n.abort(),this.destroyed){s();return}try{a()}catch{this._setupFakeWorker()}});let a=()=>{let o=new Uint8Array;i.send("test",o,[o.buffer])};a();return}catch{Wi("The worker has been disabled.")}this._setupFakeWorker()}_setupFakeWorker(){r.#e||(D("Setting up fake worker."),r.#e=!0),r._setupFakeWorkerGlobal.then(t=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}let e=new En;this._port=e;let i=`fake${r.#t++}`,s=new ee(i+"_worker",i,e);t.setup(s,e),this._messageHandler=new ee(i,i+"_worker",e),this.#s()}).catch(t=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${t.message}".`))})}destroy(){this.destroyed=!0,this._webWorker?.terminate(),this._webWorker=null,r.#i?.delete(this._port),this._port=null,this._messageHandler?.destroy(),this._messageHandler=null}static fromPort(t){if(!t?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");let e=this.#i?.get(t.port);if(e){if(e._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return e}return new r(t)}static get workerSrc(){if(ie.workerSrc)return ie.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get#r(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}}static get _setupFakeWorkerGlobal(){return O(this,"_setupFakeWorkerGlobal",w(this,null,function*(){return this.#r?this.#r:(yield import(this.workerSrc)).WorkerMessageHandler}))}},Sn=class{#t=new Map;#e=new Map;#i=new Map;#s=new Map;#r=null;constructor(t,e,i,s,n){this.messageHandler=t,this.loadingTask=e,this.commonObjs=new Ri,this.fontLoader=new Ws({ownerDocument:s.ownerDocument,styleElement:s.styleElement}),this.loadingParams=s.loadingParams,this._params=s,this.canvasFactory=n.canvasFactory,this.filterFactory=n.filterFactory,this.cMapReaderFactory=n.cMapReaderFactory,this.standardFontDataFactory=n.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=i,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}#n(t,e=null){let i=this.#t.get(t);if(i)return i;let s=this.messageHandler.sendWithPromise(t,e);return this.#t.set(t,s),s}get annotationStorage(){return O(this,"annotationStorage",new Ne)}getRenderingIntent(t,e=$t.ENABLE,i=null,s=!1,n=!1){let a=gt.DISPLAY,o=zs;switch(t){case"any":a=gt.ANY;break;case"display":break;case"print":a=gt.PRINT;break;default:D(`getRenderingIntent - invalid intent: ${t}`)}let l=a&gt.PRINT&&i instanceof vi?i:this.annotationStorage;switch(e){case $t.DISABLE:a+=gt.ANNOTATIONS_DISABLE;break;case $t.ENABLE:break;case $t.ENABLE_FORMS:a+=gt.ANNOTATIONS_FORMS;break;case $t.ENABLE_STORAGE:a+=gt.ANNOTATIONS_STORAGE,o=l.serializable;break;default:D(`getRenderingIntent - invalid annotationMode: ${e}`)}s&&(a+=gt.IS_EDITING),n&&(a+=gt.OPLIST);let{ids:c,hash:h}=l.modifiedIds,d=[a,o.hash,h];return{renderingIntent:a,cacheKey:d.join("_"),annotationStorageSerializable:o,modifiedIds:c}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#r?.reject(new Error("Worker was destroyed during onPassword callback"));let t=[];for(let i of this.#e.values())t.push(i._destroy());this.#e.clear(),this.#i.clear(),this.#s.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();let e=this.messageHandler.sendWithPromise("Terminate",null);return t.push(e),Promise.all(t).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(),Be.cleanup(),this._networkStream?.cancelAllRequests(new Lt("Worker was terminated.")),this.messageHandler?.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){let{messageHandler:t,loadingTask:e}=this;t.on("GetReader",(i,s)=>{Q(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=n=>{this._lastProgress={loaded:n.loaded,total:n.total}},s.onPull=()=>{this._fullReader.read().then(function({value:n,done:a}){if(a){s.close();return}Q(n instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(n),1,[n])}).catch(n=>{s.error(n)})},s.onCancel=n=>{this._fullReader.cancel(n),s.ready.catch(a=>{if(!this.destroyed)throw a})}}),t.on("ReaderHeadersReady",i=>w(this,null,function*(){yield this._fullReader.headersReady;let{isStreamingSupported:s,isRangeSupported:n,contentLength:a}=this._fullReader;return(!s||!n)&&(this._lastProgress&&e.onProgress?.(this._lastProgress),this._fullReader.onProgress=o=>{e.onProgress?.({loaded:o.loaded,total:o.total})}),{isStreamingSupported:s,isRangeSupported:n,contentLength:a}})),t.on("GetRangeReader",(i,s)=>{Q(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");let n=this._networkStream.getRangeReader(i.begin,i.end);if(!n){s.close();return}s.onPull=()=>{n.read().then(function({value:a,done:o}){if(o){s.close();return}Q(a instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(a),1,[a])}).catch(a=>{s.error(a)})},s.onCancel=a=>{n.cancel(a),s.ready.catch(o=>{if(!this.destroyed)throw o})}}),t.on("GetDoc",({pdfInfo:i})=>{this._numPages=i.numPages,this._htmlForXfa=i.htmlForXfa,delete i.htmlForXfa,e._capability.resolve(new wn(i,this))}),t.on("DocException",i=>{e._capability.reject(ft(i))}),t.on("PasswordRequest",i=>{this.#r=Promise.withResolvers();try{if(!e.onPassword)throw ft(i);let s=n=>{n instanceof Error?this.#r.reject(n):this.#r.resolve({password:n})};e.onPassword(s,i.code)}catch(s){this.#r.reject(s)}return this.#r.promise}),t.on("DataLoaded",i=>{e.onProgress?.({loaded:i.length,total:i.length}),this.downloadInfoCapability.resolve(i)}),t.on("StartRenderPage",i=>{if(this.destroyed)return;this.#e.get(i.pageIndex)._startRenderPage(i.transparency,i.cacheKey)}),t.on("commonobj",([i,s,n])=>{if(this.destroyed||this.commonObjs.has(i))return null;switch(s){case"Font":let{disableFontFace:a,fontExtraProperties:o,pdfBug:l}=this._params;if("error"in n){let u=n.error;D(`Error during font loading: ${u}`),this.commonObjs.resolve(i,u);break}let c=l&&globalThis.FontInspector?.enabled?(u,f)=>globalThis.FontInspector.fontAdded(u,f):null,h=new qs(n,{disableFontFace:a,fontExtraProperties:o,inspectFont:c});this.fontLoader.bind(h).catch(()=>t.sendWithPromise("FontFallback",{id:i})).finally(()=>{!o&&h.data&&(h.data=null),this.commonObjs.resolve(i,h)});break;case"CopyLocalImage":let{imageRef:d}=n;Q(d,"The imageRef must be defined.");for(let u of this.#e.values())for(let[,f]of u.objs)if(f?.ref===d)return f.dataLen?(this.commonObjs.resolve(i,structuredClone(f)),f.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(i,n);break;default:throw new Error(`Got unknown common object type ${s}`)}return null}),t.on("obj",([i,s,n,a])=>{if(this.destroyed)return;let o=this.#e.get(s);if(!o.objs.has(i)){if(o._intentStates.size===0){a?.bitmap?.close();return}switch(n){case"Image":o.objs.resolve(i,a),a?.dataLen>ho&&(o._maybeCleanupAfterRender=!0);break;case"Pattern":o.objs.resolve(i,a);break;default:throw new Error(`Got unknown object type ${n}`)}}}),t.on("DocProgress",i=>{this.destroyed||e.onProgress?.({loaded:i.loaded,total:i.total})}),t.on("FetchBuiltInCMap",i=>w(this,null,function*(){if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.cMapReaderFactory)throw new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter.");return this.cMapReaderFactory.fetch(i)})),t.on("FetchStandardFontData",i=>w(this,null,function*(){if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.standardFontDataFactory)throw new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.");return this.standardFontDataFactory.fetch(i)}))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&D("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");let{map:t,transfer:e}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:t,filename:this._fullReader?.filename??null},e).finally(()=>{this.annotationStorage.resetModified()})}getPage(t){if(!Number.isInteger(t)||t<=0||t>this._numPages)return Promise.reject(new Error("Invalid page request."));let e=t-1,i=this.#i.get(e);if(i)return i;let s=this.messageHandler.sendWithPromise("GetPage",{pageIndex:e}).then(n=>{if(this.destroyed)throw new Error("Transport destroyed");n.refStr&&this.#s.set(n.refStr,t);let a=new Cn(e,n,this,this._params.pdfBug);return this.#e.set(e,a),a});return this.#i.set(e,s),s}getPageIndex(t){return sa(t)?this.messageHandler.sendWithPromise("GetPageIndex",{num:t.num,gen:t.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(t,e){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:t,intent:e})}getFieldObjects(){return this.#n("GetFieldObjects")}hasJSActions(){return this.#n("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(t){return typeof t!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:t})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return this.#n("GetDocJSActions")}getPageJSActions(t){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:t})}getStructTree(t){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:t})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(t){return this.#n("GetOptionalContentConfig").then(e=>new ln(e,t))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){let t="GetMetadata",e=this.#t.get(t);if(e)return e;let i=this.messageHandler.sendWithPromise(t,null).then(s=>({info:s[0],metadata:s[1]?new an(s[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return this.#t.set(t,i),i}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}startCleanup(t=!1){return w(this,null,function*(){if(!this.destroyed){yield this.messageHandler.sendWithPromise("Cleanup",null);for(let e of this.#e.values())if(!e.cleanup())throw new Error(`startCleanup: Page ${e.pageNumber} is currently rendering.`);this.commonObjs.clear(),t||this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(!0),Be.cleanup()}})}cachedPageNumber(t){if(!sa(t))return null;let e=t.gen===0?`${t.num}R`:`${t.num}R${t.gen}`;return this.#s.get(e)??null}},Te=Symbol("INITIAL_DATA"),Ri=class{#t=Object.create(null);#e(t){return this.#t[t]||=nt(X({},Promise.withResolvers()),{data:Te})}get(t,e=null){if(e){let s=this.#e(t);return s.promise.then(()=>e(s.data)),null}let i=this.#t[t];if(!i||i.data===Te)throw new Error(`Requesting object that isn't resolved yet ${t}.`);return i.data}has(t){let e=this.#t[t];return!!e&&e.data!==Te}delete(t){let e=this.#t[t];return!e||e.data===Te?!1:(delete this.#t[t],!0)}resolve(t,e=null){let i=this.#e(t);i.data=e,i.resolve()}clear(){for(let t in this.#t){let{data:e}=this.#t[t];e?.bitmap?.close()}this.#t=Object.create(null)}*[Symbol.iterator](){for(let t in this.#t){let{data:e}=this.#t[t];e!==Te&&(yield[t,e])}}},xn=class{#t=null;constructor(t){this.#t=t,this.onContinue=null}get promise(){return this.#t.capability.promise}cancel(t=0){this.#t.cancel(null,t)}get separateAnnots(){let{separateAnnots:t}=this.#t.operatorList;if(!t)return!1;let{annotationCanvasMap:e}=this.#t;return t.form||t.canvas&&e?.size>0}},Tn=class r{#t=null;static#e=new WeakSet;constructor({callback:t,params:e,objs:i,commonObjs:s,annotationCanvasMap:n,operatorList:a,pageIndex:o,canvasFactory:l,filterFactory:c,useRequestAnimationFrame:h=!1,pdfBug:d=!1,pageColors:u=null}){this.callback=t,this.params=e,this.objs=i,this.commonObjs=s,this.annotationCanvasMap=n,this.operatorListIdx=null,this.operatorList=a,this._pageIndex=o,this.canvasFactory=l,this.filterFactory=c,this._pdfBug=d,this.pageColors=u,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=h===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new xn(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=e.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:t=!1,optionalContentConfig:e}){if(this.cancelled)return;if(this._canvas){if(r.#e.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");r.#e.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());let{canvasContext:i,viewport:s,transform:n,background:a}=this.params;this.gfx=new fe(i,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:e},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:n,viewport:s,transparency:t,background:a}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(t=null,e=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this.#t&&(window.cancelAnimationFrame(this.#t),this.#t=null),r.#e.delete(this._canvas),this.callback(t||new Oe(`Rendering cancelled, page ${this._pageIndex+1}`,e))}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?this.#t=window.requestAnimationFrame(()=>{this.#t=null,this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}_next(){return w(this,null,function*(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),r.#e.delete(this._canvas),this.callback())))})}},sl="4.10.38",nl="f9bea397f";function na(r){return Math.floor(Math.max(0,Math.min(1,r))*255).toString(16).padStart(2,"0")}function Me(r){return Math.max(0,Math.min(255,255*r))}var Pi=class{static CMYK_G([t,e,i,s]){return["G",1-Math.min(1,.3*t+.59*i+.11*e+s)]}static G_CMYK([t]){return["CMYK",0,0,0,1-t]}static G_RGB([t]){return["RGB",t,t,t]}static G_rgb([t]){return t=Me(t),[t,t,t]}static G_HTML([t]){let e=na(t);return`#${e}${e}${e}`}static RGB_G([t,e,i]){return["G",.3*t+.59*e+.11*i]}static RGB_rgb(t){return t.map(Me)}static RGB_HTML(t){return`#${t.map(na).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([t,e,i,s]){return["RGB",1-Math.min(1,t+s),1-Math.min(1,i+s),1-Math.min(1,e+s)]}static CMYK_rgb([t,e,i,s]){return[Me(1-Math.min(1,t+s)),Me(1-Math.min(1,i+s)),Me(1-Math.min(1,e+s))]}static CMYK_HTML(t){let e=this.CMYK_RGB(t).slice(1);return this.RGB_HTML(e)}static RGB_CMYK([t,e,i]){let s=1-t,n=1-e,a=1-i,o=Math.min(s,n,a);return["CMYK",s,n,a,o]}},Mn=class{create(t,e,i=!1){if(t<=0||e<=0)throw new Error("Invalid SVG dimensions");let s=this._createSVG("svg:svg");return s.setAttribute("version","1.1"),i||(s.setAttribute("width",`${t}px`),s.setAttribute("height",`${e}px`)),s.setAttribute("preserveAspectRatio","none"),s.setAttribute("viewBox",`0 0 ${t} ${e}`),s}createElement(t){if(typeof t!="string")throw new Error("Invalid SVG element type");return this._createSVG(t)}_createSVG(t){G("Abstract method `_createSVG` called.")}},Ge=class extends Mn{_createSVG(t){return document.createElementNS(Vt,t)}},ki=class{static setupStorage(t,e,i,s,n){let a=s.getValue(e,{value:null});switch(i.name){case"textarea":if(a.value!==null&&(t.textContent=a.value),n==="print")break;t.addEventListener("input",o=>{s.setValue(e,{value:o.target.value})});break;case"input":if(i.attributes.type==="radio"||i.attributes.type==="checkbox"){if(a.value===i.attributes.xfaOn?t.setAttribute("checked",!0):a.value===i.attributes.xfaOff&&t.removeAttribute("checked"),n==="print")break;t.addEventListener("change",o=>{s.setValue(e,{value:o.target.checked?o.target.getAttribute("xfaOn"):o.target.getAttribute("xfaOff")})})}else{if(a.value!==null&&t.setAttribute("value",a.value),n==="print")break;t.addEventListener("input",o=>{s.setValue(e,{value:o.target.value})})}break;case"select":if(a.value!==null){t.setAttribute("value",a.value);for(let o of i.children)o.attributes.value===a.value?o.attributes.selected=!0:o.attributes.hasOwnProperty("selected")&&delete o.attributes.selected}t.addEventListener("input",o=>{let l=o.target.options,c=l.selectedIndex===-1?"":l[l.selectedIndex].value;s.setValue(e,{value:c})});break}}static setAttributes({html:t,element:e,storage:i=null,intent:s,linkService:n}){let{attributes:a}=e,o=t instanceof HTMLAnchorElement;a.type==="radio"&&(a.name=`${a.name}-${s}`);for(let[l,c]of Object.entries(a))if(c!=null)switch(l){case"class":c.length&&t.setAttribute(l,c.join(" "));break;case"dataId":break;case"id":t.setAttribute("data-element-id",c);break;case"style":Object.assign(t.style,c);break;case"textContent":t.textContent=c;break;default:(!o||l!=="href"&&l!=="newWindow")&&t.setAttribute(l,c)}o&&n.addLinkAttributes(t,a.href,a.newWindow),i&&a.dataId&&this.setupStorage(t,a.dataId,e,i)}static render(t){let e=t.annotationStorage,i=t.linkService,s=t.xfaHtml,n=t.intent||"display",a=document.createElement(s.name);s.attributes&&this.setAttributes({html:a,element:s,intent:n,linkService:i});let o=n!=="richText",l=t.div;if(l.append(a),t.viewport){let d=`matrix(${t.viewport.transform.join(",")})`;l.style.transform=d}o&&l.setAttribute("class","xfaLayer xfaFont");let c=[];if(s.children.length===0){if(s.value){let d=document.createTextNode(s.value);a.append(d),o&&He.shouldBuildText(s.name)&&c.push(d)}return{textDivs:c}}let h=[[s,-1,a]];for(;h.length>0;){let[d,u,f]=h.at(-1);if(u+1===d.children.length){h.pop();continue}let p=d.children[++h.at(-1)[1]];if(p===null)continue;let{name:g}=p;if(g==="#text"){let m=document.createTextNode(p.value);c.push(m),f.append(m);continue}let b=p?.attributes?.xmlns?document.createElementNS(p.attributes.xmlns,g):document.createElement(g);if(f.append(b),p.attributes&&this.setAttributes({html:b,element:p,storage:e,intent:n,linkService:i}),p.children?.length>0)h.push([p,-1,b]);else if(p.value){let m=document.createTextNode(p.value);o&&He.shouldBuildText(g)&&c.push(m),b.append(m)}}for(let d of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))d.setAttribute("readOnly",!0);return{textDivs:c}}static update(t){let e=`matrix(${t.viewport.transform.join(",")})`;t.div.style.transform=e,t.div.hidden=!1}},We=1e3,rl=9,ae=new WeakSet;function zt(r){return{width:r[2]-r[0],height:r[3]-r[1]}}var In=class{static create(t){switch(t.data.annotationType){case et.LINK:return new Di(t);case et.TEXT:return new Rn(t);case et.WIDGET:switch(t.data.fieldType){case"Tx":return new Pn(t);case"Btn":return t.data.radioButton?new Oi(t):t.data.checkBox?new Dn(t):new On(t);case"Ch":return new Fn(t);case"Sig":return new kn(t)}return new Bt(t);case et.POPUP:return new je(t);case et.FREETEXT:return new Fi(t);case et.LINE:return new Nn(t);case et.SQUARE:return new Vn(t);case et.CIRCLE:return new Bn(t);case et.POLYLINE:return new Li(t);case et.CARET:return new Gn(t);case et.INK:return new Ue(t);case et.POLYGON:return new Hn(t);case et.HIGHLIGHT:return new Ni(t);case et.UNDERLINE:return new jn(t);case et.SQUIGGLY:return new Un(t);case et.STRIKEOUT:return new $n(t);case et.STAMP:return new Vi(t);case et.FILEATTACHMENT:return new zn(t);default:return new Y(t)}}},Y=class r{#t=null;#e=!1;#i=null;constructor(t,{isRenderable:e=!1,ignoreBorder:i=!1,createQuadrilaterals:s=!1}={}){this.isRenderable=e,this.data=t.data,this.layer=t.layer,this.linkService=t.linkService,this.downloadManager=t.downloadManager,this.imageResourcesPath=t.imageResourcesPath,this.renderForms=t.renderForms,this.svgFactory=t.svgFactory,this.annotationStorage=t.annotationStorage,this.enableScripting=t.enableScripting,this.hasJSActions=t.hasJSActions,this._fieldObjects=t.fieldObjects,this.parent=t.parent,e&&(this.container=this._createContainer(i)),s&&this._createQuadrilaterals()}static _hasPopupData({titleObj:t,contentsObj:e,richText:i}){return!!(t?.str||e?.str||i?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return r._hasPopupData(this.data)}updateEdited(t){if(!this.container)return;this.#t||={rect:this.data.rect.slice(0)};let{rect:e}=t;e&&this.#s(e),this.#i?.popup.updateEdited(t)}resetEdited(){this.#t&&(this.#s(this.#t.rect),this.#i?.popup.resetEdited(),this.#t=null)}#s(t){let{container:{style:e},data:{rect:i,rotation:s},parent:{viewport:{rawDims:{pageWidth:n,pageHeight:a,pageX:o,pageY:l}}}}=this;i?.splice(0,4,...t);let{width:c,height:h}=zt(t);e.left=`${100*(t[0]-o)/n}%`,e.top=`${100*(a-t[3]+l)/a}%`,s===0?(e.width=`${100*c/n}%`,e.height=`${100*h/a}%`):this.setRotation(s)}_createContainer(t){let{data:e,parent:{page:i,viewport:s}}=this,n=document.createElement("section");n.setAttribute("data-annotation-id",e.id),this instanceof Bt||(n.tabIndex=We);let{style:a}=n;if(a.zIndex=this.parent.zIndex++,e.alternativeText&&(n.title=e.alternativeText),e.noRotate&&n.classList.add("norotate"),!e.rect||this instanceof je){let{rotation:g}=e;return!e.hasOwnCanvas&&g!==0&&this.setRotation(g,n),n}let{width:o,height:l}=zt(e.rect);if(!t&&e.borderStyle.width>0){a.borderWidth=`${e.borderStyle.width}px`;let g=e.borderStyle.horizontalCornerRadius,b=e.borderStyle.verticalCornerRadius;if(g>0||b>0){let _=`calc(${g}px * var(--scale-factor)) / calc(${b}px * var(--scale-factor))`;a.borderRadius=_}else if(this instanceof Oi){let _=`calc(${o}px * var(--scale-factor)) / calc(${l}px * var(--scale-factor))`;a.borderRadius=_}switch(e.borderStyle.style){case Se.SOLID:a.borderStyle="solid";break;case Se.DASHED:a.borderStyle="dashed";break;case Se.BEVELED:D("Unimplemented border style: beveled");break;case Se.INSET:D("Unimplemented border style: inset");break;case Se.UNDERLINE:a.borderBottomStyle="solid";break;default:break}let m=e.borderColor||null;m?(this.#e=!0,a.borderColor=T.makeHexColor(m[0]|0,m[1]|0,m[2]|0)):a.borderWidth=0}let c=T.normalizeRect([e.rect[0],i.view[3]-e.rect[1]+i.view[1],e.rect[2],i.view[3]-e.rect[3]+i.view[1]]),{pageWidth:h,pageHeight:d,pageX:u,pageY:f}=s.rawDims;a.left=`${100*(c[0]-u)/h}%`,a.top=`${100*(c[1]-f)/d}%`;let{rotation:p}=e;return e.hasOwnCanvas||p===0?(a.width=`${100*o/h}%`,a.height=`${100*l/d}%`):this.setRotation(p,n),n}setRotation(t,e=this.container){if(!this.data.rect)return;let{pageWidth:i,pageHeight:s}=this.parent.viewport.rawDims,{width:n,height:a}=zt(this.data.rect),o,l;t%180===0?(o=100*n/i,l=100*a/s):(o=100*a/i,l=100*n/s),e.style.width=`${o}%`,e.style.height=`${l}%`,e.setAttribute("data-main-rotation",(360-t)%360)}get _commonActions(){let t=(e,i,s)=>{let n=s.detail[e],a=n[0],o=n.slice(1);s.target.style[i]=Pi[`${a}_HTML`](o),this.annotationStorage.setValue(this.data.id,{[i]:Pi[`${a}_rgb`](o)})};return O(this,"_commonActions",{display:e=>{let{display:i}=e.detail,s=i%2===1;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:s,noPrint:i===1||i===2})},print:e=>{this.annotationStorage.setValue(this.data.id,{noPrint:!e.detail.print})},hidden:e=>{let{hidden:i}=e.detail;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:i,noView:i})},focus:e=>{setTimeout(()=>e.target.focus({preventScroll:!1}),0)},userName:e=>{e.target.title=e.detail.userName},readonly:e=>{e.target.disabled=e.detail.readonly},required:e=>{this._setRequired(e.target,e.detail.required)},bgColor:e=>{t("bgColor","backgroundColor",e)},fillColor:e=>{t("fillColor","backgroundColor",e)},fgColor:e=>{t("fgColor","color",e)},textColor:e=>{t("textColor","color",e)},borderColor:e=>{t("borderColor","borderColor",e)},strokeColor:e=>{t("strokeColor","borderColor",e)},rotation:e=>{let i=e.detail.rotation;this.setRotation(i),this.annotationStorage.setValue(this.data.id,{rotation:i})}})}_dispatchEventFromSandbox(t,e){let i=this._commonActions;for(let s of Object.keys(e.detail))(t[s]||i[s])?.(e)}_setDefaultPropertiesFromJS(t){if(!this.enableScripting)return;let e=this.annotationStorage.getRawValue(this.data.id);if(!e)return;let i=this._commonActions;for(let[s,n]of Object.entries(e)){let a=i[s];if(a){let o={detail:{[s]:n},target:t};a(o),delete e[s]}}}_createQuadrilaterals(){if(!this.container)return;let{quadPoints:t}=this.data;if(!t)return;let[e,i,s,n]=this.data.rect.map(g=>Math.fround(g));if(t.length===8){let[g,b,m,_]=t.subarray(2,6);if(s===g&&n===b&&e===m&&i===_)return}let{style:a}=this.container,o;if(this.#e){let{borderColor:g,borderWidth:b}=a;a.borderWidth=0,o=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${g}" stroke-width="${b}">`],this.container.classList.add("hasBorder")}let l=s-e,c=n-i,{svgFactory:h}=this,d=h.createElement("svg");d.classList.add("quadrilateralsContainer"),d.setAttribute("width",0),d.setAttribute("height",0);let u=h.createElement("defs");d.append(u);let f=h.createElement("clipPath"),p=`clippath_${this.data.id}`;f.setAttribute("id",p),f.setAttribute("clipPathUnits","objectBoundingBox"),u.append(f);for(let g=2,b=t.length;g<b;g+=8){let m=t[g],_=t[g+1],y=t[g+2],v=t[g+3],A=h.createElement("rect"),E=(y-e)/l,C=(n-_)/c,I=(m-y)/l,R=(_-v)/c;A.setAttribute("x",E),A.setAttribute("y",C),A.setAttribute("width",I),A.setAttribute("height",R),f.append(A),o?.push(`<rect vector-effect="non-scaling-stroke" x="${E}" y="${C}" width="${I}" height="${R}"/>`)}this.#e&&(o.push("</g></svg>')"),a.backgroundImage=o.join("")),this.container.append(d),this.container.style.clipPath=`url(#${p})`}_createPopup(){let{data:t}=this,e=this.#i=new je({data:{color:t.color,titleObj:t.titleObj,modificationDate:t.modificationDate,contentsObj:t.contentsObj,richText:t.richText,parentRect:t.rect,borderStyle:0,id:`popup_${t.id}`,rotation:t.rotation},parent:this.parent,elements:[this]});this.parent.div.append(e.render())}render(){G("Abstract method `AnnotationElement.render` called")}_getElementsByName(t,e=null){let i=[];if(this._fieldObjects){let s=this._fieldObjects[t];if(s)for(let{page:n,id:a,exportValues:o}of s){if(n===-1||a===e)continue;let l=typeof o=="string"?o:null,c=document.querySelector(`[data-element-id="${a}"]`);if(c&&!ae.has(c)){D(`_getElementsByName - element not allowed: ${a}`);continue}i.push({id:a,exportValue:l,domElement:c})}return i}for(let s of document.getElementsByName(t)){let{exportValue:n}=s,a=s.getAttribute("data-element-id");a!==e&&ae.has(s)&&i.push({id:a,exportValue:n,domElement:s})}return i}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){let t=this.getElementsToTriggerPopup();if(Array.isArray(t))for(let e of t)e.classList.add("highlightArea");else t.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;let{annotationEditorType:t,data:{id:e}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:t,editId:e})})}},Di=class extends Y{constructor(t,e=null){super(t,{isRenderable:!0,ignoreBorder:!!e?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=t.data.isTooltipOnly}render(){let{data:t,linkService:e}=this,i=document.createElement("a");i.setAttribute("data-element-id",t.id);let s=!1;return t.url?(e.addLinkAttributes(i,t.url,t.newWindow),s=!0):t.action?(this._bindNamedAction(i,t.action),s=!0):t.attachment?(this.#e(i,t.attachment,t.attachmentDest),s=!0):t.setOCGState?(this.#i(i,t.setOCGState),s=!0):t.dest?(this._bindLink(i,t.dest),s=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(i,t),s=!0),t.resetForm?(this._bindResetFormAction(i,t.resetForm),s=!0):this.isTooltipOnly&&!s&&(this._bindLink(i,""),s=!0)),this.container.classList.add("linkAnnotation"),s&&this.container.append(i),this.container}#t(){this.container.setAttribute("data-internal-link","")}_bindLink(t,e){t.href=this.linkService.getDestinationHash(e),t.onclick=()=>(e&&this.linkService.goToDestination(e),!1),(e||e==="")&&this.#t()}_bindNamedAction(t,e){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(e),!1),this.#t()}#e(t,e,i=null){t.href=this.linkService.getAnchorUrl(""),e.description&&(t.title=e.description),t.onclick=()=>(this.downloadManager?.openOrDownloadData(e.content,e.filename,i),!1),this.#t()}#i(t,e){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(e),!1),this.#t()}_bindJSAction(t,e){t.href=this.linkService.getAnchorUrl("");let i=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(let s of Object.keys(e.actions)){let n=i.get(s);n&&(t[n]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e.id,name:s}}),!1))}t.onclick||(t.onclick=()=>!1),this.#t()}_bindResetFormAction(t,e){let i=t.onclick;if(i||(t.href=this.linkService.getAnchorUrl("")),this.#t(),!this._fieldObjects){D('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),i||(t.onclick=()=>!1);return}t.onclick=()=>{i?.();let{fields:s,refs:n,include:a}=e,o=[];if(s.length!==0||n.length!==0){let h=new Set(n);for(let d of s){let u=this._fieldObjects[d]||[];for(let{id:f}of u)h.add(f)}for(let d of Object.values(this._fieldObjects))for(let u of d)h.has(u.id)===a&&o.push(u)}else for(let h of Object.values(this._fieldObjects))o.push(...h);let l=this.annotationStorage,c=[];for(let h of o){let{id:d}=h;switch(c.push(d),h.type){case"text":{let f=h.defaultValue||"";l.setValue(d,{value:f});break}case"checkbox":case"radiobutton":{let f=h.defaultValue===h.exportValues;l.setValue(d,{value:f});break}case"combobox":case"listbox":{let f=h.defaultValue||"";l.setValue(d,{value:f});break}default:continue}let u=document.querySelector(`[data-element-id="${d}"]`);if(u){if(!ae.has(u)){D(`_bindResetFormAction - element not allowed: ${d}`);continue}}else continue;u.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:c,name:"ResetForm"}}),!1}}},Rn=class extends Y{constructor(t){super(t,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");let t=document.createElement("img");return t.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",t.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),t.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(t),this.container}},Bt=class extends Y{render(){return this.container}showElementAndHideCanvas(t){this.data.hasOwnCanvas&&(t.previousSibling?.nodeName==="CANVAS"&&(t.previousSibling.hidden=!0),t.hidden=!1)}_getKeyModifier(t){return rt.platform.isMac?t.metaKey:t.ctrlKey}_setEventListener(t,e,i,s,n){i.includes("mouse")?t.addEventListener(i,a=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:n(a),shift:a.shiftKey,modifier:this._getKeyModifier(a)}})}):t.addEventListener(i,a=>{if(i==="blur"){if(!e.focused||!a.relatedTarget)return;e.focused=!1}else if(i==="focus"){if(e.focused)return;e.focused=!0}n&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:n(a)}})})}_setEventListeners(t,e,i,s){for(let[n,a]of i)(a==="Action"||this.data.actions?.[a])&&((a==="Focus"||a==="Blur")&&(e||={focused:!1}),this._setEventListener(t,e,n,a,s),a==="Focus"&&!this.data.actions?.Blur?this._setEventListener(t,e,"blur","Blur",null):a==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(t,e,"focus","Focus",null))}_setBackgroundColor(t){let e=this.data.backgroundColor||null;t.style.backgroundColor=e===null?"transparent":T.makeHexColor(e[0],e[1],e[2])}_setTextStyle(t){let e=["left","center","right"],{fontColor:i}=this.data.defaultAppearanceData,s=this.data.defaultAppearanceData.fontSize||rl,n=t.style,a,o=2,l=c=>Math.round(10*c)/10;if(this.data.multiLine){let c=Math.abs(this.data.rect[3]-this.data.rect[1]-o),h=Math.round(c/(ui*s))||1,d=c/h;a=Math.min(s,l(d/ui))}else{let c=Math.abs(this.data.rect[3]-this.data.rect[1]-o);a=Math.min(s,l(c/ui))}n.fontSize=`calc(${a}px * var(--scale-factor))`,n.color=T.makeHexColor(i[0],i[1],i[2]),this.data.textAlignment!==null&&(n.textAlign=e[this.data.textAlignment])}_setRequired(t,e){e?t.setAttribute("required",!0):t.removeAttribute("required"),t.setAttribute("aria-required",e)}},Pn=class extends Bt{constructor(t){let e=t.renderForms||t.data.hasOwnCanvas||!t.data.hasAppearance&&!!t.data.fieldValue;super(t,{isRenderable:e})}setPropertyOnSiblings(t,e,i,s){let n=this.annotationStorage;for(let a of this._getElementsByName(t.name,t.id))a.domElement&&(a.domElement[e]=i),n.setValue(a.id,{[s]:i})}render(){let t=this.annotationStorage,e=this.data.id;this.container.classList.add("textWidgetAnnotation");let i=null;if(this.renderForms){let s=t.getValue(e,{value:this.data.fieldValue}),n=s.value||"",a=t.getValue(e,{charLimit:this.data.maxLen}).charLimit;a&&n.length>a&&(n=n.slice(0,a));let o=s.formattedValue||this.data.textContent?.join(`
`)||null;o&&this.data.comb&&(o=o.replaceAll(/\s+/g,""));let l={userValue:n,formattedValue:o,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(i=document.createElement("textarea"),i.textContent=o??n,this.data.doNotScroll&&(i.style.overflowY="hidden")):(i=document.createElement("input"),i.type="text",i.setAttribute("value",o??n),this.data.doNotScroll&&(i.style.overflowX="hidden")),this.data.hasOwnCanvas&&(i.hidden=!0),ae.add(i),i.setAttribute("data-element-id",e),i.disabled=this.data.readOnly,i.name=this.data.fieldName,i.tabIndex=We,this._setRequired(i,this.data.required),a&&(i.maxLength=a),i.addEventListener("input",h=>{t.setValue(e,{value:h.target.value}),this.setPropertyOnSiblings(i,"value",h.target.value,"value"),l.formattedValue=null}),i.addEventListener("resetform",h=>{let d=this.data.defaultFieldValue??"";i.value=l.userValue=d,l.formattedValue=null});let c=h=>{let{formattedValue:d}=l;d!=null&&(h.target.value=d),h.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){i.addEventListener("focus",d=>{if(l.focused)return;let{target:u}=d;l.userValue&&(u.value=l.userValue),l.lastCommittedValue=u.value,l.commitKey=1,this.data.actions?.Focus||(l.focused=!0)}),i.addEventListener("updatefromsandbox",d=>{this.showElementAndHideCanvas(d.target);let u={value(f){l.userValue=f.detail.value??"",t.setValue(e,{value:l.userValue.toString()}),f.target.value=l.userValue},formattedValue(f){let{formattedValue:p}=f.detail;l.formattedValue=p,p!=null&&f.target!==document.activeElement&&(f.target.value=p),t.setValue(e,{formattedValue:p})},selRange(f){f.target.setSelectionRange(...f.detail.selRange)},charLimit:f=>{let{charLimit:p}=f.detail,{target:g}=f;if(p===0){g.removeAttribute("maxLength");return}g.setAttribute("maxLength",p);let b=l.userValue;!b||b.length<=p||(b=b.slice(0,p),g.value=l.userValue=b,t.setValue(e,{value:b}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:b,willCommit:!0,commitKey:1,selStart:g.selectionStart,selEnd:g.selectionEnd}}))}};this._dispatchEventFromSandbox(u,d)}),i.addEventListener("keydown",d=>{l.commitKey=1;let u=-1;if(d.key==="Escape"?u=0:d.key==="Enter"&&!this.data.multiLine?u=2:d.key==="Tab"&&(l.commitKey=3),u===-1)return;let{value:f}=d.target;l.lastCommittedValue!==f&&(l.lastCommittedValue=f,l.userValue=f,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:f,willCommit:!0,commitKey:u,selStart:d.target.selectionStart,selEnd:d.target.selectionEnd}}))});let h=c;c=null,i.addEventListener("blur",d=>{if(!l.focused||!d.relatedTarget)return;this.data.actions?.Blur||(l.focused=!1);let{value:u}=d.target;l.userValue=u,l.lastCommittedValue!==u&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:u,willCommit:!0,commitKey:l.commitKey,selStart:d.target.selectionStart,selEnd:d.target.selectionEnd}}),h(d)}),this.data.actions?.Keystroke&&i.addEventListener("beforeinput",d=>{l.lastCommittedValue=null;let{data:u,target:f}=d,{value:p,selectionStart:g,selectionEnd:b}=f,m=g,_=b;switch(d.inputType){case"deleteWordBackward":{let y=p.substring(0,g).match(/\w*[^\w]*$/);y&&(m-=y[0].length);break}case"deleteWordForward":{let y=p.substring(g).match(/^[^\w]*\w*/);y&&(_+=y[0].length);break}case"deleteContentBackward":g===b&&(m-=1);break;case"deleteContentForward":g===b&&(_+=1);break}d.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:p,change:u||"",willCommit:!1,selStart:m,selEnd:_}})}),this._setEventListeners(i,l,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],d=>d.target.value)}if(c&&i.addEventListener("blur",c),this.data.comb){let d=(this.data.rect[2]-this.data.rect[0])/a;i.classList.add("comb"),i.style.letterSpacing=`calc(${d}px * var(--scale-factor) - 1ch)`}}else i=document.createElement("div"),i.textContent=this.data.fieldValue,i.style.verticalAlign="middle",i.style.display="table-cell",this.data.hasOwnCanvas&&(i.hidden=!0);return this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}},kn=class extends Bt{constructor(t){super(t,{isRenderable:!!t.data.hasOwnCanvas})}},Dn=class extends Bt{constructor(t){super(t,{isRenderable:t.renderForms})}render(){let t=this.annotationStorage,e=this.data,i=e.id,s=t.getValue(i,{value:e.exportValue===e.fieldValue}).value;typeof s=="string"&&(s=s!=="Off",t.setValue(i,{value:s})),this.container.classList.add("buttonWidgetAnnotation","checkBox");let n=document.createElement("input");return ae.add(n),n.setAttribute("data-element-id",i),n.disabled=e.readOnly,this._setRequired(n,this.data.required),n.type="checkbox",n.name=e.fieldName,s&&n.setAttribute("checked",!0),n.setAttribute("exportValue",e.exportValue),n.tabIndex=We,n.addEventListener("change",a=>{let{name:o,checked:l}=a.target;for(let c of this._getElementsByName(o,i)){let h=l&&c.exportValue===e.exportValue;c.domElement&&(c.domElement.checked=h),t.setValue(c.id,{value:h})}t.setValue(i,{value:l})}),n.addEventListener("resetform",a=>{let o=e.defaultFieldValue||"Off";a.target.checked=o===e.exportValue}),this.enableScripting&&this.hasJSActions&&(n.addEventListener("updatefromsandbox",a=>{let o={value(l){l.target.checked=l.detail.value!=="Off",t.setValue(i,{value:l.target.checked})}};this._dispatchEventFromSandbox(o,a)}),this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}},Oi=class extends Bt{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");let t=this.annotationStorage,e=this.data,i=e.id,s=t.getValue(i,{value:e.fieldValue===e.buttonValue}).value;if(typeof s=="string"&&(s=s!==e.buttonValue,t.setValue(i,{value:s})),s)for(let a of this._getElementsByName(e.fieldName,i))t.setValue(a.id,{value:!1});let n=document.createElement("input");if(ae.add(n),n.setAttribute("data-element-id",i),n.disabled=e.readOnly,this._setRequired(n,this.data.required),n.type="radio",n.name=e.fieldName,s&&n.setAttribute("checked",!0),n.tabIndex=We,n.addEventListener("change",a=>{let{name:o,checked:l}=a.target;for(let c of this._getElementsByName(o,i))t.setValue(c.id,{value:!1});t.setValue(i,{value:l})}),n.addEventListener("resetform",a=>{let o=e.defaultFieldValue;a.target.checked=o!=null&&o===e.buttonValue}),this.enableScripting&&this.hasJSActions){let a=e.buttonValue;n.addEventListener("updatefromsandbox",o=>{let l={value:c=>{let h=a===c.detail.value;for(let d of this._getElementsByName(c.target.name)){let u=h&&d.id===i;d.domElement&&(d.domElement.checked=u),t.setValue(d.id,{value:u})}}};this._dispatchEventFromSandbox(l,o)}),this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)}return this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}},On=class extends Di{constructor(t){super(t,{ignoreBorder:t.data.hasAppearance})}render(){let t=super.render();t.classList.add("buttonWidgetAnnotation","pushButton");let e=t.lastChild;return this.enableScripting&&this.hasJSActions&&e&&(this._setDefaultPropertiesFromJS(e),e.addEventListener("updatefromsandbox",i=>{this._dispatchEventFromSandbox({},i)})),t}},Fn=class extends Bt{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");let t=this.annotationStorage,e=this.data.id,i=t.getValue(e,{value:this.data.fieldValue}),s=document.createElement("select");ae.add(s),s.setAttribute("data-element-id",e),s.disabled=this.data.readOnly,this._setRequired(s,this.data.required),s.name=this.data.fieldName,s.tabIndex=We;let n=this.data.combo&&this.data.options.length>0;this.data.combo||(s.size=this.data.options.length,this.data.multiSelect&&(s.multiple=!0)),s.addEventListener("resetform",h=>{let d=this.data.defaultFieldValue;for(let u of s.options)u.selected=u.value===d});for(let h of this.data.options){let d=document.createElement("option");d.textContent=h.displayValue,d.value=h.exportValue,i.value.includes(h.exportValue)&&(d.setAttribute("selected",!0),n=!1),s.append(d)}let a=null;if(n){let h=document.createElement("option");h.value=" ",h.setAttribute("hidden",!0),h.setAttribute("selected",!0),s.prepend(h),a=()=>{h.remove(),s.removeEventListener("input",a),a=null},s.addEventListener("input",a)}let o=h=>{let d=h?"value":"textContent",{options:u,multiple:f}=s;return f?Array.prototype.filter.call(u,p=>p.selected).map(p=>p[d]):u.selectedIndex===-1?null:u[u.selectedIndex][d]},l=o(!1),c=h=>{let d=h.target.options;return Array.prototype.map.call(d,u=>({displayValue:u.textContent,exportValue:u.value}))};return this.enableScripting&&this.hasJSActions?(s.addEventListener("updatefromsandbox",h=>{let d={value(u){a?.();let f=u.detail.value,p=new Set(Array.isArray(f)?f:[f]);for(let g of s.options)g.selected=p.has(g.value);t.setValue(e,{value:o(!0)}),l=o(!1)},multipleSelection(u){s.multiple=!0},remove(u){let f=s.options,p=u.detail.remove;f[p].selected=!1,s.remove(p),f.length>0&&Array.prototype.findIndex.call(f,b=>b.selected)===-1&&(f[0].selected=!0),t.setValue(e,{value:o(!0),items:c(u)}),l=o(!1)},clear(u){for(;s.length!==0;)s.remove(0);t.setValue(e,{value:null,items:[]}),l=o(!1)},insert(u){let{index:f,displayValue:p,exportValue:g}=u.detail.insert,b=s.children[f],m=document.createElement("option");m.textContent=p,m.value=g,b?b.before(m):s.append(m),t.setValue(e,{value:o(!0),items:c(u)}),l=o(!1)},items(u){let{items:f}=u.detail;for(;s.length!==0;)s.remove(0);for(let p of f){let{displayValue:g,exportValue:b}=p,m=document.createElement("option");m.textContent=g,m.value=b,s.append(m)}s.options.length>0&&(s.options[0].selected=!0),t.setValue(e,{value:o(!0),items:c(u)}),l=o(!1)},indices(u){let f=new Set(u.detail.indices);for(let p of u.target.options)p.selected=f.has(p.index);t.setValue(e,{value:o(!0)}),l=o(!1)},editable(u){u.target.disabled=!u.detail.editable}};this._dispatchEventFromSandbox(d,h)}),s.addEventListener("input",h=>{let d=o(!0),u=o(!1);t.setValue(e,{value:d}),h.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:l,change:u,changeEx:d,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(s,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],h=>h.target.value)):s.addEventListener("input",function(h){t.setValue(e,{value:o(!0)})}),this.data.combo&&this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}},je=class extends Y{constructor(t){let{data:e,elements:i}=t;super(t,{isRenderable:Y._hasPopupData(e)}),this.elements=i,this.popup=null}render(){this.container.classList.add("popupAnnotation");let t=this.popup=new Ln({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),e=[];for(let i of this.elements)i.popup=t,i.container.ariaHasPopup="dialog",e.push(i.data.id),i.addHighlightArea();return this.container.setAttribute("aria-controls",e.map(i=>`${sr}${i}`).join(",")),this.container}},Ln=class{#t=this.#T.bind(this);#e=this.#x.bind(this);#i=this.#M.bind(this);#s=this.#w.bind(this);#r=null;#n=null;#l=null;#o=null;#h=null;#c=null;#u=null;#d=!1;#f=null;#a=null;#p=null;#m=null;#g=null;#b=null;#v=!1;constructor({container:t,color:e,elements:i,titleObj:s,modificationDate:n,contentsObj:a,richText:o,parent:l,rect:c,parentRect:h,open:d}){this.#n=t,this.#g=s,this.#l=a,this.#m=o,this.#c=l,this.#r=e,this.#p=c,this.#u=h,this.#h=i,this.#o=mi.toDateObject(n),this.trigger=i.flatMap(u=>u.getElementsToTriggerPopup());for(let u of this.trigger)u.addEventListener("click",this.#s),u.addEventListener("mouseenter",this.#i),u.addEventListener("mouseleave",this.#e),u.classList.add("popupTriggerArea");for(let u of i)u.container?.addEventListener("keydown",this.#t);this.#n.hidden=!0,d&&this.#w()}render(){if(this.#f)return;let t=this.#f=document.createElement("div");if(t.className="popup",this.#r){let n=t.style.outlineColor=T.makeHexColor(...this.#r);CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?t.style.backgroundColor=`color-mix(in srgb, ${n} 30%, white)`:t.style.backgroundColor=T.makeHexColor(...this.#r.map(o=>Math.floor(.7*(255-o)+o)))}let e=document.createElement("span");e.className="header";let i=document.createElement("h1");if(e.append(i),{dir:i.dir,str:i.textContent}=this.#g,t.append(e),this.#o){let n=document.createElement("span");n.classList.add("popupDate"),n.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),n.setAttribute("data-l10n-args",JSON.stringify({dateObj:this.#o.valueOf()})),e.append(n)}let s=this.#_;if(s)ki.render({xfaHtml:s,intent:"richText",div:t}),t.lastChild.classList.add("richText","popupContent");else{let n=this._formatContents(this.#l);t.append(n)}this.#n.append(t)}get#_(){let t=this.#m,e=this.#l;return t?.str&&(!e?.str||e.str===t.str)&&this.#m.html||null}get#A(){return this.#_?.attributes?.style?.fontSize||0}get#C(){return this.#_?.attributes?.style?.color||null}#S(t){let e=[],i={str:t,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:e}]}},s={style:{color:this.#C,fontSize:this.#A?`calc(${this.#A}px * var(--scale-factor))`:""}};for(let n of t.split(`
`))e.push({name:"span",value:n,attributes:s});return i}_formatContents({str:t,dir:e}){let i=document.createElement("p");i.classList.add("popupContent"),i.dir=e;let s=t.split(/(?:\r\n?|\n)/);for(let n=0,a=s.length;n<a;++n){let o=s[n];i.append(document.createTextNode(o)),n<a-1&&i.append(document.createElement("br"))}return i}#T(t){t.altKey||t.shiftKey||t.ctrlKey||t.metaKey||(t.key==="Enter"||t.key==="Escape"&&this.#d)&&this.#w()}updateEdited({rect:t,popupContent:e}){this.#b||={contentsObj:this.#l,richText:this.#m},t&&(this.#a=null),e&&(this.#m=this.#S(e),this.#l=null),this.#f?.remove(),this.#f=null}resetEdited(){this.#b&&({contentsObj:this.#l,richText:this.#m}=this.#b,this.#b=null,this.#f?.remove(),this.#f=null,this.#a=null)}#I(){if(this.#a!==null)return;let{page:{view:t},viewport:{rawDims:{pageWidth:e,pageHeight:i,pageX:s,pageY:n}}}=this.#c,a=!!this.#u,o=a?this.#u:this.#p;for(let p of this.#h)if(!o||T.intersect(p.data.rect,o)!==null){o=p.data.rect,a=!0;break}let l=T.normalizeRect([o[0],t[3]-o[1]+t[1],o[2],t[3]-o[3]+t[1]]),h=a?o[2]-o[0]+5:0,d=l[0]+h,u=l[1];this.#a=[100*(d-s)/e,100*(u-n)/i];let{style:f}=this.#n;f.left=`${this.#a[0]}%`,f.top=`${this.#a[1]}%`}#w(){this.#d=!this.#d,this.#d?(this.#M(),this.#n.addEventListener("click",this.#s),this.#n.addEventListener("keydown",this.#t)):(this.#x(),this.#n.removeEventListener("click",this.#s),this.#n.removeEventListener("keydown",this.#t))}#M(){this.#f||this.render(),this.isVisible?this.#d&&this.#n.classList.add("focused"):(this.#I(),this.#n.hidden=!1,this.#n.style.zIndex=parseInt(this.#n.style.zIndex)+1e3)}#x(){this.#n.classList.remove("focused"),!(this.#d||!this.isVisible)&&(this.#n.hidden=!0,this.#n.style.zIndex=parseInt(this.#n.style.zIndex)-1e3)}forceHide(){this.#v=this.isVisible,this.#v&&(this.#n.hidden=!0)}maybeShow(){this.#v&&(this.#f||this.#M(),this.#v=!1,this.#n.hidden=!1)}get isVisible(){return this.#n.hidden===!1}},Fi=class extends Y{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.textContent=t.data.textContent,this.textPosition=t.data.textPosition,this.annotationEditorType=k.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){let t=document.createElement("div");t.classList.add("annotationTextContent"),t.setAttribute("role","comment");for(let e of this.textContent){let i=document.createElement("span");i.textContent=e,t.append(i)}this.container.append(t)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}},Nn=class extends Y{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");let t=this.data,{width:e,height:i}=zt(t.rect),s=this.svgFactory.create(e,i,!0),n=this.#t=this.svgFactory.createElement("svg:line");return n.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),n.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),n.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),n.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),n.setAttribute("stroke-width",t.borderStyle.width||1),n.setAttribute("stroke","transparent"),n.setAttribute("fill","transparent"),s.append(n),this.container.append(s),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}},Vn=class extends Y{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");let t=this.data,{width:e,height:i}=zt(t.rect),s=this.svgFactory.create(e,i,!0),n=t.borderStyle.width,a=this.#t=this.svgFactory.createElement("svg:rect");return a.setAttribute("x",n/2),a.setAttribute("y",n/2),a.setAttribute("width",e-n),a.setAttribute("height",i-n),a.setAttribute("stroke-width",n||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),s.append(a),this.container.append(s),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}},Bn=class extends Y{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");let t=this.data,{width:e,height:i}=zt(t.rect),s=this.svgFactory.create(e,i,!0),n=t.borderStyle.width,a=this.#t=this.svgFactory.createElement("svg:ellipse");return a.setAttribute("cx",e/2),a.setAttribute("cy",i/2),a.setAttribute("rx",e/2-n/2),a.setAttribute("ry",i/2-n/2),a.setAttribute("stroke-width",n||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),s.append(a),this.container.append(s),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}},Li=class extends Y{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);let{data:{rect:t,vertices:e,borderStyle:i,popupRef:s}}=this;if(!e)return this.container;let{width:n,height:a}=zt(t),o=this.svgFactory.create(n,a,!0),l=[];for(let h=0,d=e.length;h<d;h+=2){let u=e[h]-t[0],f=t[3]-e[h+1];l.push(`${u},${f}`)}l=l.join(" ");let c=this.#t=this.svgFactory.createElement(this.svgElementName);return c.setAttribute("points",l),c.setAttribute("stroke-width",i.width||1),c.setAttribute("stroke","transparent"),c.setAttribute("fill","transparent"),o.append(c),this.container.append(o),!s&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}},Hn=class extends Li{constructor(t){super(t),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}},Gn=class extends Y{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}},Ue=class extends Y{#t=null;#e=[];constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?k.HIGHLIGHT:k.INK}#i(t,e){switch(t){case 90:return{transform:`rotate(90) translate(${-e[0]},${e[1]}) scale(1,-1)`,width:e[3]-e[1],height:e[2]-e[0]};case 180:return{transform:`rotate(180) translate(${-e[2]},${e[1]}) scale(1,-1)`,width:e[2]-e[0],height:e[3]-e[1]};case 270:return{transform:`rotate(270) translate(${-e[2]},${e[3]}) scale(1,-1)`,width:e[3]-e[1],height:e[2]-e[0]};default:return{transform:`translate(${-e[0]},${e[3]}) scale(1,-1)`,width:e[2]-e[0],height:e[3]-e[1]}}}render(){this.container.classList.add(this.containerClassName);let{data:{rect:t,rotation:e,inkLists:i,borderStyle:s,popupRef:n}}=this,{transform:a,width:o,height:l}=this.#i(e,t),c=this.svgFactory.create(o,l,!0),h=this.#t=this.svgFactory.createElement("svg:g");c.append(h),h.setAttribute("stroke-width",s.width||1),h.setAttribute("stroke-linecap","round"),h.setAttribute("stroke-linejoin","round"),h.setAttribute("stroke-miterlimit",10),h.setAttribute("stroke","transparent"),h.setAttribute("fill","transparent"),h.setAttribute("transform",a);for(let d=0,u=i.length;d<u;d++){let f=this.svgFactory.createElement(this.svgElementName);this.#e.push(f),f.setAttribute("points",i[d].join(",")),h.append(f)}return!n&&this.hasPopupData&&this._createPopup(),this.container.append(c),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);let{thickness:e,points:i,rect:s}=t,n=this.#t;if(e>=0&&n.setAttribute("stroke-width",e||1),i)for(let a=0,o=this.#e.length;a<o;a++)this.#e[a].setAttribute("points",i[a].join(","));if(s){let{transform:a,width:o,height:l}=this.#i(this.data.rotation,s);n.parentElement.setAttribute("viewBox",`0 0 ${o} ${l}`),n.setAttribute("transform",a)}}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}},Ni=class extends Y{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=k.HIGHLIGHT}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),this.container}},jn=class extends Y{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}},Un=class extends Y{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}},$n=class extends Y{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}},Vi=class extends Y{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=k.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}},zn=class extends Y{#t=null;constructor(t){super(t,{isRenderable:!0});let{file:e}=this.data;this.filename=e.filename,this.content=e.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",X({source:this},e))}render(){this.container.classList.add("fileAttachmentAnnotation");let{container:t,data:e}=this,i;e.hasAppearance||e.fillAlpha===0?i=document.createElement("div"):(i=document.createElement("img"),i.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(e.name)?"paperclip":"pushpin"}.svg`,e.fillAlpha&&e.fillAlpha<1&&(i.style=`filter: opacity(${Math.round(e.fillAlpha*100)}%);`)),i.addEventListener("dblclick",this.#e.bind(this)),this.#t=i;let{isMac:s}=rt.platform;return t.addEventListener("keydown",n=>{n.key==="Enter"&&(s?n.metaKey:n.ctrlKey)&&this.#e()}),!e.popupRef&&this.hasPopupData?this._createPopup():i.classList.add("popupTriggerArea"),t.append(i),t}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}#e(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}},Wn=class{#t=null;#e=null;#i=new Map;#s=null;constructor({div:t,accessibilityManager:e,annotationCanvasMap:i,annotationEditorUIManager:s,page:n,viewport:a,structTreeLayer:o}){this.div=t,this.#t=e,this.#e=i,this.#s=o||null,this.page=n,this.viewport=a,this.zIndex=0,this._annotationEditorUIManager=s}hasEditableAnnotations(){return this.#i.size>0}#r(t,e){return w(this,null,function*(){let i=t.firstChild||t,s=i.id=`${sr}${e}`,n=yield this.#s?.getAriaAttributes(s);if(n)for(let[a,o]of n)i.setAttribute(a,o);this.div.append(t),this.#t?.moveElementInDOM(this.div,t,i,!1)})}render(t){return w(this,null,function*(){let{annotations:e}=t,i=this.div;ne(i,this.viewport);let s=new Map,n={data:null,layer:i,linkService:t.linkService,downloadManager:t.downloadManager,imageResourcesPath:t.imageResourcesPath||"",renderForms:t.renderForms!==!1,svgFactory:new Ge,annotationStorage:t.annotationStorage||new Ne,enableScripting:t.enableScripting===!0,hasJSActions:t.hasJSActions,fieldObjects:t.fieldObjects,parent:this,elements:null};for(let a of e){if(a.noHTML)continue;let o=a.annotationType===et.POPUP;if(o){let h=s.get(a.id);if(!h)continue;n.elements=h}else{let{width:h,height:d}=zt(a.rect);if(h<=0||d<=0)continue}n.data=a;let l=In.create(n);if(!l.isRenderable)continue;if(!o&&a.popupRef){let h=s.get(a.popupRef);h?h.push(l):s.set(a.popupRef,[l])}let c=l.render();a.hidden&&(c.style.visibility="hidden"),yield this.#r(c,a.id),l._isEditable&&(this.#i.set(l.data.id,l),this._annotationEditorUIManager?.renderAnnotationElement(l))}this.#n()})}update({viewport:t}){let e=this.div;this.viewport=t,ne(e,{rotation:t.rotation}),this.#n(),e.hidden=!1}#n(){if(!this.#e)return;let t=this.div;for(let[e,i]of this.#e){let s=t.querySelector(`[data-annotation-id="${e}"]`);if(!s)continue;i.className="annotationContent";let{firstChild:n}=s;n?n.nodeName==="CANVAS"?n.replaceWith(i):n.classList.contains("annotationContent")?n.after(i):n.before(i):s.append(i)}this.#e.clear()}getEditableAnnotations(){return Array.from(this.#i.values())}getEditableAnnotation(t){return this.#i.get(t)}},di=/\r\n?|\n/g,qn=class r extends W{#t;#e="";#i=`${this.id}-editor`;#s=null;#r;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){let t=r.prototype,e=n=>n.isEmpty(),i=Le.TRANSLATE_SMALL,s=Le.TRANSLATE_BIG;return O(this,"_keyboardManager",new re([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-i,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-s,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[i,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[s,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-i],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-s],checker:e}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,i],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,s],checker:e}]]))}static _type="freetext";static _editorType=k.FREETEXT;constructor(t){super(nt(X({},t),{name:"freeTextEditor"})),this.#t=t.color||r._defaultColor||W._defaultLineColor,this.#r=t.fontSize||r._defaultFontSize}static initialize(t,e){W.initialize(t,e);let i=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(i.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,e){switch(t){case N.FREETEXT_SIZE:r._defaultFontSize=e;break;case N.FREETEXT_COLOR:r._defaultColor=e;break}}updateParams(t,e){switch(t){case N.FREETEXT_SIZE:this.#n(e);break;case N.FREETEXT_COLOR:this.#l(e);break}}static get defaultPropertiesToUpdate(){return[[N.FREETEXT_SIZE,r._defaultFontSize],[N.FREETEXT_COLOR,r._defaultColor||W._defaultLineColor]]}get propertiesToUpdate(){return[[N.FREETEXT_SIZE,this.#r],[N.FREETEXT_COLOR,this.#t]]}#n(t){let e=s=>{this.editorDiv.style.fontSize=`calc(${s}px * var(--scale-factor))`,this.translate(0,-(s-this.#r)*this.parentScale),this.#r=s,this.#h()},i=this.#r;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:N.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}#l(t){let e=s=>{this.#t=this.editorDiv.style.color=s},i=this.#t;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:N.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(t,e){this._uiManager.translateSelectedEditors(t,e,!0)}getInitialTranslation(){let t=this.parentScale;return[-r._internalPadding*t,-(r._internalPadding+this.#r)*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(this.isInEditMode())return;this.parent.setEditingState(!1),this.parent.updateToolbar(k.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.#s=new AbortController;let t=this._uiManager.combinedSignal(this.#s);this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t})}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#i),this._isDraggable=!0,this.#s?.abort(),this.#s=null,this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#o(){let t=[];this.editorDiv.normalize();let e=null;for(let i of this.editorDiv.childNodes)e?.nodeType===Node.TEXT_NODE&&i.nodeName==="BR"||(t.push(r.#c(i)),e=i);return t.join(`
`)}#h(){let[t,e]=this.parentDimensions,i;if(this.isAttachedToDOM)i=this.div.getBoundingClientRect();else{let{currentLayer:s,div:n}=this,a=n.style.display,o=n.classList.contains("hidden");n.classList.remove("hidden"),n.style.display="hidden",s.div.append(this.div),i=n.getBoundingClientRect(),n.remove(),n.style.display=a,n.classList.toggle("hidden",o)}this.rotation%180===this.parentRotation%180?(this.width=i.width/t,this.height=i.height/e):(this.width=i.height/t,this.height=i.width/e),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();let t=this.#e,e=this.#e=this.#o().trimEnd();if(t===e)return;let i=s=>{if(this.#e=s,!s){this.remove();return}this.#u(),this._uiManager.rebuild(this),this.#h()};this.addCommands({cmd:()=>{i(e)},undo:()=>{i(t)},mustExec:!1}),this.#h()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(t){this.enterInEditMode()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){r._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let t,e;this.width&&(t=this.x,e=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#i),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;let{style:i}=this.editorDiv;if(i.fontSize=`calc(${this.#r}px * var(--scale-factor))`,i.color=this.#t,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),bi(this,this.div,["dblclick","keydown"]),this.width){let[s,n]=this.parentDimensions;if(this.annotationElementId){let{position:a}=this._initialData,[o,l]=this.getInitialTranslation();[o,l]=this.pageTranslationToScreen(o,l);let[c,h]=this.pageDimensions,[d,u]=this.pageTranslation,f,p;switch(this.rotation){case 0:f=t+(a[0]-d)/c,p=e+this.height-(a[1]-u)/h;break;case 90:f=t+(a[0]-d)/c,p=e-(a[1]-u)/h,[o,l]=[l,-o];break;case 180:f=t-this.width+(a[0]-d)/c,p=e-(a[1]-u)/h,[o,l]=[-o,-l];break;case 270:f=t+(a[0]-d-this.height*h)/c,p=e+(a[1]-u-this.width*c)/h,[o,l]=[-l,o];break}this.setAt(f*s,p*n,o,l)}else this.setAt(t*s,e*n,this.width*s,this.height*n);this.#u(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static#c(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(di,"")}editorDivPaste(t){let e=t.clipboardData||window.clipboardData,{types:i}=e;if(i.length===1&&i[0]==="text/plain")return;t.preventDefault();let s=r.#f(e.getData("text")||"").replaceAll(di,`
`);if(!s)return;let n=window.getSelection();if(!n.rangeCount)return;this.editorDiv.normalize(),n.deleteFromDocument();let a=n.getRangeAt(0);if(!s.includes(`
`)){a.insertNode(document.createTextNode(s)),this.editorDiv.normalize(),n.collapseToStart();return}let{startContainer:o,startOffset:l}=a,c=[],h=[];if(o.nodeType===Node.TEXT_NODE){let f=o.parentElement;if(h.push(o.nodeValue.slice(l).replaceAll(di,"")),f!==this.editorDiv){let p=c;for(let g of this.editorDiv.childNodes){if(g===f){p=h;continue}p.push(r.#c(g))}}c.push(o.nodeValue.slice(0,l).replaceAll(di,""))}else if(o===this.editorDiv){let f=c,p=0;for(let g of this.editorDiv.childNodes)p++===l&&(f=h),f.push(r.#c(g))}this.#e=`${c.join(`
`)}${s}${h.join(`
`)}`,this.#u();let d=new Range,u=c.reduce((f,p)=>f+p.length,0);for(let{firstChild:f}of this.editorDiv.childNodes)if(f.nodeType===Node.TEXT_NODE){let p=f.nodeValue.length;if(u<=p){d.setStart(f,u),d.setEnd(f,u);break}u-=p}n.removeAllRanges(),n.addRange(d)}#u(){if(this.editorDiv.replaceChildren(),!!this.#e)for(let t of this.#e.split(`
`)){let e=document.createElement("div");e.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(e)}}#d(){return this.#e.replaceAll("\xA0"," ")}static#f(t){return t.replaceAll(" ","\xA0")}get contentDiv(){return this.editorDiv}static deserialize(t,e,i){return w(this,null,function*(){let s=null;if(t instanceof Fi){let{data:{defaultAppearanceData:{fontSize:a,fontColor:o},rect:l,rotation:c,id:h,popupRef:d},textContent:u,textPosition:f,parent:{page:{pageNumber:p}}}=t;if(!u||u.length===0)return null;s=t={annotationType:k.FREETEXT,color:Array.from(o),fontSize:a,value:u.join(`
`),position:f,pageIndex:p-1,rect:l.slice(0),rotation:c,id:h,deleted:!1,popupRef:d}}let n=yield Zt(r,this,"deserialize").call(this,t,e,i);return n.#r=t.fontSize,n.#t=T.makeHexColor(...t.color),n.#e=r.#f(t.value),n.annotationElementId=t.id||null,n._initialData=s,n})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let e=r._internalPadding*this.parentScale,i=this.getRect(e,e),s=W._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.#t),n={annotationType:k.FREETEXT,color:s,fontSize:this.#r,value:this.#d(),pageIndex:this.pageIndex,rect:i,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?n:this.annotationElementId&&!this.#a(n)?null:(n.id=this.annotationElementId,n)}#a(t){let{value:e,fontSize:i,color:s,pageIndex:n}=this._initialData;return this._hasBeenMoved||t.value!==e||t.fontSize!==i||t.color.some((a,o)=>a!==s[o])||t.pageIndex!==n}renderAnnotationElement(t){let e=super.renderAnnotationElement(t);if(this.deleted)return e;let{style:i}=e;i.fontSize=`calc(${this.#r}px * var(--scale-factor))`,i.color=this.#t,e.replaceChildren();for(let n of this.#e.split(`
`)){let a=document.createElement("div");a.append(n?document.createTextNode(n):document.createElement("br")),e.append(a)}let s=r._internalPadding*this.parentScale;return t.updateEdited({rect:this.getRect(s,s),popupContent:this.#e}),e}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}},S=(()=>{class r{static PRECISION=1e-4;toSVGPath(){G("Abstract method `toSVGPath` must be implemented.")}get box(){G("Abstract getter `box` must be implemented.")}serialize(e,i){G("Abstract method `serialize` must be implemented.")}static _rescale(e,i,s,n,a,o){o||=new Float32Array(e.length);for(let l=0,c=e.length;l<c;l+=2)o[l]=i+e[l]*n,o[l+1]=s+e[l+1]*a;return o}static _rescaleAndSwap(e,i,s,n,a,o){o||=new Float32Array(e.length);for(let l=0,c=e.length;l<c;l+=2)o[l]=i+e[l+1]*n,o[l+1]=s+e[l]*a;return o}static _translate(e,i,s,n){n||=new Float32Array(e.length);for(let a=0,o=e.length;a<o;a+=2)n[a]=i+e[a],n[a+1]=s+e[a+1];return n}static svgRound(e){return Math.round(e*1e4)}static _normalizePoint(e,i,s,n,a){switch(a){case 90:return[1-i/s,e/n];case 180:return[1-e/s,1-i/n];case 270:return[i/s,1-e/n];default:return[e/s,i/n]}}static _normalizePagePoint(e,i,s){switch(s){case 90:return[1-i,e];case 180:return[1-e,1-i];case 270:return[i,1-e];default:return[e,i]}}static createBezierPoints(e,i,s,n,a,o){return[(e+5*s)/6,(i+5*n)/6,(5*s+a)/6,(5*n+o)/6,(s+a)/2,(n+o)/2]}}return r})(),Bi=class r{#t;#e=[];#i;#s;#r=[];#n=new Float32Array(18);#l;#o;#h;#c;#u;#d;#f=[];static#a=8;static#p=2;static#m=r.#a+r.#p;constructor({x:t,y:e},i,s,n,a,o=0){this.#t=i,this.#d=n*s,this.#s=a,this.#n.set([NaN,NaN,NaN,NaN,t,e],6),this.#i=o,this.#c=r.#a*s,this.#h=r.#m*s,this.#u=s,this.#f.push(t,e)}isEmpty(){return isNaN(this.#n[8])}#g(){let t=this.#n.subarray(4,6),e=this.#n.subarray(16,18),[i,s,n,a]=this.#t;return[(this.#l+(t[0]-e[0])/2-i)/n,(this.#o+(t[1]-e[1])/2-s)/a,(this.#l+(e[0]-t[0])/2-i)/n,(this.#o+(e[1]-t[1])/2-s)/a]}add({x:t,y:e}){this.#l=t,this.#o=e;let[i,s,n,a]=this.#t,[o,l,c,h]=this.#n.subarray(8,12),d=t-c,u=e-h,f=Math.hypot(d,u);if(f<this.#h)return!1;let p=f-this.#c,g=p/f,b=g*d,m=g*u,_=o,y=l;o=c,l=h,c+=b,h+=m,this.#f?.push(t,e);let v=-m/p,A=b/p,E=v*this.#d,C=A*this.#d;return this.#n.set(this.#n.subarray(2,8),0),this.#n.set([c+E,h+C],4),this.#n.set(this.#n.subarray(14,18),12),this.#n.set([c-E,h-C],16),isNaN(this.#n[6])?(this.#r.length===0&&(this.#n.set([o+E,l+C],2),this.#r.push(NaN,NaN,NaN,NaN,(o+E-i)/n,(l+C-s)/a),this.#n.set([o-E,l-C],14),this.#e.push(NaN,NaN,NaN,NaN,(o-E-i)/n,(l-C-s)/a)),this.#n.set([_,y,o,l,c,h],6),!this.isEmpty()):(this.#n.set([_,y,o,l,c,h],6),Math.abs(Math.atan2(y-l,_-o)-Math.atan2(m,b))<Math.PI/2?([o,l,c,h]=this.#n.subarray(2,6),this.#r.push(NaN,NaN,NaN,NaN,((o+c)/2-i)/n,((l+h)/2-s)/a),[o,l,_,y]=this.#n.subarray(14,18),this.#e.push(NaN,NaN,NaN,NaN,((_+o)/2-i)/n,((y+l)/2-s)/a),!0):([_,y,o,l,c,h]=this.#n.subarray(0,6),this.#r.push(((_+5*o)/6-i)/n,((y+5*l)/6-s)/a,((5*o+c)/6-i)/n,((5*l+h)/6-s)/a,((o+c)/2-i)/n,((l+h)/2-s)/a),[c,h,o,l,_,y]=this.#n.subarray(12,18),this.#e.push(((_+5*o)/6-i)/n,((y+5*l)/6-s)/a,((5*o+c)/6-i)/n,((5*l+h)/6-s)/a,((o+c)/2-i)/n,((l+h)/2-s)/a),!0))}toSVGPath(){if(this.isEmpty())return"";let t=this.#r,e=this.#e;if(isNaN(this.#n[6])&&!this.isEmpty())return this.#b();let i=[];i.push(`M${t[4]} ${t[5]}`);for(let s=6;s<t.length;s+=6)isNaN(t[s])?i.push(`L${t[s+4]} ${t[s+5]}`):i.push(`C${t[s]} ${t[s+1]} ${t[s+2]} ${t[s+3]} ${t[s+4]} ${t[s+5]}`);this.#_(i);for(let s=e.length-6;s>=6;s-=6)isNaN(e[s])?i.push(`L${e[s+4]} ${e[s+5]}`):i.push(`C${e[s]} ${e[s+1]} ${e[s+2]} ${e[s+3]} ${e[s+4]} ${e[s+5]}`);return this.#v(i),i.join(" ")}#b(){let[t,e,i,s]=this.#t,[n,a,o,l]=this.#g();return`M${(this.#n[2]-t)/i} ${(this.#n[3]-e)/s} L${(this.#n[4]-t)/i} ${(this.#n[5]-e)/s} L${n} ${a} L${o} ${l} L${(this.#n[16]-t)/i} ${(this.#n[17]-e)/s} L${(this.#n[14]-t)/i} ${(this.#n[15]-e)/s} Z`}#v(t){let e=this.#e;t.push(`L${e[4]} ${e[5]} Z`)}#_(t){let[e,i,s,n]=this.#t,a=this.#n.subarray(4,6),o=this.#n.subarray(16,18),[l,c,h,d]=this.#g();t.push(`L${(a[0]-e)/s} ${(a[1]-i)/n} L${l} ${c} L${h} ${d} L${(o[0]-e)/s} ${(o[1]-i)/n}`)}newFreeDrawOutline(t,e,i,s,n,a){return new Hi(t,e,i,s,n,a)}getOutlines(){let t=this.#r,e=this.#e,i=this.#n,[s,n,a,o]=this.#t,l=new Float32Array((this.#f?.length??0)+2);for(let d=0,u=l.length-2;d<u;d+=2)l[d]=(this.#f[d]-s)/a,l[d+1]=(this.#f[d+1]-n)/o;if(l[l.length-2]=(this.#l-s)/a,l[l.length-1]=(this.#o-n)/o,isNaN(i[6])&&!this.isEmpty())return this.#A(l);let c=new Float32Array(this.#r.length+24+this.#e.length),h=t.length;for(let d=0;d<h;d+=2){if(isNaN(t[d])){c[d]=c[d+1]=NaN;continue}c[d]=t[d],c[d+1]=t[d+1]}h=this.#S(c,h);for(let d=e.length-6;d>=6;d-=6)for(let u=0;u<6;u+=2){if(isNaN(e[d+u])){c[h]=c[h+1]=NaN,h+=2;continue}c[h]=e[d+u],c[h+1]=e[d+u+1],h+=2}return this.#C(c,h),this.newFreeDrawOutline(c,l,this.#t,this.#u,this.#i,this.#s)}#A(t){let e=this.#n,[i,s,n,a]=this.#t,[o,l,c,h]=this.#g(),d=new Float32Array(36);return d.set([NaN,NaN,NaN,NaN,(e[2]-i)/n,(e[3]-s)/a,NaN,NaN,NaN,NaN,(e[4]-i)/n,(e[5]-s)/a,NaN,NaN,NaN,NaN,o,l,NaN,NaN,NaN,NaN,c,h,NaN,NaN,NaN,NaN,(e[16]-i)/n,(e[17]-s)/a,NaN,NaN,NaN,NaN,(e[14]-i)/n,(e[15]-s)/a],0),this.newFreeDrawOutline(d,t,this.#t,this.#u,this.#i,this.#s)}#C(t,e){let i=this.#e;return t.set([NaN,NaN,NaN,NaN,i[4],i[5]],e),e+=6}#S(t,e){let i=this.#n.subarray(4,6),s=this.#n.subarray(16,18),[n,a,o,l]=this.#t,[c,h,d,u]=this.#g();return t.set([NaN,NaN,NaN,NaN,(i[0]-n)/o,(i[1]-a)/l,NaN,NaN,NaN,NaN,c,h,NaN,NaN,NaN,NaN,d,u,NaN,NaN,NaN,NaN,(s[0]-n)/o,(s[1]-a)/l],e),e+=24}},Hi=class extends S{#t;#e=new Float32Array(4);#i;#s;#r;#n;#l;constructor(t,e,i,s,n,a){super(),this.#l=t,this.#r=e,this.#t=i,this.#n=s,this.#i=n,this.#s=a,this.lastPoint=[NaN,NaN],this.#o(a);let[o,l,c,h]=this.#e;for(let d=0,u=t.length;d<u;d+=2)t[d]=(t[d]-o)/c,t[d+1]=(t[d+1]-l)/h;for(let d=0,u=e.length;d<u;d+=2)e[d]=(e[d]-o)/c,e[d+1]=(e[d+1]-l)/h}toSVGPath(){let t=[`M${this.#l[4]} ${this.#l[5]}`];for(let e=6,i=this.#l.length;e<i;e+=6){if(isNaN(this.#l[e])){t.push(`L${this.#l[e+4]} ${this.#l[e+5]}`);continue}t.push(`C${this.#l[e]} ${this.#l[e+1]} ${this.#l[e+2]} ${this.#l[e+3]} ${this.#l[e+4]} ${this.#l[e+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,e,i,s],n){let a=i-t,o=s-e,l,c;switch(n){case 0:l=S._rescale(this.#l,t,s,a,-o),c=S._rescale(this.#r,t,s,a,-o);break;case 90:l=S._rescaleAndSwap(this.#l,t,e,a,o),c=S._rescaleAndSwap(this.#r,t,e,a,o);break;case 180:l=S._rescale(this.#l,i,e,-a,o),c=S._rescale(this.#r,i,e,-a,o);break;case 270:l=S._rescaleAndSwap(this.#l,i,s,-a,-o),c=S._rescaleAndSwap(this.#r,i,s,-a,-o);break}return{outline:Array.from(l),points:[Array.from(c)]}}#o(t){let e=this.#l,i=e[4],s=e[5],n=i,a=s,o=i,l=s,c=i,h=s,d=t?Math.max:Math.min;for(let f=6,p=e.length;f<p;f+=6){if(isNaN(e[f]))n=Math.min(n,e[f+4]),a=Math.min(a,e[f+5]),o=Math.max(o,e[f+4]),l=Math.max(l,e[f+5]),h<e[f+5]?(c=e[f+4],h=e[f+5]):h===e[f+5]&&(c=d(c,e[f+4]));else{let g=T.bezierBoundingBox(i,s,...e.slice(f,f+6));n=Math.min(n,g[0]),a=Math.min(a,g[1]),o=Math.max(o,g[2]),l=Math.max(l,g[3]),h<g[3]?(c=g[2],h=g[3]):h===g[3]&&(c=d(c,g[2]))}i=e[f+4],s=e[f+5]}let u=this.#e;u[0]=n-this.#i,u[1]=a-this.#i,u[2]=o-n+2*this.#i,u[3]=l-a+2*this.#i,this.lastPoint=[c,h]}get box(){return this.#e}newOutliner(t,e,i,s,n,a=0){return new Bi(t,e,i,s,n,a)}getNewOutline(t,e){let[i,s,n,a]=this.#e,[o,l,c,h]=this.#t,d=n*c,u=a*h,f=i*c+o,p=s*h+l,g=this.newOutliner({x:this.#r[0]*d+f,y:this.#r[1]*u+p},this.#t,this.#n,t,this.#s,e??this.#i);for(let b=2;b<this.#r.length;b+=2)g.add({x:this.#r[b]*d+f,y:this.#r[b+1]*u+p});return g.getOutlines()}},$e=class{#t;#e;#i=[];#s=[];constructor(t,e=0,i=0,s=!0){let n=1/0,a=-1/0,o=1/0,l=-1/0,h=10**-4;for(let{x:m,y:_,width:y,height:v}of t){let A=Math.floor((m-e)/h)*h,E=Math.ceil((m+y+e)/h)*h,C=Math.floor((_-e)/h)*h,I=Math.ceil((_+v+e)/h)*h,R=[A,C,I,!0],V=[E,C,I,!1];this.#i.push(R,V),n=Math.min(n,A),a=Math.max(a,E),o=Math.min(o,C),l=Math.max(l,I)}let d=a-n+2*i,u=l-o+2*i,f=n-i,p=o-i,g=this.#i.at(s?-1:-2),b=[g[0],g[2]];for(let m of this.#i){let[_,y,v]=m;m[0]=(_-f)/d,m[1]=(y-p)/u,m[2]=(v-p)/u}this.#t=new Float32Array([f,p,d,u]),this.#e=b}getOutlines(){this.#i.sort((e,i)=>e[0]-i[0]||e[1]-i[1]||e[2]-i[2]);let t=[];for(let e of this.#i)e[3]?(t.push(...this.#h(e)),this.#l(e)):(this.#o(e),t.push(...this.#h(e)));return this.#r(t)}#r(t){let e=[],i=new Set;for(let a of t){let[o,l,c]=a;e.push([o,l,a],[o,c,a])}e.sort((a,o)=>a[1]-o[1]||a[0]-o[0]);for(let a=0,o=e.length;a<o;a+=2){let l=e[a][2],c=e[a+1][2];l.push(c),c.push(l),i.add(l),i.add(c)}let s=[],n;for(;i.size>0;){let a=i.values().next().value,[o,l,c,h,d]=a;i.delete(a);let u=o,f=l;for(n=[o,c],s.push(n);;){let p;if(i.has(h))p=h;else if(i.has(d))p=d;else break;i.delete(p),[o,l,c,h,d]=p,u!==o&&(n.push(u,f,o,f===l?l:c),u=o),f=f===l?c:l}n.push(u,f)}return new Xn(s,this.#t,this.#e)}#n(t){let e=this.#s,i=0,s=e.length-1;for(;i<=s;){let n=i+s>>1,a=e[n][0];if(a===t)return n;a<t?i=n+1:s=n-1}return s+1}#l([,t,e]){let i=this.#n(t);this.#s.splice(i,0,[t,e])}#o([,t,e]){let i=this.#n(t);for(let s=i;s<this.#s.length;s++){let[n,a]=this.#s[s];if(n!==t)break;if(n===t&&a===e){this.#s.splice(s,1);return}}for(let s=i-1;s>=0;s--){let[n,a]=this.#s[s];if(n!==t)break;if(n===t&&a===e){this.#s.splice(s,1);return}}}#h(t){let[e,i,s]=t,n=[[e,i,s]],a=this.#n(s);for(let o=0;o<a;o++){let[l,c]=this.#s[o];for(let h=0,d=n.length;h<d;h++){let[,u,f]=n[h];if(!(c<=u||f<=l)){if(u>=l){if(f>c)n[h][1]=c;else{if(d===1)return[];n.splice(h,1),h--,d--}continue}n[h][2]=l,f>c&&n.push([e,c,f])}}}return n}},Xn=class extends S{#t;#e;constructor(t,e,i){super(),this.#e=t,this.#t=e,this.lastPoint=i}toSVGPath(){let t=[];for(let e of this.#e){let[i,s]=e;t.push(`M${i} ${s}`);for(let n=2;n<e.length;n+=2){let a=e[n],o=e[n+1];a===i?(t.push(`V${o}`),s=o):o===s&&(t.push(`H${a}`),i=a)}t.push("Z")}return t.join(" ")}serialize([t,e,i,s],n){let a=[],o=i-t,l=s-e;for(let c of this.#e){let h=new Array(c.length);for(let d=0;d<c.length;d+=2)h[d]=t+c[d]*o,h[d+1]=s-c[d+1]*l;a.push(h)}return a}get box(){return this.#t}get classNamesForOutlining(){return["highlightOutline"]}},ze=class extends Bi{newFreeDrawOutline(t,e,i,s,n,a){return new Yn(t,e,i,s,n,a)}},Yn=class extends Hi{newOutliner(t,e,i,s,n,a=0){return new ze(t,e,i,s,n,a)}},Gi=class r{#t=null;#e=null;#i;#s=null;#r=!1;#n=!1;#l=null;#o;#h=null;#c=null;#u;static#d=null;static get _keyboardManager(){return O(this,"_keyboardManager",new re([[["Escape","mac+Escape"],r.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],r.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],r.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],r.prototype._moveToPrevious],[["Home","mac+Home"],r.prototype._moveToBeginning],[["End","mac+End"],r.prototype._moveToEnd]]))}constructor({editor:t=null,uiManager:e=null}){t?(this.#n=!1,this.#u=N.HIGHLIGHT_COLOR,this.#l=t):(this.#n=!0,this.#u=N.HIGHLIGHT_DEFAULT_COLOR),this.#c=t?._uiManager||e,this.#o=this.#c._eventBus,this.#i=t?.color||this.#c?.highlightColors.values().next().value||"#FFFF98",r.#d||=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"})}renderButton(){let t=this.#t=document.createElement("button");t.className="colorPicker",t.tabIndex="0",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),t.setAttribute("aria-haspopup",!0);let e=this.#c._signal;t.addEventListener("click",this.#m.bind(this),{signal:e}),t.addEventListener("keydown",this.#p.bind(this),{signal:e});let i=this.#e=document.createElement("span");return i.className="swatch",i.setAttribute("aria-hidden",!0),i.style.backgroundColor=this.#i,t.append(i),t}renderMainDropdown(){let t=this.#s=this.#f();return t.setAttribute("aria-orientation","horizontal"),t.setAttribute("aria-labelledby","highlightColorPickerLabel"),t}#f(){let t=document.createElement("div"),e=this.#c._signal;t.addEventListener("contextmenu",xt,{signal:e}),t.className="dropdown",t.role="listbox",t.setAttribute("aria-multiselectable",!1),t.setAttribute("aria-orientation","vertical"),t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(let[i,s]of this.#c.highlightColors){let n=document.createElement("button");n.tabIndex="0",n.role="option",n.setAttribute("data-color",s),n.title=i,n.setAttribute("data-l10n-id",r.#d[i]);let a=document.createElement("span");n.append(a),a.className="swatch",a.style.backgroundColor=s,n.setAttribute("aria-selected",s===this.#i),n.addEventListener("click",this.#a.bind(this,s),{signal:e}),t.append(n)}return t.addEventListener("keydown",this.#p.bind(this),{signal:e}),t}#a(t,e){e.stopPropagation(),this.#o.dispatch("switchannotationeditorparams",{source:this,type:this.#u,value:t})}_colorSelectFromKeyboard(t){if(t.target===this.#t){this.#m(t);return}let e=t.target.getAttribute("data-color");e&&this.#a(e,t)}_moveToNext(t){if(!this.#b){this.#m(t);return}if(t.target===this.#t){this.#s.firstChild?.focus();return}t.target.nextSibling?.focus()}_moveToPrevious(t){if(t.target===this.#s?.firstChild||t.target===this.#t){this.#b&&this._hideDropdownFromKeyboard();return}this.#b||this.#m(t),t.target.previousSibling?.focus()}_moveToBeginning(t){if(!this.#b){this.#m(t);return}this.#s.firstChild?.focus()}_moveToEnd(t){if(!this.#b){this.#m(t);return}this.#s.lastChild?.focus()}#p(t){r._keyboardManager.exec(this,t)}#m(t){if(this.#b){this.hideDropdown();return}if(this.#r=t.detail===0,this.#h||(this.#h=new AbortController,window.addEventListener("pointerdown",this.#g.bind(this),{signal:this.#c.combinedSignal(this.#h)})),this.#s){this.#s.classList.remove("hidden");return}let e=this.#s=this.#f();this.#t.append(e)}#g(t){this.#s?.contains(t.target)||this.hideDropdown()}hideDropdown(){this.#s?.classList.add("hidden"),this.#h?.abort(),this.#h=null}get#b(){return this.#s&&!this.#s.classList.contains("hidden")}_hideDropdownFromKeyboard(){if(!this.#n){if(!this.#b){this.#l?.unselect();return}this.hideDropdown(),this.#t.focus({preventScroll:!0,focusVisible:this.#r})}}updateColor(t){if(this.#e&&(this.#e.style.backgroundColor=t),!this.#s)return;let e=this.#c.highlightColors.values();for(let i of this.#s.children)i.setAttribute("aria-selected",e.next().value===t)}destroy(){this.#t?.remove(),this.#t=null,this.#e=null,this.#s?.remove(),this.#s=null}},ji=class r extends W{#t=null;#e=0;#i;#s=null;#r=null;#n=null;#l=null;#o=0;#h=null;#c=null;#u=null;#d=!1;#f=null;#a;#p=null;#m="";#g;#b="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _type="highlight";static _editorType=k.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){let t=r.prototype;return O(this,"_keyboardManager",new re([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}constructor(t){super(nt(X({},t),{name:"highlightEditor"})),this.color=t.color||r._defaultColor,this.#g=t.thickness||r._defaultThickness,this.#a=t.opacity||r._defaultOpacity,this.#i=t.boxes||null,this.#b=t.methodOfCreation||"",this.#m=t.text||"",this._isDraggable=!1,t.highlightId>-1?(this.#d=!0,this.#_(t),this.#I()):this.#i&&(this.#t=t.anchorNode,this.#e=t.anchorOffset,this.#l=t.focusNode,this.#o=t.focusOffset,this.#v(),this.#I(),this.rotate(this.rotation))}get telemetryInitialData(){return{action:"added",type:this.#d?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:this.#g,methodOfCreation:this.#b}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}#v(){let t=new $e(this.#i,.001);this.#c=t.getOutlines(),[this.x,this.y,this.width,this.height]=this.#c.box;let e=new $e(this.#i,.0025,.001,this._uiManager.direction==="ltr");this.#n=e.getOutlines();let{lastPoint:i}=this.#n;this.#f=[(i[0]-this.x)/this.width,(i[1]-this.y)/this.height]}#_({highlightOutlines:t,highlightId:e,clipPathId:i}){this.#c=t;let s=1.5;if(this.#n=t.getNewOutline(this.#g/2+s,.0025),e>=0)this.#u=e,this.#s=i,this.parent.drawLayer.finalizeDraw(e,{bbox:t.box,path:{d:t.toSVGPath()}}),this.#p=this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:this.#n.box,path:{d:this.#n.toSVGPath()}},!0);else if(this.parent){let h=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(this.#u,{bbox:r.#w(this.#c.box,(h-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(this.#p,{bbox:r.#w(this.#n.box,h),path:{d:this.#n.toSVGPath()}})}let[n,a,o,l]=t.box;switch(this.rotation){case 0:this.x=n,this.y=a,this.width=o,this.height=l;break;case 90:{let[h,d]=this.parentDimensions;this.x=a,this.y=1-n,this.width=o*d/h,this.height=l*h/d;break}case 180:this.x=1-n,this.y=1-a,this.width=o,this.height=l;break;case 270:{let[h,d]=this.parentDimensions;this.x=1-a,this.y=n,this.width=o*d/h,this.height=l*h/d;break}}let{lastPoint:c}=this.#n;this.#f=[(c[0]-n)/o,(c[1]-a)/l]}static initialize(t,e){W.initialize(t,e),r._defaultColor||=e.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(t,e){switch(t){case N.HIGHLIGHT_DEFAULT_COLOR:r._defaultColor=e;break;case N.HIGHLIGHT_THICKNESS:r._defaultThickness=e;break}}translateInPage(t,e){}get toolbarPosition(){return this.#f}updateParams(t,e){switch(t){case N.HIGHLIGHT_COLOR:this.#A(e);break;case N.HIGHLIGHT_THICKNESS:this.#C(e);break}}static get defaultPropertiesToUpdate(){return[[N.HIGHLIGHT_DEFAULT_COLOR,r._defaultColor],[N.HIGHLIGHT_THICKNESS,r._defaultThickness]]}get propertiesToUpdate(){return[[N.HIGHLIGHT_COLOR,this.color||r._defaultColor],[N.HIGHLIGHT_THICKNESS,this.#g||r._defaultThickness],[N.HIGHLIGHT_FREE,this.#d]]}#A(t){let e=(n,a)=>{this.color=n,this.#a=a,this.parent?.drawLayer.updateProperties(this.#u,{root:{fill:n,"fill-opacity":a}}),this.#r?.updateColor(n)},i=this.color,s=this.#a;this.addCommands({cmd:e.bind(this,t,r._defaultOpacity),undo:e.bind(this,i,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:N.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(t)},!0)}#C(t){let e=this.#g,i=s=>{this.#g=s,this.#S(s)};this.addCommands({cmd:i.bind(this,t),undo:i.bind(this,e),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:N.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)}addEditToolbar(){return w(this,null,function*(){let t=yield Zt(r.prototype,this,"addEditToolbar").call(this);return t?(this._uiManager.highlightColors&&(this.#r=new Gi({editor:this}),t.addColorPicker(this.#r)),t):null})}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#P())}getBaseTranslation(){return[0,0]}getRect(t,e){return super.getRect(t,e,this.#P())}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){this.#T(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#I(),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let e=!1;this.parent&&!t?this.#T():t&&(this.#I(t),e=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),this.show(this._isVisible),e&&this.select()}#S(t){if(!this.#d)return;this.#_({highlightOutlines:this.#c.getNewOutline(t/2)}),this.fixAndSetPosition();let[e,i]=this.parentDimensions;this.setDims(this.width*e,this.height*i)}#T(){this.#u===null||!this.parent||(this.parent.drawLayer.remove(this.#u),this.#u=null,this.parent.drawLayer.remove(this.#p),this.#p=null)}#I(t=this.parent){this.#u===null&&({id:this.#u,clipPathId:this.#s}=t.drawLayer.draw({bbox:this.#c.box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.#a},rootClass:{highlight:!0,free:this.#d},path:{d:this.#c.toSVGPath()}},!1,!0),this.#p=t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:this.#d},bbox:this.#n.box,path:{d:this.#n.toSVGPath()}},this.#d),this.#h&&(this.#h.style.clipPath=this.#s))}static#w([t,e,i,s],n){switch(n){case 90:return[1-e-s,t,s,i];case 180:return[1-t-i,1-e-s,i,s];case 270:return[e,1-t-i,s,i]}return[t,e,i,s]}rotate(t){let{drawLayer:e}=this.parent,i;this.#d?(t=(t-this.rotation+360)%360,i=r.#w(this.#c.box,t)):i=r.#w([this.x,this.y,this.width,this.height],t),e.updateProperties(this.#u,{bbox:i,root:{"data-main-rotation":t}}),e.updateProperties(this.#p,{bbox:r.#w(this.#n.box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;let t=super.render();this.#m&&(t.setAttribute("aria-label",this.#m),t.setAttribute("role","mark")),this.#d?t.classList.add("free"):this.div.addEventListener("keydown",this.#M.bind(this),{signal:this._uiManager._signal});let e=this.#h=document.createElement("div");t.append(e),e.setAttribute("aria-hidden","true"),e.className="internal",e.style.clipPath=this.#s;let[i,s]=this.parentDimensions;return this.setDims(this.width*i,this.height*s),bi(this,this.#h,["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!0}})}pointerleave(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!1}})}#M(t){r._keyboardManager.exec(this,t)}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:this.#x(!0);break;case 1:case 3:this.#x(!1);break}}#x(t){if(!this.#t)return;let e=window.getSelection();t?e.setPosition(this.#t,this.#e):e.setPosition(this.#l,this.#o)}select(){super.select(),this.#p&&this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!1,selected:!0}})}unselect(){super.unselect(),this.#p&&(this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{selected:!1}}),this.#d||this.#x(!1))}get _mustFixPosition(){return!this.#d}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(this.#u,{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(this.#p,{rootClass:{hidden:!t}}))}#P(){return this.#d?this.rotation:0}#O(){if(this.#d)return null;let[t,e]=this.pageDimensions,[i,s]=this.pageTranslation,n=this.#i,a=new Float32Array(n.length*8),o=0;for(let{x:l,y:c,width:h,height:d}of n){let u=l*t+i,f=(1-c)*e+s;a[o]=a[o+4]=u,a[o+1]=a[o+3]=f,a[o+2]=a[o+6]=u+h*t,a[o+5]=a[o+7]=f-d*e,o+=8}return a}#L(t){return this.#c.serialize(t,this.#P())}static startHighlighting(t,e,{target:i,x:s,y:n}){let{x:a,y:o,width:l,height:c}=i.getBoundingClientRect(),h=new AbortController,d=t.combinedSignal(h),u=f=>{h.abort(),this.#y(t,f)};window.addEventListener("blur",u,{signal:d}),window.addEventListener("pointerup",u,{signal:d}),window.addEventListener("pointerdown",mt,{capture:!0,passive:!1,signal:d}),window.addEventListener("contextmenu",xt,{signal:d}),i.addEventListener("pointermove",this.#E.bind(this,t),{signal:d}),this._freeHighlight=new ze({x:s,y:n},[a,o,l,c],t.scale,this._defaultThickness/2,e,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static#E(t,e){this._freeHighlight.add(e)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})}static#y(t,e){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(e,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static deserialize(t,e,i){return w(this,null,function*(){let s=null;if(t instanceof Ni){let{data:{quadPoints:p,rect:g,rotation:b,id:m,color:_,opacity:y,popupRef:v},parent:{page:{pageNumber:A}}}=t;s=t={annotationType:k.HIGHLIGHT,color:Array.from(_),opacity:y,quadPoints:p,boxes:null,pageIndex:A-1,rect:g.slice(0),rotation:b,id:m,deleted:!1,popupRef:v}}else if(t instanceof Ue){let{data:{inkLists:p,rect:g,rotation:b,id:m,color:_,borderStyle:{rawWidth:y},popupRef:v},parent:{page:{pageNumber:A}}}=t;s=t={annotationType:k.HIGHLIGHT,color:Array.from(_),thickness:y,inkLists:p,boxes:null,pageIndex:A-1,rect:g.slice(0),rotation:b,id:m,deleted:!1,popupRef:v}}let{color:n,quadPoints:a,inkLists:o,opacity:l}=t,c=yield Zt(r,this,"deserialize").call(this,t,e,i);c.color=T.makeHexColor(...n),c.#a=l||1,o&&(c.#g=t.thickness),c.annotationElementId=t.id||null,c._initialData=s;let[h,d]=c.pageDimensions,[u,f]=c.pageTranslation;if(a){let p=c.#i=[];for(let g=0;g<a.length;g+=8)p.push({x:(a[g]-u)/h,y:1-(a[g+1]-f)/d,width:(a[g+2]-a[g])/h,height:(a[g+1]-a[g+5])/d});c.#v(),c.#I(),c.rotate(c.rotation)}else if(o){c.#d=!0;let p=o[0],g={x:p[0]-u,y:d-(p[1]-f)},b=new ze(g,[0,0,h,d],1,c.#g/2,!0,.001);for(let y=0,v=p.length;y<v;y+=2)g.x=p[y]-u,g.y=d-(p[y+1]-f),b.add(g);let{id:m,clipPathId:_}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:c.color,"fill-opacity":c._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:b.toSVGPath()}},!0,!0);c.#_({highlightOutlines:b.getOutlines(),highlightId:m,clipPathId:_}),c.#I()}return c})}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();let e=this.getRect(0,0),i=W._colorManager.convert(this.color),s={annotationType:k.HIGHLIGHT,color:i,opacity:this.#a,thickness:this.#g,quadPoints:this.#O(),outlines:this.#L(e),pageIndex:this.pageIndex,rect:e,rotation:this.#P(),structTreeParentId:this._structTreeParentId};return this.annotationElementId&&!this.#D(s)?null:(s.id=this.annotationElementId,s)}#D(t){let{color:e}=this._initialData;return t.color.some((i,s)=>i!==e[s])}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}},Kn=class{#t=Object.create(null);updateProperty(t,e){this[t]=e,this.updateSVGProperty(t,e)}updateProperties(t){if(t)for(let[e,i]of Object.entries(t))this.updateProperty(e,i)}updateSVGProperty(t,e){this.#t[t]=e}toSVGProperties(){let t=this.#t;return this.#t=Object.create(null),{root:t}}reset(){this.#t=Object.create(null)}updateAll(t=this){this.updateProperties(t)}clone(){G("Not implemented")}},al=(()=>{class r extends W{#t=null;#e;_drawId=null;static _currentDrawId=-1;static _currentParent=null;static#i=null;static#s=null;static#r=null;static#n=NaN;static#l=null;static#o=null;static#h=NaN;static _INNER_MARGIN=3;constructor(e){super(e),this.#e=e.mustBeCommitted||!1,e.drawOutlines&&(this.#c(e),this.#f())}#c({drawOutlines:e,drawId:i,drawingOptions:s}){this.#t=e,this._drawingOptions||=s,i>=0?(this._drawId=i,this.parent.drawLayer.finalizeDraw(i,e.defaultProperties)):this._drawId=this.#u(e,this.parent),this.#m(e.box)}#u(e,i){let{id:s}=i.drawLayer.draw(r._mergeSVGProperties(this._drawingOptions.toSVGProperties(),e.defaultSVGProperties),!1,!1);return s}static _mergeSVGProperties(e,i){let s=new Set(Object.keys(e));for(let[n,a]of Object.entries(i))s.has(n)?Object.assign(e[n],a):e[n]=a;return e}static getDefaultDrawingOptions(e){G("Not implemented")}static get typesMap(){G("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(e,i){let s=this.typesMap.get(e);s&&this._defaultDrawingOptions.updateProperty(s,i),this._currentParent&&(r.#i.updateProperty(s,i),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(e,i){let s=this.constructor.typesMap.get(e);s&&this._updateProperty(e,s,i)}static get defaultPropertiesToUpdate(){let e=[],i=this._defaultDrawingOptions;for(let[s,n]of this.typesMap)e.push([s,i[n]]);return e}get propertiesToUpdate(){let e=[],{_drawingOptions:i}=this;for(let[s,n]of this.constructor.typesMap)e.push([s,i[n]]);return e}_updateProperty(e,i,s){let n=this._drawingOptions,a=n[i],o=l=>{n.updateProperty(i,l);let c=this.#t.updateProperty(i,l);c&&this.#m(c),this.parent?.drawLayer.updateProperties(this._drawId,n.toSVGProperties())};this.addCommands({cmd:o.bind(this,s),undo:o.bind(this,a),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:e,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){this.parent?.drawLayer.updateProperties(this._drawId,r._mergeSVGProperties(this.#t.getPathResizingSVGProperties(this.#p()),{bbox:this.#g()}))}_onResized(){this.parent?.drawLayer.updateProperties(this._drawId,r._mergeSVGProperties(this.#t.getPathResizedSVGProperties(this.#p()),{bbox:this.#g()}))}_onTranslating(e,i){this.parent?.drawLayer.updateProperties(this._drawId,{bbox:this.#g(e,i)})}_onTranslated(){this.parent?.drawLayer.updateProperties(this._drawId,r._mergeSVGProperties(this.#t.getPathTranslatedSVGProperties(this.#p(),this.parentDimensions),{bbox:this.#g()}))}_onStartDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,this.#e&&(this.#e=!1,this.commit(),this.parent.setSelected(this),e&&this.isOnScreen&&this.div.focus())}remove(){this.#d(),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#f(),this.#m(this.#t.box),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){let i=!1;this.parent&&!e?(this._uiManager.removeShouldRescale(this),this.#d()):e&&(this._uiManager.addShouldRescale(this),this.#f(e),i=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(e),i&&this.select()}#d(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())}#f(e=this.parent){if(!(this._drawId!==null&&this.parent===e)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,e.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=this.#u(this.#t,e)}}#a([e,i,s,n]){let{parentDimensions:[a,o],rotation:l}=this;switch(l){case 90:return[i,1-e,s*(o/a),n*(a/o)];case 180:return[1-e,1-i,s,n];case 270:return[1-i,e,s*(o/a),n*(a/o)];default:return[e,i,s,n]}}#p(){let{x:e,y:i,width:s,height:n,parentDimensions:[a,o],rotation:l}=this;switch(l){case 90:return[1-i,e,s*(a/o),n*(o/a)];case 180:return[1-e,1-i,s,n];case 270:return[i,1-e,s*(a/o),n*(o/a)];default:return[e,i,s,n]}}#m(e){if([this.x,this.y,this.width,this.height]=this.#a(e),this.div){this.fixAndSetPosition();let[i,s]=this.parentDimensions;this.setDims(this.width*i,this.height*s)}this._onResized()}#g(){let{x:e,y:i,width:s,height:n,rotation:a,parentRotation:o,parentDimensions:[l,c]}=this;switch((a*4+o)/90){case 1:return[1-i-n,e,n,s];case 2:return[1-e-s,1-i-n,s,n];case 3:return[i,1-e-s,n,s];case 4:return[e,i-s*(l/c),n*(c/l),s*(l/c)];case 5:return[1-i,e,s*(l/c),n*(c/l)];case 6:return[1-e-n*(c/l),1-i,n*(c/l),s*(l/c)];case 7:return[i-s*(l/c),1-e-n*(c/l),s*(l/c),n*(c/l)];case 8:return[e-s,i-n,s,n];case 9:return[1-i,e-s,n,s];case 10:return[1-e,1-i,s,n];case 11:return[i-n,1-e,n,s];case 12:return[e-n*(c/l),i,n*(c/l),s*(l/c)];case 13:return[1-i-s*(l/c),e-n*(c/l),s*(l/c),n*(c/l)];case 14:return[1-e,1-i-s*(l/c),n*(c/l),s*(l/c)];case 15:return[i,1-e,s*(l/c),n*(c/l)];default:return[e,i,s,n]}}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,r._mergeSVGProperties({bbox:this.#g()},this.#t.updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&this.#m(this.#t.updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let e=super.render();e.classList.add("draw");let i=document.createElement("div");e.append(i),i.setAttribute("aria-hidden","true"),i.className="internal";let[s,n]=this.parentDimensions;return this.setDims(this.width*s,this.height*n),this._uiManager.addShouldRescale(this),this.disableEditing(),e}static createDrawerInstance(e,i,s,n,a){G("Not implemented")}static startDrawing(e,i,s,n){let{target:a,offsetX:o,offsetY:l,pointerId:c,pointerType:h}=n;if(r.#l&&r.#l!==h)return;let{viewport:{rotation:d}}=e,{width:u,height:f}=a.getBoundingClientRect(),p=r.#s=new AbortController,g=e.combinedSignal(p);if(r.#n||=c,r.#l??=h,window.addEventListener("pointerup",b=>{r.#n===b.pointerId?this._endDraw(b):r.#o?.delete(b.pointerId)},{signal:g}),window.addEventListener("pointercancel",b=>{r.#n===b.pointerId?this._currentParent.endDrawingSession():r.#o?.delete(b.pointerId)},{signal:g}),window.addEventListener("pointerdown",b=>{r.#l===b.pointerType&&((r.#o||=new Set).add(b.pointerId),r.#i.isCancellable()&&(r.#i.removeLastElement(),r.#i.isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:g}),window.addEventListener("contextmenu",xt,{signal:g}),a.addEventListener("pointermove",this._drawMove.bind(this),{signal:g}),a.addEventListener("touchmove",b=>{b.timeStamp===r.#h&&mt(b)},{signal:g}),e.toggleDrawing(),i._editorUndoBar?.hide(),r.#i){e.drawLayer.updateProperties(this._currentDrawId,r.#i.startNew(o,l,u,f,d));return}i.updateUIForDefaultProperties(this),r.#i=this.createDrawerInstance(o,l,u,f,d),r.#r=this.getDefaultDrawingOptions(),this._currentParent=e,{id:this._currentDrawId}=e.drawLayer.draw(this._mergeSVGProperties(r.#r.toSVGProperties(),r.#i.defaultSVGProperties),!0,!1)}static _drawMove(e){if(r.#h=-1,!r.#i)return;let{offsetX:i,offsetY:s,pointerId:n}=e;if(r.#n===n){if(r.#o?.size>=1){this._endDraw(e);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,r.#i.add(i,s)),r.#h=e.timeStamp,mt(e)}}static _cleanup(e){e&&(this._currentDrawId=-1,this._currentParent=null,r.#i=null,r.#r=null,r.#l=null,r.#h=NaN),r.#s&&(r.#s.abort(),r.#s=null,r.#n=NaN,r.#o=null)}static _endDraw(e){let i=this._currentParent;if(i){if(i.toggleDrawing(!0),this._cleanup(!1),e&&i.drawLayer.updateProperties(this._currentDrawId,r.#i.end(e.offsetX,e.offsetY)),this.supportMultipleDrawings){let s=r.#i,n=this._currentDrawId,a=s.getLastElement();i.addCommands({cmd:()=>{i.drawLayer.updateProperties(n,s.setLastElement(a))},undo:()=>{i.drawLayer.updateProperties(n,s.removeLastElement())},mustExec:!1,type:N.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(e){let i=this._currentParent;if(!i)return null;if(i.toggleDrawing(!0),i.cleanUndoStack(N.DRAW_STEP),!r.#i.isEmpty()){let{pageDimensions:[s,n],scale:a}=i,o=i.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:r.#i.getOutlines(s*a,n*a,a,this._INNER_MARGIN),drawingOptions:r.#r,mustBeCommitted:!e});return this._cleanup(!0),o}return i.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(e){}static deserializeDraw(e,i,s,n,a,o){G("Not implemented")}static deserialize(e,i,s){return w(this,null,function*(){let{rawDims:{pageWidth:n,pageHeight:a,pageX:o,pageY:l}}=i.viewport,c=this.deserializeDraw(o,l,n,a,this._INNER_MARGIN,e),h=yield Zt(r,this,"deserialize").call(this,e,i,s);return h.createDrawingOptions(e),h.#c({drawOutlines:c}),h.#f(),h.onScaleChanging(),h.rotate(),h})}serializeDraw(e){let[i,s]=this.pageTranslation,[n,a]=this.pageDimensions;return this.#t.serialize([i,s,n,a],e)}renderAnnotationElement(e){return e.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}}return r})(),Jn=class{#t=new Float64Array(6);#e;#i;#s;#r;#n;#l="";#o=0;#h=new Ui;#c;#u;constructor(t,e,i,s,n,a){this.#c=i,this.#u=s,this.#s=n,this.#r=a,[t,e]=this.#d(t,e);let o=this.#e=[NaN,NaN,NaN,NaN,t,e];this.#n=[t,e],this.#i=[{line:o,points:this.#n}],this.#t.set(o,0)}updateProperty(t,e){t==="stroke-width"&&(this.#r=e)}#d(t,e){return S._normalizePoint(t,e,this.#c,this.#u,this.#s)}isEmpty(){return!this.#i||this.#i.length===0}isCancellable(){return this.#n.length<=10}add(t,e){[t,e]=this.#d(t,e);let[i,s,n,a]=this.#t.subarray(2,6),o=t-n,l=e-a;return Math.hypot(this.#c*o,this.#u*l)<=2?null:(this.#n.push(t,e),isNaN(i)?(this.#t.set([n,a,t,e],2),this.#e.push(NaN,NaN,NaN,NaN,t,e),{path:{d:this.toSVGPath()}}):(isNaN(this.#t[0])&&this.#e.splice(6,6),this.#t.set([i,s,n,a,t,e],0),this.#e.push(...S.createBezierPoints(i,s,n,a,t,e)),{path:{d:this.toSVGPath()}}))}end(t,e){let i=this.add(t,e);return i||(this.#n.length===2?{path:{d:this.toSVGPath()}}:null)}startNew(t,e,i,s,n){this.#c=i,this.#u=s,this.#s=n,[t,e]=this.#d(t,e);let a=this.#e=[NaN,NaN,NaN,NaN,t,e];this.#n=[t,e];let o=this.#i.at(-1);return o&&(o.line=new Float32Array(o.line),o.points=new Float32Array(o.points)),this.#i.push({line:a,points:this.#n}),this.#t.set(a,0),this.#o=0,this.toSVGPath(),null}getLastElement(){return this.#i.at(-1)}setLastElement(t){return this.#i?(this.#i.push(t),this.#e=t.line,this.#n=t.points,this.#o=0,{path:{d:this.toSVGPath()}}):this.#h.setLastElement(t)}removeLastElement(){if(!this.#i)return this.#h.removeLastElement();this.#i.pop(),this.#l="";for(let t=0,e=this.#i.length;t<e;t++){let{line:i,points:s}=this.#i[t];this.#e=i,this.#n=s,this.#o=0,this.toSVGPath()}return{path:{d:this.#l}}}toSVGPath(){let t=S.svgRound(this.#e[4]),e=S.svgRound(this.#e[5]);if(this.#n.length===2)return this.#l=`${this.#l} M ${t} ${e} Z`,this.#l;if(this.#n.length<=6){let s=this.#l.lastIndexOf("M");this.#l=`${this.#l.slice(0,s)} M ${t} ${e}`,this.#o=6}if(this.#n.length===4){let s=S.svgRound(this.#e[10]),n=S.svgRound(this.#e[11]);return this.#l=`${this.#l} L ${s} ${n}`,this.#o=12,this.#l}let i=[];this.#o===0&&(i.push(`M ${t} ${e}`),this.#o=6);for(let s=this.#o,n=this.#e.length;s<n;s+=6){let[a,o,l,c,h,d]=this.#e.slice(s,s+6).map(S.svgRound);i.push(`C${a} ${o} ${l} ${c} ${h} ${d}`)}return this.#l+=i.join(" "),this.#o=this.#e.length,this.#l}getOutlines(t,e,i,s){let n=this.#i.at(-1);return n.line=new Float32Array(n.line),n.points=new Float32Array(n.points),this.#h.build(this.#i,t,e,i,this.#s,this.#r,s),this.#t=null,this.#e=null,this.#i=null,this.#l=null,this.#h}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}},Ui=class r extends S{#t;#e=0;#i;#s;#r;#n;#l;#o;#h;build(t,e,i,s,n,a,o){this.#r=e,this.#n=i,this.#l=s,this.#o=n,this.#h=a,this.#i=o??0,this.#s=t,this.#d()}setLastElement(t){return this.#s.push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return this.#s.pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){let t=[];for(let{line:e}of this.#s){if(t.push(`M${S.svgRound(e[4])} ${S.svgRound(e[5])}`),e.length===6){t.push("Z");continue}if(e.length===12){t.push(`L${S.svgRound(e[10])} ${S.svgRound(e[11])}`);continue}for(let i=6,s=e.length;i<s;i+=6){let[n,a,o,l,c,h]=e.subarray(i,i+6).map(S.svgRound);t.push(`C${n} ${a} ${o} ${l} ${c} ${h}`)}}return t.join("")}serialize([t,e,i,s],n){let a=[],o=[],[l,c,h,d]=this.#u(),u,f,p,g,b,m,_,y,v;switch(this.#o){case 0:v=S._rescale,u=t,f=e+s,p=i,g=-s,b=t+l*i,m=e+(1-c-d)*s,_=t+(l+h)*i,y=e+(1-c)*s;break;case 90:v=S._rescaleAndSwap,u=t,f=e,p=i,g=s,b=t+c*i,m=e+l*s,_=t+(c+d)*i,y=e+(l+h)*s;break;case 180:v=S._rescale,u=t+i,f=e,p=-i,g=s,b=t+(1-l-h)*i,m=e+c*s,_=t+(1-l)*i,y=e+(c+d)*s;break;case 270:v=S._rescaleAndSwap,u=t+i,f=e+s,p=-i,g=-s,b=t+(1-c-d)*i,m=e+(1-l-h)*s,_=t+(1-c)*i,y=e+(1-l)*s;break}for(let{line:A,points:E}of this.#s)a.push(v(A,u,f,p,g,n?new Array(A.length):null)),o.push(v(E,u,f,p,g,n?new Array(E.length):null));return{lines:a,points:o,rect:[b,m,_,y]}}static deserialize(t,e,i,s,n,{paths:{lines:a,points:o},rotation:l,thickness:c}){let h=[],d,u,f,p,g;switch(l){case 0:g=S._rescale,d=-t/i,u=e/s+1,f=1/i,p=-1/s;break;case 90:g=S._rescaleAndSwap,d=-e/s,u=-t/i,f=1/s,p=1/i;break;case 180:g=S._rescale,d=t/i+1,u=-e/s,f=-1/i,p=1/s;break;case 270:g=S._rescaleAndSwap,d=e/s+1,u=t/i+1,f=-1/s,p=-1/i;break}if(!a){a=[];for(let m of o){let _=m.length;if(_===2){a.push(new Float32Array([NaN,NaN,NaN,NaN,m[0],m[1]]));continue}if(_===4){a.push(new Float32Array([NaN,NaN,NaN,NaN,m[0],m[1],NaN,NaN,NaN,NaN,m[2],m[3]]));continue}let y=new Float32Array(3*(_-2));a.push(y);let[v,A,E,C]=m.subarray(0,4);y.set([NaN,NaN,NaN,NaN,v,A],0);for(let I=4;I<_;I+=2){let R=m[I],V=m[I+1];y.set(S.createBezierPoints(v,A,E,C,R,V),(I-2)*3),[v,A,E,C]=[E,C,R,V]}}}for(let m=0,_=a.length;m<_;m++)h.push({line:g(a[m].map(y=>y??NaN),d,u,f,p),points:g(o[m].map(y=>y??NaN),d,u,f,p)});let b=new r;return b.build(h,i,s,1,l,c,n),b}#c(t=this.#h){let e=this.#i+t/2*this.#l;return this.#o%180===0?[e/this.#r,e/this.#n]:[e/this.#n,e/this.#r]}#u(){let[t,e,i,s]=this.#t,[n,a]=this.#c(0);return[t+n,e+a,i-2*n,s-2*a]}#d(){let t=this.#t=new Float32Array([1/0,1/0,-1/0,-1/0]);for(let{line:s}of this.#s){if(s.length<=12){for(let o=4,l=s.length;o<l;o+=6){let[c,h]=s.subarray(o,o+2);t[0]=Math.min(t[0],c),t[1]=Math.min(t[1],h),t[2]=Math.max(t[2],c),t[3]=Math.max(t[3],h)}continue}let n=s[4],a=s[5];for(let o=6,l=s.length;o<l;o+=6){let[c,h,d,u,f,p]=s.subarray(o,o+6);T.bezierBoundingBox(n,a,c,h,d,u,f,p,t),n=f,a=p}}let[e,i]=this.#c();t[0]=Math.min(1,Math.max(0,t[0]-e)),t[1]=Math.min(1,Math.max(0,t[1]-i)),t[2]=Math.min(1,Math.max(0,t[2]+e)),t[3]=Math.min(1,Math.max(0,t[3]+i)),t[2]-=t[0],t[3]-=t[1]}get box(){return this.#t}updateProperty(t,e){return t==="stroke-width"?this.#f(e):null}#f(t){let[e,i]=this.#c();this.#h=t;let[s,n]=this.#c(),[a,o]=[s-e,n-i],l=this.#t;return l[0]-=a,l[1]-=o,l[2]+=2*a,l[3]+=2*o,l}updateParentDimensions([t,e],i){let[s,n]=this.#c();this.#r=t,this.#n=e,this.#l=i;let[a,o]=this.#c(),l=a-s,c=o-n,h=this.#t;return h[0]-=l,h[1]-=c,h[2]+=2*l,h[3]+=2*c,h}updateRotation(t){return this.#e=t,{path:{transform:this.rotationTransform}}}get viewBox(){return this.#t.map(S.svgRound).join(" ")}get defaultProperties(){let[t,e]=this.#t;return{root:{viewBox:this.viewBox},path:{"transform-origin":`${S.svgRound(t)} ${S.svgRound(e)}`}}}get rotationTransform(){let[,,t,e]=this.#t,i=0,s=0,n=0,a=0,o=0,l=0;switch(this.#e){case 90:s=e/t,n=-t/e,o=t;break;case 180:i=-1,a=-1,o=t,l=e;break;case 270:s=-e/t,n=t/e,l=e;break;default:return""}return`matrix(${i} ${s} ${n} ${a} ${S.svgRound(o)} ${S.svgRound(l)})`}getPathResizingSVGProperties([t,e,i,s]){let[n,a]=this.#c(),[o,l,c,h]=this.#t;if(Math.abs(c-n)<=S.PRECISION||Math.abs(h-a)<=S.PRECISION){let g=t+i/2-(o+c/2),b=e+s/2-(l+h/2);return{path:{"transform-origin":`${S.svgRound(t)} ${S.svgRound(e)}`,transform:`${this.rotationTransform} translate(${g} ${b})`}}}let d=(i-2*n)/(c-2*n),u=(s-2*a)/(h-2*a),f=c/i,p=h/s;return{path:{"transform-origin":`${S.svgRound(o)} ${S.svgRound(l)}`,transform:`${this.rotationTransform} scale(${f} ${p}) translate(${S.svgRound(n)} ${S.svgRound(a)}) scale(${d} ${u}) translate(${S.svgRound(-n)} ${S.svgRound(-a)})`}}}getPathResizedSVGProperties([t,e,i,s]){let[n,a]=this.#c(),o=this.#t,[l,c,h,d]=o;if(o[0]=t,o[1]=e,o[2]=i,o[3]=s,Math.abs(h-n)<=S.PRECISION||Math.abs(d-a)<=S.PRECISION){let b=t+i/2-(l+h/2),m=e+s/2-(c+d/2);for(let{line:_,points:y}of this.#s)S._translate(_,b,m,_),S._translate(y,b,m,y);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${S.svgRound(t)} ${S.svgRound(e)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}let u=(i-2*n)/(h-2*n),f=(s-2*a)/(d-2*a),p=-u*(l+n)+t+n,g=-f*(c+a)+e+a;if(u!==1||f!==1||p!==0||g!==0)for(let{line:b,points:m}of this.#s)S._rescale(b,p,g,u,f,b),S._rescale(m,p,g,u,f,m);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${S.svgRound(t)} ${S.svgRound(e)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,e],i){let[s,n]=i,a=this.#t,o=t-a[0],l=e-a[1];if(this.#r===s&&this.#n===n)for(let{line:c,points:h}of this.#s)S._translate(c,o,l,c),S._translate(h,o,l,h);else{let c=this.#r/s,h=this.#n/n;this.#r=s,this.#n=n;for(let{line:d,points:u}of this.#s)S._rescale(d,o,l,c,h,d),S._rescale(u,o,l,c,h,u);a[2]*=c,a[3]*=h}return a[0]=t,a[1]=e,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${S.svgRound(t)} ${S.svgRound(e)}`}}}get defaultSVGProperties(){let t=this.#t;return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${S.svgRound(t[0])} ${S.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}},Qn=class r extends Kn{#t;constructor(t){super(),this.#t=t,super.updateProperties({fill:"none",stroke:W._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(t,e){t==="stroke-width"&&(e??=this["stroke-width"],e*=this.#t.realScale),super.updateSVGProperty(t,e)}clone(){let t=new r(this.#t);return t.updateAll(this),t}},Zn=class r extends al{static _type="ink";static _editorType=k.INK;static _defaultDrawingOptions=null;constructor(t){super(nt(X({},t),{name:"inkEditor"})),this._willKeepAspectRatio=!0}static initialize(t,e){W.initialize(t,e),this._defaultDrawingOptions=new Qn(e.viewParameters)}static getDefaultDrawingOptions(t){let e=this._defaultDrawingOptions.clone();return e.updateProperties(t),e}static get supportMultipleDrawings(){return!0}static get typesMap(){return O(this,"typesMap",new Map([[N.INK_THICKNESS,"stroke-width"],[N.INK_COLOR,"stroke"],[N.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,e,i,s,n){return new Jn(t,e,i,s,n,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,e,i,s,n,a){return Ui.deserialize(t,e,i,s,n,a)}static deserialize(t,e,i){return w(this,null,function*(){let s=null;if(t instanceof Ue){let{data:{inkLists:a,rect:o,rotation:l,id:c,color:h,opacity:d,borderStyle:{rawWidth:u},popupRef:f},parent:{page:{pageNumber:p}}}=t;s=t={annotationType:k.INK,color:Array.from(h),thickness:u,opacity:d,paths:{points:a},boxes:null,pageIndex:p-1,rect:o.slice(0),rotation:l,id:c,deleted:!1,popupRef:f}}let n=yield Zt(r,this,"deserialize").call(this,t,e,i);return n.annotationElementId=t.id||null,n._initialData=s,n})}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();let{_drawId:t,_drawingOptions:e,parent:i}=this;e.updateSVGProperty("stroke-width"),i.drawLayer.updateProperties(t,e.toSVGProperties())}static onScaleChangingWhenDrawing(){let t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:e,opacity:i}){this._drawingOptions=r.getDefaultDrawingOptions({stroke:T.makeHexColor(...t),"stroke-width":e,"stroke-opacity":i})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let{lines:e,points:i,rect:s}=this.serializeDraw(t),{_drawingOptions:{stroke:n,"stroke-opacity":a,"stroke-width":o}}=this,l={annotationType:k.INK,color:W._colorManager.convert(n),opacity:a,thickness:o,paths:{lines:e,points:i},pageIndex:this.pageIndex,rect:s,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?l:this.annotationElementId&&!this.#t(l)?null:(l.id=this.annotationElementId,l)}#t(t){let{color:e,thickness:i,opacity:s,pageIndex:n}=this._initialData;return this._hasBeenMoved||this._hasBeenResized||t.color.some((a,o)=>a!==e[o])||t.thickness!==i||t.opacity!==s||t.pageIndex!==n}renderAnnotationElement(t){let{points:e,rect:i}=this.serializeDraw(!1);return t.updateEdited({rect:i,thickness:this._drawingOptions["stroke-width"],points:e}),null}},tr=class r extends W{#t=null;#e=null;#i=null;#s=null;#r=null;#n="";#l=null;#o=null;#h=!1;#c=!1;static _type="stamp";static _editorType=k.STAMP;constructor(t){super(nt(X({},t),{name:"stampEditor"})),this.#s=t.bitmapUrl,this.#r=t.bitmapFile}static initialize(t,e){W.initialize(t,e)}static get supportedTypes(){return O(this,"supportedTypes",["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"].map(e=>`image/${e}`))}static get supportedTypesStr(){return O(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(t){return this.supportedTypes.includes(t)}static paste(t,e){e.pasteEditor(k.STAMP,{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(t){let e=t.get("hasAltText");return{hasAltText:e.get(!0)??0,hasNoAltText:e.get(!1)??0}}#u(t,e=!1){if(!t){this.remove();return}this.#t=t.bitmap,e||(this.#e=t.id,this.#h=t.isSvg),t.file&&(this.#n=t.file.name),this.#a()}#d(){if(this.#i=null,this._uiManager.enableWaiting(!1),!!this.#l){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#t){this._editToolbar.hide(),this._uiManager.editAltText(this,!0);return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#t){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}}mlGuessAltText(t=null,e=!0){return w(this,null,function*(){if(this.hasAltTextData())return null;let{mlManager:i}=this._uiManager;if(!i)throw new Error("No ML.");if(!(yield i.isEnabledFor("altText")))throw new Error("ML isn't enabled for alt text.");let{data:s,width:n,height:a}=t||this.copyCanvas(null,null,!0).imageData,o=yield i.guess({name:"altText",request:{data:s,width:n,height:a,channels:s.length/(n*a)}});if(!o)throw new Error("No response from the AI service.");if(o.error)throw new Error("Error from the AI service.");if(o.cancel)return null;if(!o.output)throw new Error("No valid response from the AI service.");let l=o.output;return yield this.setGuessedAltText(l),e&&!this.hasAltTextData()&&(this.altTextData={alt:l,decorative:!1}),l})}#f(){if(this.#e){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#e).then(i=>this.#u(i,!0)).finally(()=>this.#d());return}if(this.#s){let i=this.#s;this.#s=null,this._uiManager.enableWaiting(!0),this.#i=this._uiManager.imageManager.getFromUrl(i).then(s=>this.#u(s)).finally(()=>this.#d());return}if(this.#r){let i=this.#r;this.#r=null,this._uiManager.enableWaiting(!0),this.#i=this._uiManager.imageManager.getFromFile(i).then(s=>this.#u(s)).finally(()=>this.#d());return}let t=document.createElement("input");t.type="file",t.accept=r.supportedTypesStr;let e=this._uiManager._signal;this.#i=new Promise(i=>{t.addEventListener("change",()=>w(this,null,function*(){if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);let s=yield this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),this.#u(s)}i()}),{signal:e}),t.addEventListener("cancel",()=>{this.remove(),i()},{signal:e})}).finally(()=>this.#d()),t.click()}remove(){this.#e&&(this.#t=null,this._uiManager.imageManager.deleteId(this.#e),this.#l?.remove(),this.#l=null,this.#o&&(clearTimeout(this.#o),this.#o=null)),super.remove()}rebuild(){if(!this.parent){this.#e&&this.#f();return}super.rebuild(),this.div!==null&&(this.#e&&this.#l===null&&this.#f(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(this.#i||this.#t||this.#s||this.#r||this.#e)}get isResizable(){return!0}render(){if(this.div)return this.div;let t,e;if(this.width&&(t=this.x,e=this.y),super.render(),this.div.hidden=!0,this.div.setAttribute("role","figure"),this.addAltTextButton(),this.#t?this.#a():this.#f(),this.width&&!this.annotationElementId){let[i,s]=this.parentDimensions;this.setAt(t*i,e*s,this.width*i,this.height*s)}return this._uiManager.addShouldRescale(this),this.div}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;this.#o!==null&&clearTimeout(this.#o);let t=200;this.#o=setTimeout(()=>{this.#o=null,this.#m()},t)}#a(){let{div:t}=this,{width:e,height:i}=this.#t,[s,n]=this.pageDimensions,a=.75;if(this.width)e=this.width*s,i=this.height*n;else if(e>a*s||i>a*n){let h=Math.min(a*s/e,a*n/i);e*=h,i*=h}let[o,l]=this.parentDimensions;this.setDims(e*o/s,i*l/n),this._uiManager.enableWaiting(!1);let c=this.#l=document.createElement("canvas");c.setAttribute("role","img"),this.addContainer(c),this.width=e/s,this.height=i/n,this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),this.#m(),this.#c||(this.parent.addUndoableEditor(this),this.#c=!0),this._reportTelemetry({action:"inserted_image"}),this.#n&&c.setAttribute("aria-label",this.#n)}copyCanvas(t,e,i=!1){t||(t=224);let{width:s,height:n}=this.#t,a=new Fe,o=this.#t,l=s,c=n,h=null;if(e){if(s>e||n>e){let E=Math.min(e/s,e/n);l=Math.floor(s*E),c=Math.floor(n*E)}h=document.createElement("canvas");let u=h.width=Math.ceil(l*a.sx),f=h.height=Math.ceil(c*a.sy);this.#h||(o=this.#p(u,f));let p=h.getContext("2d");p.filter=this._uiManager.hcmFilter;let g="white",b="#cfcfd8";this._uiManager.hcmFilter!=="none"?b="black":window.matchMedia?.("(prefers-color-scheme: dark)").matches&&(g="#8f8f9d",b="#42414d");let m=15,_=m*a.sx,y=m*a.sy,v=new OffscreenCanvas(_*2,y*2),A=v.getContext("2d");A.fillStyle=g,A.fillRect(0,0,_*2,y*2),A.fillStyle=b,A.fillRect(0,0,_,y),A.fillRect(_,y,_,y),p.fillStyle=p.createPattern(v,"repeat"),p.fillRect(0,0,u,f),p.drawImage(o,0,0,o.width,o.height,0,0,u,f)}let d=null;if(i){let u,f;if(a.symmetric&&o.width<t&&o.height<t)u=o.width,f=o.height;else if(o=this.#t,s>t||n>t){let b=Math.min(t/s,t/n);u=Math.floor(s*b),f=Math.floor(n*b),this.#h||(o=this.#p(u,f))}let g=new OffscreenCanvas(u,f).getContext("2d",{willReadFrequently:!0});g.drawImage(o,0,0,o.width,o.height,0,0,u,f),d={width:u,height:f,data:g.getImageData(0,0,u,f).data}}return{canvas:h,width:l,height:c,imageData:d}}#p(t,e){let{width:i,height:s}=this.#t,n=i,a=s,o=this.#t;for(;n>2*t||a>2*e;){let l=n,c=a;n>2*t&&(n=n>=16384?Math.floor(n/2)-1:Math.ceil(n/2)),a>2*e&&(a=a>=16384?Math.floor(a/2)-1:Math.ceil(a/2));let h=new OffscreenCanvas(n,a);h.getContext("2d").drawImage(o,0,0,l,c,0,0,n,a),o=h.transferToImageBitmap()}return o}#m(){let[t,e]=this.parentDimensions,{width:i,height:s}=this,n=new Fe,a=Math.ceil(i*t*n.sx),o=Math.ceil(s*e*n.sy),l=this.#l;if(!l||l.width===a&&l.height===o)return;l.width=a,l.height=o;let c=this.#h?this.#t:this.#p(a,o),h=l.getContext("2d");h.filter=this._uiManager.hcmFilter,h.drawImage(c,0,0,c.width,c.height,0,0,a,o)}getImageForAltText(){return this.#l}#g(t){if(t){if(this.#h){let s=this._uiManager.imageManager.getSvgUrl(this.#e);if(s)return s}let e=document.createElement("canvas");return{width:e.width,height:e.height}=this.#t,e.getContext("2d").drawImage(this.#t,0,0),e.toDataURL()}if(this.#h){let[e,i]=this.pageDimensions,s=Math.round(this.width*e*Wt.PDF_TO_CSS_UNITS),n=Math.round(this.height*i*Wt.PDF_TO_CSS_UNITS),a=new OffscreenCanvas(s,n);return a.getContext("2d").drawImage(this.#t,0,0,this.#t.width,this.#t.height,0,0,s,n),a.transferToImageBitmap()}return structuredClone(this.#t)}static deserialize(t,e,i){return w(this,null,function*(){let s=null;if(t instanceof Vi){let{data:{rect:p,rotation:g,id:b,structParent:m,popupRef:_},container:y,parent:{page:{pageNumber:v}}}=t,A=y.querySelector("canvas"),E=i.imageManager.getFromCanvas(y.id,A);A.remove();let C=(yield e._structTree.getAriaAttributes(`${sr}${b}`))?.get("aria-label")||"";s=t={annotationType:k.STAMP,bitmapId:E.id,bitmap:E.bitmap,pageIndex:v-1,rect:p.slice(0),rotation:g,id:b,deleted:!1,accessibilityData:{decorative:!1,altText:C},isSvg:!1,structParent:m,popupRef:_}}let n=yield Zt(r,this,"deserialize").call(this,t,e,i),{rect:a,bitmap:o,bitmapUrl:l,bitmapId:c,isSvg:h,accessibilityData:d}=t;c&&i.imageManager.isValidId(c)?(n.#e=c,o&&(n.#t=o)):n.#s=l,n.#h=h;let[u,f]=n.pageDimensions;return n.width=(a[2]-a[0])/u,n.height=(a[3]-a[1])/f,n.annotationElementId=t.id||null,d&&(n.altTextData=d),n._initialData=s,n.#c=!!s,n})}serialize(t=!1,e=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let i={annotationType:k.STAMP,bitmapId:this.#e,pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:this.#h,structTreeParentId:this._structTreeParentId};if(t)return i.bitmapUrl=this.#g(!0),i.accessibilityData=this.serializeAltText(!0),i;let{decorative:s,altText:n}=this.serializeAltText(!1);if(!s&&n&&(i.accessibilityData={type:"Figure",alt:n}),this.annotationElementId){let o=this.#b(i);if(o.isSame)return null;o.isSameAltText?delete i.accessibilityData:i.accessibilityData.structParent=this._initialData.structParent??-1}if(i.id=this.annotationElementId,e===null)return i;e.stamps||=new Map;let a=this.#h?(i.rect[2]-i.rect[0])*(i.rect[3]-i.rect[1]):null;if(!e.stamps.has(this.#e))e.stamps.set(this.#e,{area:a,serialized:i}),i.bitmap=this.#g(!1);else if(this.#h){let o=e.stamps.get(this.#e);a>o.area&&(o.area=a,o.serialized.bitmap.close(),o.serialized.bitmap=this.#g(!1))}return i}#b(t){let{pageIndex:e,accessibilityData:{altText:i}}=this._initialData,s=t.pageIndex===e,n=(t.accessibilityData?.alt||"")===i;return{isSame:!this._hasBeenMoved&&!this._hasBeenResized&&s&&n,isSameAltText:n}}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}},ol=(()=>{class r{#t;#e=!1;#i=null;#s=null;#r=null;#n=new Map;#l=!1;#o=!1;#h=!1;#c=null;#u=null;#d=null;#f=null;#a;static _initialized=!1;static#p=new Map([qn,Zn,tr,ji].map(e=>[e._editorType,e]));constructor({uiManager:e,pageIndex:i,div:s,structTreeLayer:n,accessibilityManager:a,annotationLayer:o,drawLayer:l,textLayer:c,viewport:h,l10n:d}){let u=[...r.#p.values()];if(!r._initialized){r._initialized=!0;for(let f of u)f.initialize(d,e)}e.registerEditorTypes(u),this.#a=e,this.pageIndex=i,this.div=s,this.#t=a,this.#i=o,this.viewport=h,this.#d=c,this.drawLayer=l,this._structTree=n,this.#a.addLayer(this)}get isEmpty(){return this.#n.size===0}get isInvisible(){return this.isEmpty&&this.#a.getMode()===k.NONE}updateToolbar(e){this.#a.updateToolbar(e)}updateMode(e=this.#a.getMode()){switch(this.#_(),e){case k.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case k.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case k.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);let{classList:i}=this.div;for(let s of r.#p.values())i.toggle(`${s._type}Editing`,e===s._editorType);this.div.hidden=!1}hasTextLayer(e){return e===this.#d?.div}setEditingState(e){this.#a.setEditingState(e)}addCommands(e){this.#a.addCommands(e)}cleanUndoStack(e){this.#a.cleanUndoStack(e)}toggleDrawing(e=!1){this.div.classList.toggle("drawing",!e)}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(e=!1){this.#i?.div.classList.toggle("disabled",!e)}enable(){return w(this,null,function*(){this.#h=!0,this.div.tabIndex=0,this.togglePointerEvents(!0);let e=new Set;for(let s of this.#n.values())s.enableEditing(),s.show(!0),s.annotationElementId&&(this.#a.removeChangedExistingAnnotation(s),e.add(s.annotationElementId));if(!this.#i){this.#h=!1;return}let i=this.#i.getEditableAnnotations();for(let s of i){if(s.hide(),this.#a.isDeletedAnnotationElement(s.data.id)||e.has(s.data.id))continue;let n=yield this.deserialize(s);n&&(this.addOrRebuild(n),n.enableEditing())}this.#h=!1})}disable(){this.#o=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1);let e=new Map,i=new Map;for(let n of this.#n.values())if(n.disableEditing(),!!n.annotationElementId){if(n.serialize()!==null){e.set(n.annotationElementId,n);continue}else i.set(n.annotationElementId,n);this.getEditableAnnotation(n.annotationElementId)?.show(),n.remove()}if(this.#i){let n=this.#i.getEditableAnnotations();for(let a of n){let{id:o}=a.data;if(this.#a.isDeletedAnnotationElement(o))continue;let l=i.get(o);if(l){l.resetAnnotationElement(a),l.show(!1),a.show();continue}l=e.get(o),l&&(this.#a.addChangedExistingAnnotation(l),l.renderAnnotationElement(a)&&l.show(!1)),a.show()}}this.#_(),this.isEmpty&&(this.div.hidden=!0);let{classList:s}=this.div;for(let n of r.#p.values())s.remove(`${n._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),this.#o=!1}getEditableAnnotation(e){return this.#i?.getEditableAnnotation(e)||null}setActiveEditor(e){this.#a.getActive()!==e&&this.#a.setActiveEditor(e)}enableTextSelection(){if(this.div.tabIndex=-1,this.#d?.div&&!this.#f){this.#f=new AbortController;let e=this.#a.combinedSignal(this.#f);this.#d.div.addEventListener("pointerdown",this.#m.bind(this),{signal:e}),this.#d.div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0,this.#d?.div&&this.#f&&(this.#f.abort(),this.#f=null,this.#d.div.classList.remove("highlighting"))}#m(e){this.#a.unselectAll();let{target:i}=e;if(i===this.#d.div||(i.getAttribute("role")==="img"||i.classList.contains("endOfContent"))&&this.#d.div.contains(i)){let{isMac:s}=rt.platform;if(e.button!==0||e.ctrlKey&&s)return;this.#a.showAllEditors("highlight",!0,!0),this.#d.div.classList.add("free"),this.toggleDrawing(),ji.startHighlighting(this,this.#a.direction==="ltr",{target:this.#d.div,x:e.x,y:e.y}),this.#d.div.addEventListener("pointerup",()=>{this.#d.div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:this.#a._signal}),e.preventDefault()}}enableClick(){if(this.#s)return;this.#s=new AbortController;let e=this.#a.combinedSignal(this.#s);this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:e});let i=this.pointerup.bind(this);this.div.addEventListener("pointerup",i,{signal:e}),this.div.addEventListener("pointercancel",i,{signal:e})}disableClick(){this.#s?.abort(),this.#s=null}attach(e){this.#n.set(e.id,e);let{annotationElementId:i}=e;i&&this.#a.isDeletedAnnotationElement(i)&&this.#a.removeDeletedAnnotationElement(e)}detach(e){this.#n.delete(e.id),this.#t?.removePointerInTextLayer(e.contentDiv),!this.#o&&e.annotationElementId&&this.#a.addDeletedAnnotationElement(e)}remove(e){this.detach(e),this.#a.removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1}changeParent(e){e.parent!==this&&(e.parent&&e.annotationElementId&&(this.#a.addDeletedAnnotationElement(e.annotationElementId),W.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),e.parent?.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(!(e.parent===this&&e.isAttachedToDOM)){if(this.changeParent(e),this.#a.addEditor(e),this.attach(e),!e.isAttachedToDOM){let i=e.render();this.div.append(i),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(!this.#h),this.#a.addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){if(!e.isAttachedToDOM)return;let{activeElement:i}=document;e.div.contains(i)&&!this.#r&&(e._focusEventsAllowed=!1,this.#r=setTimeout(()=>{this.#r=null,e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this.#a._signal}),i.focus())},0)),e._structTreeParentId=this.#t?.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||=this,e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){let i=()=>e._uiManager.rebuild(e),s=()=>{e.remove()};this.addCommands({cmd:i,undo:s,mustExec:!1})}getNextId(){return this.#a.getId()}get#g(){return r.#p.get(this.#a.getMode())}combinedSignal(e){return this.#a.combinedSignal(e)}#b(e){let i=this.#g;return i?new i.prototype.constructor(e):null}canCreateNewEmptyEditor(){return this.#g?.canCreateNewEmptyEditor()}pasteEditor(e,i){this.#a.updateToolbar(e),this.#a.updateMode(e);let{offsetX:s,offsetY:n}=this.#v(),a=this.getNextId(),o=this.#b(X({parent:this,id:a,x:s,y:n,uiManager:this.#a,isCentered:!0},i));o&&this.add(o)}deserialize(e){return w(this,null,function*(){return(yield r.#p.get(e.annotationType??e.annotationEditorType)?.deserialize(e,this,this.#a))||null})}createAndAddNewEditor(e,i,s={}){let n=this.getNextId(),a=this.#b(X({parent:this,id:n,x:e.offsetX,y:e.offsetY,uiManager:this.#a,isCentered:i},s));return a&&this.add(a),a}#v(){let{x:e,y:i,width:s,height:n}=this.div.getBoundingClientRect(),a=Math.max(0,e),o=Math.max(0,i),l=Math.min(window.innerWidth,e+s),c=Math.min(window.innerHeight,i+n),h=(a+l)/2-e,d=(o+c)/2-i,[u,f]=this.viewport.rotation%180===0?[h,d]:[d,h];return{offsetX:u,offsetY:f}}addNewEditor(){this.createAndAddNewEditor(this.#v(),!0)}setSelected(e){this.#a.setSelected(e)}toggleSelected(e){this.#a.toggleSelected(e)}unselect(e){this.#a.unselect(e)}pointerup(e){let{isMac:i}=rt.platform;if(!(e.button!==0||e.ctrlKey&&i)&&e.target===this.div&&this.#l&&(this.#l=!1,!(this.#g?.isDrawer&&this.#g.supportMultipleDrawings))){if(!this.#e){this.#e=!0;return}if(this.#a.getMode()===k.STAMP){this.#a.unselectAll();return}this.createAndAddNewEditor(e,!1)}}pointerdown(e){if(this.#a.getMode()===k.HIGHLIGHT&&this.enableTextSelection(),this.#l){this.#l=!1;return}let{isMac:i}=rt.platform;if(e.button!==0||e.ctrlKey&&i||e.target!==this.div)return;if(this.#l=!0,this.#g?.isDrawer){this.startDrawingSession(e);return}let s=this.#a.getActive();this.#e=!s||s.isEmpty()}startDrawingSession(e){if(this.div.focus(),this.#c){this.#g.startDrawing(this,this.#a,!1,e);return}this.#a.setCurrentDrawingSession(this),this.#c=new AbortController;let i=this.#a.combinedSignal(this.#c);this.div.addEventListener("blur",({relatedTarget:s})=>{s&&!this.div.contains(s)&&(this.#u=null,this.commitOrRemove())},{signal:i}),this.#g.startDrawing(this,this.#a,!1,e)}pause(e){if(e){let{activeElement:i}=document;this.div.contains(i)&&(this.#u=i);return}this.#u&&setTimeout(()=>{this.#u?.focus(),this.#u=null},0)}endDrawingSession(e=!1){return this.#c?(this.#a.setCurrentDrawingSession(null),this.#c.abort(),this.#c=null,this.#u=null,this.#g.endDrawing(e)):null}findNewParent(e,i,s){let n=this.#a.findParent(i,s);return n===null||n===this?!1:(n.changeParent(e),!0)}commitOrRemove(){return this.#c?(this.endDrawingSession(),!0):!1}onScaleChanging(){this.#c&&this.#g.onScaleChangingWhenDrawing(this)}destroy(){this.commitOrRemove(),this.#a.getActive()?.parent===this&&(this.#a.commitOrRemove(),this.#a.setActiveEditor(null)),this.#r&&(clearTimeout(this.#r),this.#r=null);for(let e of this.#n.values())this.#t?.removePointerInTextLayer(e.contentDiv),e.setParent(null),e.isAttachedToDOM=!1,e.div.remove();this.div=null,this.#n.clear(),this.#a.removeLayer(this)}#_(){for(let e of this.#n.values())e.isEmpty()&&e.remove()}render({viewport:e}){this.viewport=e,ne(this.div,e);for(let i of this.#a.getEditors(this.pageIndex))this.add(i),i.rebuild();this.updateMode()}update({viewport:e}){this.#a.commitOrRemove(),this.#_();let i=this.viewport.rotation,s=e.rotation;if(this.viewport=e,ne(this.div,{rotation:s}),i!==s)for(let n of this.#n.values())n.rotate(s)}get pageDimensions(){let{pageWidth:e,pageHeight:i}=this.viewport.rawDims;return[e,i]}get scale(){return this.#a.viewParameters.realScale}}return r})(),er=class r{#t=null;#e=0;#i=new Map;#s=new Map;constructor({pageIndex:t}){this.pageIndex=t}setParent(t){if(!this.#t){this.#t=t;return}if(this.#t!==t){if(this.#i.size>0)for(let e of this.#i.values())e.remove(),t.append(e);this.#t=t}}static get _svgFactory(){return O(this,"_svgFactory",new Ge)}static#r(t,[e,i,s,n]){let{style:a}=t;a.top=`${100*i}%`,a.left=`${100*e}%`,a.width=`${100*s}%`,a.height=`${100*n}%`}#n(){let t=r._svgFactory.create(1,1,!0);return this.#t.append(t),t.setAttribute("aria-hidden",!0),t}#l(t,e){let i=r._svgFactory.createElement("clipPath");t.append(i);let s=`clip_${e}`;i.setAttribute("id",s),i.setAttribute("clipPathUnits","objectBoundingBox");let n=r._svgFactory.createElement("use");return i.append(n),n.setAttribute("href",`#${e}`),n.classList.add("clip"),s}#o(t,e){for(let[i,s]of Object.entries(e))s===null?t.removeAttribute(i):t.setAttribute(i,s)}draw(t,e=!1,i=!1){let s=this.#e++,n=this.#n(),a=r._svgFactory.createElement("defs");n.append(a);let o=r._svgFactory.createElement("path");a.append(o);let l=`path_p${this.pageIndex}_${s}`;o.setAttribute("id",l),o.setAttribute("vector-effect","non-scaling-stroke"),e&&this.#s.set(s,o);let c=i?this.#l(a,l):null,h=r._svgFactory.createElement("use");return n.append(h),h.setAttribute("href",`#${l}`),this.updateProperties(n,t),this.#i.set(s,n),{id:s,clipPathId:`url(#${c})`}}drawOutline(t,e){let i=this.#e++,s=this.#n(),n=r._svgFactory.createElement("defs");s.append(n);let a=r._svgFactory.createElement("path");n.append(a);let o=`path_p${this.pageIndex}_${i}`;a.setAttribute("id",o),a.setAttribute("vector-effect","non-scaling-stroke");let l;if(e){let d=r._svgFactory.createElement("mask");n.append(d),l=`mask_p${this.pageIndex}_${i}`,d.setAttribute("id",l),d.setAttribute("maskUnits","objectBoundingBox");let u=r._svgFactory.createElement("rect");d.append(u),u.setAttribute("width","1"),u.setAttribute("height","1"),u.setAttribute("fill","white");let f=r._svgFactory.createElement("use");d.append(f),f.setAttribute("href",`#${o}`),f.setAttribute("stroke","none"),f.setAttribute("fill","black"),f.setAttribute("fill-rule","nonzero"),f.classList.add("mask")}let c=r._svgFactory.createElement("use");s.append(c),c.setAttribute("href",`#${o}`),l&&c.setAttribute("mask",`url(#${l})`);let h=c.cloneNode();return s.append(h),c.classList.add("mainOutline"),h.classList.add("secondaryOutline"),this.updateProperties(s,t),this.#i.set(i,s),i}finalizeDraw(t,e){this.#s.delete(t),this.updateProperties(t,e)}updateProperties(t,e){if(!e)return;let{root:i,bbox:s,rootClass:n,path:a}=e,o=typeof t=="number"?this.#i.get(t):t;if(o){if(i&&this.#o(o,i),s&&r.#r(o,s),n){let{classList:l}=o;for(let[c,h]of Object.entries(n))l.toggle(c,h)}if(a){let c=o.firstChild.firstChild;this.#o(c,a)}}}updateParent(t,e){if(e===this)return;let i=this.#i.get(t);i&&(e.#t.append(i),this.#i.delete(t),e.#i.set(t,i))}remove(t){this.#s.delete(t),this.#t!==null&&(this.#i.get(t).remove(),this.#i.delete(t))}destroy(){this.#t=null;for(let t of this.#i.values())t.remove();this.#i.clear(),this.#s.clear()}};globalThis.pdfjsTestingUtils={HighlightOutliner:$e};var wc=P.AbortException,Cc=P.AnnotationEditorLayer,Ec=P.AnnotationEditorParamsType,Sc=P.AnnotationEditorType,xc=P.AnnotationEditorUIManager,Tc=P.AnnotationLayer,Mc=P.AnnotationMode,Ic=P.ColorPicker,Rc=P.DOMSVGFactory,Pc=P.DrawLayer,kc=P.FeatureTest,pa=P.GlobalWorkerOptions,Dc=P.ImageKind,Oc=P.InvalidPDFException,Fc=P.MissingPDFException,Lc=P.OPS,Nc=P.OutputScale,Vc=P.PDFDataRangeTransport,Bc=P.PDFDateString,Hc=P.PDFWorker,Gc=P.PasswordResponses,jc=P.PermissionFlag,Uc=P.PixelsPerInch,$c=P.RenderingCancelledException,zc=P.TextLayer,Wc=P.TouchManager,qc=P.UnexpectedResponseException,Xc=P.Util,Yc=P.VerbosityLevel,Kc=P.XfaLayer,Jc=P.build,Qc=P.createValidAbsoluteUrl,Zc=P.fetchData,ga=P.getDocument,th=P.getFilenameFromUrl,eh=P.getPdfFilenameFromUrl,ih=P.getXfaPageViewport,sh=P.isDataScheme,nh=P.isPdfFile,rh=P.noContextMenu,ah=P.normalizeUnicode,oh=P.setLayerDimensions,lh=P.shadow,ch=P.stopEvent,hh=P.version;var ma=["user","model","function","system"];var Qi=function(r){return r.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",r.STOP="STOP",r.MAX_TOKENS="MAX_TOKENS",r.SAFETY="SAFETY",r.RECITATION="RECITATION",r.LANGUAGE="LANGUAGE",r.BLOCKLIST="BLOCKLIST",r.PROHIBITED_CONTENT="PROHIBITED_CONTENT",r.SPII="SPII",r.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",r.OTHER="OTHER",r}(Qi||{});var st=class extends Error{constructor(t){super(`[GoogleGenerativeAI Error]: ${t}`)}},Xt=class extends st{constructor(t,e){super(t),this.response=e}},ts=class extends st{constructor(t,e,i,s){super(t),this.status=e,this.statusText=i,this.errorDetails=s}},Nt=class extends st{},es=class extends st{};var cl="https://generativelanguage.googleapis.com",hl="v1beta",dl="0.24.0",ul="genai-js",me=function(r){return r.GENERATE_CONTENT="generateContent",r.STREAM_GENERATE_CONTENT="streamGenerateContent",r.COUNT_TOKENS="countTokens",r.EMBED_CONTENT="embedContent",r.BATCH_EMBED_CONTENTS="batchEmbedContents",r}(me||{}),ar=class{constructor(t,e,i,s,n){this.model=t,this.task=e,this.apiKey=i,this.stream=s,this.requestOptions=n}toString(){var t,e;let i=((t=this.requestOptions)===null||t===void 0?void 0:t.apiVersion)||hl,n=`${((e=this.requestOptions)===null||e===void 0?void 0:e.baseUrl)||cl}/${i}/${this.model}:${this.task}`;return this.stream&&(n+="?alt=sse"),n}};function fl(r){let t=[];return r?.apiClient&&t.push(r.apiClient),t.push(`${ul}/${dl}`),t.join(" ")}function pl(r){return w(this,null,function*(){var t;let e=new Headers;e.append("Content-Type","application/json"),e.append("x-goog-api-client",fl(r.requestOptions)),e.append("x-goog-api-key",r.apiKey);let i=(t=r.requestOptions)===null||t===void 0?void 0:t.customHeaders;if(i){if(!(i instanceof Headers))try{i=new Headers(i)}catch(s){throw new Nt(`unable to convert customHeaders value ${JSON.stringify(i)} to Headers: ${s.message}`)}for(let[s,n]of i.entries()){if(s==="x-goog-api-key")throw new Nt(`Cannot set reserved header name ${s}`);if(s==="x-goog-api-client")throw new Nt(`Header name ${s} can only be set using the apiClient field`);e.append(s,n)}}return e})}function gl(r,t,e,i,s,n){return w(this,null,function*(){let a=new ar(r,t,e,i,n);return{url:a.toString(),fetchOptions:Object.assign(Object.assign({},yl(n)),{method:"POST",headers:yield pl(a),body:s})}})}function Ye(o,l,c,h,d){return w(this,arguments,function*(r,t,e,i,s,n={},a=fetch){let{url:u,fetchOptions:f}=yield gl(r,t,e,i,s,n);return ml(u,f,a)})}function ml(i,s){return w(this,arguments,function*(r,t,e=fetch){let n;try{n=yield e(r,t)}catch(a){bl(a,r)}return n.ok||(yield _l(n,r)),n})}function bl(r,t){let e=r;throw e.name==="AbortError"?(e=new es(`Request aborted when fetching ${t.toString()}: ${r.message}`),e.stack=r.stack):r instanceof ts||r instanceof Nt||(e=new st(`Error fetching from ${t.toString()}: ${r.message}`),e.stack=r.stack),e}function _l(r,t){return w(this,null,function*(){let e="",i;try{let s=yield r.json();e=s.error.message,s.error.details&&(e+=` ${JSON.stringify(s.error.details)}`,i=s.error.details)}catch{}throw new ts(`Error fetching from ${t.toString()}: [${r.status} ${r.statusText}] ${e}`,r.status,r.statusText,i)})}function yl(r){let t={};if(r?.signal!==void 0||r?.timeout>=0){let e=new AbortController;r?.timeout>=0&&setTimeout(()=>e.abort(),r.timeout),r?.signal&&r.signal.addEventListener("abort",()=>{e.abort()}),t.signal=e.signal}return t}function lr(r){return r.text=()=>{if(r.candidates&&r.candidates.length>0){if(r.candidates.length>1&&console.warn(`This response had ${r.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),Zi(r.candidates[0]))throw new Xt(`${Yt(r)}`,r);return vl(r)}else if(r.promptFeedback)throw new Xt(`Text not available. ${Yt(r)}`,r);return""},r.functionCall=()=>{if(r.candidates&&r.candidates.length>0){if(r.candidates.length>1&&console.warn(`This response had ${r.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),Zi(r.candidates[0]))throw new Xt(`${Yt(r)}`,r);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),ba(r)[0]}else if(r.promptFeedback)throw new Xt(`Function call not available. ${Yt(r)}`,r)},r.functionCalls=()=>{if(r.candidates&&r.candidates.length>0){if(r.candidates.length>1&&console.warn(`This response had ${r.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),Zi(r.candidates[0]))throw new Xt(`${Yt(r)}`,r);return ba(r)}else if(r.promptFeedback)throw new Xt(`Function call not available. ${Yt(r)}`,r)},r}function vl(r){var t,e,i,s;let n=[];if(!((e=(t=r.candidates)===null||t===void 0?void 0:t[0].content)===null||e===void 0)&&e.parts)for(let a of(s=(i=r.candidates)===null||i===void 0?void 0:i[0].content)===null||s===void 0?void 0:s.parts)a.text&&n.push(a.text),a.executableCode&&n.push("\n```"+a.executableCode.language+`
`+a.executableCode.code+"\n```\n"),a.codeExecutionResult&&n.push("\n```\n"+a.codeExecutionResult.output+"\n```\n");return n.length>0?n.join(""):""}function ba(r){var t,e,i,s;let n=[];if(!((e=(t=r.candidates)===null||t===void 0?void 0:t[0].content)===null||e===void 0)&&e.parts)for(let a of(s=(i=r.candidates)===null||i===void 0?void 0:i[0].content)===null||s===void 0?void 0:s.parts)a.functionCall&&n.push(a.functionCall);if(n.length>0)return n}var Al=[Qi.RECITATION,Qi.SAFETY,Qi.LANGUAGE];function Zi(r){return!!r.finishReason&&Al.includes(r.finishReason)}function Yt(r){var t,e,i;let s="";if((!r.candidates||r.candidates.length===0)&&r.promptFeedback)s+="Response was blocked",!((t=r.promptFeedback)===null||t===void 0)&&t.blockReason&&(s+=` due to ${r.promptFeedback.blockReason}`),!((e=r.promptFeedback)===null||e===void 0)&&e.blockReasonMessage&&(s+=`: ${r.promptFeedback.blockReasonMessage}`);else if(!((i=r.candidates)===null||i===void 0)&&i[0]){let n=r.candidates[0];Zi(n)&&(s+=`Candidate was blocked due to ${n.finishReason}`,n.finishMessage&&(s+=`: ${n.finishMessage}`))}return s}function qe(r){return this instanceof qe?(this.v=r,this):new qe(r)}function wl(r,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=e.apply(r,t||[]),s,n=[];return s={},a("next"),a("throw"),a("return"),s[Symbol.asyncIterator]=function(){return this},s;function a(u){i[u]&&(s[u]=function(f){return new Promise(function(p,g){n.push([u,f,p,g])>1||o(u,f)})})}function o(u,f){try{l(i[u](f))}catch(p){d(n[0][3],p)}}function l(u){u.value instanceof qe?Promise.resolve(u.value.v).then(c,h):d(n[0][2],u)}function c(u){o("next",u)}function h(u){o("throw",u)}function d(u,f){u(f),n.shift(),n.length&&o(n[0][0],n[0][1])}}var _a=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function Cl(r){let t=r.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),e=xl(t),[i,s]=e.tee();return{stream:Sl(i),response:El(s)}}function El(r){return w(this,null,function*(){let t=[],e=r.getReader();for(;;){let{done:i,value:s}=yield e.read();if(i)return lr(Tl(t));t.push(s)}})}function Sl(r){return wl(this,arguments,function*(){let e=r.getReader();for(;;){let{value:i,done:s}=yield qe(e.read());if(s)break;yield yield qe(lr(i))}})}function xl(r){let t=r.getReader();return new ReadableStream({start(i){let s="";return n();function n(){return t.read().then(({value:a,done:o})=>{if(o){if(s.trim()){i.error(new st("Failed to parse stream"));return}i.close();return}s+=a;let l=s.match(_a),c;for(;l;){try{c=JSON.parse(l[1])}catch{i.error(new st(`Error parsing JSON response: "${l[1]}"`));return}i.enqueue(c),s=s.substring(l[0].length),l=s.match(_a)}return n()}).catch(a=>{let o=a;throw o.stack=a.stack,o.name==="AbortError"?o=new es("Request aborted when reading from the stream"):o=new st("Error reading from the stream"),o})}}})}function Tl(r){let t=r[r.length-1],e={promptFeedback:t?.promptFeedback};for(let i of r){if(i.candidates){let s=0;for(let n of i.candidates)if(e.candidates||(e.candidates=[]),e.candidates[s]||(e.candidates[s]={index:s}),e.candidates[s].citationMetadata=n.citationMetadata,e.candidates[s].groundingMetadata=n.groundingMetadata,e.candidates[s].finishReason=n.finishReason,e.candidates[s].finishMessage=n.finishMessage,e.candidates[s].safetyRatings=n.safetyRatings,n.content&&n.content.parts){e.candidates[s].content||(e.candidates[s].content={role:n.content.role||"user",parts:[]});let a={};for(let o of n.content.parts)o.text&&(a.text=o.text),o.functionCall&&(a.functionCall=o.functionCall),o.executableCode&&(a.executableCode=o.executableCode),o.codeExecutionResult&&(a.codeExecutionResult=o.codeExecutionResult),Object.keys(a).length===0&&(a.text=""),e.candidates[s].content.parts.push(a)}s++}i.usageMetadata&&(e.usageMetadata=i.usageMetadata)}return e}function Ca(r,t,e,i){return w(this,null,function*(){let s=yield Ye(t,me.STREAM_GENERATE_CONTENT,r,!0,JSON.stringify(e),i);return Cl(s)})}function Ea(r,t,e,i){return w(this,null,function*(){let n=yield(yield Ye(t,me.GENERATE_CONTENT,r,!1,JSON.stringify(e),i)).json();return{response:lr(n)}})}function Sa(r){if(r!=null){if(typeof r=="string")return{role:"system",parts:[{text:r}]};if(r.text)return{role:"system",parts:[r]};if(r.parts)return r.role?r:{role:"system",parts:r.parts}}}function Xe(r){let t=[];if(typeof r=="string")t=[{text:r}];else for(let e of r)typeof e=="string"?t.push({text:e}):t.push(e);return Ml(t)}function Ml(r){let t={role:"user",parts:[]},e={role:"function",parts:[]},i=!1,s=!1;for(let n of r)"functionResponse"in n?(e.parts.push(n),s=!0):(t.parts.push(n),i=!0);if(i&&s)throw new st("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!i&&!s)throw new st("No content is provided for sending chat message.");return i?t:e}function Il(r,t){var e;let i={model:t?.model,generationConfig:t?.generationConfig,safetySettings:t?.safetySettings,tools:t?.tools,toolConfig:t?.toolConfig,systemInstruction:t?.systemInstruction,cachedContent:(e=t?.cachedContent)===null||e===void 0?void 0:e.name,contents:[]},s=r.generateContentRequest!=null;if(r.contents){if(s)throw new Nt("CountTokensRequest must have one of contents or generateContentRequest, not both.");i.contents=r.contents}else if(s)i=Object.assign(Object.assign({},i),r.generateContentRequest);else{let n=Xe(r);i.contents=[n]}return{generateContentRequest:i}}function ya(r){let t;return r.contents?t=r:t={contents:[Xe(r)]},r.systemInstruction&&(t.systemInstruction=Sa(r.systemInstruction)),t}function Rl(r){return typeof r=="string"||Array.isArray(r)?{content:Xe(r)}:r}var va=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],Pl={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function kl(r){let t=!1;for(let e of r){let{role:i,parts:s}=e;if(!t&&i!=="user")throw new st(`First content should be with role 'user', got ${i}`);if(!ma.includes(i))throw new st(`Each item should include role field. Got ${i} but valid roles are: ${JSON.stringify(ma)}`);if(!Array.isArray(s))throw new st("Content should have 'parts' property with an array of Parts");if(s.length===0)throw new st("Each Content should have at least one part");let n={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(let o of s)for(let l of va)l in o&&(n[l]+=1);let a=Pl[i];for(let o of va)if(!a.includes(o)&&n[o]>0)throw new st(`Content with role '${i}' can't contain '${o}' part`);t=!0}}function Aa(r){var t;if(r.candidates===void 0||r.candidates.length===0)return!1;let e=(t=r.candidates[0])===null||t===void 0?void 0:t.content;if(e===void 0||e.parts===void 0||e.parts.length===0)return!1;for(let i of e.parts)if(i===void 0||Object.keys(i).length===0||i.text!==void 0&&i.text==="")return!1;return!0}var wa="SILENT_ERROR",or=class{constructor(t,e,i,s={}){this.model=e,this.params=i,this._requestOptions=s,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=t,i?.history&&(kl(i.history),this._history=i.history)}getHistory(){return w(this,null,function*(){return yield this._sendPromise,this._history})}sendMessage(i){return w(this,arguments,function*(t,e={}){var s,n,a,o,l,c;yield this._sendPromise;let h=Xe(t),d={safetySettings:(s=this.params)===null||s===void 0?void 0:s.safetySettings,generationConfig:(n=this.params)===null||n===void 0?void 0:n.generationConfig,tools:(a=this.params)===null||a===void 0?void 0:a.tools,toolConfig:(o=this.params)===null||o===void 0?void 0:o.toolConfig,systemInstruction:(l=this.params)===null||l===void 0?void 0:l.systemInstruction,cachedContent:(c=this.params)===null||c===void 0?void 0:c.cachedContent,contents:[...this._history,h]},u=Object.assign(Object.assign({},this._requestOptions),e),f;return this._sendPromise=this._sendPromise.then(()=>Ea(this._apiKey,this.model,d,u)).then(p=>{var g;if(Aa(p.response)){this._history.push(h);let b=Object.assign({parts:[],role:"model"},(g=p.response.candidates)===null||g===void 0?void 0:g[0].content);this._history.push(b)}else{let b=Yt(p.response);b&&console.warn(`sendMessage() was unsuccessful. ${b}. Inspect response object for details.`)}f=p}),yield this._sendPromise,f})}sendMessageStream(i){return w(this,arguments,function*(t,e={}){var s,n,a,o,l,c;yield this._sendPromise;let h=Xe(t),d={safetySettings:(s=this.params)===null||s===void 0?void 0:s.safetySettings,generationConfig:(n=this.params)===null||n===void 0?void 0:n.generationConfig,tools:(a=this.params)===null||a===void 0?void 0:a.tools,toolConfig:(o=this.params)===null||o===void 0?void 0:o.toolConfig,systemInstruction:(l=this.params)===null||l===void 0?void 0:l.systemInstruction,cachedContent:(c=this.params)===null||c===void 0?void 0:c.cachedContent,contents:[...this._history,h]},u=Object.assign(Object.assign({},this._requestOptions),e),f=Ca(this._apiKey,this.model,d,u);return this._sendPromise=this._sendPromise.then(()=>f).catch(p=>{throw new Error(wa)}).then(p=>p.response).then(p=>{if(Aa(p)){this._history.push(h);let g=Object.assign({},p.candidates[0].content);g.role||(g.role="model"),this._history.push(g)}else{let g=Yt(p);g&&console.warn(`sendMessageStream() was unsuccessful. ${g}. Inspect response object for details.`)}}).catch(p=>{p.message!==wa&&console.error(p)}),f})}};function Dl(r,t,e,i){return w(this,null,function*(){return(yield Ye(t,me.COUNT_TOKENS,r,!1,JSON.stringify(e),i)).json()})}function Ol(r,t,e,i){return w(this,null,function*(){return(yield Ye(t,me.EMBED_CONTENT,r,!1,JSON.stringify(e),i)).json()})}function Fl(r,t,e,i){return w(this,null,function*(){let s=e.requests.map(a=>Object.assign(Object.assign({},a),{model:t}));return(yield Ye(t,me.BATCH_EMBED_CONTENTS,r,!1,JSON.stringify({requests:s}),i)).json()})}var is=class{constructor(t,e,i={}){this.apiKey=t,this._requestOptions=i,e.model.includes("/")?this.model=e.model:this.model=`models/${e.model}`,this.generationConfig=e.generationConfig||{},this.safetySettings=e.safetySettings||[],this.tools=e.tools,this.toolConfig=e.toolConfig,this.systemInstruction=Sa(e.systemInstruction),this.cachedContent=e.cachedContent}generateContent(i){return w(this,arguments,function*(t,e={}){var s;let n=ya(t),a=Object.assign(Object.assign({},this._requestOptions),e);return Ea(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(s=this.cachedContent)===null||s===void 0?void 0:s.name},n),a)})}generateContentStream(i){return w(this,arguments,function*(t,e={}){var s;let n=ya(t),a=Object.assign(Object.assign({},this._requestOptions),e);return Ca(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(s=this.cachedContent)===null||s===void 0?void 0:s.name},n),a)})}startChat(t){var e;return new or(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(e=this.cachedContent)===null||e===void 0?void 0:e.name},t),this._requestOptions)}countTokens(i){return w(this,arguments,function*(t,e={}){let s=Il(t,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),n=Object.assign(Object.assign({},this._requestOptions),e);return Dl(this.apiKey,this.model,s,n)})}embedContent(i){return w(this,arguments,function*(t,e={}){let s=Rl(t),n=Object.assign(Object.assign({},this._requestOptions),e);return Ol(this.apiKey,this.model,s,n)})}batchEmbedContents(i){return w(this,arguments,function*(t,e={}){let s=Object.assign(Object.assign({},this._requestOptions),e);return Fl(this.apiKey,this.model,t,s)})}};var wt=class{constructor(t){this.apiKey=t}getGenerativeModel(t,e){if(!t.model)throw new st("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new is(this.apiKey,t,e)}getGenerativeModelFromCachedContent(t,e,i){if(!t.name)throw new Nt("Cached content must contain a `name` field.");if(!t.model)throw new Nt("Cached content must contain a `model` field.");let s=["model","systemInstruction"];for(let a of s)if(e?.[a]&&t[a]&&e?.[a]!==t[a]){if(a==="model"){let o=e.model.startsWith("models/")?e.model.replace("models/",""):e.model,l=t.model.startsWith("models/")?t.model.replace("models/",""):t.model;if(o===l)continue}throw new Nt(`Different value for "${a}" specified in modelParams (${e[a]}) and cachedContent (${t[a]})`)}let n=Object.assign(Object.assign({},e),{model:t.model,tools:t.tools,toolConfig:t.toolConfig,systemInstruction:t.systemInstruction,cachedContent:t});return new is(this.apiKey,n,i)}};var ss=class r{generateAtsScore(t,e){let i,s;i=new wt(e),s=i.getGenerativeModel({model:"gemini-2.0-flash"});let n=`
          You are an **Applicant Tracking System (ATS) expert** specializing in **resume optimization**. Analyze the provided resume strictly for **ATS compatibility** and return the results **only in valid JSON format**. Ensure the analysis is based **solely on the resume content** without adding, inferring, or fabricating any details.

          The JSON response must strictly follow this format:

          {
            "name": "<Extracted name from the resume>",
            "email": "<Extracted email from the resume>",
            "phone": "<Extracted phone number from the resume>",
            "location": "<Extracted location if available>",
            "overall": <integer between 0-100, evaluating resume formatting, keyword structure, and ATS compatibility>,
            "overallComment": "<Brief assessment based on overall score>",
            "keywords": [<Array of detected keywords>],
            "missing_keywords": [<Array of important missing keywords relevant to the role>],
            "grammar_score": <integer between 0-100, evaluating grammar, spelling, and language quality>,
            "grammarScoreComment": "<Brief assessment based on grammar score>",
            "readability_score": <integer between 0-100, analyzing sentence complexity, bullet point usage, and clarity>,
            "readabilityScoreComment": "<Brief assessment based on readability score>",
            "tips": [
              {
                "title": "<Resume improvement tip>",
                "description": "<Short explanation of the tip based on resume content>"
              },
              {
                "title": "<Another resume improvement tip>",
                "description": "<Short explanation of the tip>"
              },
              ...
            ]
          }
         
          ### Example output:

          {
            "name": "John Doe",
            "email": "123@gmail.com",
            "phone": "123-456-7890",
            "location": "San Francisco, CA",
            "overall": 85,
            "keywords": ["javascript", "react", "node.js"],
            "missing_keywords": ["", ""],
            "grammar_score": 90,
            "readability_score":90,
            "tips":[{
              'title': 'Add Modern JavaScript Frameworks',
              'description': 'While your Angular experience is strong, many frontend positions now require experience with React or Vue.js. Consider adding these skills if you have any experience with them.',
            }]
          }

          ### **Guidelines:**  
          - Extract and return **only authentic** information present in the resume.  
          - Do **not** infer, assume, or fabricate any missing details.  
          - Provide **at least five actionable tips** for improving the resume.  
          - Ensure the **output is valid JSON** with no additional commentary, explanations, or formatting errors.  

          Now, analyze the resume and return the JSON response accordingly.

          **Resume Input:**  
          ${t}
         
          `;return It(s.generateContent(n)).pipe(Rt(a=>{let o=a.response.text();o=o.replace(/^```json|```$/g,""),o=o.replace(/,\s*([}\]])/g,"$1");try{return JSON.parse(o)}catch(l){throw console.error("Error parsing JSON:",l),new Error("Invalid JSON response from Gemini.")}}),Ht(a=>{throw console.error("Error generating ATS score:",a),new Error("Error analyzing resume with Gemini.")}))}static \u0275fac=function(e){return new(e||r)};static \u0275prov=vt({token:r,factory:r.\u0275fac,providedIn:"root"})};var ns=class r{constructor(){}validateToken(t){return w(this,null,function*(){try{return t?(yield new wt(t).getGenerativeModel({model:"gemini-2.0-flash"}).generateContent("test"),!0):!1}catch(e){return e&&e.message&&(e.message.includes("API key not valid")||e.message.includes("PERMISSION_DENIED"))||console.error("Error validating Gemini token:",e),!1}})}static \u0275fac=function(e){return new(e||r)};static \u0275prov=vt({token:r,factory:r.\u0275fac,providedIn:"root"})};var rs=class r{constructor(){}analyzeJobDescription(t,e,i){let n=new wt(i).getGenerativeModel({model:"gemini-2.0-flash"}),a=`
    You are an **experienced technical recruiter and job matching specialist**.

    Compare the provided **resume** with the **job description** and return a **structured analysis in valid JSON format**. Ensure that all results are derived **strictly from the input** without any additional or fabricated information.

    The JSON response must follow this exact structure:

    {
      "name": "<Extracted name from the resume>",
      "email": "<Extracted email from the resume>",
      "phone": "<Extracted phone number from the resume>",
      "location": "<Extracted location if available>",
      "score": <integer between 0-100 representing overall match percentage based on job description and resume>,
      "scoreComments": "<Brief assessment based on the score>",
      "matching_skills": [<Array of skills that match both the job description and resume>],
      "missing_skills": [<Array of required skills that are missing in the resume while comparing with the job description>],
      "recommendations": [<Array of specific suggestions for improvement to increase the match score>],
      "relevance": <integer between 0-100 representing experience and skills relevance based on the job description and resume>,
      "relevanceComments": "<Brief assessment based on the relevance score>"
    }

    ### Example Output:

    {
      "name": "John Doe",
      "email": "123@gmail.com",
      "phone": "123-456-7890",
      "location": "India",
      "score": 75,
      "scoreComments": "You got a decent score. Consider improving alignment with the job requirements.",
      "matching_skills": ["JavaScript", "React", "AWS"],
      "missing_skills": ["Python", "Django"],
      "recommendations": [
        "Add experience with Python",
        "Highlight cloud deployment skills",
        "Improve keyword optimization for ATS",
        "Include specific project examples",
        "Refine technical skill descriptions"
      ],
      "relevance": 80,
      "relevanceComments": "Your background is highly relevant to this position. Your experience aligns well with the core requirements of the role."
    }

    ### **Guidelines:**  
    - Extract and compare **only authentic** details found in the **resume** and **job description**.  
    - Do **not** infer, assume, or fabricate any missing details.  
    - Provide **at least five actionable recommendations** to improve the match score.  
    - Ensure the **output is valid JSON** with no additional commentary, explanations, or formatting errors.  

    Now, analyze the match and return the JSON response accordingly.

    **Resume:**  
    ${t}

    **Job Description:**  
    ${e}
    `;return It(n.generateContent(a)).pipe(Rt(o=>{let l=o.response.text();l=l.replace(/^```json|```$/g,""),l=l.replace(/,\s*([}\]])/g,"$1");try{return JSON.parse(l)}catch(c){throw console.error("Error parsing JSON:",c),new Error("Invalid JSON response from Gemini.")}}),Ht(o=>{throw console.error("Error analyzing job description:",o),new Error("Error analyzing job description with Gemini.")}))}static \u0275fac=function(e){return new(e||r)};static \u0275prov=vt({token:r,factory:r.\u0275fac,providedIn:"root"})};var as=class r{constructor(){}generateResumeFormatScore(t,e){let s=new wt(e).getGenerativeModel({model:"gemini-2.0-flash"}),n=`
            You are an **expert in resume structure analysis**, specializing in **format and organization**.

            Analyze the **structure and formatting** of the provided resume and return a **structured assessment in valid JSON format**. Ensure that all results are **strictly based on the input**, without any inferred or fabricated information.

            The JSON response must follow this exact format:

            {
              "name": "<Extracted name from the resume>",
              "email": "<Extracted email from the resume>",
              "location": "<Extracted location from the resume>",
              "phone": "<Extracted phone number from the resume>",
              "completeness": <integer between 0-100 representing how complete the resume is>,
              "completenessComments": "<Brief assessment based on the completeness score>",
              "sections_present": [<Array of detected resume sections>],
              "sections_missing": [<Array of important missing sections that could improve visibility to recruiters>],
              "suggestions": [<Array of formatting and structure improvements that will enhance the resume>],
              "readability": <integer between 0-100 representing how readable the resume is>,
              "readabilityComments": "<Brief assessment based on the readability score>"
            }

            ### Example Output:

            {
              "name": "John Doe",
              "email": "123@gmail.com",
              "phone": "123-456-7890",
              "location": "India",
              "completeness": 85,
              "completenessComments": "Your resume includes most essential sections. Adding a few more could make it more comprehensive.",
              "readability": 90,
              "readabilityComments": "Your resume is well-structured and easy to read. Minor formatting improvements could further enhance readability.",
              "sections_present": ["Summary", "Experience", "Education", "Skills"],
              "sections_missing": ["Projects", "Certifications"],
              "suggestions": [
                "Add a Projects section to showcase hands-on work",
                "Make section headers more prominent",
                "Ensure consistent formatting for bullet points",
                "Use a professional font for better readability",
                "Optimize spacing and alignment for a cleaner layout"
              ]
            }

            ### **Guidelines:**  
            - Identify **only the sections explicitly present** in the resume.  
            - Do **not** infer missing sections unless they are **clearly absent** from the input.  
            - Provide **at least five actionable suggestions** for improving the structure.  
            - Ensure that **readability and completeness scores** are based **only on detected content**.  
            - Return **valid JSON output** without any additional text, explanations, or formatting errors.  

            Now, analyze the resume and return the JSON response accordingly.

            **Resume Input:**  
              ${t}

            `;return It(s.generateContent(n)).pipe(Rt(a=>{let o=a.response.text();o=o.replace(/^```json|```$/g,""),o=o.replace(/,\s*([}\]])/g,"$1");try{return JSON.parse(o)}catch(l){throw console.error("Error parsing JSON:",l),new Error("Invalid JSON response from Gemini.")}}),Ht(a=>{throw console.error("Error analyzing resume format:",a),new Error("Error analyzing resume format with Gemini.")}))}static \u0275fac=function(e){return new(e||r)};static \u0275prov=vt({token:r,factory:r.\u0275fac,providedIn:"root"})};var os=class r{constructor(){}generateFeedback(t,e,i,s,n,a){let l=new wt(a).getGenerativeModel({model:"gemini-2.0-flash"}),c=`
          You are a **senior career coach and resume expert** with extensive experience in **talent acquisition**.

          Analyze the provided **resume** against the **job description** and deliver a **structured evaluation in valid JSON format**. Ensure that all results are **strictly based on the input**, without any inferred or fabricated details.

          ---

          ### **Input Data:**
          **RESUME:**  
          ${t}

          **JOB DESCRIPTION:**  
          ${e}

          ### **Analysis Metrics:**  
          - **ATS Score:** ${i.overall}/100  
          - **Job Match Score:** ${s.score}/100  
          - **Structure Score:** ${n.completeness}/100  

          ### **Key Findings:**  
          - **Detected Keywords:** ${i.keywords.join(", ")}  
          - **Missing Keywords:** ${i.missing_keywords.join(", ")}  
          - **Matching Skills:** ${s.matching_skills.join(", ")}  
          - **Missing Skills:** ${s.missing_skills.join(", ")}  
          - **Present Sections:** ${n.sections_present.join(", ")}  
          - **Missing Sections:** ${n.sections_missing.join(", ")}  

          ---

          ### **Guidelines:**  
          - Extract insights **only** from the **provided resume and job description**\u2014do **not** assume or fabricate missing details.  
          - Ensure that **scores, strengths, weaknesses, and recommendations** are based **strictly on detected content**.  
          - Provide **valid JSON output** with **no additional commentary, explanations, or formatting errors**.  

          ---

          ### **Expected JSON Output Format:**

          json
          {
            "overall_score": <integer between 0-100 based on input>,
            "overall_scoreComments": "<Comments based on the overall score>",
            "summary": "<Concise 2-3 sentence overview of the resume's fitness for the role>",
            "strengths": [<Array of 5 key strengths identified in the resume>],
            "weaknesses": [<Array of 5 main areas needing improvement>],
            "action_items": [<Array of 5 specific, actionable steps to improve the resume>],
            "improvement_plan": "<Structured paragraph describing the recommended approach to enhance the resume>"
          }


          ---

          ### **Example Output:**

          {
            "overall_score": 20,
            "overall_scoreComments": "Your combined resume evaluation score based on all factors needs improvement.",
            "summary": "The resume partially aligns with the role but lacks key industry-specific skills and structure.",
            "strengths": ["Expertise in data analysis", "Strong communication skills"],
            "weaknesses": ["Lack of industry-specific knowledge", "Limited project management experience"],
            "action_items": [
              "Take a course on industry-specific data analysis",
              "Improve project management skills",
              "Refine the resume structure for better readability",
              "Add measurable achievements under experience",
              "Optimize keywords for better ATS compatibility"
            ],
            "improvement_plan": "To improve the resume, focus on gaining deeper knowledge in relevant fields, enhancing soft skills such as communication, and restructuring sections to improve readability and keyword optimization."
          }

          Now, analyze the resume and return the JSON response accordingly.
          `;return It(l.generateContent(c)).pipe(Rt(h=>{let d=h.response.text();d=d.replace(/^```json|```$/g,""),d=d.replace(/,\s*([}\]])/g,"$1");try{return JSON.parse(d)}catch(u){throw console.error("Error parsing JSON:",u),new Error("Invalid JSON response from Gemini.")}}),Ht(h=>{throw console.error("Error generating feedback:",h),new Error("Error generating feedback with Gemini.")}))}static \u0275fac=function(e){return new(e||r)};static \u0275prov=vt({token:r,factory:r.\u0275fac,providedIn:"root"})};var Oa=(()=>{class r{_renderer;_elementRef;onChange=e=>{};onTouched=()=>{};constructor(e,i){this._renderer=e,this._elementRef=i}setProperty(e,i){this._renderer.setProperty(this._elementRef.nativeElement,e,i)}registerOnTouched(e){this.onTouched=e}registerOnChange(e){this.onChange=e}setDisabledState(e){this.setProperty("disabled",e)}static \u0275fac=function(i){return new(i||r)($(Es),$(Cs))};static \u0275dir=kt({type:r})}return r})(),Ll=(()=>{class r extends Oa{static \u0275fac=(()=>{let e;return function(s){return(e||(e=Mr(r)))(s||r)}})();static \u0275dir=kt({type:r,features:[Gt]})}return r})(),gr=new te("");var Nl={provide:gr,useExisting:Ae(()=>bs),multi:!0};function Vl(){let r=Rs()?Rs().getUserAgent():"";return/android (\d+)/.test(r.toLowerCase())}var Bl=new te(""),bs=(()=>{class r extends Oa{_compositionMode;_composing=!1;constructor(e,i,s){super(e,i),this._compositionMode=s,this._compositionMode==null&&(this._compositionMode=!Vl())}writeValue(e){let i=e??"";this.setProperty("value",i)}_handleInput(e){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(e)}_compositionStart(){this._composing=!0}_compositionEnd(e){this._composing=!1,this._compositionMode&&this.onChange(e)}static \u0275fac=function(i){return new(i||r)($(Es),$(Cs),$(Bl,8))};static \u0275dir=kt({type:r,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(i,s){i&1&&ht("input",function(a){return s._handleInput(a.target.value)})("blur",function(){return s.onTouched()})("compositionstart",function(){return s._compositionStart()})("compositionend",function(a){return s._compositionEnd(a.target.value)})},standalone:!1,features:[Ce([Nl]),Gt]})}return r})();function mr(r){return r==null||br(r)===0}function br(r){return r==null?null:Array.isArray(r)||typeof r=="string"?r.length:r instanceof Set?r.size:null}var _r=new te(""),yr=new te(""),Hl=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,cs=class{static min(t){return Gl(t)}static max(t){return jl(t)}static required(t){return Ul(t)}static requiredTrue(t){return $l(t)}static email(t){return zl(t)}static minLength(t){return Wl(t)}static maxLength(t){return ql(t)}static pattern(t){return Xl(t)}static nullValidator(t){return Fa()}static compose(t){return Ga(t)}static composeAsync(t){return Ua(t)}};function Gl(r){return t=>{if(t.value==null||r==null)return null;let e=parseFloat(t.value);return!isNaN(e)&&e<r?{min:{min:r,actual:t.value}}:null}}function jl(r){return t=>{if(t.value==null||r==null)return null;let e=parseFloat(t.value);return!isNaN(e)&&e>r?{max:{max:r,actual:t.value}}:null}}function Ul(r){return mr(r.value)?{required:!0}:null}function $l(r){return r.value===!0?null:{required:!0}}function zl(r){return mr(r.value)||Hl.test(r.value)?null:{email:!0}}function Wl(r){return t=>{let e=t.value?.length??br(t.value);return e===null||e===0?null:e<r?{minlength:{requiredLength:r,actualLength:e}}:null}}function ql(r){return t=>{let e=t.value?.length??br(t.value);return e!==null&&e>r?{maxlength:{requiredLength:r,actualLength:e}}:null}}function Xl(r){if(!r)return Fa;let t,e;return typeof r=="string"?(e="",r.charAt(0)!=="^"&&(e+="^"),e+=r,r.charAt(r.length-1)!=="$"&&(e+="$"),t=new RegExp(e)):(e=r.toString(),t=r),i=>{if(mr(i.value))return null;let s=i.value;return t.test(s)?null:{pattern:{requiredPattern:e,actualValue:s}}}}function Fa(r){return null}function La(r){return r!=null}function Na(r){return Ir(r)?It(r):r}function Va(r){let t={};return r.forEach(e=>{t=e!=null?X(X({},t),e):t}),Object.keys(t).length===0?null:t}function Ba(r,t){return t.map(e=>e(r))}function Yl(r){return!r.validate}function Ha(r){return r.map(t=>Yl(t)?t:e=>t.validate(e))}function Ga(r){if(!r)return null;let t=r.filter(La);return t.length==0?null:function(e){return Va(Ba(e,t))}}function ja(r){return r!=null?Ga(Ha(r)):null}function Ua(r){if(!r)return null;let t=r.filter(La);return t.length==0?null:function(e){let i=Ba(e,t).map(Na);return ei(i).pipe(Rt(Va))}}function $a(r){return r!=null?Ua(Ha(r)):null}function xa(r,t){return r===null?[t]:Array.isArray(r)?[...r,t]:[r,t]}function za(r){return r._rawValidators}function Wa(r){return r._rawAsyncValidators}function cr(r){return r?Array.isArray(r)?r:[r]:[]}function hs(r,t){return Array.isArray(r)?r.includes(t):r===t}function Ta(r,t){let e=cr(t);return cr(r).forEach(s=>{hs(e,s)||e.push(s)}),e}function Ma(r,t){return cr(t).filter(e=>!hs(r,e))}var ds=class{get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators=[];_rawAsyncValidators=[];_setValidators(t){this._rawValidators=t||[],this._composedValidatorFn=ja(this._rawValidators)}_setAsyncValidators(t){this._rawAsyncValidators=t||[],this._composedAsyncValidatorFn=$a(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_onDestroyCallbacks=[];_registerOnDestroy(t){this._onDestroyCallbacks.push(t)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(t=>t()),this._onDestroyCallbacks=[]}reset(t=void 0){this.control&&this.control.reset(t)}hasError(t,e){return this.control?this.control.hasError(t,e):!1}getError(t,e){return this.control?this.control.getError(t,e):null}},oe=class extends ds{name;get formDirective(){return null}get path(){return null}},le=class extends ds{_parent=null;name=null;valueAccessor=null},us=class{_cd;constructor(t){this._cd=t}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}},Kl={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},td=nt(X({},Kl),{"[class.ng-submitted]":"isSubmitted"}),qa=(()=>{class r extends us{constructor(e){super(e)}static \u0275fac=function(i){return new(i||r)($(le,2))};static \u0275dir=kt({type:r,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(i,s){i&2&&jt("ng-untouched",s.isUntouched)("ng-touched",s.isTouched)("ng-pristine",s.isPristine)("ng-dirty",s.isDirty)("ng-valid",s.isValid)("ng-invalid",s.isInvalid)("ng-pending",s.isPending)},standalone:!1,features:[Gt]})}return r})(),Xa=(()=>{class r extends us{constructor(e){super(e)}static \u0275fac=function(i){return new(i||r)($(oe,10))};static \u0275dir=kt({type:r,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(i,s){i&2&&jt("ng-untouched",s.isUntouched)("ng-touched",s.isTouched)("ng-pristine",s.isPristine)("ng-dirty",s.isDirty)("ng-valid",s.isValid)("ng-invalid",s.isInvalid)("ng-pending",s.isPending)("ng-submitted",s.isSubmitted)},standalone:!1,features:[Gt]})}return r})();var Ke="VALID",ls="INVALID",be="PENDING",Je="DISABLED",Jt=class{},fs=class extends Jt{value;source;constructor(t,e){super(),this.value=t,this.source=e}},Qe=class extends Jt{pristine;source;constructor(t,e){super(),this.pristine=t,this.source=e}},Ze=class extends Jt{touched;source;constructor(t,e){super(),this.touched=t,this.source=e}},_e=class extends Jt{status;source;constructor(t,e){super(),this.status=t,this.source=e}},hr=class extends Jt{source;constructor(t){super(),this.source=t}},dr=class extends Jt{source;constructor(t){super(),this.source=t}};function vr(r){return(_s(r)?r.validators:r)||null}function Jl(r){return Array.isArray(r)?ja(r):r||null}function Ar(r,t){return(_s(t)?t.asyncValidators:r)||null}function Ql(r){return Array.isArray(r)?$a(r):r||null}function _s(r){return r!=null&&!Array.isArray(r)&&typeof r=="object"}function Ya(r,t,e){let i=r.controls;if(!(t?Object.keys(i):i).length)throw new ii(1e3,"");if(!i[e])throw new ii(1001,"")}function Ka(r,t,e){r._forEachChild((i,s)=>{if(e[s]===void 0)throw new ii(1002,"")})}var ye=class{_pendingDirty=!1;_hasOwnPendingAsyncValidator=null;_pendingTouched=!1;_onCollectionChange=()=>{};_updateOn;_parent=null;_asyncValidationSubscription;_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators;_rawAsyncValidators;value;constructor(t,e){this._assignValidators(t),this._assignAsyncValidators(e)}get validator(){return this._composedValidatorFn}set validator(t){this._rawValidators=this._composedValidatorFn=t}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(t){this._rawAsyncValidators=this._composedAsyncValidatorFn=t}get parent(){return this._parent}get status(){return Ut(this.statusReactive)}set status(t){Ut(()=>this.statusReactive.set(t))}_status=Ee(()=>this.statusReactive());statusReactive=we(void 0);get valid(){return this.status===Ke}get invalid(){return this.status===ls}get pending(){return this.status==be}get disabled(){return this.status===Je}get enabled(){return this.status!==Je}errors;get pristine(){return Ut(this.pristineReactive)}set pristine(t){Ut(()=>this.pristineReactive.set(t))}_pristine=Ee(()=>this.pristineReactive());pristineReactive=we(!0);get dirty(){return!this.pristine}get touched(){return Ut(this.touchedReactive)}set touched(t){Ut(()=>this.touchedReactive.set(t))}_touched=Ee(()=>this.touchedReactive());touchedReactive=we(!1);get untouched(){return!this.touched}_events=new Tr;events=this._events.asObservable();valueChanges;statusChanges;get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(t){this._assignValidators(t)}setAsyncValidators(t){this._assignAsyncValidators(t)}addValidators(t){this.setValidators(Ta(t,this._rawValidators))}addAsyncValidators(t){this.setAsyncValidators(Ta(t,this._rawAsyncValidators))}removeValidators(t){this.setValidators(Ma(t,this._rawValidators))}removeAsyncValidators(t){this.setAsyncValidators(Ma(t,this._rawAsyncValidators))}hasValidator(t){return hs(this._rawValidators,t)}hasAsyncValidator(t){return hs(this._rawAsyncValidators,t)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(t={}){let e=this.touched===!1;this.touched=!0;let i=t.sourceControl??this;this._parent&&!t.onlySelf&&this._parent.markAsTouched(nt(X({},t),{sourceControl:i})),e&&t.emitEvent!==!1&&this._events.next(new Ze(!0,i))}markAllAsTouched(t={}){this.markAsTouched({onlySelf:!0,emitEvent:t.emitEvent,sourceControl:this}),this._forEachChild(e=>e.markAllAsTouched(t))}markAsUntouched(t={}){let e=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let i=t.sourceControl??this;this._forEachChild(s=>{s.markAsUntouched({onlySelf:!0,emitEvent:t.emitEvent,sourceControl:i})}),this._parent&&!t.onlySelf&&this._parent._updateTouched(t,i),e&&t.emitEvent!==!1&&this._events.next(new Ze(!1,i))}markAsDirty(t={}){let e=this.pristine===!0;this.pristine=!1;let i=t.sourceControl??this;this._parent&&!t.onlySelf&&this._parent.markAsDirty(nt(X({},t),{sourceControl:i})),e&&t.emitEvent!==!1&&this._events.next(new Qe(!1,i))}markAsPristine(t={}){let e=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let i=t.sourceControl??this;this._forEachChild(s=>{s.markAsPristine({onlySelf:!0,emitEvent:t.emitEvent})}),this._parent&&!t.onlySelf&&this._parent._updatePristine(t,i),e&&t.emitEvent!==!1&&this._events.next(new Qe(!0,i))}markAsPending(t={}){this.status=be;let e=t.sourceControl??this;t.emitEvent!==!1&&(this._events.next(new _e(this.status,e)),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.markAsPending(nt(X({},t),{sourceControl:e}))}disable(t={}){let e=this._parentMarkedDirty(t.onlySelf);this.status=Je,this.errors=null,this._forEachChild(s=>{s.disable(nt(X({},t),{onlySelf:!0}))}),this._updateValue();let i=t.sourceControl??this;t.emitEvent!==!1&&(this._events.next(new fs(this.value,i)),this._events.next(new _e(this.status,i)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(nt(X({},t),{skipPristineCheck:e}),this),this._onDisabledChange.forEach(s=>s(!0))}enable(t={}){let e=this._parentMarkedDirty(t.onlySelf);this.status=Ke,this._forEachChild(i=>{i.enable(nt(X({},t),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent}),this._updateAncestors(nt(X({},t),{skipPristineCheck:e}),this),this._onDisabledChange.forEach(i=>i(!1))}_updateAncestors(t,e){this._parent&&!t.onlySelf&&(this._parent.updateValueAndValidity(t),t.skipPristineCheck||this._parent._updatePristine({},e),this._parent._updateTouched({},e))}setParent(t){this._parent=t}getRawValue(){return this.value}updateValueAndValidity(t={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let i=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Ke||this.status===be)&&this._runAsyncValidator(i,t.emitEvent)}let e=t.sourceControl??this;t.emitEvent!==!1&&(this._events.next(new fs(this.value,e)),this._events.next(new _e(this.status,e)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.updateValueAndValidity(nt(X({},t),{sourceControl:e}))}_updateTreeValidity(t={emitEvent:!0}){this._forEachChild(e=>e._updateTreeValidity(t)),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Je:Ke}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(t,e){if(this.asyncValidator){this.status=be,this._hasOwnPendingAsyncValidator={emitEvent:e!==!1};let i=Na(this.asyncValidator(this));this._asyncValidationSubscription=i.subscribe(s=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(s,{emitEvent:e,shouldHaveEmitted:t})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let t=this._hasOwnPendingAsyncValidator?.emitEvent??!1;return this._hasOwnPendingAsyncValidator=null,t}return!1}setErrors(t,e={}){this.errors=t,this._updateControlsErrors(e.emitEvent!==!1,this,e.shouldHaveEmitted)}get(t){let e=t;return e==null||(Array.isArray(e)||(e=e.split(".")),e.length===0)?null:e.reduce((i,s)=>i&&i._find(s),this)}getError(t,e){let i=e?this.get(e):this;return i&&i.errors?i.errors[t]:null}hasError(t,e){return!!this.getError(t,e)}get root(){let t=this;for(;t._parent;)t=t._parent;return t}_updateControlsErrors(t,e,i){this.status=this._calculateStatus(),t&&this.statusChanges.emit(this.status),(t||i)&&this._events.next(new _e(this.status,e)),this._parent&&this._parent._updateControlsErrors(t,e,i)}_initObservables(){this.valueChanges=new he,this.statusChanges=new he}_calculateStatus(){return this._allControlsDisabled()?Je:this.errors?ls:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(be)?be:this._anyControlsHaveStatus(ls)?ls:Ke}_anyControlsHaveStatus(t){return this._anyControls(e=>e.status===t)}_anyControlsDirty(){return this._anyControls(t=>t.dirty)}_anyControlsTouched(){return this._anyControls(t=>t.touched)}_updatePristine(t,e){let i=!this._anyControlsDirty(),s=this.pristine!==i;this.pristine=i,this._parent&&!t.onlySelf&&this._parent._updatePristine(t,e),s&&this._events.next(new Qe(this.pristine,e))}_updateTouched(t={},e){this.touched=this._anyControlsTouched(),this._events.next(new Ze(this.touched,e)),this._parent&&!t.onlySelf&&this._parent._updateTouched(t,e)}_onDisabledChange=[];_registerOnCollectionChange(t){this._onCollectionChange=t}_setUpdateStrategy(t){_s(t)&&t.updateOn!=null&&(this._updateOn=t.updateOn)}_parentMarkedDirty(t){let e=this._parent&&this._parent.dirty;return!t&&!!e&&!this._parent._anyControlsDirty()}_find(t){return null}_assignValidators(t){this._rawValidators=Array.isArray(t)?t.slice():t,this._composedValidatorFn=Jl(this._rawValidators)}_assignAsyncValidators(t){this._rawAsyncValidators=Array.isArray(t)?t.slice():t,this._composedAsyncValidatorFn=Ql(this._rawAsyncValidators)}},ps=class extends ye{constructor(t,e,i){super(vr(e),Ar(i,e)),this.controls=t,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}controls;registerControl(t,e){return this.controls[t]?this.controls[t]:(this.controls[t]=e,e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange),e)}addControl(t,e,i={}){this.registerControl(t,e),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}removeControl(t,e={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}setControl(t,e,i={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],e&&this.registerControl(t,e),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}contains(t){return this.controls.hasOwnProperty(t)&&this.controls[t].enabled}setValue(t,e={}){Ka(this,!0,t),Object.keys(t).forEach(i=>{Ya(this,!0,i),this.controls[i].setValue(t[i],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(t,e={}){t!=null&&(Object.keys(t).forEach(i=>{let s=this.controls[i];s&&s.patchValue(t[i],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(t={},e={}){this._forEachChild((i,s)=>{i.reset(t?t[s]:null,{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e,this),this._updateTouched(e,this),this.updateValueAndValidity(e)}getRawValue(){return this._reduceChildren({},(t,e,i)=>(t[i]=e.getRawValue(),t))}_syncPendingControls(){let t=this._reduceChildren(!1,(e,i)=>i._syncPendingControls()?!0:e);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_forEachChild(t){Object.keys(this.controls).forEach(e=>{let i=this.controls[e];i&&t(i,e)})}_setUpControls(){this._forEachChild(t=>{t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(t){for(let[e,i]of Object.entries(this.controls))if(this.contains(e)&&t(i))return!0;return!1}_reduceValue(){let t={};return this._reduceChildren(t,(e,i,s)=>((i.enabled||this.disabled)&&(e[s]=i.value),e))}_reduceChildren(t,e){let i=t;return this._forEachChild((s,n)=>{i=e(i,s,n)}),i}_allControlsDisabled(){for(let t of Object.keys(this.controls))if(this.controls[t].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(t){return this.controls.hasOwnProperty(t)?this.controls[t]:null}};var ur=class extends ps{};var ys=new te("",{providedIn:"root",factory:()=>vs}),vs="always";function Ja(r,t){return[...t.path,r]}function fr(r,t,e=vs){wr(r,t),t.valueAccessor.writeValue(r.value),(r.disabled||e==="always")&&t.valueAccessor.setDisabledState?.(r.disabled),tc(r,t),ic(r,t),ec(r,t),Zl(r,t)}function Ia(r,t,e=!0){let i=()=>{};t.valueAccessor&&(t.valueAccessor.registerOnChange(i),t.valueAccessor.registerOnTouched(i)),ms(r,t),r&&(t._invokeOnDestroyCallbacks(),r._registerOnCollectionChange(()=>{}))}function gs(r,t){r.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(t)})}function Zl(r,t){if(t.valueAccessor.setDisabledState){let e=i=>{t.valueAccessor.setDisabledState(i)};r.registerOnDisabledChange(e),t._registerOnDestroy(()=>{r._unregisterOnDisabledChange(e)})}}function wr(r,t){let e=za(r);t.validator!==null?r.setValidators(xa(e,t.validator)):typeof e=="function"&&r.setValidators([e]);let i=Wa(r);t.asyncValidator!==null?r.setAsyncValidators(xa(i,t.asyncValidator)):typeof i=="function"&&r.setAsyncValidators([i]);let s=()=>r.updateValueAndValidity();gs(t._rawValidators,s),gs(t._rawAsyncValidators,s)}function ms(r,t){let e=!1;if(r!==null){if(t.validator!==null){let s=za(r);if(Array.isArray(s)&&s.length>0){let n=s.filter(a=>a!==t.validator);n.length!==s.length&&(e=!0,r.setValidators(n))}}if(t.asyncValidator!==null){let s=Wa(r);if(Array.isArray(s)&&s.length>0){let n=s.filter(a=>a!==t.asyncValidator);n.length!==s.length&&(e=!0,r.setAsyncValidators(n))}}}let i=()=>{};return gs(t._rawValidators,i),gs(t._rawAsyncValidators,i),e}function tc(r,t){t.valueAccessor.registerOnChange(e=>{r._pendingValue=e,r._pendingChange=!0,r._pendingDirty=!0,r.updateOn==="change"&&Qa(r,t)})}function ec(r,t){t.valueAccessor.registerOnTouched(()=>{r._pendingTouched=!0,r.updateOn==="blur"&&r._pendingChange&&Qa(r,t),r.updateOn!=="submit"&&r.markAsTouched()})}function Qa(r,t){r._pendingDirty&&r.markAsDirty(),r.setValue(r._pendingValue,{emitModelToViewChange:!1}),t.viewToModelUpdate(r._pendingValue),r._pendingChange=!1}function ic(r,t){let e=(i,s)=>{t.valueAccessor.writeValue(i),s&&t.viewToModelUpdate(i)};r.registerOnChange(e),t._registerOnDestroy(()=>{r._unregisterOnChange(e)})}function sc(r,t){r==null,wr(r,t)}function nc(r,t){return ms(r,t)}function Za(r,t){if(!r.hasOwnProperty("model"))return!1;let e=r.model;return e.isFirstChange()?!0:!Object.is(t,e.currentValue)}function rc(r){return Object.getPrototypeOf(r.constructor)===Ll}function ac(r,t){r._syncPendingControls(),t.forEach(e=>{let i=e.control;i.updateOn==="submit"&&i._pendingChange&&(e.viewToModelUpdate(i._pendingValue),i._pendingChange=!1)})}function to(r,t){if(!t)return null;Array.isArray(t);let e,i,s;return t.forEach(n=>{n.constructor===bs?e=n:rc(n)?i=n:s=n}),s||i||e||null}function oc(r,t){let e=r.indexOf(t);e>-1&&r.splice(e,1)}function Ra(r,t){let e=r.indexOf(t);e>-1&&r.splice(e,1)}function Pa(r){return typeof r=="object"&&r!==null&&Object.keys(r).length===2&&"value"in r&&"disabled"in r}var ti=class extends ye{defaultValue=null;_onChange=[];_pendingValue;_pendingChange=!1;constructor(t=null,e,i){super(vr(e),Ar(i,e)),this._applyFormState(t),this._setUpdateStrategy(e),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),_s(e)&&(e.nonNullable||e.initialValueIsDefault)&&(Pa(t)?this.defaultValue=t.value:this.defaultValue=t)}setValue(t,e={}){this.value=this._pendingValue=t,this._onChange.length&&e.emitModelToViewChange!==!1&&this._onChange.forEach(i=>i(this.value,e.emitViewToModelChange!==!1)),this.updateValueAndValidity(e)}patchValue(t,e={}){this.setValue(t,e)}reset(t=this.defaultValue,e={}){this._applyFormState(t),this.markAsPristine(e),this.markAsUntouched(e),this.setValue(this.value,e),this._pendingChange=!1}_updateValue(){}_anyControls(t){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(t){this._onChange.push(t)}_unregisterOnChange(t){Ra(this._onChange,t)}registerOnDisabledChange(t){this._onDisabledChange.push(t)}_unregisterOnDisabledChange(t){Ra(this._onDisabledChange,t)}_forEachChild(t){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(t){Pa(t)?(this.value=this._pendingValue=t.value,t.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=t}};var lc=r=>r instanceof ti;var cc={provide:le,useExisting:Ae(()=>Cr)},ka=Promise.resolve(),Cr=(()=>{class r extends le{_changeDetectorRef;callSetDisabledState;control=new ti;static ngAcceptInputType_isDisabled;_registered=!1;viewModel;name="";isDisabled;model;options;update=new he;constructor(e,i,s,n,a,o){super(),this._changeDetectorRef=a,this.callSetDisabledState=o,this._parent=e,this._setValidators(i),this._setAsyncValidators(s),this.valueAccessor=to(this,n)}ngOnChanges(e){if(this._checkForErrors(),!this._registered||"name"in e){if(this._registered&&(this._checkName(),this.formDirective)){let i=e.name.previousValue;this.formDirective.removeControl({name:i,path:this._getPath(i)})}this._setUpControl()}"isDisabled"in e&&this._updateDisabled(e),Za(e,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){fr(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._checkName()}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(e){ka.then(()=>{this.control.setValue(e,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(e){let i=e.isDisabled.currentValue,s=i!==0&&Nr(i);ka.then(()=>{s&&!this.control.disabled?this.control.disable():!s&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(e){return this._parent?Ja(e,this._parent):[e]}static \u0275fac=function(i){return new(i||r)($(oe,9),$(_r,10),$(yr,10),$(gr,10),$(Lr,8),$(ys,8))};static \u0275dir=kt({type:r,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],standalone:!1,features:[Ce([cc]),Gt,ni]})}return r})();var eo=(()=>{class r{static \u0275fac=function(i){return new(i||r)};static \u0275dir=kt({type:r,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""],standalone:!1})}return r})();var io=new te("");var hc={provide:oe,useExisting:Ae(()=>Er)},Er=(()=>{class r extends oe{callSetDisabledState;get submitted(){return Ut(this._submittedReactive)}set submitted(e){this._submittedReactive.set(e)}_submitted=Ee(()=>this._submittedReactive());_submittedReactive=we(!1);_oldForm;_onCollectionChange=()=>this._updateDomValue();directives=[];form=null;ngSubmit=new he;constructor(e,i,s){super(),this.callSetDisabledState=s,this._setValidators(e),this._setAsyncValidators(i)}ngOnChanges(e){e.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(ms(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(e){let i=this.form.get(e.path);return fr(i,e,this.callSetDisabledState),i.updateValueAndValidity({emitEvent:!1}),this.directives.push(e),i}getControl(e){return this.form.get(e.path)}removeControl(e){Ia(e.control||null,e,!1),oc(this.directives,e)}addFormGroup(e){this._setUpFormContainer(e)}removeFormGroup(e){this._cleanUpFormContainer(e)}getFormGroup(e){return this.form.get(e.path)}addFormArray(e){this._setUpFormContainer(e)}removeFormArray(e){this._cleanUpFormContainer(e)}getFormArray(e){return this.form.get(e.path)}updateModel(e,i){this.form.get(e.path).setValue(i)}onSubmit(e){return this._submittedReactive.set(!0),ac(this.form,this.directives),this.ngSubmit.emit(e),this.form._events.next(new hr(this.control)),e?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(e=void 0){this.form.reset(e),this._submittedReactive.set(!1),this.form._events.next(new dr(this.form))}_updateDomValue(){this.directives.forEach(e=>{let i=e.control,s=this.form.get(e.path);i!==s&&(Ia(i||null,e),lc(s)&&(fr(s,e,this.callSetDisabledState),e.control=s))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(e){let i=this.form.get(e.path);sc(i,e),i.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(e){if(this.form){let i=this.form.get(e.path);i&&nc(i,e)&&i.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){wr(this.form,this),this._oldForm&&ms(this._oldForm,this)}static \u0275fac=function(i){return new(i||r)($(_r,10),$(yr,10),$(ys,8))};static \u0275dir=kt({type:r,selectors:[["","formGroup",""]],hostBindings:function(i,s){i&1&&ht("submit",function(a){return s.onSubmit(a)})("reset",function(){return s.onReset()})},inputs:{form:[0,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],standalone:!1,features:[Ce([hc]),Gt,ni]})}return r})();var dc={provide:le,useExisting:Ae(()=>Sr)},Sr=(()=>{class r extends le{_ngModelWarningConfig;_added=!1;viewModel;control;name=null;set isDisabled(e){}model;update=new he;static _ngModelWarningSentOnce=!1;_ngModelWarningSent=!1;constructor(e,i,s,n,a){super(),this._ngModelWarningConfig=a,this._parent=e,this._setValidators(i),this._setAsyncValidators(s),this.valueAccessor=to(this,n)}ngOnChanges(e){this._added||this._setUpControl(),Za(e,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}get path(){return Ja(this.name==null?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_setUpControl(){this.control=this.formDirective.addControl(this),this._added=!0}static \u0275fac=function(i){return new(i||r)($(oe,13),$(_r,10),$(yr,10),$(gr,10),$(io,8))};static \u0275dir=kt({type:r,selectors:[["","formControlName",""]],inputs:{name:[0,"formControlName","name"],isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"]},outputs:{update:"ngModelChange"},standalone:!1,features:[Ce([dc]),Gt,ni]})}return r})();var so=(()=>{class r{static \u0275fac=function(i){return new(i||r)};static \u0275mod=ri({type:r});static \u0275inj=si({})}return r})(),pr=class extends ye{constructor(t,e,i){super(vr(e),Ar(i,e)),this.controls=t,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}controls;at(t){return this.controls[this._adjustIndex(t)]}push(t,e={}){this.controls.push(t),this._registerControl(t),this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}insert(t,e,i={}){this.controls.splice(t,0,e),this._registerControl(e),this.updateValueAndValidity({emitEvent:i.emitEvent})}removeAt(t,e={}){let i=this._adjustIndex(t);i<0&&(i=0),this.controls[i]&&this.controls[i]._registerOnCollectionChange(()=>{}),this.controls.splice(i,1),this.updateValueAndValidity({emitEvent:e.emitEvent})}setControl(t,e,i={}){let s=this._adjustIndex(t);s<0&&(s=0),this.controls[s]&&this.controls[s]._registerOnCollectionChange(()=>{}),this.controls.splice(s,1),e&&(this.controls.splice(s,0,e),this._registerControl(e)),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(t,e={}){Ka(this,!1,t),t.forEach((i,s)=>{Ya(this,!1,s),this.at(s).setValue(i,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(t,e={}){t!=null&&(t.forEach((i,s)=>{this.at(s)&&this.at(s).patchValue(i,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(t=[],e={}){this._forEachChild((i,s)=>{i.reset(t[s],{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e,this),this._updateTouched(e,this),this.updateValueAndValidity(e)}getRawValue(){return this.controls.map(t=>t.getRawValue())}clear(t={}){this.controls.length<1||(this._forEachChild(e=>e._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:t.emitEvent}))}_adjustIndex(t){return t<0?t+this.length:t}_syncPendingControls(){let t=this.controls.reduce((e,i)=>i._syncPendingControls()?!0:e,!1);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_forEachChild(t){this.controls.forEach((e,i)=>{t(e,i)})}_updateValue(){this.value=this.controls.filter(t=>t.enabled||this.disabled).map(t=>t.value)}_anyControls(t){return this.controls.some(e=>e.enabled&&t(e))}_setUpControls(){this._forEachChild(t=>this._registerControl(t))}_allControlsDisabled(){for(let t of this.controls)if(t.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(t){t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)}_find(t){return this.at(t)??null}};function Da(r){return!!r&&(r.asyncValidators!==void 0||r.validators!==void 0||r.updateOn!==void 0)}var no=(()=>{class r{useNonNullable=!1;get nonNullable(){let e=new r;return e.useNonNullable=!0,e}group(e,i=null){let s=this._reduceControls(e),n={};return Da(i)?n=i:i!==null&&(n.validators=i.validator,n.asyncValidators=i.asyncValidator),new ps(s,n)}record(e,i=null){let s=this._reduceControls(e);return new ur(s,i)}control(e,i,s){let n={};return this.useNonNullable?(Da(i)?n=i:(n.validators=i,n.asyncValidators=s),new ti(e,nt(X({},n),{nonNullable:!0}))):new ti(e,i,s)}array(e,i,s){let n=e.map(a=>this._createControl(a));return new pr(n,i,s)}_reduceControls(e){let i={};return Object.keys(e).forEach(s=>{i[s]=this._createControl(e[s])}),i}_createControl(e){if(e instanceof ti)return e;if(e instanceof ye)return e;if(Array.isArray(e)){let i=e[0],s=e.length>1?e[1]:null,n=e.length>2?e[2]:null;return this.control(i,s,n)}else return this.control(e)}static \u0275fac=function(i){return new(i||r)};static \u0275prov=vt({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var ro=(()=>{class r{static withConfig(e){return{ngModule:r,providers:[{provide:ys,useValue:e.callSetDisabledState??vs}]}}static \u0275fac=function(i){return new(i||r)};static \u0275mod=ri({type:r});static \u0275inj=si({imports:[so]})}return r})(),ao=(()=>{class r{static withConfig(e){return{ngModule:r,providers:[{provide:io,useValue:e.warnOnNgModelWithFormControl??"always"},{provide:ys,useValue:e.callSetDisabledState??vs}]}}static \u0275fac=function(i){return new(i||r)};static \u0275mod=ri({type:r});static \u0275inj=si({imports:[so]})}return r})();var fc=["analyzeBtn"],pc=["fileInput"];function gc(r,t){r&1&&ct(0,"div",34)}function mc(r,t){r&1&&(L(0,"span"),j(1,"Validate Key"),B())}function bc(r,t){if(r&1){let e=Ss();L(0,"div",19)(1,"div",35)(2,"span"),j(3),B(),L(4,"button",36),ht("click",function(){Ct(e);let s=oi();return Et(s.removeFile())}),j(5,"\xD7"),B()()()}if(r&2){let e=oi();tt(3),Is(e.selectedFile.name)}}function _c(r,t){if(r&1&&(L(0,"p",37),j(1),B()),r&2){let e=oi();tt(),Is(e.errorMessage)}}function yc(r,t){r&1&&ct(0,"div",34)}function vc(r,t){r&1&&(L(0,"span"),j(1,"Analyze Resume"),B())}pa.workerSrc="pdf.worker.mjs";var As=class r{constructor(t){this.fb=t;this.apiKeyForm=this.fb.group({apiKey:["",[cs.required]]})}apiKeyForm;isValidateResumeLoading=!1;analysisLoading=!1;validationInfo={valid:!1,message:""};analyzeBtn;fileInput;selectedFile=null;errorMessage="";toastService=Pt(Ur);commonService=Pt(ns);atsService=Pt(ss);jdMatchService=Pt(rs);formatScoreService=Pt(as);overallScoreService=Pt(os);storageService=Pt(jr);router=Pt(Gr);extractedPdfContent="";jobDescription="";analysisOptions={ats_score:!0,match:!1,structure:!1,overall:!1};get apiKey(){return this.apiKeyForm.get("apiKey")}validateKey(){return w(this,null,function*(){this.isValidateResumeLoading=!0,this.validationInfo={valid:!1,message:""},(yield this.commonService.validateToken(this.apiKey?.value))?(this.validationInfo.valid=!0,this.validationInfo.message="Success: API key is valid",this.toastService.showSuccess("API key is valid","Success")):(this.validationInfo.valid=!1,this.validationInfo.message="Failure: API key is invalid",this.toastService.showError("Invalid API key ,Please try again","Failure")),this.isValidateResumeLoading=!1})}toggleOption(t){t==="overall"?this.analysisOptions={ats_score:!1,match:!1,structure:!1,overall:!this.analysisOptions.overall}:t==="ats_score"?this.analysisOptions={ats_score:!this.analysisOptions.ats_score,match:!1,structure:!1,overall:!1}:t==="match"?this.analysisOptions={ats_score:!1,match:!this.analysisOptions.match,structure:!1,overall:!1}:t==="structure"&&(this.analysisOptions={ats_score:!1,match:!1,structure:!this.analysisOptions.structure,overall:!1})}handleFile(t){let e=t.target;if(e.files&&e.files.length){let i=e.files[0];this.validateFile(i),this.readPdfContent(i)}setTimeout(()=>{e.value=""},0)}validateFile(t){if(this.errorMessage="",t.type!=="application/pdf"){this.errorMessage="Please upload a PDF file.";return}if(t.size>5*1024*1024){this.errorMessage="File size exceeds the 5MB limit.";return}this.selectedFile=t}removeFile(){this.toastService.showSuccess(`${this.selectedFile?.name} removed successfully`,"Success"),this.selectedFile=null}analyzeResume(){if(this.analysisLoading=!0,!this.validateForm()){this.analysisLoading=!1;return}let t;if(this.analysisOptions.ats_score)t=this.atsService.generateAtsScore(this.extractedPdfContent,this.apiKey.value);else if(this.analysisOptions.match)if(this.jobDescription.length)t=this.jdMatchService.analyzeJobDescription(this.extractedPdfContent,this.jobDescription,this.apiKey.value);else{this.toastService.showError("Job description required for matching","Validation"),this.analysisLoading=!1;return}else if(this.analysisOptions.structure)t=this.formatScoreService.generateResumeFormatScore(this.extractedPdfContent,this.apiKey.value);else if(this.analysisOptions.overall){if(!this.jobDescription.length){this.toastService.showError("Job description required for overall analysis","Validation"),this.analysisLoading=!1;return}t=ei({atsScore:this.atsService.generateAtsScore(this.extractedPdfContent,this.apiKey.value),jobMatch:this.jdMatchService.analyzeJobDescription(this.extractedPdfContent,this.jobDescription,this.apiKey.value),formatScore:this.formatScoreService.generateResumeFormatScore(this.extractedPdfContent,this.apiKey.value)})}else{this.toastService.showError("No analysis option selected","Validation"),this.analysisLoading=!1;return}t.subscribe({next:e=>{if(console.log("Analysis Result:",e),this.analysisOptions.overall)this.overallScoreService.generateFeedback(this.extractedPdfContent,this.jobDescription,e.atsScore,e.jobMatch,e.formatScore,this.apiKey.value).subscribe({next:i=>{console.log("Feedback Result:",i),this.storageService.setData("overall_score",{ats_score:e.atsScore,jd_score:e.jobMatch,format_score:e.formatScore,overall:i}),this.router.navigate(["/overall"]),this.toastService.showSuccess("Resume analysis complete!","Success"),this.analysisLoading=!1},error:i=>{console.error("Feedback analysis error:",i),this.toastService.showError("Feedback analysis failed","Failure"),this.analysisLoading=!1}});else{switch(!0){case!!this.analysisOptions.ats_score:this.storageService.setData("ats_score",e),this.router.navigate(["/ats"]);break;case!!this.analysisOptions.match:this.storageService.setData("jd_score",e),this.router.navigate(["/jd"]);break;case!!this.analysisOptions.structure:this.storageService.setData("format_score",e),this.router.navigate(["/format"]);break}this.toastService.showSuccess("Resume analysis complete!","Success"),this.analysisLoading=!1}},error:e=>{console.error("Analysis error:",e),this.toastService.showError("Resume analysis failed","Failure"),this.analysisLoading=!1}})}startAnimation(){this.analyzeBtn.nativeElement.style.animation="pulse 1s infinite"}stopAnimation(){this.analyzeBtn.nativeElement.style.animation=""}readPdfContent(t){return w(this,null,function*(){let e=new FileReader;e.onload=()=>w(this,null,function*(){let i=new Uint8Array(e.result),s=yield ga(i).promise;this.extractedPdfContent="";for(let n=1;n<=s.numPages;n++){let o=yield(yield s.getPage(n)).getTextContent();this.extractedPdfContent+=o.items.map(l=>l.str).join(" ")+`
`}console.log("PDF Content:",this.extractedPdfContent)}),e.readAsArrayBuffer(t)})}validateForm(){if(this.validationInfo.valid){if(!this.apiKey.value)this.toastService.showError("Enter API key","Validation");else if(!this.selectedFile)return this.toastService.showError("Please upload the resume","Validation"),!1}else return this.toastService.showError("Enter valid Api Key / Validate your api key before Submission","Validation"),!1;return!0}ngOnDestroy(){this.validationInfo={valid:!1,message:""}}static \u0275fac=function(e){return new(e||r)($(no))};static \u0275cmp=de({type:r,selectors:[["app-upload-section"]],viewQuery:function(e,i){if(e&1&&(xs(fc,5),xs(pc,5)),e&2){let s;Ts(s=Ms())&&(i.analyzeBtn=s.first),Ts(s=Ms())&&(i.fileInput=s.first)}},decls:72,vars:20,consts:[["fileInput",""],["analyzeBtn",""],["id","start",1,"upload-section"],[1,"container"],["href","https://aistudio.google.com/app/apikey","target","_blank"],["aria-hidden","true","data-tooltip","Click the icon to generate free API key",1,"fa","fa-info-circle"],[3,"ngSubmit","formGroup"],[1,"form-group"],[1,"input-wrapper"],["type","password","formControlName","apiKey","placeholder","Enter your API key","autocomplete","off"],[1,"message",3,"ngClass"],["type","submit",1,"button",3,"disabled"],["class","spinner",4,"ngIf"],[4,"ngIf"],[1,"upload-container"],[1,"upload-box","glass"],[1,"file-upload",3,"click"],[1,"fas","fa-file-upload"],["type","file","accept",".pdf","hidden","",3,"change"],[1,"file-chips"],["class","error-message",4,"ngIf"],[1,"job-description","glass"],["placeholder","Paste the job description here to analyze the match between your resume and the role...",3,"ngModelChange","ngModel"],[1,"analysis-options"],[1,"options-title"],[1,"option-cards"],[1,"option-card","glass",3,"click"],[1,"option-checkbox"],[1,"fas","fa-chart-bar"],[1,"fas","fa-file-alt"],[1,"fas","fa-check-circle"],[1,"fas","fa-star"],[1,"action-button"],["id","analyze-btn",1,"btn","btn-primary",3,"click","disabled"],[1,"spinner"],[1,"file-chip"],[1,"remove-file",3,"click"],[1,"error-message"]],template:function(e,i){if(e&1){let s=Ss();L(0,"section",2)(1,"div",3)(2,"h3"),j(3,"Enter Api key "),L(4,"a",4),ct(5,"i",5),B()(),ct(6,"br"),L(7,"form",6),ht("ngSubmit",function(){return Ct(s),Et(i.validateKey())}),L(8,"div",7)(9,"div",8),ct(10,"input",9),L(11,"span",10),j(12),B()(),L(13,"button",11),ai(14,gc,1,0,"div",12)(15,mc,2,0,"span",13),B()()(),L(16,"div",14)(17,"div",15)(18,"h3"),j(19,"Upload Your Resume"),B(),L(20,"div",16),ht("click",function(){Ct(s);let a=Pr(27);return Et(a.click())}),ct(21,"i",17),L(22,"p"),j(23,"Click here and upload single file"),B(),L(24,"span"),j(25,"Supports PDF files only (Max size: 5MB)"),B()(),L(26,"input",18,0),ht("change",function(a){return Ct(s),Et(i.handleFile(a))}),B(),ai(28,bc,6,1,"div",19)(29,_c,2,1,"p",20),B(),L(30,"div",21)(31,"h3"),j(32,"Job Description (Needed for Job Match and Overall fedback)"),B(),L(33,"textarea",22),Fr("ngModelChange",function(a){return Ct(s),Or(i.jobDescription,a)||(i.jobDescription=a),Et(a)}),B()()(),L(34,"div",23)(35,"div",24)(36,"h2"),j(37,"Select Analysis Options"),B()(),L(38,"div",25)(39,"div",26),ht("click",function(){return Ct(s),Et(i.toggleOption("ats_score"))}),ct(40,"div",27)(41,"i",28),L(42,"h4"),j(43,"ATS Score"),B(),L(44,"p"),j(45,"See how well your resume passes through Applicant Tracking Systems."),B()(),L(46,"div",26),ht("click",function(){return Ct(s),Et(i.toggleOption("structure"))}),ct(47,"div",27)(48,"i",29),L(49,"h4"),j(50,"Resume Structure"),B(),L(51,"p"),j(52,"Get feedback on your resume's formatting, organization, and content."),B()(),L(53,"div",26),ht("click",function(){return Ct(s),Et(i.toggleOption("match"))}),ct(54,"div",27)(55,"i",30),L(56,"h4"),j(57,"Job Match"),B(),L(58,"p"),j(59,"Analyze how well your resume matches the specific job requirements."),B()(),L(60,"div",26),ht("click",function(){return Ct(s),Et(i.toggleOption("overall"))}),ct(61,"div",27)(62,"i",31),L(63,"h4"),j(64,"Overall Feedback"),B(),L(65,"p"),j(66,"Comprehensive analysis including all three metrics above."),B()()()(),L(67,"div",32)(68,"button",33,1),ht("click",function(){return Ct(s),Et(i.analyzeResume())}),ai(70,yc,1,0,"div",12)(71,vc,2,0,"span",13),B()()()()}e&2&&(tt(7),Dt("formGroup",i.apiKeyForm),tt(4),Dt("ngClass",i.validationInfo.valid?"success-message":"error-message"),tt(),kr(" ",i.validationInfo.message," "),tt(),Dt("disabled",i.apiKeyForm.invalid||i.isValidateResumeLoading),tt(),Dt("ngIf",i.isValidateResumeLoading),tt(),Dt("ngIf",!i.isValidateResumeLoading),tt(13),Rr(i.selectedFile?28:-1),tt(),Dt("ngIf",i.errorMessage),tt(4),Dr("ngModel",i.jobDescription),tt(6),jt("selected",i.analysisOptions.ats_score),tt(7),jt("selected",i.analysisOptions.structure),tt(7),jt("selected",i.analysisOptions.match),tt(7),jt("selected",i.analysisOptions.overall),tt(8),Dt("disabled",i.analysisLoading),tt(2),Dt("ngIf",i.analysisLoading),tt(),Dt("ngIf",!i.analysisLoading))},dependencies:[Hr,Vr,Br,ao,eo,bs,qa,Xa,Er,Sr,ro,Cr],styles:['.upload-section[_ngcontent-%COMP%]{padding:20px 0 0}#analyze-btn[_ngcontent-%COMP%]{font-size:large}.upload-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:30px;margin-bottom:40px}@media (max-width: 768px){.upload-container[_ngcontent-%COMP%]{grid-template-columns:1fr}}.upload-box[_ngcontent-%COMP%], .job-description[_ngcontent-%COMP%]{padding:30px;height:100%;display:flex;flex-direction:column}.upload-box[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], .job-description[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:20px;color:#333}.file-upload[_ngcontent-%COMP%]{border:2px dashed rgba(255,255,255,.5);border-radius:10px;padding:40px 20px;text-align:center;cursor:pointer;transition:all .3s ease;margin-bottom:20px;flex-grow:1;display:flex;flex-direction:column;justify-content:center;align-items:center}.file-upload[_ngcontent-%COMP%]:hover{border-color:#6a11cb80;background:#ffffff1a}.file-upload[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:3rem;margin-bottom:15px;color:#6a11cb}.file-upload[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:10px;font-weight:500}.file-upload[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.9rem;color:#666}#file-input[_ngcontent-%COMP%]{display:none}.file-chips[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:10px;margin-top:20px}.file-chip[_ngcontent-%COMP%]{display:flex;align-items:center;background:#ffffff4d;padding:8px 15px;border-radius:30px;font-size:.9rem;animation:fadeIn .3s ease-in-out}.file-chip[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-right:10px;max-width:150px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.remove-file[_ngcontent-%COMP%]{background:#ffffff80;border:none;width:20px;height:20px;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:.8rem;transition:all .2s ease}.remove-file[_ngcontent-%COMP%]:hover{background:#f003}.job-description[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{width:100%;height:100%;min-height:200px;padding:15px;border-radius:10px;border:1px solid rgba(255,255,255,.3);background:#ffffff1a;backdrop-filter:blur(5px);-webkit-backdrop-filter:blur(5px);resize:none;color:#333;font-size:1rem;transition:all .3s ease}.job-description[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:#6a11cb80;background:#fff3}.analysis-options[_ngcontent-%COMP%]{margin-bottom:40px}.options-title[_ngcontent-%COMP%]{text-align:center;margin-bottom:30px}.option-cards[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px}.option-card[_ngcontent-%COMP%]{padding:25px;text-align:center;cursor:pointer;position:relative;overflow:hidden}.option-card.selected[_ngcontent-%COMP%]{background:#fff;box-shadow:0 8px 32px #1f268733}.option-card[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:2.5rem;margin-bottom:15px;background:linear-gradient(135deg,#6a11cb,#2575fc);-webkit-background-clip:text;background-clip:text;color:transparent}.option-card[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin-bottom:10px;font-size:1.2rem}.option-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.9rem;color:#555}.option-checkbox[_ngcontent-%COMP%]{position:absolute;top:15px;right:15px;width:22px;height:22px;background:#ffffff4d;border-radius:50%;display:flex;align-items:center;justify-content:center;transition:all .3s ease}.option-card.selected[_ngcontent-%COMP%]   .option-checkbox[_ngcontent-%COMP%]{background:linear-gradient(135deg,#6a11cb,#2575fc)}.option-checkbox[_ngcontent-%COMP%]:after{content:"";width:10px;height:10px;border-radius:50%;background:#fff;opacity:0;transition:all .2s ease}.option-card.selected[_ngcontent-%COMP%]   .option-checkbox[_ngcontent-%COMP%]:after{opacity:1}.action-button[_ngcontent-%COMP%]{text-align:center;margin-bottom:80px}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:10px;margin-bottom:20px;width:100%}@media (max-width: 600px){.form-group[_ngcontent-%COMP%]{flex-direction:column}}.input-wrapper[_ngcontent-%COMP%]{position:relative;flex-grow:1}input[_ngcontent-%COMP%]{width:100%;padding:12px 15px;border:2px solid #e0e6ed;border-radius:6px;font-size:16px;transition:border-color .3s;outline:none;background:transparent}input[_ngcontent-%COMP%]:focus{border-color:#3498db}.button[_ngcontent-%COMP%]{padding:12px 24px;background:linear-gradient(135deg,#6a11cb,#2575fc);color:#fff;border:none;border-radius:50px;font-size:16px;cursor:pointer;transition:background-color .3s;display:flex;align-items:center;justify-content:center;min-width:100px;height:50px}.button[_ngcontent-%COMP%]:disabled, .btn-primary[_ngcontent-%COMP%]:disabled{background-color:#95a5a6;cursor:not-allowed}.spinner[_ngcontent-%COMP%]{width:20px;height:20px;border:3px solid rgba(255,255,255,.3);border-radius:50%;border-top-color:#fff;animation:_ngcontent-%COMP%_spin 1s ease-in-out infinite;margin-right:10px}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.message[_ngcontent-%COMP%]{display:block;margin-top:10px;font-size:14px}.error-message[_ngcontent-%COMP%]{color:#e74c3c}.success-message[_ngcontent-%COMP%]{color:#048c3e}[data-tooltip][_ngcontent-%COMP%]{position:relative;cursor:pointer;font-size:small}[data-tooltip][_ngcontent-%COMP%]:hover:after{display:block;position:absolute;content:attr(data-tooltip);background:#ffffff40;padding:.45em;white-space:nowrap;bottom:120%;left:100%;transform:translate(-10%);font-family:Inter,sans-serif;font-size:12px;margin-bottom:5px}']})};var ws=class r{scrollToStart(t){t.preventDefault();let e=document.getElementById("start");e&&e.scrollIntoView({behavior:"smooth"})}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=de({type:r,selectors:[["app-heading-section"]],decls:9,vars:0,consts:[[1,"hero"],[1,"container"],[1,"btn","btn-primary",3,"click"],[1,"fas","fa-arrow-right",2,"margin-left","10px"]],template:function(e,i){e&1&&(L(0,"section",0)(1,"div",1)(2,"h1"),j(3,"Smart Resume Analysis With ATS Scoring"),B(),L(4,"p"),j(5,"Optimize your resume for Applicant Tracking Systems. Upload your resume, paste the job description, and get detailed feedback to improve your chances of landing an interview."),B(),L(6,"div",2),ht("click",function(n){return i.scrollToStart(n)}),j(7,"Get Started "),ct(8,"i",3),B()()())},styles:[".hero[_ngcontent-%COMP%]{padding:50px 0 25px;text-align:center}.hero[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:3rem;margin-bottom:20px;background:linear-gradient(135deg,#1a1a1a,#4a4a4a);-webkit-background-clip:text;background-clip:text;color:transparent}.hero[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.2rem;max-width:700px;margin:0 auto 40px;color:#333;line-height:1.6}@media (max-width: 992px){.hero[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2.5rem}.hero[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.1rem}}@media (max-width: 768px){.hero[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2rem}.hero[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1rem}}@media (max-width: 576px){.hero[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.5rem}}"]})};var lo=class r{static \u0275fac=function(e){return new(e||r)};static \u0275cmp=de({type:r,selectors:[["app-home"]],decls:2,vars:0,template:function(e,i){e&1&&ct(0,"app-heading-section")(1,"app-upload-section")},dependencies:[ws,As],encapsulation:2})};export{lo as HomeComponent};
